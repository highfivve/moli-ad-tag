/* ad tag library 5.3.9 by highfivve.com */
"use strict";(()=>{var bi=Object.defineProperty,hi=Object.defineProperties;var vi=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var At=(r,e,t)=>e in r?bi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,v=(r,e)=>{for(var t in e||(e={}))Pt.call(e,t)&&At(r,t,e[t]);if(we)for(var t of we(e))Ct.call(e,t)&&At(r,t,e[t]);return r},T=(r,e)=>hi(r,vi(e));var Rt=(r,e)=>{var t={};for(var i in r)Pt.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&we)for(var i of we(r))e.indexOf(i)<0&&Ct.call(r,i)&&(t[i]=r[i]);return t};var Mt=(r,e,t)=>new Promise((i,n)=>{var o=u=>{try{a(t.next(u))}catch(p){n(p)}},s=u=>{try{a(t.throw(u))}catch(p){n(p)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(o,s);a((t=t.apply(r,e)).next())});var Ii=r=>{let e=r.indexOf("=");if(e>=0){let t=decodeURIComponent(r.slice(0,e)),i=decodeURIComponent(r.slice(e+1));return[t,i]}else return[decodeURIComponent(r),""]},ve=r=>{try{let e=r.startsWith("?")?r.slice(1):r;return e.length>0?new Map(e.split("&").filter(t=>t.length>0).map(Ii)):new Map}catch(e){return console.error(e),new Map}};var Be=(r,e)=>{let t=[],i,n=typeof r.document=="object"&&r.document,o=n&&n.documentElement.doScroll,s="DOMContentLoaded",a=n&&(o?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);!a&&n&&n.addEventListener(s,i=()=>{if(n)for(n.removeEventListener(s,i),a=!0;i=t.shift();)i()}),a?setTimeout(e,0):t.push(e)};var pt=class{constructor(e){this.window=e}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,t);case 1:return this.loadAssetViaTag(e,t)}})}loadJson(e,t){return this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(i=>i.ok?i.json():i.text().then(n=>Promise.reject(`${i.statusText}: ${n}`))).catch(i=>Promise.reject(i))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then(i=>i.ok?Promise.resolve(i):Promise.reject(i)).then(i=>i.text()).then(i=>this.scriptTagWithBody(i)).then(i=>t.appendChild(i))}scriptTagWithBody(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){let i=this.scriptTag(e);return new Promise((n,o)=>{i.onload=n,i.onerror=o,t.appendChild(i)})}scriptTag(e){let t=this.window.document.createElement("script");return e.type==="module"?t.type="module":e.type==="nomodule"?(t.type="text/javascript",t.setAttribute("nomodule","")):e.assetUrl.endsWith("mjs")?t.type="module":t.type="text/javascript",t.async=!0,t.src=e.assetUrl,t}awaitDomReady(){return new Promise(e=>{Be(this.window,e)})}},De=r=>new pt(r);function Si(r){try{let e="moliDebug";return!!ve(r.location.search).get(e)||!!r.sessionStorage.getItem(e)||!!r.localStorage.getItem(e)}catch(e){return!1}}function Ai(){let r=()=>{};return{debug:r,info:r,warn:r,error:console.error}}function Q(r){return`background:${r}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function qe(r){switch(r){case"debug":return Q("#49A0CC");case"info":return Q("#61A172");case"warn":return Q("#FFC300");case"error":return Q("#C70039")}}function Ue(r){switch(r){case"AdPipeline":return Q("#74ABC6");case"GAM":return Q("#BA0E5F");case"MoliGlobal":return Q("#403073");case"Prebid":return Q("#4357AD");case"AdVisibilityService":return Q("#d5ba3c");case"UserActivityService":return Q("#19ad0e");case"Adex DMP":return Q("#003E74");default:return Q("#052E53")}}function ie(){return{debug(r,e,...t){console.debug(`%c[DEBUG]%c${r}%c${e}`,qe("debug"),Ue(r),"",...t)},info(r,e,...t){console.info(`%c[INFO]%c${r}%c${e}`,qe("info"),Ue(r),"",...t)},warn(r,e,...t){console.warn(`%c[WARN]%c${r}%c${e}`,qe("warn"),Ue(r),"",...t)},error(r,e,...t){console.error(`%c[ERROR]%c${r}%c${e}`,qe("error"),Ue(r),"",...t)}}}function B(r,e){return Si(e)?ie():r&&r.logger?r.logger:Ai()}var Le=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}};var _e=(r,e,t,i)=>{let n=r.slots.find(o=>o.domId===e);if(n){let o=T(v({},n),{domId:t});return T(v({},r),{slots:[...r.slots,o]})}else return i.error("MoliGlobal","no infinite ad slot configured!",r),r};function ge(r){return r.reduce((e,t)=>e.concat(t),[])}function G(r,e,t){return t.indexOf(r)===e}function V(r){return r!=null}var Ce=(r,e,t)=>{let i=["mobile","desktop","android","ios"],n=e.some(d=>i.indexOf(d)>-1),o=r.filter(d=>t.matchMedia(d.mediaQuery).matches),s=[...n?[]:ge(o.map(d=>d.labelsSupported)),...e].filter(G);return{filterSlot:d=>{var y,c;let m=!0;return s.length&&((y=d.labelAll)!=null&&y.length)&&(m=d.labelAll.every(l=>s.indexOf(l)>-1)),s.length&&d.labelAny&&!((c=d.labelAll)!=null&&c.length)&&(m=d.labelAny.some(l=>s.indexOf(l)>-1)),m},getSupportedLabels:()=>s,getDeviceLabel:()=>s.find(d=>i.indexOf(d)>-1)||"mobile"}},ct=(r,e,t,i)=>Ce(t!=null?t:[],[...(i==null?void 0:i.labels)||[],...e.labels],r).getDeviceLabel();var R;(t=>{let r;(o=>{let i;(b=>(b[b.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",b[b.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",b[b.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",b[b.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",b[b.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",b[b.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",b[b.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",b[b.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",b[b.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",b[b.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",b[b.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(i=o.TCPurpose||(o.TCPurpose={}));let n;(p=>(p[p.NOT_ALLOWED=0]="NOT_ALLOWED",p[p.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",p[p.REQUIRE_LI=2]="REQUIRE_LI"))(n=o.RestrictionType||(o.RestrictionType={}))})(r=t.responses||(t.responses={}));let e;(s=>{let i;(d=>(d.VISIBLE="visible",d.HIDDEN="hidden",d.DISABLED="disabled"))(i=s.DisplayStatus||(s.DisplayStatus={}));let n;(m=>(m.STUB="stub",m.LOADING="loading",m.LOADED="loaded",m.ERROR="error"))(n=s.CmpStatus||(s.CmpStatus={}));let o;(d=>(d.TC_LOADED="tcloaded",d.CMP_UI_SHOWN="cmpuishown",d.USER_ACTION_COMPLETE="useractioncomplete"))(o=s.EventStatus||(s.EventStatus={}))})(e=t.status||(t.status={}))})(R||(R={}));var Pi=R.status.EventStatus,Ci=R.status.CmpStatus,Ri=[R.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,R.responses.TCPurpose.SELECT_BASIC_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,R.responses.TCPurpose.MEASURE_AD_PERFORMANCE,R.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,R.responses.TCPurpose.APPLY_MARKET_RESEARCH,R.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],Mi=r=>!!r.gdprApplies&&Ri.some(e=>!r.purpose.consents[e]&&r.purpose.legitimateInterests[e]),Et=(r,e,t,i)=>(i==="test"&&t.info("gdprApplies is set to false in test mode!"),i==="test"||r.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:Pi.TC_LOADED,cmpStatus:Ci.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((n,o)=>{if(e.__tcfapi){let s=a=>{a.cmpStatus==="error"?o(a):(a.eventStatus==="useractioncomplete"||a.eventStatus==="tcloaded")&&(t.debug("Consent","consent ready",a),r.disableLegitimateInterest&&Mi(a)?o("user consent is missing for some purposes"):n(a),a.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},a.listenerId))};e.__tcfapi("addEventListener",2,s)}else o("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var fe=r=>{if(r){let[e,t,i]=r.split(".").reverse();switch(`${t}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${i}.${t}.${e}`;default:return t?`${t}.${e}`:e}}else return};var Ve=r=>{let[e,t,...i]=r.split("/"),[n,...o]=t.split(",");return o.length===0?r:["",n,...i].join("/")},W=(r,e)=>{let t=/[^{]+(?=})/g,i=/([A-Za-z0-9\_]+)/g,n=r.match(t);return!e||!n?r:(n.forEach(o=>{if(!o.match(i))throw new SyntaxError(`invalid variable "${o}" in path`);if(!e[o])throw new ReferenceError(`path variable "${o}" is not defined`)}),r.replace(new RegExp(Object.keys(e).map(o=>`{${o}}`).join("|"),"g"),o=>e[o.substr(1,o.length-2)]))},Tt=(r,e)=>r.split("/").slice(0,e+1).join("/"),xt=(r,e,t,i)=>v({device:e,domain:i||fe(r)||"unknown"},t);var Ot=r=>{var e;return typeof((e=r.crypto)==null?void 0:e.randomUUID)=="function"?r.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let i=Math.random()*16|0;return(t==="x"?i:i&3|8).toString(16)})};var Ei=R.responses.TCPurpose,Ne=100,J=10,U=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),N=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),oe=(r,e)=>{Object.defineProperty(e,"name",{value:r});let t=0;return N(r,(i,n)=>t!==i.f?(t=i.f,e(i,n)):Promise.resolve())},wt=(r,e)=>(Object.defineProperty(e,"name",{value:r}),N(r,(t,i)=>t.f===1&&t.c===1?e(t,i):Promise.resolve())),j=(r,e,t)=>{let i=Object.assign(t,{priority:e});return Object.defineProperty(t,"name",{value:r}),i},ze=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),Ie=class{constructor(e,t,i,n){this.config=e;this.logger=t;this.window=i;this.auction=n;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,t)=>{let i=new Map;return this.config.prepareRequestAds.forEach(n=>{let o=i.get(n.priority);o?o.push(n):i.set(n.priority,[n])}),Array.from(i.entries()).sort(([n],[o])=>n>o?-1:1).reduce((n,[o,s])=>n.then(()=>(e.t.debug("AdPipeline",e.c,`run prepareRequestAds with priority ${o}`),Promise.all(s.map(a=>a(e,t))))),Promise.resolve(void 0))}}run(e,t,i,n,o){if(e.length===0)return Promise.resolve();this.requestId=this.requestId+1;let s=this.requestId,a=Ot(this.window);this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${n}. call. AuctionId ${a}`,e);let u=t.consent||{};return this.tcData=this.tcData?this.tcData:Et(u,this.window,this.logger,i.environment),this.tcData.then(p=>{var b,I,S;let d=[...((b=t.targeting)==null?void 0:b.labels)||[],...i.labels];p.gdprApplies&&p.purpose.consents[Ei.STORE_INFORMATION_ON_DEVICE]?d.push("purpose-1"):p.gdprApplies||d.push("purpose-1");let m=Ce(t.labelSizeConfig||[],d,this.window),y=o&&((I=t.buckets)!=null&&I.bucket)&&t.buckets.bucket[o]?t.buckets.bucket[o]:null,c=xt(this.window.location.hostname,m.getDeviceLabel(),(S=t.targeting)==null?void 0:S.adUnitPathVariables,t.domain),l=v(v({},c),i.adUnitPathVariables),f={I:a,c:s,f:n,t:this.logger,i:i.environment||"production",r:t,l:i,u:m,e:this.window,o:p,b:y,m:l,g:this.auction,p:De(this.window)};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(A=>A(f))));let g="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(A=>A(f,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(f,e))).then(A=>A.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(f,A)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(E=>E(f,A)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(f,A)):Promise.reject(g)).catch(A=>{switch(A){case g:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",A),Promise.reject(A)}})})}getAuction(){return this.auction}logStage(e,t){return new Promise(i=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),i()})}};var je=(r,e)=>r[0]===e[0]&&r[1]===e[1];var X=class{constructor(e,t,i){this.sizeConfig=e;this.supportedLabels=t;this.window=i;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:e.filter(t=>this.supportedSizes.some(i=>i==="fluid"?t==="fluid":t==="fluid"?!1:je(t,i))):[];this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every(i=>t.some(n=>n===i)))&&(!e.labelNone||!e.labelNone.some(i=>t.some(n=>n===i)));let n=e.length!==0?e.filter(o=>i.matchMedia(o.mediaQuery).matches&&this.areLabelsMatching(o,t)):[];this.isValid=e.length===0||!(e.length>0&&n.length===0),this.supportedSizes=ge(n.map(o=>o.sizesSupported)).map(o=>JSON.stringify(o)).filter(G).map(o=>JSON.parse(o))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var ee={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:r=>`moli-test-slot-size-${r}`,debugDelay:"moli-debug-delay"};var ye=(r,e=localStorage)=>{try{return e.getItem(r)}catch(t){return ie().debug(`Could not read value with key ${r} from browser storage`,e),null}},Re=(r,e,t=localStorage)=>{try{t.setItem(r,e)}catch(i){ie().debug(`Could not set key ${r} with value ${e} to browser storage`,t)}};var Ti=r=>r==="hidden"||Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number",Dt=r=>`${r}__container`,Fe=(r,e)=>{let t=ki(r,e);return t.forEach(({slot:i,container:n})=>{n.innerHTML="",n.appendChild(wi(i))}),t};var xi=(r,e)=>{let t=document.getElementById(r);t&&(t.innerHTML=e)},ki=(r,e)=>(e.forEach(t=>{let{moliSlot:i}=t,n=Dt(i.domId),o=document.createElement("div");o.id=n;let s=document.getElementById(i.domId);s&&s.setAttribute("data-google-query-id","test"),xi(i.domId,o.outerHTML),r.t.debug("GAM",`Set content for slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath}`)}),Oi(e)),Oi=r=>r.map(e=>{let t=document.getElementById(Dt(e.moliSlot.domId));return t?{slot:e,container:t}:void 0}).filter(V),wi=r=>{let e=Bi(r),t=Di(r.moliSlot,e);if(t==="hidden")return document.createElement("div");{let i=document.createElement("div"),[n,o]=t;i.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${n}px; height: ${o}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${r.moliSlot.domId}</strong>`,i.appendChild(s);let a=document.createElement("span");a.style.color="#656565";let u=([g,b])=>a.innerText=`(${g}x${b})`;u([n,o]),s.appendChild(a);let p=document.createElement("div");p.style.cssText="position: absolute; top: 5px; left: 5px",i.appendChild(p);let d=(g,b)=>{if(g==="hidden")i.style.display="none";else{let[I,S]=g;i.style.width=`${I}px`,i.style.height=`${S}px`,u(g),f(b)}qi(r.moliSlot,g)},m="1px dotted white",y="1px solid black",c=document.createElement("button");c.innerText="hide",c.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",c.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${m};`,c.addEventListener("click",()=>d("hidden",c));let l=[...e.map(g=>{let[b,I]=g,S=qt(t,g),A=document.createElement("button");return A.innerText=`${b}x${I}`,A.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${S?y:m};`,A.addEventListener("click",()=>d(g,A)),A}),c];l.forEach(g=>p.appendChild(g));let f=g=>{l.forEach(b=>b.style.border=m),g.style.border=y};return i}},Bi=r=>r.filterSupportedSizes(r.moliSlot.sizes).filter(X.isFixedSize).filter(([e,t])=>e>1&&t>1),Di=(r,e)=>{let t=Ui(r);if(t&&(t==="hidden"||Li(e,t)))return t;{let i=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[i]}},qi=(r,e)=>Re(ee.testSlotSize(r.domId),JSON.stringify(e)),Ui=r=>{let e=ye(ee.testSlotSize(r.domId));if(e)try{let t=JSON.parse(e);return Ti(t)?t:void 0}catch(t){return}},qt=(r,e)=>{let[t,i]=r,[n,o]=e;return t===n&&i===o},Li=(r,e)=>r.some(t=>qt(t,e));var _i=(r,e)=>({setCollapseEmptyDiv(){},addService(t){},getSlotElementId(){return r},getAdUnitPath(){return e},setTargeting(t,i){return this},getTargeting(t){return[]},getTargetingKeys(){return[]},clearTargeting(t){},getResponseInformation(){return null}}),Ut=(r,e,t)=>{var o;let i=t?t.keyValues:{},n=(o=t==null?void 0:t.adManagerExcludes)!=null?o:[];[i,e].forEach(s=>{Object.keys(s).filter(a=>!n.includes(a)).forEach(a=>{let u=s[a];u&&r.googletag.pubads().setTargeting(a,u)})})},Lt=(r,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!r.gdprApplies||r.vendor.consents[755]&&r.purpose.consents[R.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[R.responses.TCPurpose.SELECT_BASIC_ADS,R.responses.TCPurpose.MEASURE_AD_PERFORMANCE,R.responses.TCPurpose.APPLY_MARKET_RESEARCH,R.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(t=>r.purpose.consents[t]||r.purpose.legitimateInterests[t]),_t=()=>{let r;return U("gpt-init",e=>e.i==="test"?Promise.resolve():(r||(r=new Promise(t=>{e.t.debug("GAM","init googletag stub"),e.e.googletag=e.e.googletag||{},e.e.googletag.cmd=e.e.googletag.cmd||[],e.e.googletag.cmd.push(t),e.p.loadScript({name:"gpt",loadMethod:1,assetUrl:Lt(e.o,e.r.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(i=>e.t.error("failed to load gpt.js",i))})),r))},Vt=()=>{let r=0;return N("gpt-destroy-ad-slots",(e,t)=>{var i;if(e.i==="test")return Promise.resolve();if(((i=e.r.spa)==null?void 0:i.destroyAllAdSlots)===!1){let n=e.e.googletag.pubads().getSlots(),o=t.map(s=>n.find(a=>a.getSlotElementId()===s.domId)).filter(V);o.length===0?e.t.debug("GAM","no ad slots to destroy"):(e.t.debug("GAM",`destroy ${o.length} ad slots`,o),e.e.googletag.destroySlots(o))}else r!==e.f&&(r=e.f,e.t.debug("GAM","destroy all ad slots"),e.e.googletag.destroySlots());return Promise.resolve()})},Nt=()=>oe("gpt-reset-targeting",r=>new Promise(e=>{r.i==="production"&&(r.t.debug("GAM","reset top level targeting"),r.e.googletag.pubads().clearTargeting(),Ut(r.e,r.l.keyValues,r.r.targeting)),e()})),zt=()=>{let r;return N("gpt-configure",(e,t)=>(r||(r=new Promise(i=>{var o;let n=e.l.environment||"production";switch(e.t.debug("GAM","configure googletag"),n){case"production":Ut(e.e,e.l.keyValues,e.r.targeting),e.e.googletag.pubads().enableAsyncRendering(),e.e.googletag.pubads().disableInitialLoad(),e.e.googletag.pubads().enableSingleRequest(),(o=e.r.gpt)!=null&&o.pageSettingsConfig&&e.e.googletag.setConfig(e.r.gpt.pageSettingsConfig);let s=!Lt(e.o,e.r.consent);e.t.debug("GAM","use limited ads",s),e.e.googletag.pubads().setPrivacySettings({limitedAds:s}),e.e.googletag.enableServices(),i();return;case"test":i();return}})),r))},jt=()=>j("gpt-device-label-keyValue",J,r=>r.i==="test"?Promise.resolve():new Promise(e=>{let t=r.u.getDeviceLabel();r.t.debug("GAM",'adding "device_label" key-value with values',t),r.e.googletag.pubads().setTargeting("device_label",t),e()})),Ft=()=>j("gpt-consent-keyValue",J,r=>r.i==="test"?Promise.resolve():new Promise(e=>{let t=r.o,i=!t.gdprApplies||[R.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,R.responses.TCPurpose.SELECT_BASIC_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,R.responses.TCPurpose.MEASURE_AD_PERFORMANCE,R.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,R.responses.TCPurpose.APPLY_MARKET_RESEARCH,R.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(n=>t.purpose.consents[n]);r.e.googletag.pubads().setTargeting("consent",i?"full":"none"),e()})),$t=()=>(r,e)=>{let t=e.map(i=>{var l;let n=new X(i.sizeConfig,r.u.getSupportedLabels(),r.e),o=n.filterSupportedSizes;if(!(n.filterSlot(i)&&r.u.filterSlot(i)))return Promise.resolve(null);let s=o(i.sizes),a=W(i.adUnitPath,r.m),u=f=>{if(!r.e.document.getElementById(f)){let g=r.e.document.createElement("div");g.id=f,g.setAttribute("data-h5v-position",i.position),g.style.setProperty("display","none"),r.e.document.body.appendChild(g)}},p=()=>{switch(i.position){case"in-page":return r.e.googletag.defineSlot(a,s,i.domId);case"interstitial":return u(i.domId),r.e.googletag.defineSlot(a,s,i.domId);case"out-of-page":return u(i.domId),r.e.googletag.defineOutOfPageSlot(a,i.domId);case"out-of-page-interstitial":return r.e.googletag.defineOutOfPageSlot(a,r.e.googletag.enums.OutOfPageFormat.INTERSTITIAL);case"out-of-page-bottom-anchor":return r.e.googletag.defineOutOfPageSlot(a,r.e.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);case"out-of-page-top-anchor":return r.e.googletag.defineOutOfPageSlot(a,r.e.googletag.enums.OutOfPageFormat.TOP_ANCHOR)}},d=()=>{if(r.i==="test")return null;let f=p();return f&&r.e.googletag.display(f),f},y=(r.i==="test"?[]:r.e.googletag.pubads().getSlots()).find(f=>f.getSlotElementId()===i.domId),c=y||d();switch(r.i){case"production":if(c)return c.setCollapseEmptyDiv(((l=i.gpt)==null?void 0:l.collapseEmptyDiv)!==!1),c.addService(r.e.googletag.pubads()),r.t.debug("GAM",`Register slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath}`),Promise.resolve({moliSlot:i,adSlot:c,filterSupportedSizes:o});if(i.position==="out-of-page-interstitial"||i.position==="out-of-page-top-anchor"||i.position==="out-of-page-bottom-anchor")return r.t.warn("GAM",`${i.position} is not supported`),Promise.resolve(null);{let f=`Slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath} is already defined. You may have called requestAds() multiple times`;return r.t.error("GAM",f),Promise.reject(new Error(f))}case"test":return Promise.resolve({moliSlot:i,adSlot:_i(i.domId,i.adUnitPath),filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${r.l.environment}`)}});return Promise.all(t).then(i=>i.filter(V))},Vi=(r,e)=>{let t=r.find(({moliSlot:i})=>i.position==="interstitial");if(t&&t.adSlot.getTargeting("hb_pb").length===0){e.e.googletag.destroySlots([t.adSlot]);let n=e.e.googletag.defineOutOfPageSlot(W(t.moliSlot.adUnitPath,e.m),e.e.googletag.enums.OutOfPageFormat.INTERSTITIAL);if(n)return console.log("GAM","Display out-of-page-interstitial slot"),n.addService(e.e.googletag.pubads()),e.e.googletag.display(n),[...r.filter(({moliSlot:o})=>o.position!=="interstitial"),T(v({},t),{adSlot:n})];e.t.error("GAM","Failed to define out-of-page-interstitial slot")}return r},Gt=()=>(r,e)=>new Promise(t=>{switch(r.t.debug("GAM","requestAds"),r.i){case"test":Fe(r,e);break;case"production":let i=e.filter(({moliSlot:s,adSlot:a})=>!r.g.isSlotThrottled(s.domId,a.getAdUnitPath()));if(i.length===0)break;let n=Vi(i,r);r.e.googletag.pubads().refresh(n.map(({adSlot:s})=>s));let o=n.map(({moliSlot:s})=>`[DomID] ${s.domId} [AdUnitPath] ${s.adUnitPath}`).join(`
`);r.t.debug("GAM",`Refresh ${e.length} slot(s):
${o}`);break}t()});var le;(C=>{let r;(ce=>{let se;(te=>(te[te.Unknown=0]="Unknown",te[te.ProfessionallyProduced=1]="ProfessionallyProduced",te[te.Prosumer=2]="Prosumer",te[te.UGC=3]="UGC"))(se=ce.ContentQuality||(ce.ContentQuality={}))})(r=C.firstpartydata||(C.firstpartydata={}));let e;($=>{let se;(ae=>(ae[ae.NO=0]="NO",ae[ae.YES=1]="YES"))(se=$.Skip||($.Skip={}));let ce;(_=>(_[_.VAST_1=1]="VAST_1",_[_.VAST_2=2]="VAST_2",_[_.VAST_3=3]="VAST_3",_[_.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",_[_.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",_[_.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",_[_.VAST_4=7]="VAST_4",_[_.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",_[_.DAAST_1=9]="DAAST_1",_[_.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(ce=$.Protocol||($.Protocol={}));let Oe;(q=>(q[q.AutoPlaySoundOff=1]="AutoPlaySoundOff",q[q.AutoPlaySoundOn=2]="AutoPlaySoundOn",q[q.ClickToPlay=3]="ClickToPlay",q[q.MousOver=4]="MousOver",q[q.InViewportSoundsOn=5]="InViewportSoundsOn",q[q.InViewportSoundsOff=6]="InViewportSoundsOff"))(Oe=$.PlaybackMethod||($.PlaybackMethod={}));let he;(q=>(q[q.VPAID_1=1]="VPAID_1",q[q.VPAID_2=2]="VPAID_2",q[q.MRAID_1=3]="MRAID_1",q[q.ORMMA=4]="ORMMA",q[q.MRAID_2=5]="MRAID_2",q[q.MRAID_3=6]="MRAID_3"))(he=$.Api||($.Api={}));let gi;(re=>(re[re.InStream=1]="InStream",re[re.InBanner=2]="InBanner",re[re.InArticle=3]="InArticle",re[re.InFeed=4]="InFeed",re[re.Interstitial=5]="Interstitial"))(gi=$.Placement||($.Placement={}));let fi;(me=>(me[me.Instream=1]="Instream",me[me.AccompanyingContent=2]="AccompanyingContent",me[me.Interstitial=3]="Interstitial",me[me.NoContentStandalone=4]="NoContentStandalone"))(fi=$.Plcmt||($.Plcmt={}));let te;(k=>(k[k.AudioAdAutoPlay=1]="AudioAdAutoPlay",k[k.AudioAdUserInitiated=2]="AudioAdUserInitiated",k[k.ExpandableAutomatic=3]="ExpandableAutomatic",k[k.ExpandableOnClick=4]="ExpandableOnClick",k[k.ExpandableOnRollover=5]="ExpandableOnRollover",k[k.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",k[k.InBannerVideoAdClick=7]="InBannerVideoAdClick",k[k.Pop=8]="Pop",k[k.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",k[k.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",k[k.Surveys=11]="Surveys",k[k.TextOnly=12]="TextOnly",k[k.UserInteractive=13]="UserInteractive",k[k.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",k[k.HasAudioOnOffButton=15]="HasAudioOnOffButton",k[k.HasSkipButton=16]="HasSkipButton",k[k.AdobeFlash=16]="AdobeFlash"))(te=$.CreativeAttributes||($.CreativeAttributes={}));let yi;(ae=>(ae[ae.LinerInStream=1]="LinerInStream",ae[ae.NonLinearOverlay=2]="NonLinearOverlay"))(yi=$.Linearity||($.Linearity={}))})(e=C.video||(C.video={})),C.Adagio="adagio",C.AdaptMx="amx",C.Adform="adf",C.AdUp="aduptech",C.Criteo="criteo",C.ConnectAd="connectad",C.AppNexusAst="appnexusAst",C.AppNexus="appnexus",C.GumGum="gumgum",C.ImproveDigital="improvedigital",C.IndexExchange="ix",C.Invibes="invibes",C.NanoInteractive="nanointeractive",C.PubMatic="pubmatic",C.Ogury="ogury",C.OneTag="onetag",C.OpenX="openx",C.SmartAdServer="smartadserver",C.Smartx="smartx",C.Unruly="unruly",C.Teads="teads",C.TheTradeDesk="ttd",C.Triplelift="triplelift",C.Yieldlab="yieldlab",C.Seedtag="seedtag",C.Spotx="spotx",C.ShowHeroes="showheroesBs",C.StroeerCore="stroeerCore",C.StailaMedia="stailamedia",C.Xaxis="xhb",C.DSPX="dspx",C.RichAudience="ra",C.Rubicon="rubicon",C.Recognified="rads",C.Visx="visx",C.Vlyby="vlyby",C.Orbidder="orbidder"})(le||(le={}));var Wt=(r,e)=>{var t;return T(v({},r),{ext:T(v({},r.ext),{prebid:T(v({},(t=r.ext)==null?void 0:t.prebid),{storedrequest:e})})})};var Me={version:"5.3.9"};var Ht=(r,e,t={})=>({url:e,render:i=>Ni(i,r,t),backupOnly:!0}),Ni=(r,e,t={})=>{if(!r.renderer){ie().error("Can not initialize prebid outstream player, because bid.renderer is not defined");return}r.renderer.push(()=>{var i;return(i=window.outstreamPlayer)==null?void 0:i.call(window,r,e,t)})};var zi=r=>new Promise((e,t)=>{r.e.setTimeout(()=>t("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),ji=r=>new Promise(e=>r.pbjs.que.push(e)),Kt=r=>!!r.moliSlot.prebid,Fi=(r,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(t=>r.code===t.code):!1,Yt=(r,e,t)=>t.filter(Kt).map(({moliSlot:n,priceRule:o,filterSupportedSizes:s})=>{let a=o?{floors:{currency:e.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":o.floorprice}}}:null;return r.t.debug("Prebid",r.c,"Price Rule",o,n.domId,a),$i(n.prebid).map(u=>{var K,Z,ue,pe;let p=u.adUnit.mediaTypes.banner,d=u.adUnit.mediaTypes.video,m=u.adUnit.mediaTypes.native,y=p?s(p.sizes).filter(X.isFixedSize):[],c=d?Gi(d.playerSize,s):[],l=u.adUnit.bids.filter(L=>r.u.filterSlot(L)).filter(L=>!L.bidder||L.bidder&&!r.g.isBidderDisabled(n.domId,L.bidder)&&!r.g.isBidderFrequencyCappedOnSlot(n.domId,L.bidder)).map(L=>{let M=L,{labelAny:St,labelAll:h}=M;return Rt(M,["labelAny","labelAll"])}),f=c.length>0&&!(d!=null&&d.w)&&!(d!=null&&d.h)?{w:c[0][0],h:c[0][1]}:{},g=e.backupVideoRenderer,b=d?{video:v(v(T(v({},d),{playerSize:c.length===0?void 0:c}),f),g?{renderer:Ht(n.domId,g.url)}:{})}:void 0,I=p&&y.length>0?{banner:T(v({},p),{sizes:y})}:void 0,S=m?{native:v({},m)}:void 0,A=T(v({},u.adUnit.pubstack),{adUnitPath:W(((K=u.adUnit.pubstack)==null?void 0:K.adUnitPath)||n.adUnitPath,r.m)}),E=(pe=(ue=(Z=u.adUnit.ortb2Imp)==null?void 0:Z.ext)==null?void 0:ue.prebid)==null?void 0:pe.storedrequest,O=E&&E.id?T(v({},E),{id:W(E.id,r.m)}):null;return v(T(v(T(v(v({},u.adUnit),E&&O&&{ortb2Imp:Wt(u.adUnit.ortb2Imp,O)}),{code:u.adUnit.code||n.domId}),u.adUnit.pubstack?{pubstack:A}:{}),{mediaTypes:v(v(v({},b),I),S),bids:l}),a)}).filter(u=>u.bids.length>0&&u.mediaTypes&&(u.mediaTypes.banner||u.mediaTypes.video||u.mediaTypes.native)&&!Fi(u,r.e))}).reduce((n,o)=>[...n,...o],[]),Jt=r=>U("prebid-init",e=>{var i,n;e.e.pbjs=e.e.pbjs||{que:[]};let t=(i=e.r.prebid)==null?void 0:i.analyticAdapters;return t&&t.length>0&&e.e.pbjs.que.push(()=>{e.e.pbjs.enableAnalytics(t)}),e.e.pbjs.libLoaded?Promise.resolve():(n=e.r.prebid)!=null&&n.distributionUrl?(r.loadScript({name:"prebid",assetUrl:e.r.prebid.distributionUrl,loadMethod:1}),Promise.resolve()):Promise.race([ji(e.e),zi(e)])}),Xt=r=>N("prebid-remove-adunits",e=>new Promise(t=>{if(r.ephemeralAdUnits!==!0){e.e.pbjs=e.e.pbjs||{que:[]};let i=e.e.pbjs.adUnits;i&&e.e.pbjs.que.push(()=>{e.t.debug("Prebid","Destroying prebid adUnits",i),i.forEach(n=>e.e.pbjs.removeAdUnit(n.code))})}t()})),Qt=(r,e)=>{let t,i=n=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:n}});return N("prebid-configure",(n,o)=>(t||(t=new Promise(s=>{r.bidderSettings&&(n.e.pbjs.bidderSettings=r.bidderSettings),n.e.pbjs.que.push(()=>{r.config.s2sConfig&&(Array.isArray(r.config.s2sConfig)?r.config.s2sConfig:[r.config.s2sConfig]).forEach(p=>{var m,y;let d=(y=(m=p.extPrebid)==null?void 0:m.analytics)==null?void 0:y.h5v;d&&(d.configLabel=n.e.moli.configLabel,d.moliVersion=Me.version)}),n.e.pbjs.setConfig(T(v({},r.config),{schain:i([e.supplyChainStartNode]),floors:r.config.floors||{}})),r.schain.nodes.forEach(({bidder:u,node:p,appendNode:d})=>{let m=[e.supplyChainStartNode];d&&m.push(p),n.e.pbjs.setBidderConfig({bidders:[u],config:{schain:i(m)}},!0)}),n.e.pbjs.registerSignalSources&&n.e.pbjs.registerSignalSources()}),s()})),t))},$i=r=>Array.isArray(r)?r:[r],Zt=r=>j("prebid-prepare-adunits",J,(e,t)=>new Promise(i=>{r.ephemeralAdUnits||e.e.pbjs.que.push(()=>{let n=Yt(e,r,t);n.forEach(o=>{e.t.debug("Prebid",e.c,`Prebid add ad unit: [Code] ${o.code}`,o)}),e.e.pbjs.addAdUnits(n)}),i()})),er=(r,e)=>ze("prebid-request-bids",(t,i)=>{var a,u;let n=Math.max(((a=r.config.bidderTimeout)!=null?a:2e3)+3e3,(u=r.failsafeTimeout)!=null?u:0),o=new Promise(p=>t.e.setTimeout(p,n)),s=new Promise(p=>{var f;let d=i.filter(g=>!t.g.isSlotThrottled(g.moliSlot.domId,g.adSlot.getAdUnitPath())),m=r.ephemeralAdUnits?{adUnits:Yt(t,r,d)}:{adUnitCodes:d.filter(Kt).map(g=>g.moliSlot.domId)},y=m.adUnitCodes||((f=m.adUnits)==null?void 0:f.map(g=>g.code).filter(V).filter(G))||[];if(y.length===0)return t.t.debug("Prebid","skip request bids. All slots were filtered.",d.map(g=>g.moliSlot)),p();let c=!1;t.t.debug("Prebid",`Prebid request bids: 
			${y.join(`
			`)}`);let l=(g,b,I)=>{t.t.info("Prebid",I,g,i.map(S=>S.moliSlot.domId));try{if(c){t.t.warn("Prebid",`ad server request already sent [${t.c}]. AuctionId ${I}`);return}if(!g)return t.t.warn("Prebid",`Undefined bid response map for ad unit codes: ${y.join(", ")}`),p();c=!0,e==="gam"&&(t.l.adPipelineConfig.prebidBidsBackHandler.forEach(S=>S(t,g,i)),t.e.pbjs.setTargetingForGPTAsync(y)),p()}catch(S){t.t.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(S)),p()}};t.e.pbjs.que.push(()=>{var g;t.e.pbjs.requestBids(T(v({},m),{auctionId:t.I,timeout:(g=t.b)==null?void 0:g.timeout,bidsBackHandler:l}))})});return Promise.race([o,s])}),tr=()=>(r,e)=>{let t=e.map(i=>{let n=new X(i.sizeConfig,r.u.getSupportedLabels(),r.e),o=n.filterSupportedSizes;if(!(n.filterSlot(i)&&r.u.filterSlot(i)))return Promise.resolve(null);let s={getAdUnitPath:()=>i.adUnitPath};switch(r.i){case"production":return Promise.resolve({moliSlot:i,adSlot:s,filterSupportedSizes:o});case"test":return Promise.resolve({moliSlot:i,adSlot:s,filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${r.l.environment}`)}});return Promise.all(t).then(i=>i.filter(V))},rr=()=>(r,e)=>new Promise((t,i)=>{r.t.debug("Prebid","start rendering");try{switch(r.i){case"test":r.t.debug("Prebid","Rendering test slots"),Fe(r,e);break;case"production":r.e.pbjs.getHighestCpmBids().filter(n=>n&&n.adId).forEach(n=>{var s;let o=r.e.document.getElementById(n.adUnitCode);if(o){let a=document.createElement("div");a.style.setProperty("border","0pt none");let u=document.createElement("iframe");u.scrolling="no",u.frameBorder="0",u.marginHeight="0",u.marginHeight="0",u.name=`prebid_ads_iframe_${n.adUnitCode}`,u.title="3rd party ad content",u.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),u.setAttribute("aria-label","Advertisment"),u.style.setProperty("border","0"),u.style.setProperty("margin","0"),u.style.setProperty("overflow","hidden"),a.appendChild(u),o.appendChild(a);let p=(s=u.contentWindow)==null?void 0:s.document;if(p){r.e.pbjs.renderAd(p,n.adId);let d="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",m=p.createElement("style");m.appendChild(p.createTextNode(d)),p.head.appendChild(m)}else r.t.error("Prebid",`No access to iframe contentWindow for ad unit${n.adUnitCode}`)}else r.t.error("Prebid",`Could not locate ad slot with id ${n.adUnitCode}`)});break}t()}catch(n){i(n)}}),Gi=(r,e)=>{let t=i=>!!i&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number";return r?e(t(r)?[r]:r).filter(X.isFixedSize):[]};var be=R.responses.TCPurpose,Wi=r=>!!r.moliSlot.a9,ir=r=>!r.gdprApplies||r.vendor.consents[793]&&[be.STORE_INFORMATION_ON_DEVICE,be.SELECT_BASIC_ADS,be.CREATE_PERSONALISED_ADS_PROFILE,be.SELECT_PERSONALISED_ADS,be.MEASURE_AD_PERFORMANCE,be.APPLY_MARKET_RESEARCH,be.DEVELOP_IMPROVE_PRODUCTS].every(e=>r.purpose.consents[e]),or=(r,e)=>U("a9-init",t=>new Promise(i=>{t.e.apstag=t.e.apstag||{_Q:[],init:function(){t.e.apstag._Q.push(["i",arguments])},fetchBids:function(){t.e.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){t.e.apstag._Q.push(["di",arguments])},rpa:function(){t.e.apstag._Q.push(["ri",arguments])},upa:function(){t.e.apstag._Q.push(["ui",arguments])}},t.i!=="test"&&ir(t.o)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:r.scriptUrl?r.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(n=>t.t.error("failed to load apstag.js",n)),i()})),nr=(r,e)=>N("a9-configure",(t,i)=>new Promise(n=>{let o=[e.supplyChainStartNode];r.schainNode&&o.push(r.schainNode),t.e.apstag.init({pubID:r.pubID,adServer:"googletag",bidTimeout:r.timeout,gdpr:{cmpTimeout:r.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:o}}),n()})),sr=r=>wt("a9-publisher-audiences",(e,t)=>new Promise(i=>{let n=r.publisherAudience;if(n&&n.enabled){let o={hashedRecords:[{type:"email",record:n.sha256Email}]};if(e.t.debug("A9","Enable publisher audiences"),e.e.apstag.rpa(o),e.e.__tcfapi){let s=!0;e.e.__tcfapi("addEventListener",2,a=>{if(s){s=!1;return}a.eventStatus===R.status.EventStatus.USER_ACTION_COMPLETE&&(e.t.debug("A9","Update publisher audience token"),e.e.apstag.upa(o))})}}i()})),ar=()=>j("a9-clear-targeting",J,(r,e)=>r.c===0?(r.t.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(t=>{r.t.debug("A9","clear a9 targetings"),e.forEach(({adSlot:i})=>{i.getTargetingKeys().filter(n=>n==="amznp"||n==="amznsz"||n==="amznbid").forEach(n=>i.clearTargeting(n))}),t()})),Hi=(r,e,t)=>{let i=Ve(r),n=e?Tt(i,e):i;return W(n,t)},dr=r=>ze("a9-fetch-bids",(e,t)=>new Promise(i=>{var o;if(!ir(e.o)){e.t.debug("A9","Skip any due to missing consent"),i();return}let n=t.filter(Wi).filter(s=>!e.g.isSlotThrottled(s.moliSlot.domId,s.adSlot.getAdUnitPath())).filter(s=>{let a=s.moliSlot.a9.mediaType==="video",u=e.u.filterSlot(s.moliSlot.a9),p=s.filterSupportedSizes(s.moliSlot.sizes).filter(X.isFixedSize).length>0;return u&&(a||p)}).map(({moliSlot:s,priceRule:a,filterSupportedSizes:u})=>{var p,d;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let m=r.supportedSizes?s.sizes.filter(c=>{var l;return(l=r.supportedSizes)==null?void 0:l.some(f=>je(f,c))}):s.sizes,y=Hi(s.adUnitPath,(p=s.a9.slotNamePathDepth)!=null?p:r.slotNamePathDepth,e.m);return v({slotID:s.domId,slotName:y,sizes:u(m).filter(X.isFixedSize)},r.enableFloorPrices&&a?{floor:{value:Math.ceil((d=e.e.pbjs)!=null&&d.convertCurrency?e.e.pbjs.convertCurrency(a.floorprice,"EUR",r.floorPriceCurrency||"USD")*100:a.floorprice*100*1.19),currency:r.floorPriceCurrency||"USD"}}:{})}});e.t.debug("A9",`Fetch '${n.length}' A9 slots: ${n.map(s=>`[slotID] ${s.slotID}`)}`),n.length===0?i():e.e.apstag.fetchBids(v({slots:n},((o=e.b)==null?void 0:o.timeout)&&{bidTimeout:e.b.timeout}),s=>{e.e.apstag.setDisplayBids(),i()})}));var lr=(r,e)=>e?new Promise(t=>r.setTimeout(t,e)):Promise.resolve(),ur=r=>Number(ye(ee.debugDelay,r.localStorage))||void 0;var pr=(r,e,t)=>{let i=new Map;t==null||t.info(`Bidders disabling feature is ${r.enabled?"enabled":"disabled"}`);let n=(d,m)=>{var y,c,l;return(l=(c=(y=i.get(d))==null?void 0:y.get(m))==null?void 0:c.disabled)!=null?l:!1},o=d=>{var m,y;(m=d.bidderRequests)==null||m.forEach(c=>{var l;(l=c==null?void 0:c.bids)==null||l.forEach(f=>{var S,A,E;let g=f.bidder,b=f.adUnitCode;i.get(b)||i.set(b,new Map);let I=(S=i.get(b))==null?void 0:S.get(g);if(I){let O=I.bidRequestCount+1;(A=i.get(b))==null||A.set(g,T(v({},I),{bidRequestCount:O}))}else(E=i.get(b))==null||E.set(g,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),(y=d.bidsReceived)==null||y.forEach(c=>{var b,I,S;let l=c.bidderCode,f=c.adUnitCode,g=(b=i.get(f))==null?void 0:b.get(l);g?(I=i.get(f))==null||I.set(l,T(v({},g),{bidReceivedCount:g.bidReceivedCount+1})):(S=i.get(f))==null||S.set(l,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),s()},s=()=>{i.forEach((d,m)=>{d.forEach((y,c)=>{a(y)&&(u(m,c),e.setTimeout(()=>{p(m,c)},r.reactivationPeriod))})})},a=d=>d.bidRequestCount>r.minBidRequests&&d.bidReceivedCount/d.bidRequestCount<r.minRate&&!d.disabled,u=(d,m)=>{var c;let y=(c=i.get(d))==null?void 0:c.get(m);y&&(y.disabled=!0,t==null||t.info(`Bidder ${m} for position ${d} is now disabled.`))},p=(d,m)=>{var c;let y=(c=i.get(d))==null?void 0:c.get(m);y&&(y.disabled=!1,t==null||t.info(`Bidder ${m} for position ${d} is now enabled.`))};return{isBidderDisabled:n,onAuctionEnd:o}};var cr=(r,e)=>{let t=new Set;function i(o){let s=o.slot.getSlotElementId();(!r.includedDomIds||r.includedDomIds.length===0||r.includedDomIds.includes(s))&&(t.add(s),e.setTimeout(()=>{t.delete(s)},r.throttle*1e3))}function n(o){return t.has(o)}return{onSlotRequested:i,isThrottled:n}};var mt=(r,e)=>Math.max(r.wait-(e-r.ts),0);var mr="h5v-fc",gr=(r,e,t,i)=>{let n=new Map,o=new Map,s=0,a=r.configs.filter(c=>{var l;return!c.events||((l=c.events)==null?void 0:l.includes("bidWon"))}),u=r.configs.filter(c=>{var l;return(l=c.events)==null?void 0:l.includes("bidRequested")}),p=r.positions||[],d=()=>{if(r.persistent===!0){let c={caps:Array.from(n.values()),pCaps:Array.from(o.entries()).reduce((l,[f,g])=>T(v({},l),{[f]:g}),{}),requestAds:s};e.sessionStorage.setItem(mr,JSON.stringify(c))}},m=(c,l,f)=>{if(l.bidder===f.bidder&&l.domId===f.adUnitCode){let g=`${f.adUnitCode}:${f.bidder}`;i.debug("fc",`adding ${g}`),n.set(g,{ts:c,wait:l.blockedForMs,bid:{bidder:f.bidder,adUnitCode:f.adUnitCode}}),e.setTimeout(()=>{i.debug("fc",`removing ${g}`),n.delete(g)},l.blockedForMs)}},y=(c,l,f)=>{var b;let g=(b=o.get(l))!=null?b:[];g.push({ts:c,wait:f.intervalInMs}),o.set(l,g),e.setTimeout(()=>{let I=o.get(l);I&&o.set(l,I.filter(S=>S.ts!==c))},f.intervalInMs),d()};if(r.persistent===!0){let c=e.sessionStorage.getItem(mr);if(c)try{let l=JSON.parse(c);s=l.requestAds,l.caps.forEach(f=>{let g=mt(f,t());m(f.ts,{bidder:f.bid.bidder,domId:f.bid.adUnitCode,blockedForMs:g},f.bid)}),Object.entries(l.pCaps).forEach(([f,g])=>{g==null||g.forEach(b=>{let I=mt(b,t());y(b.ts,f,{intervalInMs:I})})})}catch(l){i.error("fc","failed to parse fc state",l)}}return{onAuctionEnd(c){u.forEach(l=>{var f;(f=c.bidderRequests)==null||f.forEach(g=>{var b;(b=g==null?void 0:g.bids)==null||b.forEach(I=>{m(t(),l,I)})})}),d()},onBidWon(c){a.forEach(l=>m(t(),l,c)),d()},onSlotRenderEnded(c){var l;if(!c.isEmpty){let f=c.slot.getAdUnitPath(),g=(l=p.find(b=>b.adUnitPath===f))==null?void 0:l.conditions.pacingInterval;g&&y(t(),f,g)}},afterRequestAds(){s++,d()},updateAdUnitPaths(c){var l;p=((l=r.positions)!=null?l:[]).map(f=>T(v({},f),{adUnitPath:W(f.adUnitPath,c)}))},isAdUnitCapped(c){return p.some(l=>{var f;return l.adUnitPath===c&&l.conditions.delay&&s<l.conditions.delay.minRequestAds||l.conditions.pacingRequestAds&&s%l.conditions.pacingRequestAds.requestAds!==0||l.conditions.pacingInterval&&((f=o.get(c))!=null?f:[]).length>=l.conditions.pacingInterval.maxImpressions})},isFrequencyCapped(c,l){return n.has(`${c}:${l}`)}}};var fr=()=>{let r=new Map,e=n=>n.reduce((o,s)=>{let{adUnitCode:a,cpm:u}=s;return o[a]||(o[a]=[]),o[a].push(u),o},{}),t=n=>{let o=e(n);r.forEach((s,a)=>{o[a]||r.delete(a)}),Object.entries(o).forEach(([s,a])=>{var p;let u=(p=i(s))!=null?p:[];r.set(s,Array.from(new Set([...a,...u])))})},i=n=>{var o;return(o=r.get(n))!=null?o:null};return{groupReceivedBidsByAdUnitCode:e,onAuctionEnd:t,getLastBidCpms:i}};var $e=(r,e,t,i={})=>{var p,d,m,y,c,l,f,g;let n=(p=i.biddersDisabling)!=null&&p.enabled?pr(i.biddersDisabling,r):void 0,o=(d=i.adRequestThrottling)!=null&&d.enabled?cr(i.adRequestThrottling,r):void 0,s=(m=i.frequencyCap)!=null&&m.enabled?gr(i.frequencyCap,r,r.Date.now,e):void 0,a=(y=i.previousBidCpms)!=null&&y.enabled?fr():void 0;r.pbjs=r.pbjs||{que:[]},r.googletag=r.googletag||{cmd:[]},((c=i.biddersDisabling)!=null&&c.enabled||(l=i.previousBidCpms)!=null&&l.enabled)&&r.pbjs.que.push(()=>{r.pbjs.onEvent("auctionEnd",b=>{var I,S;(I=i.biddersDisabling)!=null&&I.enabled&&(n==null||n.onAuctionEnd(b)),(S=i.previousBidCpms)!=null&&S.enabled&&b.bidsReceived&&(a==null||a.onAuctionEnd(b.bidsReceived))})}),(f=i.adRequestThrottling)!=null&&f.enabled&&r.googletag.cmd.push(()=>{r.googletag.pubads().addEventListener("slotRequested",b=>{o==null||o.onSlotRequested(b)})}),(g=i.frequencyCap)!=null&&g.enabled&&(r.pbjs.que.push(()=>{r.pbjs.onEvent("bidWon",b=>{i.frequencyCap&&(s==null||s.onBidWon(b))})}),r.googletag.cmd.push(()=>{r.googletag.pubads().addEventListener("slotRenderEnded",b=>{s==null||s.onSlotRenderEnded(b)})}),t.addEventListener("afterRequestAds",()=>{s==null||s.afterRequestAds()}));let u=N("GlobalAuctionContext",b=>(s==null||s.updateAdUnitPaths(b.m),Promise.resolve()));return{isSlotThrottled(b,I){return!!(o!=null&&o.isThrottled(b)||s!=null&&s.isAdUnitCapped(I))},isBidderFrequencyCappedOnSlot(b,I){var S;return(S=s==null?void 0:s.isFrequencyCapped(b,I))!=null?S:!1},getLastBidCpmsOfAdUnit(b){var I;return(I=a==null?void 0:a.getLastBidCpms(b))!=null?I:[]},isBidderDisabled(b,I){var S;return(S=n==null?void 0:n.isBidderDisabled(b,I))!=null?S:!1},configureStep(){return u}}};var Ee=r=>r!==null&&typeof r=="object"&&!Array.isArray(r);function Ge(r,...e){if(!e.length)return r;let t=e.shift();if(Ee(r)&&Ee(t))for(let i in t)Ee(t[i])?(r[i]||Object.assign(r,{[i]:{}}),Ge(r[i],t[i])):Array.isArray(t[i])?r[i]?Array.isArray(r[i])&&(r[i]=r[i].concat(t[i])):Object.assign(r,{[i]:t[i]}):Object.assign(r,{[i]:t[i]});return Ge(r,...e)}var yr=(r,e)=>e.pubads().getSlots().find(t=>t.getSlotElementId()===r.domId||t.getAdUnitPath()===r.adUnitPath),Ki=r=>{try{let e=typeof r=="string"?JSON.parse(r):Ee(r)?r:null;switch(e==null?void 0:e.event){case"h5.adunit.passback":return e.passbackOrigin&&(e.domId||e.adUnitPath)?e:null;case"h5.adunit.refresh":return e;default:return null}}catch(e){return null}},Yi=(r,e)=>{let t=e.r.slots.find(n=>n.domId===r.domId&&n.behaviour.loaded==="backfill"),i=yr(r,e.e.googletag);t&&i&&(e.t.debug("bridge",`Refresh ad slot ${r.domId}`),e.e.googletag.destroySlots([i]),e.e.moli.refreshAdSlot(r.domId,{loaded:"backfill"}).catch(n=>e.t.error("bridge",`failed to refresh ${r.domId}`,n)))},Ji=(r,e)=>{let t=yr(r,e.e.googletag),i="passback";t&&t.getTargeting(i).length===0&&(e.t.debug("passback",`Process passback for ad slot ${t.getAdUnitPath()}`),t.setTargeting(i,"true"),t.setTargeting("passbackOrigin",r.passbackOrigin),e.e.googletag.pubads().refresh([t]))},br=()=>U("bridge",r=>{var e;return(e=r.r.bridge)!=null&&e.enabled&&(r.t.debug("bridge","add message listener"),r.e.addEventListener("message",t=>{let i=Ki(t.data);if(i)switch(i.event){case"h5.adunit.passback":Ji(i,r);break;case"h5.adunit.refresh":Yi(i,r);break}})),Promise.resolve()});var Xi=r=>r.behaviour.loaded==="manual",Qi=r=>r.behaviour.loaded==="infinite",Zi=r=>r.behaviour.loaded==="backfill",gt=r=>e=>!!r.document.getElementById(e.domId)||e.position==="interstitial"||e.position==="out-of-page"||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor",vr=(r,e)=>r?typeof r=="string"?r:r[e]||"default":"default",hr=(r,e,t,i,n)=>{let{loaded:o}=v({loaded:"manual"},n);return e.slots.filter(gt(r)).filter(s=>vr(s.behaviour.bucket,t)===i&&(s.behaviour.loaded===o||s.behaviour.loaded==="infinite")).map(s=>n!=null&&n.sizesOverride?T(v({},s),{sizes:n.sizesOverride}):s)},We=class r{constructor(e,t,i,n){this.assetService=e;this.eventService=t;this.window=i;this.adPipelineConfig=n;this.requestAdsCalls=0;this.adPipeline=new Ie({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},ie(),this.window,$e(this.window,ie(),this.eventService));this.initialize=(e,t)=>{var y;let i=r.getEnvironment(t),n=e.adServer||"gam",o=n==="gam",s=((y=e.spa)==null?void 0:y.enabled)===!0;this.logger.setLogger(B(t,this.window)),this.logger.debug("AdService",`Initializing with environment ${i} and ad server ${n}`);let a=o?[_t(),br()]:[],u=o?[zt()]:[];o&&s&&u.push(Vt(),Nt());let p=[];o&&p.push(jt(),Ft());let d=[];e.prebid&&i==="production"&&(a.push(Jt(this.assetService)),u.push(Qt(e.prebid,e.schain)),s&&u.push(Xt(e.prebid)),p.push(Zt(e.prebid)),d.push(er(e.prebid,n))),e.a9&&i==="production"&&o&&(a.push(or(e.a9,this.assetService)),u.push(nr(e.a9,e.schain)),u.push(sr(e.a9)),p.push(ar()),d.push(dr(e.a9)));let m=$e(this.window,this.logger,this.eventService,e.globalAuctionContext);if(u.push(m.configureStep()),a.push(...t.adPipelineConfig.initSteps),u.push(...t.adPipelineConfig.configureSteps),p.push(...t.adPipelineConfig.prepareRequestAdsSteps),d.push(...t.adPipelineConfig.requestBidsSteps),i==="test"){let c=ur(this.window);c&&u.push(()=>lr(this.window,c))}return this.adPipeline=new Ie({init:a,configure:u,defineSlots:o?$t():tr(),prepareRequestAds:p,requestBids:d,requestAds:o?Gt():rr()},this.logger,this.window,m),new Promise(c=>{Be(this.window,()=>{this.logger.debug("DOM","dom ready"),c(e)})})};this.requestAds=(e,t)=>Mt(this,null,function*(){var u;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:i,refreshInfiniteSlots:n,refreshBuckets:o}=t,s=ct(this.window,t,e.labelSizeConfig,e.targeting),a=o.flatMap(p=>hr(this.window,e,s,p.bucket,p.options).map(d=>d.domId));this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,i,o),this.eventService.emit("beforeRequestAds",{runtimeConfig:t});try{let p=e.slots.map(d=>Xi(d)?i.includes(d.domId)||a.includes(d.domId)?d:null:Qi(d)?n.some(m=>m.artificialDomId===d.domId)?d:null:Zi(d)?null:d).filter(V).filter(gt(this.window));if((u=e.buckets)!=null&&u.enabled){let d=new Map;p.forEach(y=>{let c=vr(y.behaviour.bucket,s),l=d.get(c);l?l.push(y):d.set(c,[y])});let m=yield Promise.all(Array.from(d.entries()).map(([y,c])=>(this.logger.debug("AdPipeline",`running bucket ${y}, slots:`,c),this.adPipeline.run(c,e,t,this.requestAdsCalls).then(()=>c))));return this.eventService.emit("afterRequestAds",{state:"finished"}),ge(m)}else return yield this.adPipeline.run(p,e,t,this.requestAdsCalls),this.eventService.emit("afterRequestAds",{state:"finished"}),p}catch(p){return this.logger.error("AdPipeline","slot filtering failed",p),this.eventService.emit("afterRequestAds",{state:"error"}),Promise.reject(p)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.logger=new Le(ie()),n&&(this.adPipeline=new Ie(n,this.logger,i,$e(i,this.logger,this.eventService)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,t,i,n){if(e.length===0)return Promise.resolve();let{loaded:o}=v({loaded:"manual"},n),s=t.slots.filter(a=>e.some(u=>u===a.domId)&&(a.behaviour.loaded===o||a.behaviour.loaded==="infinite")).filter(gt(this.window)).map(a=>n!=null&&n.sizesOverride?T(v({},a),{sizes:n.sizesOverride}):a);if(e.length!==s.length){let a=s.filter(p=>e.every(d=>d!==p.domId)),u=e.filter(p=>s.every(d=>d.domId!==p));a.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",a),u.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",a)}return this.logger.debug("AdService","refresh ad slots",s),this.adPipeline.run(s,t,i,this.requestAdsCalls)}refreshBucket(e,t,i,n){var a;if(!((a=t.buckets)!=null&&a.enabled))return Promise.resolve();let o=ct(this.window,i,t.labelSizeConfig,t.targeting),s=hr(this.window,t,o,e,n);return s.length===0?(this.logger.warn("AdService","No slots found in bucket",e),Promise.resolve()):(this.logger.debug("AdService","refresh ad buckets",s,t.targeting),this.adPipeline.run(s,t,i,this.requestAdsCalls,e))}};var Ir=()=>{let r=new Map,e=new Map;return{addEventListener(t,i,n={}){var s;let o=n.once?e:r;o.has(t)||o.set(t,new Set),(s=o.get(t))==null||s.add(i)},removeEventListener(t,i){var n,o;(n=r.get(t))==null||n.delete(i),(o=e.get(t))==null||o.delete(i)},emit(t,i){var o;(o=r.get(t))==null||o.forEach(s=>{try{s(i)}catch(a){console.error(`Error in event listener for ${String(t)}:`,a)}});let n=e.get(t);n&&(n.forEach(s=>{try{s(i)}catch(a){console.error(`Error in one-time event listener for ${String(t)}:`,a)}finally{n.delete(s)}}),n.size===0&&e.delete(t))}}};var Te={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var xe=(r,e,t,i=n=>!0)=>[{source:"queryParam",value:ve(r.location.search).get(e)},{source:"sessionStorage",value:ye(t,r.sessionStorage)},{source:"localStorage",value:ye(t,r.localStorage)}].map(({source:n,value:o})=>o&&i(o)?{source:n,value:o}:void 0).filter(V);var eo=r=>!!["production","test"].find(t=>t===r),Sr=r=>xe(r,Te.moliEnv,ee.moliEnv,eo)[0]||void 0,Ar=(r,e)=>Re(ee.moliEnv,r,e);var ke=(r,e,t)=>{switch(r){case"none":return!0;case"href":return t.href===e;case"path":try{let i=new URL(e);return t.pathname===i.pathname}catch(i){return!0}}},Pr=(r,e,t)=>{switch(r){case"none":return!0;case"href":return t.href!==e;case"path":try{let i=new URL(e);return t.pathname!==i.pathname}catch(i){return!0}}};var Cr=r=>{let e=De(r),t=Ir(),i=new We(e,t,r),n=r,o={state:"configurable",initialize:!1,runtimeConfig:L(),modules:[]};function s(h,P){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.keyValues[h]=P;break}case"spa-finished":case"spa-requestAds":{o.nextRuntimeConfig.keyValues[h]=P;break}default:{B(o.runtimeConfig,r).error("MoliGlobal",`Setting key-value after configuration: ${h} : ${P}`);break}}}function a(h){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.labels.push(h);break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.labels.push(h);break}default:{B(o.runtimeConfig,r).error("MoliGlobal",`Adding label after configure: ${h}`);break}}}function u(h){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.adUnitPathVariables=h;break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.adUnitPathVariables=h;break}default:{B(o.runtimeConfig,r).error("MoliGlobal",`Setting unit path variables after configuration: ${h}`);break}}}function p(){let h=fe(r.location.hostname)||"unknown";switch(o.state){case"configurable":return T(v({},o.runtimeConfig.adUnitPathVariables),{domain:h,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let P=Ce(o.config.labelSizeConfig||[],[],r);return T(v({},g().adUnitPathVariables),{domain:o.config.domain||h,device:P.getDeviceLabel()})}}function d(h,P){let w=(P||{}).removeNetworkChildId||!1,D=W(h,p());return w?Ve(D):D}function m(h){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.logger=h;break}default:{h.error("Setting a custom logger is not allowed after configuration");break}}}function y(h){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.beforeRequestAds.push(h);break}default:{B(o.runtimeConfig,r).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",o.config);break}}}function c(h){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.afterRequestAds.push(h);break}default:{B(o.runtimeConfig,r).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",o.config);break}}}function l(){switch(o.state){case"configurable":return null;case"configured":return o.config;case"requestAds":return o.config;case"spa-requestAds":case"spa-finished":return o.config;case"finished":return o.config;case"error":return o.config}}function f(){return o.runtimeConfig}function g(){var h,P,M,w,D,F,x;return{keyValues:v(v({},(P=(h=o.config)==null?void 0:h.targeting)==null?void 0:P.keyValues),o.runtimeConfig.keyValues),labels:[...(D=(w=(M=o.config)==null?void 0:M.targeting)==null?void 0:w.labels)!=null?D:[],...o.runtimeConfig.labels],adUnitPathVariables:v(v({},(x=(F=o.config)==null?void 0:F.targeting)==null?void 0:x.adUnitPathVariables),o.runtimeConfig.adUnitPathVariables)}}function b(h){switch(o.state){case"configurable":case"configured":{o.modules.push(h);return}default:B(o.runtimeConfig,r).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function I(h){var P;switch(o.state){case"configurable":{let M=o.initialize,w=Sr(r),D=o.modules;w&&(o.runtimeConfig.environment=w.value),(w==null?void 0:w.source)==="queryParam"&&Ar(w.value,r.sessionStorage);let F=B(o.runtimeConfig,r);return F.debug("MoliGlobal","configure modules",(P=h.modules)!=null?P:{}),D.forEach(x=>{var H;try{x.n((H=h.modules)!=null?H:{}),F.debug("MoliGlobal",`configure ${x.moduleType} module ${x.name}`,x.r()),o.runtimeConfig.adPipelineConfig.initSteps.push(...x.s()),o.runtimeConfig.adPipelineConfig.configureSteps.push(...x.a()),o.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...x.d()),x.S&&o.runtimeConfig.adPipelineConfig.requestBidsSteps.push(...x.S()),x.v&&o.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.push(...x.v())}catch(z){F.error("MoliGlobal",`failed to configure ${x.moduleType} module ${x.name}`,z)}}),o={state:"configured",config:h,runtimeConfig:o.runtimeConfig,modules:D},M||h.requestAds===!0?S():Promise.resolve(o)}case"configured":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",o.config),Promise.resolve(o);case"requestAds":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(o);case"finished":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(o);case"error":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",o.error),Promise.resolve(o)}return Promise.resolve(null)}function S(){var h;switch(o.state){case"configurable":return o.initialize=!0,Promise.resolve(o);case"configured":{ue(),pe(o.config.domain);let{refreshInfiniteSlots:P}=o.runtimeConfig,M=o.config;P.length>0&&P.forEach(x=>{M=_e(M,x.idOfConfiguredSlot,x.artificialDomId,B(o.runtimeConfig,r))});let w=B(o.runtimeConfig,r);o.runtimeConfig.hooks&&o.runtimeConfig.hooks.beforeRequestAds&&o.runtimeConfig.hooks.beforeRequestAds.forEach(x=>{try{x(M,o.runtimeConfig)}catch(H){w.error("MoliGlobal","beforeRequestAds hook failed",H)}});let D=o.runtimeConfig.hooks.afterRequestAds;if(((h=M.spa)==null?void 0:h.enabled)===!0){let x=o.runtimeConfig,H=i.initialize(M,x);return o={state:"spa-requestAds",config:M,initialized:H,modules:o.modules,href:r.location.href,runtimeConfig:Object.freeze(L(o.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:L(o.runtimeConfig)},H.then(()=>i.requestAds(M,x)).then(()=>{var Y,C;let z=(C=(Y=M.spa)==null?void 0:Y.validateLocation)!=null?C:"href";if(o.state==="spa-requestAds"&&ke(z,o.href,r.location)){let{config:se,runtimeConfig:ce}=o;o.runtimeConfig.refreshSlots.length>0&&i.refreshAdSlots(ce.refreshSlots,se,ce),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(he=>{i.refreshBucket(he.bucket,se,ce,he.options)}),D.forEach(he=>he("spa-finished"));let Oe=T(v({},o),{state:"spa-finished",nextRuntimeConfig:L(o.runtimeConfig),runtimeConfig:L(o.runtimeConfig,{keepTargeting:!0})});return o=Oe,Oe}else return o.state==="spa-finished"||o.state==="spa-requestAds"?(B(o.runtimeConfig,r).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),o):Promise.reject(`reached invalid state [${o.state}]`)})}else return o={state:"requestAds",config:M,modules:o.modules,runtimeConfig:Object.freeze(o.runtimeConfig)},i.initialize(M,o.runtimeConfig).then(x=>i.requestAds(x,o.runtimeConfig)).then(()=>(o={state:"finished",config:M,runtimeConfig:o.runtimeConfig,modules:o.modules},D.forEach(x=>x("finished")),Promise.resolve(o))).catch(x=>(B(o.runtimeConfig,r).error("MoliGlobal",x),o={state:"error",config:M,runtimeConfig:o.runtimeConfig,error:x,modules:o.modules},D.forEach(H=>H("error")),Promise.resolve(o)))}case"spa-requestAds":case"spa-finished":{o.state==="spa-requestAds"&&B(o.runtimeConfig,r).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),ue(),pe(o.config.domain);let{modules:P}=o,M=o.nextRuntimeConfig.hooks.afterRequestAds,w=o.nextRuntimeConfig.hooks.beforeRequestAds,D=o;w.forEach(z=>{try{z(D.config,o.runtimeConfig)}catch(Y){B(o.runtimeConfig,r).error("MoliGlobal","beforeRequestAds hook failed",Y)}});let{initialized:F,href:x,nextRuntimeConfig:H}=o;return o=T(v({},D),{state:"spa-requestAds",runtimeConfig:L(o.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:L(o.runtimeConfig)}),F.then(z=>{var C,se;let Y=(se=(C=z.spa)==null?void 0:C.validateLocation)!=null?se:"href";return Pr(Y,x,r.location)?i.requestAds(z,H).then(()=>z):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${Y} for validation.`)}).then(z=>{let Y=o.runtimeConfig;return o.runtimeConfig.refreshSlots.length>0&&i.refreshAdSlots(o.runtimeConfig.refreshSlots,z,o.runtimeConfig),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(C=>{i.refreshBucket(C.bucket,z,Y,C.options)}),o={state:"spa-finished",config:z,initialized:F,modules:P,href:r.location.href,runtimeConfig:o.runtimeConfig,nextRuntimeConfig:L(o.runtimeConfig)},M.forEach(C=>C("spa-finished")),o})}case"requestAds":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return B(o.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",o.error),Promise.reject()}}function A(h,P){var w,D;let M=typeof h=="string"?[h]:h;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshSlots.push(...M),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshSlots.push(...M),Promise.resolve("queued");case"spa-finished":let F=(D=(w=o.config.spa)==null?void 0:w.validateLocation)!=null?D:"href";return ke(F,o.href,r.location)?i.refreshAdSlots(M,o.config,o.runtimeConfig,P).then(()=>"refreshed"):(o.nextRuntimeConfig.refreshSlots.push(...M),Promise.resolve("queued"));case"finished":case"requestAds":return i.refreshAdSlots(M,o.config,o.runtimeConfig,P).then(()=>"refreshed");default:return B(o.runtimeConfig,r).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function E(h,P){var M,w;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:h,idOfConfiguredSlot:P}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:h,idOfConfiguredSlot:P}),Promise.resolve("queued");case"spa-finished":let D=(w=(M=o.config.spa)==null?void 0:M.validateLocation)!=null?w:"href";return ke(D,o.href,r.location)?(o=T(v({},o),{config:_e(o.config,P,h,B(o.runtimeConfig,r))}),i.refreshAdSlots([h],o.config,o.runtimeConfig).then(()=>"refreshed")):(o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:h,idOfConfiguredSlot:P}),Promise.resolve("queued"));case"finished":case"requestAds":return o=T(v({},o),{config:_e(o.config,P,h,B(o.runtimeConfig,r))}),i.refreshAdSlots([h],o.config,o.runtimeConfig).then(()=>"refreshed");default:return B(o.runtimeConfig,r).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function O(h,P){var M,w;switch(o.state){case"configurable":return o.runtimeConfig.refreshBuckets.push({bucket:h,options:P}),Promise.resolve("queued");case"configured":return o.runtimeConfig.refreshBuckets.push({bucket:h,options:P}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshBuckets.push({bucket:h,options:P}),Promise.resolve("queued");case"spa-finished":{let D=(w=(M=o.config.spa)==null?void 0:M.validateLocation)!=null?w:"href";return ke(D,o.href,r.location)?i.refreshBucket(h,o.config,o.runtimeConfig,P).then(()=>"refreshed"):(o.runtimeConfig.refreshBuckets.push({bucket:h,options:P}),Promise.resolve("queued"))}case"finished":case"requestAds":return i.refreshBucket(h,o.config,o.runtimeConfig,P).then(()=>"refreshed");default:return B(o.runtimeConfig,r).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function K(){return o.state}function Z(h){switch(o.state){case"configurable":{B(o.runtimeConfig,r).error("MoliGlobal","Cannot open console before configuration");break}default:e.loadScript({assetUrl:h!=null?h:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${Me.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(P=>console.error("failed to load moli debugger",P))}}function ue(){let h="ABtest",M=ve(r.location.search).get(h),w=M?Number(M):Math.floor(Math.random()*100)+1;s(h,w.toString())}function pe(h){let P=h||fe(r.location.hostname);P&&a(P)}function L(h,P){var M,w,D,F,x,H,z,Y;return{environment:(M=h==null?void 0:h.environment)!=null?M:"production",hooks:{beforeRequestAds:(w=h==null?void 0:h.hooks.beforeRequestAds)!=null?w:[],afterRequestAds:(D=h==null?void 0:h.hooks.afterRequestAds)!=null?D:[]},logger:(F=h==null?void 0:h.logger)!=null?F:void 0,adUnitPathVariables:(P==null?void 0:P.keepTargeting)===!0?(x=h==null?void 0:h.adUnitPathVariables)!=null?x:{}:{},labels:(P==null?void 0:P.keepTargeting)===!0?(H=h==null?void 0:h.labels)!=null?H:[]:[],keyValues:(P==null?void 0:P.keepTargeting)===!0?(z=h==null?void 0:h.keyValues)!=null?z:{}:{},refreshSlots:[],refreshInfiniteSlots:[],refreshBuckets:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[],requestBidsSteps:[],prebidBidsBackHandler:(Y=h==null?void 0:h.adPipelineConfig.prebidBidsBackHandler)!=null?Y:[]}}}return{que:{push(h){h(n.moli)}},version:Me.version,setTargeting:s,addLabel:a,setLogger:m,setAdUnitPathVariables:u,resolveAdUnitPath:d,beforeRequestAds:y,afterRequestAds:c,getConfig:l,getRuntimeConfig:f,getPageTargeting:g,registerModule:b,configure:I,requestAds:S,refreshAdSlot:A,refreshBucket:O,refreshInfiniteAdSlot:E,getState:K,openConsole:Z,addEventListener:t.addEventListener,removeEventListener:t.removeEventListener}};var Rr=r=>{let e=r,t=e.moli?[...e.moli.que]:[],i=Cr(r);return e.moli=i,t.forEach(n=>n(i)),i};Rr(window);var to=r=>r==="android"?"aaid":r==="ios"?"idfa":void 0,Mr=(r,e,t,i,n,o,s,a)=>{let u=to(typeof n=="string"?n:n[0]),p=i.reduce((y,c)=>v(v({},y),c),{}),d=i.length?`&kv=${JSON.stringify(p)}`:"",m=a?`&gdpr_consent=${a}`:"";o(`https://api.theadex.com/collector/v1/ifa/c/${r}/t/${e}/request?&ifa=${t}&ifa_type=${u}${d}${m}`).catch(y=>s.error(y))};var Er=(r,e,t)=>{let i=r[e.key],n=ft(r,e.valueType,e.valueKey);if(!i||Array.isArray(i)||n===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(n)&&e.defaultValue===void 0){t.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,i,n);return}let o=Or(n,e,t);return{[e.attribute]:{[i]:o}}},Tr=(r,e,t)=>{let i=ft(r,e.adexValueType,e.key);if(i===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(i)&&e.defaultValue===void 0||Array.isArray(i))){t.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,i);return}let n=Or(i,e,t);return{[e.attribute]:n}},xr=(r,e,t)=>{let i=ft(r,"string",e.key);if(i===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof i=="number"){t.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,i);return}let n=io(i,e,t);return{[e.attribute]:n}},kr=r=>Object.fromEntries(r.sort().map(e=>[e,1])),ro=r=>r.sort().join(","),ft=(r,e,t)=>e==="number"?Number(r[t]):r[t],Or=(r,e,t)=>r!==void 0&&!Number.isNaN(r)?Array.isArray(r)?ro(r):r:wr(e,t),io=(r,e,t)=>r===void 0?wr(e,t):Array.isArray(r)?kr(r):{[r]:1},wr=(r,e)=>(e.warn("Adex DMP","using defaultValue",r.defaultValue,"as fallback for key",r.key),r.adexValueType==="list"?r.defaultValue?kr(r.defaultValue):void 0:r.defaultValue);var Br=(r,e)=>{var t;e.Utiq||(e.Utiq={queue:[]}),(t=e.Utiq).queue||(t.queue=[]),e.Utiq.queue.push(()=>{var i,n;(n=(i=e.Utiq)==null?void 0:i.API)==null||n.addEventListener("onIdsAvailable",({mtid:o})=>{e._adexc.push([`/${r.adexCustomerId}/${r.adexTagId}/`,"cm","_cm",[308,o]])})})};var ne=R.responses.TCPurpose,He=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[ne.STORE_INFORMATION_ON_DEVICE,ne.SELECT_BASIC_ADS,ne.CREATE_PERSONALISED_ADS_PROFILE,ne.SELECT_PERSONALISED_ADS,ne.CREATE_PERSONALISED_CONTENT_PROFILE,ne.SELECT_PERSONALISED_CONTENT,ne.MEASURE_AD_PERFORMANCE,ne.MEASURE_CONTENT_PERFORMANCE,ne.APPLY_MARKET_RESEARCH,ne.DEVELOP_IMPROVE_PRODUCTS].every(t=>e.purpose.consents[t]);this.getOrInitAdexQueue=e=>{let t=e;return t._adexc=t._adexc||[],t};this.getAdexKeyValues=(e,t)=>{var n;let i=v(v({},(n=e.r.targeting)==null?void 0:n.keyValues),e.l.keyValues);if(Object.keys(i).length>0)return t.mappingDefinitions.map(o=>{switch(o.adexValueType){case"map":return Er(i,o,e.t);case"list":return xr(i,o,e.t);default:return Tr(i,o,e.t)}}).filter(V)};this.configureAdexC=(e,t)=>{var o;let i=this.getOrInitAdexQueue(e.e),n=this.getAdexKeyValues(e,t);n?i._adexc.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"ut","_kv",[n.reduce((s,a)=>v(v({},s),a),{}),t.spaMode?1:0]]):e.t.warn("Adex DMP","targeting key/values are empty"),(o=t.enabledPartners)!=null&&o.includes("utiq")&&Br(t,e.e)}}r(){return this.adexConfig}n(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}s(){let e=this.adexConfig;return e?[U("DMP module setup",t=>this.track(t,e))]:[]}a(){let e=this.adexConfig;return e!=null&&e.spaMode?[N("DMP module setup",t=>(this.configureAdexC(t,e),Promise.resolve()))]:[]}track(e,t){var u,p;let{adexCustomerId:i,adexTagId:n,appConfig:o}=t;this.configureAdexC(e,t);let s=this.getAdexKeyValues(e,t),a=v(v({},(u=e.r.targeting)==null?void 0:u.keyValues),e.l.keyValues);if(this.hasRequiredConsent(e.o)&&!this.isLoaded&&Object.keys(a).length>0){this.isLoaded=!0;let d=V(o)&&V(a[o.advertiserIdKey])&&(a[o.clientTypeKey]==="android"||a[o.clientTypeKey]==="ios");if(o!=null&&o.advertiserIdKey&&d){let m=e.o.gdprApplies?e.o.tcString:void 0,y=a[o.advertiserIdKey];typeof y=="string"&&s&&Mr(i,o.adexMobileTagId?o.adexMobileTagId:n,y,s,(p=a[o.clientTypeKey])!=null?p:"",e.e.fetch,e.t,m)}else e.p.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${i}/${n}/s/adex.js`,loadMethod:1}).catch(m=>e.t.error("failed to load adex",m))}return Promise.resolve()}d(){return[]}};window.moli.registerModule(new He);var Se=class Se{constructor(e,t,i,n,o,s,a,u){this.userActivityService=e;this.refreshInterval=t;this.refreshIntervalOverrides=i;this.useIntersectionObserver=n;this.disableAdVisibilityChecks=o;this.viewabilityOverrides=s;this.window=a;this.logger=u;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var i;(i=this.logger)==null||i.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId());let t=this.observedDomElementForSlot(e);this.intersectionObserver&&t&&this.intersectionObserver.unobserve(t.target)};this.handleGoogletagAdVisibilityChanged=e=>{var n;let t=e.slot,i=this.visibilityRecordForGoogletagEvent(e);i&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${t.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(i,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,t)=>{var i,n,o;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(i=this.logger)==null||i.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}t>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(o=this.logger)==null||o.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var d;this.minimalAdVisibilityRatio=o?0:.5,this.visibilityRecords=new Map,(n||Object.values(s).some(m=>(m==null?void 0:m.variant)==="css"))&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new this.window.IntersectionObserver(m=>this.handleObservedAdVisibilityChanged(m),{threshold:this.minimalAdVisibilityRatio})),n||this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged)}),this.userActivityService.addUserActivityChangedListener(m=>this.handleUserActivityChanged(m)),this.setUpdateTimer(!0),(d=this.logger)==null||d.debug("AdVisibilityService","initialized")}trackSlot(e,t,i){var s;let n=e.getSlotElementId(),o=this.observedDomElementForSlot(e);if(o){(s=this.logger)==null||s.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(n)&&this.removeSlotTracking(e);let a=o.viewabilityOverride;this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks||(a==null?void 0:a.variant)==="disabled"&&(a.disableAllAdVisibilityChecks||!(a.disabledAdVisibilityCheckAdvertiserIds&&a.disabledAdVisibilityCheckAdvertiserIds.length>0&&i)||a.disabledAdVisibilityCheckAdvertiserIds.includes(i))?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:t}),this.intersectionObserver&&(o.targetOverride||this.useIntersectionObserver)&&this.intersectionObserver.observe(o.target)}}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),Se.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var t;if(e.latestStartVisible){let i=this.window.performance.now(),n=Math.round(i-e.latestStartVisible);e.durationVisibleSum+=n,e.latestStartVisible=i,(t=this.logger)==null||t.debug("AdVisibilityService",`added ${n}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let t=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>t}).forEach(e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-Se.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(t=>{var n;let i=this.visibilityRecordForEntry(t);i&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${i.slot.getSlotElementId()} changed. Visible area: ${t.intersectionRatio*100}%`),this.updateVisibilityRecord(i,t.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(t=>{t.latestStartVisible&&(t.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}observedDomElementForSlot(e){let t=e.getSlotElementId(),i=this.viewabilityOverrides[t],n=this.window.document.getElementById(t),o=i&&i.variant==="css"?this.window.document.querySelector(i.cssSelector):null;return o?{target:o,targetOverride:!0,viewabilityOverride:i}:n?{target:n,targetOverride:!1,viewabilityOverride:i}:null}};Se.updateVisibilityInterval=1e3,Se.consecutiveDurationToRefresh=1500;var Ke=Se;var oo=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Ae=class Ae{constructor(e,t={level:"strict"},i){this.window=e;this.userActivityLevelControl=t;this.logger=i;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var n;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(n=this.logger)==null||n.debug("UserActivityService","initialized"),t.level){case"custom":this.userActivityDuration=t.userActivityDuration,this.userBecomingInactiveDuration=t.userBecomingInactiveDuration;break;default:let{userActivityDuration:o,userBecomingInactiveDuration:s}=oo.get(t.level);this.userActivityDuration=o,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Ae.observedEvents.forEach(t=>this.window.removeEventListener(t,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Ae.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Ae.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Ae.observedEvents=["mousemove","touchstart","scroll","keypress"];var Ye=Ae;var Je=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,t,i,n)=>{if(e.i==="test"){e.t.info("AdReload","disabled in environment test");return}this.initialized||(e.t.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(t,e.e,e.t),this.setupSlotRenderListener(t,i,n,e.e,e.t),this.initialized=!0)};this.setupAdVisibilityService=(e,t,i)=>{var n,o;this.adVisibilityService=new Ke(new Ye(t,e.userActivityLevelControl,i),this.refreshIntervalMs,(n=e.refreshIntervalMsOverrides)!=null?n:{},!1,!!e.disableAdVisibilityChecks,(o=e.viewabilityOverrides)!=null?o:{},t,i)};this.setupSlotRenderListener=(e,t,i,n,o)=>n.googletag.pubads().addEventListener("slotRenderEnded",s=>{var A;let{slot:a,campaignId:u,advertiserId:p,yieldGroupIds:d,isEmpty:m}=s,y=a.getSlotElementId(),c=t.indexOf(y)>-1,l=!u||e.excludeOrderIds.indexOf(u)===-1,f=!!u&&e.includeOrderIds.indexOf(u)>-1,g=!!p&&e.includeAdvertiserIds.indexOf(p)>-1,b=!!d&&e.includeYieldGroupIds.some(E=>d.indexOf(E)>-1),I=!m&&c&&l&&(f||g||b);I||this.logTrackingDisallowedReason(y,{slotIsEmpty:m,slotIsMonitored:c,orderIdNotExcluded:l,orderIdIncluded:f,advertiserIdIncluded:g,yieldGroupIdIncluded:b},o,d,u,p);let S=!!((A=this.adVisibilityService)!=null&&A.isSlotTracked(y));I?this.adVisibilityService.trackSlot(a,i,p):S&&this.adVisibilityService.removeSlotTracking(a)});this.reloadAdSlot=(e,t)=>i=>{let n=i.getSlotElementId(),o=t.r.slots.find(s=>s.domId===n);if(o&&o.behaviour.loaded!=="infinite"){t.t.debug("AdReload","fired slot reload",o.domId);let s=this.maybeOptimizeSlotForCls(e,o,i,t.t,t.e);i.setTargeting(this.reloadKeyValue,"true");let u=(()=>{var d,m;if(((m=(d=e.viewabilityOverrides)==null?void 0:d[n])==null?void 0:m.refreshBucket)===!0){let y=o.behaviour.loaded,c=o.behaviour.bucket,l=typeof c=="string"?c:c==null?void 0:c[t.u.getDeviceLabel()];return l&&y!=="infinite"?{name:l,loaded:y}:void 0}})();u?t.e.moli.refreshBucket(u.name,{loaded:u.loaded}).then(p=>t.t.debug("AdReload",`refreshBucket '${u.name}' result`,p)).catch(p=>t.t.error("AdReload",`refreshBucket '${u.name}' failed`,p)):t.e.moli.refreshAdSlot(n,v({loaded:o.behaviour.loaded},s&&{sizesOverride:s})).catch(p=>t.t.error("AdReload",`refreshing ${n} failed`,p))}};this.maybeOptimizeSlotForCls=(e,t,i,n,o)=>{let s=t.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let a=o.document.getElementById(s);if(a&&a.style){let u=a.scrollHeight;a.style.setProperty("height",`${u}px`);let p=t.sizes.filter(d=>d!=="fluid"&&d[1]<=u);return n.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${u}px`,"new sizes:",p),p.length<t.sizes.filter(d=>d!=="fluid").length&&o.googletag.destroySlots([i]),p}n.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return t.sizes};this.logTrackingDisallowedReason=(e,t,i,n,o,s)=>{let{slotIsEmpty:a,slotIsMonitored:u,orderIdNotExcluded:p,orderIdIncluded:d,advertiserIdIncluded:m,yieldGroupIdIncluded:y}=t;a&&i.debug("AdReload",e,"slot not tracked: reported empty"),u||i.debug("AdReload",e,"slot not tracked: excluded by DOM id"),p||i.debug("AdReload",e,"slot not tracked: excluded by order id",o),d||m||y||i.debug("AdReload",e,"slot not tracked: neither order id",o,"nor advertiser id",s,"nor yieldGroup id",n,"included")}}r(){return this.moduleConfig}isInitialized(){return this.initialized}n(e){var t;(t=e==null?void 0:e.adReload)!=null&&t.enabled&&(this.moduleConfig=e.adReload)}s(){return[]}a(){let e=this.moduleConfig;return e?[N(this.name,t=>{let i=t.r.slots.filter(o=>e.excludeAdSlotDomIds.indexOf(o.domId)===-1).map(o=>o.domId).filter(V),n=this.reloadAdSlot(e,t);return t.t.debug("AdReload","monitoring slots",i),this.initialize(t,e,i,n),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new Je);var Xe=class{constructor(){this.name="Blocklist URLs";this.description="Blocks ad requests entirely or adds key-values for blocklistd urls";this.moduleType="policy";this.blocklistConfig=null;this.isBlocklisted=(e,t,i)=>e.urls.some(({pattern:n,matchType:o})=>{switch(o){case"exact":return t===n;case"contains":return t.indexOf(n)>-1;case"regex":try{let s=RegExp(n).test(t);return s&&i.debug(this.name,`Url '${t}' matched pattern '${n}'`),s}catch(s){return i.error(this.name,`Invalid pattern ${n}`,s),!1}}});this.blocklistCache=null}r(){return this.blocklistConfig}n(e){e!=null&&e.blocklist&&e.blocklist.enabled&&(this.blocklistConfig=e.blocklist)}s(){return this.blocklistConfig?[U("blocklist-urls-init",t=>{var i;switch((i=this.blocklistConfig)==null?void 0:i.mode){case"key-value":let n=this.blocklistConfig.key,o=this.blocklistConfig.isBlocklistedValue||"true";return this.getBlocklist(this.blocklistConfig.blocklist,t.p,t.t)().then(s=>{this.isBlocklisted(s,t.e.location.href,t.t)&&t.e.googletag.pubads().setTargeting(n,o)});case"block":return this.getBlocklist(this.blocklistConfig.blocklist,t.p,t.t)().then(s=>{if(t.t.debug(this.name,"using blocklist",s),this.isBlocklisted(s,t.e.location.href,t.t))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[]}getBlocklist(e,t,i){switch(e.provider){case"static":return()=>Promise.resolve(e.blocklist);case"dynamic":let n;return()=>(n||(n=this.loadConfigWithRetry(t,e.endpoint,3).catch(o=>(i.error(this.name,"Fetching blocklisted urls failed",o),{urls:[]}))),n)}}loadConfigWithRetry(e,t,i,n=null){return i<=0?Promise.reject(n):(this.blocklistCache||(this.blocklistCache=e.loadJson("blocklist-urls.json",t).catch(o=>new Promise(a=>setTimeout(a,100/i)).then(()=>this.loadConfigWithRetry(e,t,i-1,o)))),this.blocklistCache)}a(){return[]}d(){return[]}};window.moli.registerModule(new Xe);var Qe=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(e,t)=>{t.forEach(i=>{"cssSelectors"in i.deleteMethod?i.deleteMethod.cssSelectors.forEach(n=>{let o=e.e.document.querySelectorAll(n);e.t.debug("Cleanup Module",`Remove elements with selector ${n} from dom`,o),o.forEach(s=>{try{s.remove()}catch(a){e.t.error("Cleanup Module",`Error removing element with selector ${n}`,a)}})}):i.deleteMethod.jsAsString.forEach(n=>{try{e.t.debug("Cleanup Module",`Try to execute string as JS: '${n}'`),new Function(n)()}catch(o){e.t.error("Cleanup Module",`Error executing JS string: '${n}'`,o)}})})};this.hasBidderWonLastAuction=(e,t)=>{var o;return((o=e.e.pbjs.getAllWinningBids().find(s=>s.adUnitCode===t.domId))==null?void 0:o.bidder)===t.bidder}}n(e){e!=null&&e.cleanup&&e.cleanup.enabled&&(this.cleanupConfig=e.cleanup)}r(){return this.cleanupConfig}s(){return[]}a(){let e=this.cleanupConfig;return e?[oe("destroy-out-of-page-ad-format",t=>(t.l.environment==="test"||t.e.pbjs.que.push(()=>{let i=e.configs.filter(n=>this.hasBidderWonLastAuction(t,n));this.cleanUp(t,i)}),Promise.resolve()))]:[]}d(){let e=this.cleanupConfig;return e?[j("cleanup-before-ad-reload",Ne,(t,i)=>(t.l.environment==="test"||t.e.pbjs.que.push(()=>{let n=e.configs.filter(o=>i.map(s=>s.moliSlot.domId).includes(o.domId)).filter(o=>this.hasBidderWonLastAuction(t,o));this.cleanUp(t,n)}),Promise.resolve()))]:[]}};window.moli.registerModule(new Qe);var Ze=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}r(){return this.confiantConfig}n(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}s(){let e=this.confiantConfig;return e?[U("confiant-init",t=>this.loadConfiant(t,e))]:[]}loadConfiant(e,t){var i;return e.i==="test"||e.o.gdprApplies&&(!e.o.purpose.consents[1]||!(!((i=this.confiantConfig)!=null&&i.checkGVLID)||e.o.vendor.consents[this.gvlid]))||e.p.loadScript({name:this.name,loadMethod:1,assetUrl:t.assetUrl}).catch(n=>e.t.error("failed to load confiant",n)),Promise.resolve()}a(){return[]}d(){return[]}};window.moli.registerModule(new Ze);var no=(r,e)=>{var i;let t=(i=r.r.targeting)==null?void 0:i.keyValues[e];return t?`&device_id=${typeof t=="string"?t:t[0]}`:""},Dr=(r,e,t,i,n)=>{let o=no(r,e.advertiserIdKey),s=r.o.gdprApplies?`gdpr=1&gdpr_consent=${r.o.tcString}`:"gdpr=0",a=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",u=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",p="",d=v(v({},e.additionalIdentifier),t);Object.entries(d).forEach(([l,f])=>{p+=`&${l}=${encodeURIComponent(f)}`});let m="",y=v(v({},e.customKeywords),i);Object.entries(y).forEach(([l,f])=>{m+=`&${l}=${encodeURIComponent(f)}`});let c=n.createElement("img");c.src=`https://aps.xplosion.de/data?sid=${e.sid}${o}&os=${e.os}&app_id=${e.appId}${u}${a}${p}${m}&${s}`,c.width=1,c.height=1,n.body.append(c)};var so=(r,e)=>{var i;if(e.os==="web")return;let t=(i=r.r.targeting)==null?void 0:i.keyValues[e.advertiserIdKey];if(t)return typeof t=="string"?t:t[0]},qr=(r,e,t)=>{try{let n="moli_emetriq",o=r.getItem(n),s=o?Number.parseInt(o,10):0,a=e-864e5>s;return a&&(r.setItem(n,e.toString()),t.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),a}catch(i){return t.error("emetriq","could not access session storage",i),!1}},Ur=(r,e,t,i)=>{if(!e.login){i.warn("emetriq","login configuration missing!");return}let n=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);n.searchParams.append("guid",e.login.guid),r.o.gdprApplies?(n.searchParams.append("gdpr","1"),n.searchParams.append("gdpr_consent",r.o.tcString)):n.searchParams.append("gdpr","0");let o=so(r,e);if(o)switch(e.os){case"android":n.searchParams.append("adid",o);break;case"ios":n.searchParams.append("idfa",o);break}let s=t.createElement("img");s.src=n.href,s.width=1,s.height=1,t.body.append(s)};var et=class r{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}r(){return this.emetriqConfig}n(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}s(){let e=this.emetriqConfig;return e?[U("load-emetriq",t=>{var n;let i=r.staticCustomParams(v(v({},(n=t.r.targeting)==null?void 0:n.keyValues),t.l.keyValues),e.customMappingDefinition);return t.i==="test"||this.checkIfConsentIsMissing(t)||r.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"web":this.loadEmetriqScript(t,e,o,i);break}}),Promise.resolve()})]:[]}a(){let e=this.emetriqConfig;return e?[oe("track-emetriq",t=>{var n;let i=r.staticCustomParams(v(v({},(n=t.r.targeting)==null?void 0:n.keyValues),t.l.keyValues),e.customMappingDefinition);return t.i==="test"||this.checkIfConsentIsMissing(t)||(e.login&&qr(t.e.sessionStorage,Date.now(),t.t)&&Ur(t,e,t.e.document,t.t),r.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"android":case"ios":Dr(t,e,o,i,t.e.document);break}})),Promise.resolve()})]:[]}d(){return[]}checkIfConsentIsMissing(e){return e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid]?(e.t.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,t,i,n){let o=e.e;return o._enqAdpParam=v(v(v({},t._enqAdpParam),i),n),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${t._enqAdpParam.sid}/default.js`}).catch(s=>e.t.error("failed to load emetriq",s))}static syncDelay(e,t){return t?typeof t=="number"?new Promise(i=>e.e.setTimeout(()=>i({}),t)):e.e.pbjs?new Promise(i=>{e.e.pbjs.que.push(()=>{let n=()=>{i(r.prebidIdentifiers(e)),e.e.pbjs.offEvent("auctionEnd",n)};e.e.pbjs.onEvent("auctionEnd",n)})}):(e.t.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,t){let i={};return(t!=null?t:[]).forEach(({param:n,key:o})=>{let s=e[o];s&&(i[n]=typeof s=="string"?s:s.join(","))}),i}static prebidIdentifiers(e){let t={},i=e.e.pbjs.getUserIds();return i.amxId&&(t.id_amxid=i.amxId),i.idl_env&&(t.id_liveramp=i.idl_env),i.IDP&&(t.id_zeotap=i.IDP),i.pubcid&&(t.id_sharedid=i.pubcid),i.id5id&&(t.id_id5=i.id5id.uid),t}};window.moli.registerModule(new et);var tt=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}r(){return this.identityLinkConfig}n(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}s(){let e=this.identityLinkConfig;return e?[U(this.name,t=>(this.loadAts(t,e),Promise.resolve()))]:[]}a(){return[]}d(){return[]}loadAts(e,t){if(e.i==="test"||e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid])return Promise.resolve();let i=e.e;return i.addEventListener("envelopeModuleReady",()=>{i.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:t.hashedEmailAddresses})}),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${t.launchPadId}/launchpad-liveramp.js`}).catch(n=>e.t.error("failed to load emetriq",n))}};window.moli.registerModule(new tt);var Lr=r=>{let e=r.filter(i=>i.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:i=>{let n=i.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:n?e.find(s=>s.domId===n):e[0],configSlotDomId:n}}}};var rt=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,t)=>{var p;if(this.initialized)return;this.initialized=!0,(p=e.t)==null||p.debug(this.name,"initialize moli lazy load module");let i=t.slots,n=t.buckets,o=t.infiniteSlots,s=e.e;i.forEach(d=>{let m=new s.IntersectionObserver(y=>{var c;(c=e.t)==null||c.debug(this.name,"lazy-load slots called with",y),y.forEach(l=>{var f;l.isIntersecting&&((f=e.t)==null||f.debug(this.name,`Trigger ad slot with DOM ID ${l.target.id}`),s.moli.refreshAdSlot(l.target.id),m.unobserve(l.target))})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});this.observers.push(m),d.domIds.forEach(y=>{var l,f;let c=e.r.slots.find(g=>g.domId===y);if(!c)(l=e.t)==null||l.warn(this.name,`Lazy-load non-existing slot with domID ${y}`);else if(c.behaviour.loaded!=="manual")(f=e.t)==null||f.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${y}`);else if(c.behaviour.loaded==="manual"){let g=s.document.getElementById(y);g&&m.observe(g)}})}),n.forEach(d=>{var y,c,l,f;let m=new s.IntersectionObserver(g=>{g.forEach(b=>{var I,S,A;if(b.isIntersecting&&b.target.id===d.observedDomId)if(((I=e.r.slots.find(O=>O.domId===d.observedDomId))==null?void 0:I.behaviour.bucket)!==d.bucket)(S=e.t)==null||S.warn(this.name,`${d.observedDomId} doesn't belong to ${d.bucket}`);else{let O=e.r.slots.filter(K=>K.behaviour.bucket===d.bucket).map(K=>K.domId);(A=e.t)==null||A.debug(`Refresh ${d.bucket}`,`Trigger ad slots with DOM IDs [${O.join(", ")}]`),s.moli.refreshBucket(d.bucket),m.unobserve(b.target)}})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});if(this.observers.push(m),(y=e.r.buckets)!=null&&y.enabled||(c=e.t)==null||c.warn(this.name,"GlobalBucket config isn't enabled"),!((l=e.r.buckets)!=null&&l.bucket&&e.r.buckets.bucket[d.bucket]))(f=e.t)==null||f.error(this.name,`Lazy-load non-existing bucket with name ${d.bucket}`);else{let g=s.document.getElementById(d.observedDomId);g&&m.observe(g)}});let{configuredInfiniteSlots:a,findSlot:u}=Lr(e.r.slots);(o||[]).forEach(d=>{var y;let m="data-h5-serial-number";if(a.length>0){let c=new s.IntersectionObserver(f=>{f.forEach(g=>{var b,I,S,A;if(g.isIntersecting){let{configuredInfiniteSlot:E,configSlotDomId:O}=u(g.target);if(E){let K=(I=(b=g.target.attributes)==null?void 0:b.getNamedItem(m))==null?void 0:I.value,Z=`${E.domId}-${K}`;g.target.setAttribute("id",Z),(S=e.t)==null||S.debug(this.name,`Trigger ad slot with newly created DOM ID ${Z}`),s.moli.refreshInfiniteAdSlot(Z,E.domId),c.unobserve(g.target)}else(A=e.t)==null||A.error(this.name,`No infinite-scrolling slot configured for ${O}`),c.unobserve(g.target)}})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});this.observers.push(c),s.document.querySelectorAll(d.selector).forEach((f,g)=>{f.setAttribute(m,`${g+1}`),f&&c.observe(f)})}else(y=e.t)==null||y.warn(this.name,"No infinite-scrolling slots configured!")})}}r(){return this.lazyloadConfig}n(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}s(){return[]}a(){let e=this.lazyloadConfig;return e?[oe("lazy-module-configuration",t=>(this.initialized=!1,this.observers.forEach(i=>i.disconnect()),this.observers.length=0,this.registerIntersectionObservers(t,e),Promise.resolve()))]:[]}d(){return[]}};window.moli.registerModule(new rt);var it=class r{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}r(){return this.moduleConfig}n(e){var t;if((t=e==null?void 0:e.prebidFirstPartyData)!=null&&t.enabled){let i=e.prebidFirstPartyData;this._configureSteps=[N("prebid-fpd-module-configure",n=>r.setPrebidFpdConfig(n,i,n.t))]}}s(){return[]}a(){return this._configureSteps}d(){return[]}static setPrebidFpdConfig(e,t,i){var n;if(e.r.prebid){let o=((n=e.r.targeting)==null?void 0:n.keyValues)||{},s=t.gptTargetingMappings;e.e.pbjs.que.push(()=>{var p,d,m,y,c,l,f,g,b;let a=e.e.pbjs.readConfig().ortb2||{},u=Ge({},t.staticPrebidFirstPartyData,a);if(s){let I=v({cat:[],sectioncat:[],pagecat:[]},u.site);if(s.cat){let A=r.extractKeyValueArray(s.cat,o);(p=I.cat)==null||p.push(...A),(d=I.pagecat)==null||d.push(...A),(m=I.sectioncat)==null||m.push(...A)}s.sectionCat&&(I.sectioncat=r.extractKeyValueArray(s.sectionCat,o)),s.pageCat&&(I.pagecat=r.extractKeyValueArray(s.pageCat,o)),I.cat&&(I.cat=I.cat.filter(G)),I.sectioncat&&(I.sectioncat=I.sectioncat.filter(G)),I.pagecat&&(I.pagecat=I.pagecat.filter(G));let S=(y=t.iabDataProviderName)!=null?y:fe(e.e.location.hostname);if(!t.iabDataProviderName&&(s.iabV2||s.iabV3)&&i.debug("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Use tld as fallback",S),I.content=T(v({},I.content),{data:(f=(l=(c=I.content)==null?void 0:c.data)==null?void 0:l.filter(A=>A.name!==S))!=null?f:[]}),s.iabV2&&S){let A=r.extractKeyValueArray(s.iabV2,o),E={name:S,ext:{segtax:6},segment:A.map(O=>({id:O})).filter(G)};(g=I.content.data)==null||g.push(E)}if(s.iabV3&&S){let A=r.extractKeyValueArray(s.iabV3,o),E={name:S,ext:{segtax:7},segment:A.map(O=>({id:O})).filter(G)};(b=I.content.data)==null||b.push(E)}u.site=I}e.e.pbjs.setConfig({ortb2:u})})}return Promise.resolve()}static extractKeyValueArray(e,t){let i=t[e];return i?typeof i=="string"?[i]:i:[]}};window.moli.registerModule(new it);var ot=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}r(){return this.pubstackConfig}n(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}s(){let e=this.pubstackConfig;return e?[U("pubstack-init",t=>(t.i==="test"||t.p.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(i=>t.t.error("failed to load pubstack",i)),Promise.resolve()))]:[]}a(){return this.pubstackConfig?[N("pubstack-configure",t=>{if(t.i==="test")return Promise.resolve();let i=["0","1","2","3"],n=t.e.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return n&&n.content&&i.includes(n.content)&&t.e.googletag.pubads().setTargeting("pbstck_ab_test",n.content),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new ot);var Vr="footer-ad-close-button",ao="[data-ref=h5-footer-ad-container]",lo=`[data-ref=${Vr}]`,nt={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},_r=(r,e,t,i)=>n=>{let o=n.slot,s=r.document.body.querySelector(ao),a=r.document.getElementById(e),u=()=>{var d;o.getSlotElementId()===e&&s&&((d=r.googletag)==null||d.destroySlots([o]),s.remove())};if(!s||!a||o.getSlotElementId()!==e||n.isEmpty||n.advertiserId&&t.includes(n.advertiserId)||r.matchMedia("(max-width: 767px)").matches){i.debug("[footer-ad]","remove footer ad container");return}if(r.document.body.querySelector(lo))return;let p=document.createElement("button");p.classList.add(nt.footerAdClose),p.setAttribute("aria-label","Anzeige entfernen"),p.setAttribute("data-ref",Vr),a.classList.add(nt.adSlot),Array.isArray(n.size)&&n.size[1]>200&&r.matchMedia("(max-height: 800px)").matches&&a.classList.add(nt.isShiftedBottom),s.classList.add(nt.container),s.style.setProperty("display","block"),s.appendChild(p),p.addEventListener("click",()=>u())},Nr=(r,e,t,i,n)=>{e==="production"?r.googletag.pubads().addEventListener("slotRenderEnded",_r(r,i,n,t)):_r(r,i,n,t)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>i}})};var zr="[data-ref=sticky-ad]",jr="[data-ref=sticky-ad-close]",Wr="h5-sticky-ad--visible",yt=r=>{r.style.setProperty("display","none"),r.classList.remove(Wr)},Fr=r=>{r.style.setProperty("display","block"),r.classList.add(Wr)},$r=(r,e,t,i)=>new Promise(n=>{let o=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(r&&yt(r),n("empty")):s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):n("standard"),i.googletag.pubads().removeEventListener("slotRenderEnded",o))};i.googletag.cmd.push(()=>{i.googletag.pubads().addEventListener("slotRenderEnded",o)})}),Gr=(r,e)=>new Promise(t=>{let i=n=>{n.slot.getSlotElementId()===r&&(t(),e.googletag.pubads().removeEventListener("slotOnload",i))};e.googletag.pubads().addEventListener("slotOnload",i)}),Hr=(r,e,t,i,n,o)=>{let s=r.document.querySelector(zr),a=r.document.querySelector(jr);if(s&&a){if(t.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),o||Fr(s),a.addEventListener("click",()=>{yt(s);let u=r.googletag.pubads().getSlots().find(p=>p.getSlotElementId()===i);u&&r.googletag.destroySlots([u])},{once:!0,passive:!0}),e==="production"){let u=([p])=>(t.debug("mobile-sticky-ad",`result ${p}`),p==="disallowed"?(t.debug("mobile-sticky-ad","hide mobile sticky container"),s&&yt(s),Promise.resolve()):p==="standard"?(o&&Fr(s),Promise.all([$r(s,i,n,r),Gr(i,r)]).then(u)):Promise.resolve());Promise.all([$r(s,i,n,r),Gr(i,r)]).then(u)}}else t.warn("[mobile-sticky]",`Could not find adSticky container ${zr} or closeButton ${jr}`,s,a)};var st=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}r(){return this.stickyFooterAdConfig}n(e){var t;(t=e==null?void 0:e.stickyFooterAd)!=null&&t.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}d(){let e=this.stickyFooterAdConfig;return e?[j(this.name,J,(t,i)=>{var n;return e.mobileStickyDomId&&i.some(o=>{var s;return o.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&Hr(t.e,t.i,t.t,e.mobileStickyDomId,e.disallowedAdvertiserIds,(n=e.initiallyHidden)!=null?n:!1),e.desktopFloorAdDomId&&i.some(o=>o.moliSlot.domId===e.desktopFloorAdDomId)&&Nr(t.e,t.i,t.t,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new st);var bt="[data-ref=h5v-sticky-ad]",ht="[data-ref=h5v-sticky-ad-close]",Kr=".h5v-closeButtonContent",Qr="h5v-footerAd--hidden",Yr=(r,e,t)=>new Promise(i=>{let n=o=>{o.slot.getSlotElementId()===r&&(o.isEmpty?i("empty"):o.advertiserId&&e.includes(o.advertiserId)?i("disallowed"):i("standard"),t.googletag.pubads().removeEventListener("slotRenderEnded",n))};t.googletag.cmd.push(()=>{t.googletag.pubads().addEventListener("slotRenderEnded",n)})}),Jr=(r,e)=>new Promise(t=>{let i=n=>{n.slot.getSlotElementId()===r&&(t(),e.googletag.pubads().removeEventListener("slotOnload",i))};e.googletag.pubads().addEventListener("slotOnload",i)}),Xr=r=>{r.classList.add(Qr)},uo=r=>{r.classList.remove(Qr)},Zr=(r,e,t,i,n,o)=>{let s="sticky-ad",a=r.document.querySelector(bt),u=r.document.querySelector(ht),p=r.document.querySelector(Kr);if(a&&u){if(t.debug(s,"Running initAdSticky with defined sticky container and close button"),!p){if(o)u.textContent=o;else if(!u.querySelector("svg")){let m=r.document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width","24"),m.setAttribute("height","24");let y=r.document.createElementNS("http://www.w3.org/2000/svg","path");y.classList.add(Kr),y.setAttribute("d","M7 10l5 5 5-5z"),m.appendChild(y),u.appendChild(m)}}u.addEventListener("click",()=>{a.addEventListener("transitionend",function(){var y;a.remove();let m=(y=r.googletag)==null?void 0:y.pubads().getSlots().find(c=>c.getSlotElementId()===i);m&&r.googletag.destroySlots([m])},{once:!0}),Xr(a)});let d=m=>{if(t.debug(s,`result ${m}`),m==="disallowed"||m==="empty")return t.debug(s,"stickyFooter container"),Xr(a),Promise.resolve();if(m==="standard"){uo(a);let y=Jr(i,r);return Yr(i,n,r).then(c=>c==="empty"||c==="disallowed"?Promise.resolve(c):y.then(()=>c)).then(d)}return Promise.resolve()};if(e==="production")if(i){let m=Jr(i,r);Yr(i,n,r).then(y=>y==="empty"||y==="disallowed"?Promise.resolve(y):m.then(()=>y)).then(d)}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${bt} or closeButton ${ht}`,a,u);else d("standard")}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${bt} or closeButton ${ht}`,a,u)};var at=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}r(){return this.stickyFooterAdConfig}n(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}d(){let e=this.stickyFooterAdConfig;return e?[j(this.name,J,(t,i)=>{let n=i.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.desktop),o=i.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.mobile),s=o||n;return o&&n&&t.t.warn(this.name,"mobile and desktop sticky footer are called!"),s&&Zr(t.e,t.i,t.t,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new at);var ei=(r,e,t,i,n,o)=>s=>{s.forEach(a=>{e&&a.target===e?t.then(u=>{a.isIntersecting||!a.isIntersecting&&a.boundingClientRect.y<0||u==="empty"||u==="disallowed"?r.classList.add(o):a.boundingClientRect.y>=0&&u==="standard"&&r.classList.remove(o)}):a.target===i&&n&&(a.isIntersecting?r.classList.remove(n):r.classList.add(n))})};var ti=(r,e,t,i)=>new Promise(n=>{if(r.i==="test"){n("standard");return}let o=s=>{s.slot.getSlotElementId()===e.domId&&(s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):s.isEmpty?n("empty"):i>0?r.e.setTimeout(()=>n("standard"),i):n("standard"),r.e.googletag.pubads().removeEventListener("slotRenderEnded",o))};r.e.googletag.pubads().addEventListener("slotRenderEnded",o)});var dt=class{constructor(){this.name="sticky-header-ads";this.description="sticky header ad creatives";this.moduleType="creatives";this.containerSelector='[data-ref="header-ad"]';this.buttonSelector='[data-ref="header-ad-close-button"]';this.navbarHiddenClassName="h5v-header-ad--navbarHidden";this.observer=null;this.stickyHeaderAdConfig=null}n(e){var t;(t=e==null?void 0:e.stickyHeaderAd)!=null&&t.enabled&&(this.stickyHeaderAdConfig=e.stickyHeaderAd)}r(){return this.stickyHeaderAdConfig}s(){return[]}a(){return this.stickyHeaderAdConfig?[oe("sticky-header-ads:cleanup",()=>(this.observer&&(this.observer.disconnect(),this.observer=null),Promise.resolve()))]:[]}d(){let e=this.stickyHeaderAdConfig;return e?[j(this.name,J,(t,i)=>{var u,p,d;if(this.observer)return Promise.resolve();let n=i.find(m=>m.moliSlot.domId===e.headerAdDomId);if(!n)return Promise.resolve();let o=t.e.document.querySelector(this.containerSelector);if(!o)return t.t.warn(this.name,`Could not find sticky header container with selector '${this.containerSelector}'`),Promise.resolve();let s=(u=e.minVisibleDurationMs)!=null?u:0;if(e.fadeOutTrigger!==!1){let m=(p=e.fadeOutTrigger.options)!=null?p:{rootMargin:"0px"},y=t.e.document.querySelectorAll(e.fadeOutTrigger.selector),c=y.length>0?y.item(0):null,l=e.navbarConfig,f=(d=l==null?void 0:l.navbarHiddenClassName)!=null?d:this.navbarHiddenClassName,g=l?t.e.document.querySelector(l.selector):null;if(c){let b=ti(t,n.moliSlot,e.disallowedAdvertiserIds,s);this.observer=new IntersectionObserver(ei(o,c,b,g,f,e.fadeOutClassName),m),this.observer.observe(c),g&&this.observer.observe(g)}else t.t.error(this.name,`No DOM element found for selector ${e.fadeOutTrigger.selector}. Sticky header may never fade out`)}let a=t.e.document.querySelector(this.buttonSelector);return a&&a.addEventListener("click",()=>{o.classList.add(e.fadeOutClassName),this.observer&&this.observer.disconnect(),t.i==="production"&&t.e.googletag.destroySlots([n.adSlot]),e.destroySlot&&o&&o.remove()}),Promise.resolve()})]:[]}};window.moli.registerModule(new dt);var po=(r,e)=>{let t=Object.keys(r);return ge(t.map(i=>v({adSlotId:i},r[i])).filter(i=>e.indexOf(i.adSlotId)>-1).filter(i=>V(i.bids)).map(i=>i.bids.sort((n,o)=>o.cpm-n.cpm).slice(0,1)))},lt=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.bidsBackHandler=[];this.getConfigEffect=(e,t,i,n)=>{let o=t[e.skinAdSlotDomId],s=m=>{let y=e.formatFilter.some(c=>{switch(c.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return m.bidder===le.AppNexusAst||m.bidder===le.AppNexus;case"improvedigital":return m.bidder===le.ImproveDigital;case"gumgum":return m.bidder===le.GumGum&&(c.auid===void 0||typeof m.ad!="string"&&m.ad.auid===c.auid);case"dspx":return m.bidder===le.DSPX;case"visx":return m.bidder===le.Visx;case"yieldlab":return m.bidder===le.Yieldlab;default:return!1}});return m.cpm>0&&y},a=po(t,e.blockedAdSlotDomIds),u=a.reduce((m,y)=>m+y.cpm,0),p=o?o.bids.filter(s).sort((m,y)=>y.cpm-m.cpm):[],d=p.length>0?p[0].cpm>u?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return n.debug(this.name,"nonSkinBids",a),n.debug(this.name,"skinBids",p),i&&d==="BlockSkinSlot"&&(i({skin:p[0].cpm,combinedNonSkinSlots:u},e,p[0]),n.debug(this.name,"trackSkinCpmLow",a)),e.enableCpmComparison?d:p.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,t,i)=>e.configs.map(n=>({skinConfig:n,configEffect:this.getConfigEffect(n,t,e.trackSkinCpmLow,i)})).find(({configEffect:n})=>n!=="NoBlocking");this.destroyAdSlot=(e,t)=>i=>{let n=e.map(o=>o.adSlot).filter(o=>o.getSlotElementId()===i);t.googletag.destroySlots(n)};this.runSkinConfigs=e=>(t,i,n)=>{var a,u,p;let o=null,s=this.selectConfig(e,i,t.t);if(s){let{skinConfig:d,configEffect:m}=s;if(m==="BlockOtherSlots"){t.t.debug("SkinModule","Skin configuration applied",d),d.blockedAdSlotDomIds.forEach(this.destroyAdSlot(n,t.e)),d.hideBlockedSlots&&d.blockedAdSlotDomIds.forEach(this.hideAdSlot(t.e,t.t)),d.hideSkinAdSlot&&this.hideAdSlot(t.e,t.t)(d.skinAdSlotDomId),d.hideBlockedSlotsSelector&&t.e.document.querySelectorAll(d.hideBlockedSlotsSelector).forEach(l=>{t.t.debug("SkinModule",`Set display:none for container with selector ${d.hideBlockedSlotsSelector}`),l.style.setProperty("display","none")});let y=(a=i[d.skinAdSlotDomId])==null?void 0:a.bids.sort((l,f)=>f.cpm-l.cpm)[0],c=l=>t.e.googletag.pubads().getSlots().find(g=>g.getSlotElementId()===l);if((u=d.adReload)!=null&&u.intervalMs&&(y!=null&&y.bidder)&&d.adReload.allowed.includes(y.bidder)){let l=n.filter(g=>g.moliSlot.domId===d.skinAdSlotDomId||d.blockedAdSlotDomIds.includes(g.moliSlot.domId)).map(g=>g.moliSlot.behaviour.loaded);l.every(g=>g===l[0])&&l[0]!=="infinite"?(o&&clearTimeout(o),o=t.e.setTimeout(()=>{var g;t.e.moli.refreshAdSlot([...d.blockedAdSlotDomIds,d.skinAdSlotDomId],{loaded:l[0]}),(g=c(d.skinAdSlotDomId))==null||g.setTargeting("native-ad-reload","true"),t.t.info("SkinModule","Ad reload for skin and blocked slots triggered",d.skinAdSlotDomId,d.blockedAdSlotDomIds)},(p=d.adReload)==null?void 0:p.intervalMs)):t.t.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",l)}}else d.enableCpmComparison&&(t.t.debug("SkinModule","Skin configuration ignored because cpm was low",d),this.destroyAdSlot(n,t.e)(d.skinAdSlotDomId))}else e.configs.filter(d=>d.destroySkinSlot).map(d=>d.skinAdSlotDomId).filter(G).forEach(this.destroyAdSlot(n,t.e))};this.hideAdSlot=(e,t)=>i=>{let n=e.document.getElementById(i);try{n&&(t.debug("SkinModule",`Set display:none for ${i}`),n.style.setProperty("display","none"))}catch(o){t.error("SkinModule",`Couldn't set the the wallpaper div ${i} to display:none;`,o)}}}r(){return this.skinModuleConfig}n(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin,this.bidsBackHandler.push(this.runSkinConfigs(e.skin)))}s(){return[]}a(){return[]}d(){return[]}v(){return this.bidsBackHandler}};window.moli.registerModule(new lt);var co=[R.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,R.responses.TCPurpose.SELECT_BASIC_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_ADS,R.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,R.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,R.responses.TCPurpose.MEASURE_AD_PERFORMANCE,R.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,R.responses.TCPurpose.APPLY_MARKET_RESEARCH,R.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS,R.responses.TCPurpose.USE_LIMITED_DATA_TO_SElECT_CONTENT],ri=()=>{let r=null,e=(t,i)=>{if(i.i==="test")return Promise.resolve();let n=i.e;return n.Utiq=n.Utiq?T(v({},n.Utiq),{config:v(v({},n.Utiq.config),t.options)}):{queue:[],config:t.options},n.Utiq.queue=n.Utiq.queue||[],i.o.gdprApplies&&co.some(o=>i.o.gdprApplies&&!i.o.purpose.consents[o])?Promise.resolve():i.p.loadScript({name:"utiq",loadMethod:1,assetUrl:t.assetUrl}).catch(o=>i.t.error("failed to load utiq",o))};return{name:"utiq",description:"user module",moduleType:"identity",r(){return r},n(t){t!=null&&t.utiq&&t.utiq.enabled&&(r=t.utiq)},s(){return r!=null&&r.enabled?[U("utiq",t=>e(r,t))]:[]},a(){return[]},d(){return[]}}};window.moli.registerModule(ri());var ii=r=>{var e;return r?((e=r.dynamicFloorPrices)==null?void 0:e.strategy)!==void 0:!1};var mo=r=>{if(r.length===0)return null;{let e=Math.max(...r);return Math.round(e*100)}},go=r=>{if(r.length===0)return null;{let e=Math.min(...r);return Math.round(e*100)}},fo=r=>{if(!r||r.length===0)return null;if(r.length===1)return Math.round(r[0]*100);{let e=r.sort()[r.length-2];return Math.round(e*100)}},yo=(r,e)=>{switch(r){case"max":return mo(e);case"min":return go(e);case"second-highest":return fo(e);default:return null}},ut=r=>Math.floor(r),bo=r=>{let e=ut(r.priceInCents),t=ut(r.roundingStepsInCents),i=r.maxPriceRuleInCents!==void 0?ut(r.maxPriceRuleInCents):void 0,n=r.minPriceRuleInCents!==void 0?ut(r.minPriceRuleInCents):void 0,o=Math.floor(e/t)*t;return i!==void 0&&o>i?i:n!==void 0&&o<n?n:o},oi=({strategy:r,previousCpms:e,standardRule:t,roundingStepsInCents:i=5,maxPriceRuleInCents:n=500,minPriceRuleInCents:o=5})=>{let s=Array.isArray(e)?e==null?void 0:e.filter(p=>p>0&&!isNaN(p)):[];if(!s||s.length===0||!r)return t;let a=yo(r,s);if(a===null)return t;let u=bo({priceInCents:a,roundingStepsInCents:i,maxPriceRuleInCents:n,minPriceRuleInCents:o});return T(v({},t),{floorprice:u/100,priceRuleId:u})};var ni=r=>{let e={rules:{},browser:"None"},t=Promise.resolve(e),i=!1,n="mobile",o={},s=(l,f,g,b,I)=>{switch(n=l,o=f,r.provider){case"none":I.warn("YieldOptimizationService","Yield optimization is disabled!"),i=!1,t=Promise.resolve(e);break;case"static":I.warn("YieldOptimizationService","Yield optimization is static!"),i=!0,t=Promise.resolve({rules:r.config.rules,browser:"None"});break;case"dynamic":i=!0;let S=r.excludedAdUnitPaths,E=g.filter(O=>S.indexOf(O)<0).map(O=>W(O,o));t=d(r.configEndpoint,3,E,b).then(O=>(I.info("YieldOptimizationService",`loaded pricing rules for device ${n}`,O),O)).catch(O=>(I.error("YieldOptimizationService","failed to initialize service",O),e));break;default:i=!1,t=Promise.reject("Unknown config provider")}return Promise.resolve()},a=l=>t.then(f=>f.rules[W(l,o)]),u=()=>t.then(l=>l.browser||"None"),p=(l,f,g,b,I)=>{let S=W(l.getAdUnitPath(),o);return t.then(A=>{let E=A.rules[S];if(f==="gam")if(E)if(l.setTargeting("upr_model",E.model||"static"),E.main){l.setTargeting("upr_main","true");let O=I==null?void 0:I.getLastBidCpmsOfAdUnit(l.getSlotElementId());if(O&&(O==null?void 0:O.length)>0&&ii(b)&&b.dynamicFloorPrices){let{strategy:K,roundingStepsInCents:Z,maxPriceRuleInCents:ue,minPriceRuleInCents:pe}=b.dynamicFloorPrices,L=oi({strategy:K,previousCpms:O,standardRule:E,roundingStepsInCents:Z,maxPriceRuleInCents:ue,minPriceRuleInCents:pe});return g.debug("YieldOptimizationService",`set dynamic price rule id ${L.priceRuleId} for ${S} based on previous bid cpms on same position. Stategy is '${K}'. Main traffic share ${E.main}. Cpm is ${L.floorprice}.`),l.setTargeting("upr_id",L.priceRuleId.toFixed(0)),L}else l.setTargeting("upr_id",E.priceRuleId.toFixed(0))}else g.debug("YieldOptimizationService",`set price rule id ${E.priceRuleId} for ${S}. Main traffic share ${E.main}. cpm is ${E.floorprice}`),l.setTargeting("upr_id",E.priceRuleId.toFixed(0));else i&&g.warn("YieldOptimizationService",`No price rule found for ${S}`);return E})},d=(l,f,g,b,I=null)=>f<=0?Promise.reject(I):b(l,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:n,key:"adUnitPath",adUnitPaths:g})}).then(S=>S.ok?S.json():S.text().then(A=>Promise.reject(`${S.statusText}: ${A}`))).then(S=>typeof S!="object"||S===null?Promise.reject("Invalid response"):m(S)?c(S.rules)?S:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(S=>new Promise(E=>setTimeout(E,100/f)).then(()=>d(l,f-1,g,b,S))),m=l=>l.hasOwnProperty("rules"),y=l=>typeof l=="object"&&l!==null,c=l=>y(l)?Object.keys(l).every(f=>{let g=l[f];return typeof g=="object"&&g!==null&&typeof g.main=="boolean"&&typeof g.floorprice=="number"&&typeof g.priceRuleId=="number"}):!1;return{init:s,getPriceRule:a,getBrowser:u,setTargeting:p}};var si=r=>{let e="YieldOptimization",t="Provides floors and UPR ids",i="yield",n=null,o=[],s=[],a=()=>n,u=l=>{var f;if((f=l==null?void 0:l.yieldOptimization)!=null&&f.enabled){n=l.yieldOptimization;let g=r!=null?r:ni(l.yieldOptimization);o.push(y(g)),s.push(c(g))}},p=()=>o,d=()=>[],m=()=>s,y=l=>U("yield-optimization-init",f=>{let g=f.r.slots.filter(b=>f.u.filterSlot(b)).map(b=>b.adUnitPath).filter(G);return l.init(f.u.getDeviceLabel(),f.m,g,f.e.fetch,f.t)}),c=l=>j("yield-optimization",Ne,(f,g)=>{f.t.debug("YieldOptimizationService",f.c,"applying price rules");let b=f.r.adServer||"gam",I=g.map(S=>l.setTargeting(S.adSlot,b,f.t,n,f.g).then(A=>S.priceRule=A));return Promise.all(I).then(()=>l.getBrowser()).then(S=>{f.i==="production"&&b==="gam"&&f.e.googletag.pubads().setTargeting("upr_browser",S)})});return{name:e,description:t,moduleType:i,r:a,n:u,s:p,a:d,d:m}};window.moli.registerModule(si());var ai,Pe=(ai=window.document.currentScript)!=null?ai:document.getElementById("moli-ad-tag"),di,vt=(di=xe(window,Te.moliPubCode,ee.moliPubCode)[0])==null?void 0:di.value,li,It=(li=xe(window,Te.moliVersion,ee.moliVersion)[0])==null?void 0:li.value,ui,pi,ci,mi;if(Pe){let r=vt!=null?vt:Pe.getAttribute("data-publisher-code"),e=(ui=It!=null?It:Pe.getAttribute("data-version"))!=null?ui:"production",t=((pi=Pe.getAttribute("data-labels"))!=null?pi:"").split(",").map(o=>o.trim()).filter(o=>o.length>0);t.length>0&&window.moli.que.push(o=>{o.beforeRequestAds(()=>t.forEach(s=>o.addLabel(s)))}),window.moli.configLabel=e;let i=(ci=Pe.getAttribute("data-endpoint"))!=null?ci:"api.h5v.eu/publishers",n=(mi=Pe.getAttribute("data-endpoint-fallback"))!=null?mi:"cdn.h5v.eu/publishers";if(r){let o=`/${r}/configs/${e}/config.json`,s=`//${i}${o}`;fetch(s,{mode:"cors"}).then(a=>a.json()).catch(a=>(console.error(`Failed to load configuration from ${s}. Using fallback`,a),fetch(`//${n}${o}`,{mode:"cors"}))).then(a=>window.moli.configure(a)).catch(a=>console.error(`Failed to load configuration from ${s}:`,a))}else console.error('No publisher code provided for ad tag configuration! Add the `data-publisher-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");})();
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
