/* ad tag library 5.5.0 by highfivve.com */
"use strict";(()=>{var Pi=Object.defineProperty,Ci=Object.defineProperties;var Ri=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var Et=(t,e,r)=>e in t?Pi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h=(t,e)=>{for(var r in e||(e={}))Mt.call(e,r)&&Et(t,r,e[r]);if(Le)for(var r of Le(e))Tt.call(e,r)&&Et(t,r,e[r]);return t},x=(t,e)=>Ci(t,Ri(e));var xt=(t,e)=>{var r={};for(var i in t)Mt.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&Le)for(var i of Le(t))e.indexOf(i)<0&&Tt.call(t,i)&&(r[i]=t[i]);return r};var Ue=(t,e,r)=>new Promise((i,n)=>{var o=u=>{try{d(r.next(u))}catch(l){n(l)}},s=u=>{try{d(r.throw(u))}catch(l){n(l)}},d=u=>u.done?i(u.value):Promise.resolve(u.value).then(o,s);d((r=r.apply(t,e)).next())});var Ei=t=>{let e=t.indexOf("=");if(e>=0){let r=decodeURIComponent(t.slice(0,e)),i=decodeURIComponent(t.slice(e+1));return[r,i]}else return[decodeURIComponent(t),""]},Ie=t=>{try{let e=t.startsWith("?")?t.slice(1):t;return e.length>0?new Map(e.split("&").filter(r=>r.length>0).map(Ei)):new Map}catch(e){return console.error(e),new Map}};var _e=(t,e)=>{let r=[],i,n=typeof t.document=="object"&&t.document,o=n&&n.documentElement.doScroll,s="DOMContentLoaded",d=n&&(o?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);!d&&n&&n.addEventListener(s,i=()=>{if(n)for(n.removeEventListener(s,i),d=!0;i=r.shift();)i()}),d?setTimeout(e,0):r.push(e)};var ft=class{constructor(e){this.window=e}loadScript(e,r=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,r);case 1:return this.loadAssetViaTag(e,r)}})}loadJson(e,r){return this.window.fetch(r,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(i=>i.ok?i.json():i.text().then(n=>Promise.reject(`${i.statusText}: ${n}`))).catch(i=>Promise.reject(i))}loadAssetViaFetch(e,r){return this.window.fetch(e.assetUrl).then(i=>i.ok?Promise.resolve(i):Promise.reject(i)).then(i=>i.text()).then(i=>this.scriptTagWithBody(i)).then(i=>r.appendChild(i))}scriptTagWithBody(e){let r=this.window.document.createElement("script");return r.type="text/javascript",r.async=!0,r.text=e,r}loadAssetViaTag(e,r){let i=this.scriptTag(e);return new Promise((n,o)=>{i.onload=n,i.onerror=o,r.appendChild(i)})}scriptTag(e){let r=this.window.document.createElement("script");return e.type==="module"?r.type="module":e.type==="nomodule"?(r.type="text/javascript",r.setAttribute("nomodule","")):e.assetUrl.endsWith("mjs")?r.type="module":r.type="text/javascript",r.async=!0,r.src=e.assetUrl,r}awaitDomReady(){return new Promise(e=>{_e(this.window,e)})}},Ve=t=>new ft(t);function Mi(t){try{let e="moliDebug";return!!Ie(t.location.search).get(e)||!!t.sessionStorage.getItem(e)||!!t.localStorage.getItem(e)}catch(e){return!1}}function Ti(){let t=()=>{};return{debug:t,info:t,warn:t,error:console.error}}function ie(t){return`background:${t}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function Ne(t){switch(t){case"debug":return ie("#49A0CC");case"info":return ie("#61A172");case"warn":return ie("#FFC300");case"error":return ie("#C70039")}}function Fe(t){switch(t){case"AdPipeline":return ie("#74ABC6");case"GAM":return ie("#BA0E5F");case"MoliGlobal":return ie("#403073");case"Prebid":return ie("#4357AD");case"AdVisibilityService":return ie("#d5ba3c");case"UserActivityService":return ie("#19ad0e");case"Adex DMP":return ie("#003E74");default:return ie("#052E53")}}function le(){return{debug(t,e,...r){console.debug(`%c[DEBUG]%c${t}%c${e}`,Ne("debug"),Fe(t),"",...r)},info(t,e,...r){console.info(`%c[INFO]%c${t}%c${e}`,Ne("info"),Fe(t),"",...r)},warn(t,e,...r){console.warn(`%c[WARN]%c${t}%c${e}`,Ne("warn"),Fe(t),"",...r)},error(t,e,...r){console.error(`%c[ERROR]%c${t}%c${e}`,Ne("error"),Fe(t),"",...r)}}}function q(t,e){return Mi(e)?le():t&&t.logger?t.logger:Ti()}var ze=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...r){this.logger.debug(e,...r)}error(e,...r){this.logger.error(e,...r)}info(e,...r){this.logger.info(e,...r)}warn(e,...r){this.logger.warn(e,...r)}};var je=(t,e,r,i)=>{let n=t.slots.find(o=>o.domId===e);if(n){let o=x(h({},n),{domId:r});return x(h({},t),{slots:[...t.slots,o]})}else return i.error("MoliGlobal","no infinite ad slot configured!",t),t};function fe(t){return t.reduce((e,r)=>e.concat(r),[])}function Y(t,e,r){return r.indexOf(t)===e}function z(t){return t!=null}var yt=["mobile","desktop","android","ios"],Me=(t,e,r)=>{let i=e.some(a=>yt.indexOf(a)>-1),n=t.filter(a=>r.matchMedia(a.mediaQuery).matches),o=[...i?[]:fe(n.map(a=>a.labelsSupported)),...e].filter(Y);return{filterSlot:a=>{var c,m;let p=!0;return o.length&&((c=a.labelAll)!=null&&c.length)&&(p=a.labelAll.every(f=>o.indexOf(f)>-1)),o.length&&a.labelAny&&!((m=a.labelAll)!=null&&m.length)&&(p=a.labelAny.some(f=>o.indexOf(f)>-1)),p},getSupportedLabels:()=>o,getDeviceLabel:()=>o.find(a=>yt.indexOf(a)>-1)||"mobile",addLabel:a=>{yt.includes(a)||o.push(a)}}},bt=(t,e,r,i)=>Me(r!=null?r:[],[...(i==null?void 0:i.labels)||[],...e.labels],t).getDeviceLabel();var T;(r=>{let t;(o=>{let i;(A=>(A[A.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",A[A.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",A[A.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",A[A.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",A[A.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",A[A.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",A[A.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",A[A.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",A[A.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",A[A.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",A[A.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(i=o.TCPurpose||(o.TCPurpose={}));let n;(l=>(l[l.NOT_ALLOWED=0]="NOT_ALLOWED",l[l.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",l[l.REQUIRE_LI=2]="REQUIRE_LI"))(n=o.RestrictionType||(o.RestrictionType={}))})(t=r.responses||(r.responses={}));let e;(s=>{let i;(a=>(a.VISIBLE="visible",a.HIDDEN="hidden",a.DISABLED="disabled"))(i=s.DisplayStatus||(s.DisplayStatus={}));let n;(p=>(p.STUB="stub",p.LOADING="loading",p.LOADED="loaded",p.ERROR="error"))(n=s.CmpStatus||(s.CmpStatus={}));let o;(a=>(a.TC_LOADED="tcloaded",a.CMP_UI_SHOWN="cmpuishown",a.USER_ACTION_COMPLETE="useractioncomplete"))(o=s.EventStatus||(s.EventStatus={}))})(e=r.status||(r.status={}))})(T||(T={}));var xi=T.status.EventStatus,ki=T.status.CmpStatus,Oi=[T.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,T.responses.TCPurpose.SELECT_BASIC_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,T.responses.TCPurpose.MEASURE_AD_PERFORMANCE,T.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,T.responses.TCPurpose.APPLY_MARKET_RESEARCH,T.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],Bi=t=>!!t.gdprApplies&&Oi.some(e=>!t.purpose.consents[e]),kt=(t,e,r,i)=>(i==="test"&&r.info("gdprApplies is set to false in test mode!"),i==="test"||t.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:xi.TC_LOADED,cmpStatus:ki.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((n,o)=>{if(e.__tcfapi){let s=d=>{d.cmpStatus==="error"?o(d):(d.eventStatus==="useractioncomplete"||d.eventStatus==="tcloaded")&&(r.debug("Consent","consent ready",d),t.disableLegitimateInterest&&Bi(d)?o("user consent is missing for some purposes"):n(d),d.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},d.listenerId))};e.__tcfapi("addEventListener",2,s)}else o("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var ye=t=>{if(t){let[e,r,i]=t.split(".").reverse();switch(`${r}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${i}.${r}.${e}`;default:return r?`${r}.${e}`:e}}else return};var $e=t=>{let[e,r,...i]=t.split("/"),[n,...o]=r.split(",");return o.length===0?t:["",n,...i].join("/")},J=(t,e)=>{let r=/[^{]+(?=})/g,i=/([A-Za-z0-9\_]+)/g,n=t.match(r);return!e||!n?t:(n.forEach(o=>{if(!o.match(i))throw new SyntaxError(`invalid variable "${o}" in path`);if(!e[o])throw new ReferenceError(`path variable "${o}" is not defined`)}),t.replace(new RegExp(Object.keys(e).map(o=>`{${o}}`).join("|"),"g"),o=>e[o.substr(1,o.length-2)]))},Ot=(t,e)=>t.split("/").slice(0,e+1).join("/"),Bt=(t,e,r,i)=>h({device:e,domain:i||ye(t)||"unknown"},r);var qt=t=>{var e;return typeof((e=t.crypto)==null?void 0:e.randomUUID)=="function"?t.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let i=Math.random()*16|0;return(r==="x"?i:i&3|8).toString(16)})};var wi=T.responses.TCPurpose,Ge=100,Z=10,_=(t,e)=>(Object.defineProperty(e,"name",{value:t}),e),V=(t,e)=>(Object.defineProperty(e,"name",{value:t}),e),oe=(t,e)=>{Object.defineProperty(e,"name",{value:t});let r=0;return V(t,(i,n)=>r!==i.f?(r=i.f,e(i,n)):Promise.resolve())},Dt=(t,e)=>(Object.defineProperty(e,"name",{value:t}),V(t,(r,i)=>r.f===1&&r.c===1?e(r,i):Promise.resolve())),$=(t,e,r)=>{let i=Object.assign(r,{priority:e});return Object.defineProperty(r,"name",{value:t}),i},We=(t,e)=>(Object.defineProperty(e,"name",{value:t}),e),Se=class{constructor(e,r,i,n){this.config=e;this.logger=r;this.window=i;this.auction=n;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,r)=>{let i=new Map;return this.config.prepareRequestAds.forEach(n=>{let o=i.get(n.priority);o?o.push(n):i.set(n.priority,[n])}),Array.from(i.entries()).sort(([n],[o])=>n>o?-1:1).reduce((n,[o,s])=>n.then(()=>(e.t.debug("AdPipeline",e.c,`run prepareRequestAds with priority ${o}`),Promise.all(s.map(d=>d(e,r))))),Promise.resolve(void 0))}}run(e,r,i,n,o){this.requestId=this.requestId+1;let s=this.requestId,d=qt(this.window);this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${n}. call. AuctionId ${d}`,e);let u=r.consent||{};return this.tcData=this.tcData?this.tcData:kt(u,this.window,this.logger,i.environment),this.tcData.then(l=>{var S,P,v;let a=[...((S=r.targeting)==null?void 0:S.labels)||[],...i.labels];l.gdprApplies&&l.purpose.consents[wi.STORE_INFORMATION_ON_DEVICE]?a.push("purpose-1"):l.gdprApplies||a.push("purpose-1");let p=Me(r.labelSizeConfig||[],a,this.window),c=o==null?void 0:o.bucketName,m=c&&((P=r.buckets)!=null&&P.bucket)&&r.buckets.bucket[c]?r.buckets.bucket[c]:null,f=Bt(this.window.location.hostname,p.getDeviceLabel(),(v=r.targeting)==null?void 0:v.adUnitPathVariables,r.domain),y=h(h({},f),i.adUnitPathVariables),g={I:d,c:s,f:n,t:this.logger,i:i.environment||"production",r,l:i,u:p,e:this.window,o:l,b:m,m:y,g:this.auction,p:Ve(this.window),S:o};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(b=>b(g))));let A="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(b=>b(g,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(g,e))).then(b=>b.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(g,b)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(C=>C(g,b)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(g,b)):Promise.reject(A)).catch(b=>{switch(b){case A:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",b),Promise.reject(b)}})})}getAuction(){return this.auction}logStage(e,r){return new Promise(i=>{this.logger.debug("AdPipeline",r,`stage: ${e}`),i()})}};var He=(t,e)=>t[0]===e[0]&&t[1]===e[1];var te=class{constructor(e,r,i){this.sizeConfig=e;this.supportedLabels=r;this.window=i;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:e.filter(r=>this.supportedSizes.some(i=>i==="fluid"?r==="fluid":r==="fluid"?!1:He(r,i))):[];this.areLabelsMatching=(e,r)=>(!e.labelAll||e.labelAll.every(i=>r.some(n=>n===i)))&&(!e.labelNone||!e.labelNone.some(i=>r.some(n=>n===i)));let n=e.length!==0?e.filter(o=>i.matchMedia(o.mediaQuery).matches&&this.areLabelsMatching(o,r)):[];this.isValid=e.length===0||!(e.length>0&&n.length===0),this.supportedSizes=fe(n.map(o=>o.sizesSupported)).map(o=>JSON.stringify(o)).filter(Y).map(o=>JSON.parse(o))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var ne={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:t=>`moli-test-slot-size-${t}`,debugDelay:"moli-debug-delay"};var be=(t,e=localStorage)=>{try{return e.getItem(t)}catch(r){return le().debug(`Could not read value with key ${t} from browser storage`,e),null}},Te=(t,e,r=localStorage)=>{try{r.setItem(t,e)}catch(i){le().debug(`Could not set key ${t} with value ${e} to browser storage`,r)}};var qi=t=>t==="hidden"||Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number",Ut=t=>`${t}__container`,Ke=(t,e)=>{let r=Li(t,e);return r.forEach(({slot:i,container:n})=>{n.innerHTML="",n.appendChild(_i(i))}),r};var Di=(t,e)=>{let r=document.getElementById(t);r&&(r.innerHTML=e)},Li=(t,e)=>(e.forEach(r=>{let{moliSlot:i}=r,n=Ut(i.domId),o=document.createElement("div");o.id=n;let s=document.getElementById(i.domId);s&&s.setAttribute("data-google-query-id","test"),Di(i.domId,o.outerHTML),t.t.debug("GAM",`Set content for slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath}`)}),Ui(e)),Ui=t=>t.map(e=>{let r=document.getElementById(Ut(e.moliSlot.domId));return r?{slot:e,container:r}:void 0}).filter(z),_i=t=>{let e=Vi(t),r=Ni(t.moliSlot,e);if(r==="hidden")return document.createElement("div");{let i=document.createElement("div"),[n,o]=r;i.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${n}px; height: ${o}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${t.moliSlot.domId}</strong>`,i.appendChild(s);let d=document.createElement("span");d.style.color="#656565";let u=([g,A])=>d.innerText=`(${g}x${A})`;u([n,o]),s.appendChild(d);let l=document.createElement("div");l.style.cssText="position: absolute; top: 5px; left: 5px",i.appendChild(l);let a=(g,A)=>{if(g==="hidden")i.style.display="none";else{let[S,P]=g;i.style.width=`${S}px`,i.style.height=`${P}px`,u(g),y(A)}Fi(t.moliSlot,g)},p="1px dotted white",c="1px solid black",m=document.createElement("button");m.innerText="hide",m.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",m.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${p};`,m.addEventListener("click",()=>a("hidden",m));let f=[...e.map(g=>{let[A,S]=g,P=_t(r,g),v=document.createElement("button");return v.innerText=`${A}x${S}`,v.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${P?c:p};`,v.addEventListener("click",()=>a(g,v)),v}),m];f.forEach(g=>l.appendChild(g));let y=g=>{f.forEach(A=>A.style.border=p),g.style.border=c};return i}},Vi=t=>t.filterSupportedSizes(t.moliSlot.sizes).filter(te.isFixedSize).filter(([e,r])=>e>1&&r>1),Ni=(t,e)=>{let r=zi(t);if(r&&(r==="hidden"||ji(e,r)))return r;{let i=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[i]}},Fi=(t,e)=>Te(ne.testSlotSize(t.domId),JSON.stringify(e)),zi=t=>{let e=be(ne.testSlotSize(t.domId));if(e)try{let r=JSON.parse(e);return qi(r)?r:void 0}catch(r){return}},_t=(t,e)=>{let[r,i]=t,[n,o]=e;return r===n&&i===o},ji=(t,e)=>t.some(r=>_t(r,e));var Ae="f";var $i=(t,e)=>({setCollapseEmptyDiv(){},addService(r){},getSlotElementId(){return t},getAdUnitPath(){return e},setTargeting(r,i){return this},getTargeting(r){return[]},getTargetingKeys(){return[]},clearTargeting(r){},getResponseInformation(){return null}}),Vt=(t,e,r)=>{var o;let i=r?r.keyValues:{},n=(o=r==null?void 0:r.adManagerExcludes)!=null?o:[];[i,e].forEach(s=>{Object.keys(s).filter(d=>!n.includes(d)).forEach(d=>{let u=s[d];u&&t.googletag.pubads().setTargeting(d,u)})})},Nt=(t,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!t.gdprApplies||t.vendor.consents[755]&&t.purpose.consents[T.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[T.responses.TCPurpose.SELECT_BASIC_ADS,T.responses.TCPurpose.MEASURE_AD_PERFORMANCE,T.responses.TCPurpose.APPLY_MARKET_RESEARCH,T.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(r=>t.purpose.consents[r]||t.purpose.legitimateInterests[r]),Ft=()=>{let t;return _("gpt-init",e=>e.i==="test"?Promise.resolve():(t||(t=new Promise(r=>{e.t.debug("GAM","init googletag stub"),e.e.googletag=e.e.googletag||{},e.e.googletag.cmd=e.e.googletag.cmd||[],e.e.googletag.cmd.push(r),e.p.loadScript({name:"gpt",loadMethod:1,assetUrl:Nt(e.o,e.r.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(i=>e.t.error("failed to load gpt.js",i))})),t))},zt=()=>{let t=0;return V("gpt-destroy-ad-slots",(e,r)=>{var s,d;if(e.i==="test")return Promise.resolve();let i=(d=(s=e.r.spa)==null?void 0:s.cleanup)!=null?d:{slots:"all"},n=u=>u.length===0?(e.t.debug("GAM","no ad slots to destroy"),Promise.resolve()):(e.t.debug("GAM",`destroy ${u.length} ad slots`,u),e.e.googletag.destroySlots(u),Promise.resolve()),o=t!==e.f;switch(t=e.f,e.t.debug("GAM",`destroy ${i.slots} ad slots`),i.slots){case"all":return o&&e.e.googletag.destroySlots(),Promise.resolve();case"requested":let u=e.e.googletag.pubads().getSlots(),l=r.map(a=>u.find(p=>p.getSlotElementId()===a.domId)).filter(z);return n(l);case"excluded":if(o){let a=e.e.googletag.pubads().getSlots().filter(p=>!i.slotIds.includes(p.getSlotElementId()));return n(a)}return Promise.resolve();default:return Promise.resolve()}})},jt=()=>oe("gpt-reset-targeting",t=>new Promise(e=>{t.i==="production"&&(t.t.debug("GAM","reset top level targeting"),t.e.googletag.pubads().clearTargeting(),Vt(t.e,t.l.keyValues,t.r.targeting)),e()})),$t=()=>{let t;return V("gpt-configure",(e,r)=>(t||(t=new Promise(i=>{var o;let n=e.l.environment||"production";switch(e.t.debug("GAM","configure googletag"),n){case"production":Vt(e.e,e.l.keyValues,e.r.targeting),e.e.googletag.pubads().enableAsyncRendering(),e.e.googletag.pubads().disableInitialLoad(),e.e.googletag.pubads().enableSingleRequest(),(o=e.r.gpt)!=null&&o.pageSettingsConfig&&e.e.googletag.setConfig(e.r.gpt.pageSettingsConfig);let s=!Nt(e.o,e.r.consent);e.t.debug("GAM","use limited ads",s),e.e.googletag.pubads().setPrivacySettings({limitedAds:s}),e.e.googletag.enableServices(),i();return;case"test":i();return}})),t))},Gt=()=>$("gpt-device-label-keyValue",Z,t=>t.i==="test"?Promise.resolve():new Promise(e=>{let r=t.u.getDeviceLabel();t.t.debug("GAM",'adding "device_label" key-value with values',r),t.e.googletag.pubads().setTargeting("device_label",r),e()})),Wt=()=>$("gpt-consent-keyValue",Z,t=>t.i==="test"?Promise.resolve():new Promise(e=>{let r=t.o,i=!r.gdprApplies||[T.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,T.responses.TCPurpose.SELECT_BASIC_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,T.responses.TCPurpose.MEASURE_AD_PERFORMANCE,T.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,T.responses.TCPurpose.APPLY_MARKET_RESEARCH,T.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(n=>r.purpose.consents[n]);t.e.googletag.pubads().setTargeting("consent",i?"full":"none"),e()})),Ht=()=>(t,e)=>{let r=e.map(i=>{var f;let n=new te(i.sizeConfig,t.u.getSupportedLabels(),t.e),o=n.filterSupportedSizes;if(!(n.filterSlot(i)&&t.u.filterSlot(i)))return Promise.resolve(null);let s=o(i.sizes),d=J(i.adUnitPath,t.m),u=y=>{if(!t.e.document.getElementById(y)){let g=t.e.document.createElement("div");g.id=y,g.setAttribute("data-h5v-position",i.position),g.style.setProperty("display","none"),t.e.document.body.appendChild(g)}},l=()=>{switch(i.position){case"in-page":return[t.e.googletag.defineSlot(d,s,i.domId),null];case"interstitial":return u(i.domId),[t.e.googletag.defineSlot(d,s,i.domId),null];case"out-of-page":return u(i.domId),[t.e.googletag.defineOutOfPageSlot(d,i.domId),null];case"out-of-page-interstitial":return[t.e.googletag.defineOutOfPageSlot(d,t.e.googletag.enums.OutOfPageFormat.INTERSTITIAL),t.e.googletag.enums.OutOfPageFormat.INTERSTITIAL];case"out-of-page-bottom-anchor":return[t.e.googletag.defineOutOfPageSlot(d,t.e.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR),t.e.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR];case"out-of-page-top-anchor":return[t.e.googletag.defineOutOfPageSlot(d,t.e.googletag.enums.OutOfPageFormat.TOP_ANCHOR),t.e.googletag.enums.OutOfPageFormat.TOP_ANCHOR]}},a=()=>{if(t.i==="test")return null;let[y,g]=l();return y&&(g?y.setTargeting(Ae,g.toString()):y.clearTargeting(Ae),t.e.googletag.display(y)),y},c=(t.i==="test"?[]:t.e.googletag.pubads().getSlots()).find(y=>y.getSlotElementId()===i.domId),m=c||a();switch(t.i){case"production":if(m)return m.setCollapseEmptyDiv(((f=i.gpt)==null?void 0:f.collapseEmptyDiv)!==!1),m.addService(t.e.googletag.pubads()),t.t.debug("GAM",`Register slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath}`),Promise.resolve({moliSlot:i,adSlot:m,filterSupportedSizes:o});if(i.position==="out-of-page-interstitial"||i.position==="out-of-page-top-anchor"||i.position==="out-of-page-bottom-anchor")return t.t.warn("GAM",`${i.position} is not supported`),Promise.resolve(null);{let y=`Slot: [DomID] ${i.domId} [AdUnitPath] ${i.adUnitPath} is already defined. You may have called requestAds() multiple times`;return t.t.error("GAM",y),Promise.reject(new Error(y))}case"test":return Promise.resolve({moliSlot:i,adSlot:$i(i.domId,i.adUnitPath),filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${t.l.environment}`)}});return Promise.all(r).then(i=>i.filter(z))},Gi=(t,e)=>{let r=t.find(({moliSlot:i})=>i.position==="interstitial");if(r&&r.adSlot.getTargeting("hb_pb").length===0){e.e.googletag.destroySlots([r.adSlot]);let n=e.e.googletag.defineOutOfPageSlot(J(r.moliSlot.adUnitPath,e.m),e.e.googletag.enums.OutOfPageFormat.INTERSTITIAL);if(n)return e.t.debug("GAM","Display out-of-page-interstitial slot"),n.addService(e.e.googletag.pubads()),e.e.googletag.display(n),[...t.filter(({moliSlot:o})=>o.position!=="interstitial"),x(h({},r),{adSlot:n})];e.t.error("GAM","Failed to define out-of-page-interstitial slot")}return t},Kt=()=>(t,e)=>new Promise(r=>{switch(t.t.debug("GAM","requestAds"),t.i){case"test":Ke(t,e);break;case"production":let i=e.filter(({moliSlot:s,adSlot:d})=>!t.g.isSlotThrottled(s.domId,d.getAdUnitPath()));if(i.length===0)break;let n=Gi(i,t);t.e.googletag.pubads().refresh(n.map(({adSlot:s})=>s));let o=n.map(({moliSlot:s})=>`[DomID] ${s.domId} [AdUnitPath] ${s.adUnitPath}`).join(`
`);t.t.debug("GAM",`Refresh ${e.length} slot(s):
${o}`);break}r()});var me;(R=>{let t;(se=>{let ee;(ae=>(ae[ae.Unknown=0]="Unknown",ae[ae.ProfessionallyProduced=1]="ProfessionallyProduced",ae[ae.Prosumer=2]="Prosumer",ae[ae.UGC=3]="UGC"))(ee=se.ContentQuality||(se.ContentQuality={}))})(t=R.firstpartydata||(R.firstpartydata={}));let e;(K=>{let ee;(pe=>(pe[pe.NO=0]="NO",pe[pe.YES=1]="YES"))(ee=K.Skip||(K.Skip={}));let se;(F=>(F[F.VAST_1=1]="VAST_1",F[F.VAST_2=2]="VAST_2",F[F.VAST_3=3]="VAST_3",F[F.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",F[F.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",F[F.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",F[F.VAST_4=7]="VAST_4",F[F.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",F[F.DAAST_1=9]="DAAST_1",F[F.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(se=K.Protocol||(K.Protocol={}));let Ee;(U=>(U[U.AutoPlaySoundOff=1]="AutoPlaySoundOff",U[U.AutoPlaySoundOn=2]="AutoPlaySoundOn",U[U.ClickToPlay=3]="ClickToPlay",U[U.MousOver=4]="MousOver",U[U.InViewportSoundsOn=5]="InViewportSoundsOn",U[U.InViewportSoundsOff=6]="InViewportSoundsOff"))(Ee=K.PlaybackMethod||(K.PlaybackMethod={}));let De;(U=>(U[U.VPAID_1=1]="VPAID_1",U[U.VPAID_2=2]="VPAID_2",U[U.MRAID_1=3]="MRAID_1",U[U.ORMMA=4]="ORMMA",U[U.MRAID_2=5]="MRAID_2",U[U.MRAID_3=6]="MRAID_3"))(De=K.Api||(K.Api={}));let he;(de=>(de[de.InStream=1]="InStream",de[de.InBanner=2]="InBanner",de[de.InArticle=3]="InArticle",de[de.InFeed=4]="InFeed",de[de.Interstitial=5]="Interstitial"))(he=K.Placement||(K.Placement={}));let Si;(ge=>(ge[ge.Instream=1]="Instream",ge[ge.AccompanyingContent=2]="AccompanyingContent",ge[ge.Interstitial=3]="Interstitial",ge[ge.NoContentStandalone=4]="NoContentStandalone"))(Si=K.Plcmt||(K.Plcmt={}));let ae;(B=>(B[B.AudioAdAutoPlay=1]="AudioAdAutoPlay",B[B.AudioAdUserInitiated=2]="AudioAdUserInitiated",B[B.ExpandableAutomatic=3]="ExpandableAutomatic",B[B.ExpandableOnClick=4]="ExpandableOnClick",B[B.ExpandableOnRollover=5]="ExpandableOnRollover",B[B.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",B[B.InBannerVideoAdClick=7]="InBannerVideoAdClick",B[B.Pop=8]="Pop",B[B.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",B[B.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",B[B.Surveys=11]="Surveys",B[B.TextOnly=12]="TextOnly",B[B.UserInteractive=13]="UserInteractive",B[B.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",B[B.HasAudioOnOffButton=15]="HasAudioOnOffButton",B[B.HasSkipButton=16]="HasSkipButton",B[B.AdobeFlash=16]="AdobeFlash"))(ae=K.CreativeAttributes||(K.CreativeAttributes={}));let Ai;(pe=>(pe[pe.LinerInStream=1]="LinerInStream",pe[pe.NonLinearOverlay=2]="NonLinearOverlay"))(Ai=K.Linearity||(K.Linearity={}))})(e=R.video||(R.video={})),R.Adagio="adagio",R.AdaptMx="amx",R.Adform="adf",R.AdUp="aduptech",R.Criteo="criteo",R.ConnectAd="connectad",R.AppNexusAst="appnexusAst",R.AppNexus="appnexus",R.GumGum="gumgum",R.ImproveDigital="improvedigital",R.IndexExchange="ix",R.Invibes="invibes",R.NanoInteractive="nanointeractive",R.PubMatic="pubmatic",R.Ogury="ogury",R.OneTag="onetag",R.OpenX="openx",R.SmartAdServer="smartadserver",R.Smartx="smartx",R.Unruly="unruly",R.Teads="teads",R.TheTradeDesk="ttd",R.Triplelift="triplelift",R.Yieldlab="yieldlab",R.Seedtag="seedtag",R.Spotx="spotx",R.ShowHeroes="showheroesBs",R.StroeerCore="stroeerCore",R.StailaMedia="stailamedia",R.Xaxis="xhb",R.DSPX="dspx",R.RichAudience="ra",R.Rubicon="rubicon",R.Recognified="rads",R.Visx="visx",R.Vlyby="vlyby",R.Orbidder="orbidder"})(me||(me={}));var Yt=(t,e)=>{var r;return x(h({},t),{ext:x(h({},t.ext),{prebid:x(h({},(r=t.ext)==null?void 0:r.prebid),{storedrequest:e})})})};var xe={version:"5.5.0"};var Jt=(t,e,r={})=>({url:e,render:i=>Wi(i,t,r),backupOnly:!0}),Wi=(t,e,r={})=>{if(!t.renderer){le().error("Can not initialize prebid outstream player, because bid.renderer is not defined");return}t.renderer.push(()=>{var i;return(i=window.outstreamPlayer)==null?void 0:i.call(window,t,e,r)})};var Hi=t=>new Promise((e,r)=>{t.e.setTimeout(()=>r("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),Ki=t=>new Promise(e=>t.pbjs.que.push(e)),Xt=t=>!!t.moliSlot.prebid,Yi=(t,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(r=>t.code===r.code):!1,Qt=(t,e,r)=>r.filter(Xt).map(({moliSlot:n,priceRule:o,filterSupportedSizes:s})=>{var u,l;let d=o?{floors:{currency:(l=(u=e.config.currency)==null?void 0:u.adServerCurrency)!=null?l:"EUR",schema:{delimiter:"|",fields:["mediaType"]},values:{"*":o.floorprice}}}:null;return t.t.debug("Prebid",t.c,"Price Rule",o,n.domId,d),Ji(n.prebid).map(a=>{var N,j,W,X;let p=a.adUnit.mediaTypes.banner,c=a.adUnit.mediaTypes.video,m=a.adUnit.mediaTypes.native,f=p?s(p.sizes).filter(te.isFixedSize):[],y=c?Xi(c.playerSize,s):[],g=a.adUnit.bids.filter(re=>t.u.filterSlot(re)).filter(re=>!re.bidder||re.bidder&&!t.g.isBidderDisabled(n.domId,re.bidder)&&!t.g.isBidderFrequencyCappedOnSlot(n.domId,re.bidder)).map(re=>{let w=re,{labelAny:I,labelAll:M}=w;return xt(w,["labelAny","labelAll"])}),A=y.length>0&&!(c!=null&&c.w)&&!(c!=null&&c.h)?{w:y[0][0],h:y[0][1]}:{},S=e.backupVideoRenderer,P=c?{video:h(h(x(h({},c),{playerSize:y.length===0?void 0:y}),A),S?{renderer:Jt(n.domId,S.url)}:{})}:void 0,v=p&&f.length>0?{banner:x(h({},p),{sizes:f})}:void 0,b=m?{native:h({},m)}:void 0,C=x(h({},a.adUnit.pubstack),{adUnitPath:J(((N=a.adUnit.pubstack)==null?void 0:N.adUnitPath)||n.adUnitPath,t.m)}),E=(X=(W=(j=a.adUnit.ortb2Imp)==null?void 0:j.ext)==null?void 0:W.prebid)==null?void 0:X.storedrequest,D=E&&E.id?x(h({},E),{id:J(E.id,t.m)}):null;return h(x(h(x(h(h({},a.adUnit),E&&D&&{ortb2Imp:Yt(a.adUnit.ortb2Imp,D)}),{code:a.adUnit.code||n.domId}),a.adUnit.pubstack?{pubstack:C}:{}),{mediaTypes:h(h(h({},P),v),b),bids:g}),d)}).filter(a=>a.bids.length>0&&a.mediaTypes&&(a.mediaTypes.banner||a.mediaTypes.video||a.mediaTypes.native)&&!Yi(a,t.e))}).reduce((n,o)=>[...n,...o],[]),Zt=t=>_("prebid-init",e=>{var i,n;e.e.pbjs=e.e.pbjs||{que:[]};let r=(i=e.r.prebid)==null?void 0:i.analyticAdapters;return r&&r.length>0&&e.e.pbjs.que.push(()=>{e.e.pbjs.enableAnalytics(r)}),e.e.pbjs.libLoaded?Promise.resolve():(n=e.r.prebid)!=null&&n.distributionUrl?(t.loadScript({name:"prebid",assetUrl:e.r.prebid.distributionUrl,loadMethod:1}),Promise.resolve()):Promise.race([Ki(e.e),Hi(e)])}),er=t=>V("prebid-remove-adunits",e=>new Promise(r=>{if(t.ephemeralAdUnits!==!0){e.e.pbjs=e.e.pbjs||{que:[]};let i=e.e.pbjs.adUnits;i&&e.e.pbjs.que.push(()=>{e.t.debug("Prebid","Destroying prebid adUnits",i),i.forEach(n=>e.e.pbjs.removeAdUnit(n.code))})}r()})),tr=()=>oe("prebid-clear-auction",t=>new Promise(e=>{t.e.pbjs=t.e.pbjs||{que:[]},t.e.pbjs.que.push(()=>{t.t.debug("Prebid","Clearing prebid auctions"),t.e.pbjs.clearAllAuctions()}),e()})),rr=(t,e)=>{let r,i=n=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:n}});return V("prebid-configure",(n,o)=>(r||(r=new Promise(s=>{t.bidderSettings&&(n.e.pbjs.bidderSettings=t.bidderSettings),n.e.pbjs.que.push(()=>{var u;t.config.s2sConfig&&(Array.isArray(t.config.s2sConfig)?t.config.s2sConfig:[t.config.s2sConfig]).forEach(a=>{var c,m;let p=(m=(c=a.extPrebid)==null?void 0:c.analytics)==null?void 0:m.h5v;p&&(p.configLabel=n.e.moli.configLabel,p.moliVersion=xe.version)}),n.e.pbjs.setConfig(x(h({},t.config),{schain:i([e.supplyChainStartNode]),floors:t.config.floors||{}})),(u=t.bidderConfigs)==null||u.forEach(({options:l,merge:a})=>{n.e.pbjs.setBidderConfig(l,a)}),t.schain.nodes.forEach(({bidder:l,node:a,appendNode:p})=>{let c=[e.supplyChainStartNode];p&&c.push(a),n.e.pbjs.setBidderConfig({bidders:[l],config:{schain:i(c)}},!0)}),n.e.pbjs.registerSignalSources&&n.e.pbjs.registerSignalSources()}),s()})),r))},Ji=t=>Array.isArray(t)?t:[t],ir=t=>$("prebid-prepare-adunits",Z,(e,r)=>new Promise(i=>{t.ephemeralAdUnits||e.e.pbjs.que.push(()=>{let n=Qt(e,t,r);n.forEach(o=>{e.t.debug("Prebid",e.c,`Prebid add ad unit: [Code] ${o.code}`,o)}),e.e.pbjs.addAdUnits(n)}),i()})),or=(t,e)=>We("prebid-request-bids",(r,i)=>{var d,u;let n=Math.max(((d=t.config.bidderTimeout)!=null?d:2e3)+3e3,(u=t.failsafeTimeout)!=null?u:0),o=new Promise(l=>r.e.setTimeout(l,n)),s=new Promise(l=>{var y;let a=i.filter(g=>!r.g.isSlotThrottled(g.moliSlot.domId,g.adSlot.getAdUnitPath())),p=t.ephemeralAdUnits?{adUnits:Qt(r,t,a)}:{adUnitCodes:a.filter(Xt).map(g=>g.moliSlot.domId)},c=p.adUnitCodes||((y=p.adUnits)==null?void 0:y.map(g=>g.code).filter(z).filter(Y))||[];if(c.length===0)return r.t.debug("Prebid","skip request bids. All slots were filtered.",a.map(g=>g.moliSlot)),l();let m=!1;r.t.debug("Prebid",`Prebid request bids: 
			${c.join(`
			`)}`);let f=(g,A,S)=>{r.t.info("Prebid",S,g,i.map(P=>P.moliSlot.domId));try{if(m){r.t.warn("Prebid",`ad server request already sent [${r.c}]. AuctionId ${S}`);return}if(!g)return r.t.warn("Prebid",`Undefined bid response map for ad unit codes: ${c.join(", ")}`),l();m=!0,e==="gam"&&(r.l.adPipelineConfig.prebidBidsBackHandler.forEach(P=>P(r,g,i)),r.e.pbjs.setTargetingForGPTAsync(c)),l()}catch(P){r.t.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(P)),l()}};r.e.pbjs.que.push(()=>{var g;r.e.pbjs.requestBids(x(h({},p),{auctionId:r.I,timeout:(g=r.b)==null?void 0:g.timeout,bidsBackHandler:f}))})});return Promise.race([o,s])}),nr=()=>(t,e)=>{let r=e.map(i=>{let n=new te(i.sizeConfig,t.u.getSupportedLabels(),t.e),o=n.filterSupportedSizes;if(!(n.filterSlot(i)&&t.u.filterSlot(i)))return Promise.resolve(null);let s={getAdUnitPath:()=>i.adUnitPath};switch(t.i){case"production":return Promise.resolve({moliSlot:i,adSlot:s,filterSupportedSizes:o});case"test":return Promise.resolve({moliSlot:i,adSlot:s,filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${t.l.environment}`)}});return Promise.all(r).then(i=>i.filter(z))},sr=()=>(t,e)=>new Promise((r,i)=>{t.t.debug("Prebid","start rendering");try{switch(t.i){case"test":t.t.debug("Prebid","Rendering test slots"),Ke(t,e);break;case"production":t.e.pbjs.getHighestCpmBids().filter(n=>n&&n.adId).forEach(n=>{var s;let o=t.e.document.getElementById(n.adUnitCode);if(o){let d=document.createElement("div");d.style.setProperty("border","0pt none");let u=document.createElement("iframe");u.scrolling="no",u.frameBorder="0",u.marginHeight="0",u.marginHeight="0",u.name=`prebid_ads_iframe_${n.adUnitCode}`,u.title="3rd party ad content",u.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),u.setAttribute("aria-label","Advertisment"),u.style.setProperty("border","0"),u.style.setProperty("margin","0"),u.style.setProperty("overflow","hidden"),d.appendChild(u),o.appendChild(d);let l=(s=u.contentWindow)==null?void 0:s.document;if(l){t.e.pbjs.renderAd(l,n.adId);let a="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",p=l.createElement("style");p.appendChild(l.createTextNode(a)),l.head.appendChild(p)}else t.t.error("Prebid",`No access to iframe contentWindow for ad unit${n.adUnitCode}`)}else t.t.error("Prebid",`Could not locate ad slot with id ${n.adUnitCode}`)});break}r()}catch(n){i(n)}}),Xi=(t,e)=>{let r=i=>!!i&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number";return t?e(r(t)?[t]:t).filter(te.isFixedSize):[]};var ve=T.responses.TCPurpose,Qi=t=>!!t.moliSlot.a9,ar=t=>!t.gdprApplies||t.vendor.consents[793]&&[ve.STORE_INFORMATION_ON_DEVICE,ve.SELECT_BASIC_ADS,ve.CREATE_PERSONALISED_ADS_PROFILE,ve.SELECT_PERSONALISED_ADS,ve.MEASURE_AD_PERFORMANCE,ve.APPLY_MARKET_RESEARCH,ve.DEVELOP_IMPROVE_PRODUCTS].every(e=>t.purpose.consents[e]),dr=(t,e)=>_("a9-init",r=>new Promise(i=>{r.e.apstag=r.e.apstag||{_Q:[],init:function(){r.e.apstag._Q.push(["i",arguments])},fetchBids:function(){r.e.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){r.e.apstag._Q.push(["di",arguments])},rpa:function(){r.e.apstag._Q.push(["ri",arguments])},upa:function(){r.e.apstag._Q.push(["ui",arguments])}},r.i!=="test"&&ar(r.o)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:t.scriptUrl?t.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(n=>r.t.error("failed to load apstag.js",n)),i()})),lr=(t,e)=>V("a9-configure",(r,i)=>new Promise(n=>{let o=[e.supplyChainStartNode];t.schainNode&&o.push(t.schainNode),r.e.apstag.init({pubID:t.pubID,adServer:"googletag",bidTimeout:t.timeout,gdpr:{cmpTimeout:t.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:o}}),n()})),ur=t=>Dt("a9-publisher-audiences",(e,r)=>new Promise(i=>{let n=t.publisherAudience;if(n&&n.enabled){let o={hashedRecords:[{type:"email",record:n.sha256Email}]};if(e.t.debug("A9","Enable publisher audiences"),e.e.apstag.rpa(o),e.e.__tcfapi){let s=!0;e.e.__tcfapi("addEventListener",2,d=>{if(s){s=!1;return}d.eventStatus===T.status.EventStatus.USER_ACTION_COMPLETE&&(e.t.debug("A9","Update publisher audience token"),e.e.apstag.upa(o))})}}i()})),pr=()=>$("a9-clear-targeting",Z,(t,e)=>t.c===0?(t.t.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(r=>{t.t.debug("A9","clear a9 targetings"),e.forEach(({adSlot:i})=>{i.getTargetingKeys().filter(n=>n==="amznp"||n==="amznsz"||n==="amznbid").forEach(n=>i.clearTargeting(n))}),r()})),Zi=(t,e,r)=>{let i=$e(t),n=e?Ot(i,e):i;return J(n,r)},cr=t=>We("a9-fetch-bids",(e,r)=>new Promise(i=>{var o;if(!ar(e.o)){e.t.debug("A9","Skip any due to missing consent"),i();return}let n=r.filter(Qi).filter(s=>!e.g.isSlotThrottled(s.moliSlot.domId,s.adSlot.getAdUnitPath())).filter(s=>{let d=s.moliSlot.a9.mediaType==="video",u=e.u.filterSlot(s.moliSlot.a9),l=s.filterSupportedSizes(s.moliSlot.sizes).filter(te.isFixedSize).length>0;return u&&(d||l)}).map(({moliSlot:s,priceRule:d,filterSupportedSizes:u})=>{var l,a;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let p=t.supportedSizes?s.sizes.filter(m=>{var f;return(f=t.supportedSizes)==null?void 0:f.some(y=>He(y,m))}):s.sizes,c=Zi(s.adUnitPath,(l=s.a9.slotNamePathDepth)!=null?l:t.slotNamePathDepth,e.m);return h({slotID:s.domId,slotName:c,sizes:u(p).filter(te.isFixedSize)},t.enableFloorPrices&&d?{floor:{value:Math.ceil((a=e.e.pbjs)!=null&&a.convertCurrency?e.e.pbjs.convertCurrency(d.floorprice,"EUR",t.floorPriceCurrency||"USD")*100:d.floorprice*100*1.19),currency:t.floorPriceCurrency||"USD"}}:{})}});e.t.debug("A9",`Fetch '${n.length}' A9 slots: ${n.map(s=>`[slotID] ${s.slotID}`)}`),n.length===0?i():e.e.apstag.fetchBids(h({slots:n},((o=e.b)==null?void 0:o.timeout)&&{bidTimeout:e.b.timeout}),s=>{e.e.apstag.setDisplayBids(),i()})}));var mr=(t,e)=>e?new Promise(r=>t.setTimeout(r,e)):Promise.resolve(),gr=t=>Number(be(ne.debugDelay,t.localStorage))||void 0;var fr=(t,e,r)=>{let i=new Map;r==null||r.info(`Bidders disabling feature is ${t.enabled?"enabled":"disabled"}`);let n=(a,p)=>{var c,m,f,y;return(c=t.excludedPositions)!=null&&c.includes(a)?!1:(y=(f=(m=i.get(a))==null?void 0:m.get(p))==null?void 0:f.disabled)!=null?y:!1},o=a=>{var p,c;(p=a.bidderRequests)==null||p.forEach(m=>{var f;(f=m==null?void 0:m.bids)==null||f.forEach(y=>{var P,v,b;let g=y.bidder,A=y.adUnitCode;i.get(A)||i.set(A,new Map);let S=(P=i.get(A))==null?void 0:P.get(g);if(S){let C=S.bidRequestCount+1;(v=i.get(A))==null||v.set(g,x(h({},S),{bidRequestCount:C}))}else(b=i.get(A))==null||b.set(g,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),(c=a.bidsReceived)==null||c.forEach(m=>{var A,S,P;let f=m.bidderCode,y=m.adUnitCode,g=(A=i.get(y))==null?void 0:A.get(f);g?(S=i.get(y))==null||S.set(f,x(h({},g),{bidReceivedCount:g.bidReceivedCount+1})):(P=i.get(y))==null||P.set(f,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),s()},s=()=>{i.forEach((a,p)=>{a.forEach((c,m)=>{d(c)&&(u(p,m),e.setTimeout(()=>{l(p,m)},t.reactivationPeriod))})})},d=a=>a.bidRequestCount>t.minBidRequests&&a.bidReceivedCount/a.bidRequestCount<t.minRate&&!a.disabled,u=(a,p)=>{var m;let c=(m=i.get(a))==null?void 0:m.get(p);c&&(c.disabled=!0,r==null||r.info(`Bidder ${p} for position ${a} is now disabled.`))},l=(a,p)=>{var m;let c=(m=i.get(a))==null?void 0:m.get(p);c&&(c.disabled=!1,r==null||r.info(`Bidder ${p} for position ${a} is now enabled.`))};return{isBidderDisabled:n,onAuctionEnd:o}};var yr=(t,e)=>{let r=new Set;function i(o){let s=o.slot.getSlotElementId();(!t.includedDomIds||t.includedDomIds.length===0||t.includedDomIds.includes(s))&&(r.add(s),e.setTimeout(()=>{r.delete(s)},t.throttle*1e3))}function n(o){return r.has(o)}return{onSlotRequested:i,isThrottled:n}};var vt=(t,e)=>Math.max(t.wait-(e-t.ts),0);var ke;(e=>{let t;(i=>{let r;(u=>(u[u.TOP_ANCHOR=2]="TOP_ANCHOR",u[u.BOTTOM_ANCHOR=3]="BOTTOM_ANCHOR",u[u.REWARDED=4]="REWARDED",u[u.INTERSTITIAL=5]="INTERSTITIAL"))(r=i.OutOfPageFormat||(i.OutOfPageFormat={}))})(t=e.enums||(e.enums={}))})(ke||(ke={}));var br="h5v-fc",eo=t=>!!t.conditions&&!!t.conditions.pacingInterval,vr=(t,e,r,i)=>{var g,A,S,P;let n=new Map,o=new Map,s=new Map,d=0,u=(A=(g=t.bidders)==null?void 0:g.filter(eo))!=null?A:[],l=(S=u.filter(v=>{var b,C,E;return!((b=v.conditions.pacingInterval)!=null&&b.events)||((E=(C=v.conditions.pacingInterval)==null?void 0:C.events)==null?void 0:E.includes("bidWon"))}))!=null?S:[],a=(P=u.filter(v=>{var b,C;return(C=(b=v.conditions.pacingInterval)==null?void 0:b.events)==null?void 0:C.includes("bidRequested")}))!=null?P:[],p=t.positions||[],c=()=>{if(t.persistent===!0){let v={bCaps:Array.from(s.entries()).reduce((b,[C,E])=>x(h({},b),{[C]:E}),{}),pCaps:Array.from(n.entries()).reduce((b,[C,E])=>x(h({},b),{[C]:E}),{}),pLastImpAdRequests:Array.from(o.entries()).reduce((b,[C,E])=>x(h({},b),{[C]:E}),{}),requestAds:d};e.sessionStorage.setItem(br,JSON.stringify(v))}},m=(v,b,C,E)=>{var N;let D=b.bidders;if((!D||D.includes(E.bidder))&&b.domId===E.adUnitCode){let j=`${E.adUnitCode}:${E.bidder}`,W=(N=s.get(j))!=null?N:[];W.push({ts:v,wait:C}),s.set(j,W),e.setTimeout(()=>{i.debug("fc",`removing ${j} at ${v}`);let X=s.get(j);X&&s.set(j,X.filter(re=>re.ts!==v))},C),c()}},f=(v,b,C)=>{var D;let E=(D=n.get(b))!=null?D:[];E.push({ts:v,wait:C.intervalInMs}),n.set(b,E),e.setTimeout(()=>{let N=n.get(b);N&&n.set(b,N.filter(j=>j.ts!==v))},C.intervalInMs),c()},y=v=>{p.filter(b=>b.adUnitPath===v).forEach(b=>{b.conditions.pacingInterval&&f(r(),v,b.conditions.pacingInterval),b.conditions.pacingRequestAds&&(o.set(v,d),c())})};if(t.persistent===!0){let v=e.sessionStorage.getItem(br);if(v)try{let b=JSON.parse(v);d=b.requestAds,Object.entries(b.bCaps).forEach(([C,E])=>{E==null||E.forEach(D=>{let[N,j]=C.split(":"),W=vt(D,r());m(r(),{domId:N,bidders:[j]},W,{bidder:j,adUnitCode:N})})}),Object.entries(b.pCaps).forEach(([C,E])=>{E==null||E.forEach(D=>{let N=vt(D,r());f(D.ts,C,{intervalInMs:N})})})}catch(b){i.error("fc","failed to parse fc state",b)}}return{onAuctionEnd(v){a.forEach(b=>{var C;(C=v.bidderRequests)==null||C.forEach(E=>{var D;(D=E==null?void 0:E.bids)==null||D.forEach(N=>{m(r(),b,b.conditions.pacingInterval.intervalInMs,N)})})}),c()},onBidWon(v){l.forEach(b=>m(r(),b,b.conditions.pacingInterval.intervalInMs,v)),c()},onSlotRenderEnded(v){let[b]=v.slot.getTargeting(Ae);!v.isEmpty&&b!==ke.enums.OutOfPageFormat.INTERSTITIAL.toString()&&y(v.slot.getAdUnitPath())},onImpressionViewable(v){let[b]=v.slot.getTargeting(Ae);b===ke.enums.OutOfPageFormat.INTERSTITIAL.toString()&&y(v.slot.getAdUnitPath())},afterRequestAds(){d++,c()},updateAdUnitPaths(v){var b;p=((b=t.positions)!=null?b:[]).map(C=>x(h({},C),{adUnitPath:J(C.adUnitPath,v)}))},isAdUnitCapped(v){return p.filter(b=>b.adUnitPath===v).some(b=>{var C,E;return b.adUnitPath===v&&b.conditions.delay&&d<b.conditions.delay.minRequestAds||b.conditions.pacingRequestAds&&o.has(v)&&d-((C=o.get(v))!=null?C:0)<b.conditions.pacingRequestAds.requestAds||b.conditions.pacingInterval&&((E=n.get(v))!=null?E:[]).length>=b.conditions.pacingInterval.maxImpressions})},isFrequencyCapped(v,b){return t.bidders?t.bidders.filter(C=>C.domId===v&&(!C.bidders||C.bidders.includes(b))).some(({conditions:{pacingInterval:C,delay:E}})=>{var D;return C&&((D=s.get(`${v}:${b}`))!=null?D:[]).length>=C.maxImpressions||E&&d<E.minRequestAds}):!1}}};var hr=()=>{let t=new Map,e=n=>n.reduce((o,s)=>{let{adUnitCode:d,cpm:u}=s;return o[d]||(o[d]=[]),o[d].push(u),o},{}),r=n=>{let o=e(n);t.forEach((s,d)=>{o[d]||t.delete(d)}),Object.entries(o).forEach(([s,d])=>{var l;let u=(l=i(s))!=null?l:[];t.set(s,Array.from(new Set([...d,...u])))})},i=n=>{var o;return(o=t.get(n))!=null?o:null};return{groupReceivedBidsByAdUnitCode:e,onAuctionEnd:r,getLastBidCpms:i}};var Ye=(t,e,r,i={})=>{var l,a,p,c,m,f,y,g,A;let n=(l=i.biddersDisabling)!=null&&l.enabled?fr(i.biddersDisabling,t):void 0,o=(a=i.adRequestThrottling)!=null&&a.enabled?yr(i.adRequestThrottling,t):void 0,s=(p=i.frequencyCap)!=null&&p.enabled?vr(i.frequencyCap,t,t.Date.now,e):void 0,d=(c=i.previousBidCpms)!=null&&c.enabled?hr():void 0;t.pbjs=t.pbjs||{que:[]},t.googletag=t.googletag||{},t.googletag.cmd=t.googletag.cmd||[],((m=i.biddersDisabling)!=null&&m.enabled||(f=i.previousBidCpms)!=null&&f.enabled||(y=i.frequencyCap)!=null&&y.enabled)&&t.pbjs.que.push(()=>{t.pbjs.onEvent("auctionEnd",S=>{var P,v,b;(P=i.biddersDisabling)!=null&&P.enabled&&(n==null||n.onAuctionEnd(S)),(v=i.previousBidCpms)!=null&&v.enabled&&S.bidsReceived&&(d==null||d.onAuctionEnd(S.bidsReceived)),(b=i.frequencyCap)!=null&&b.enabled&&(s==null||s.onAuctionEnd(S))})}),(g=i.adRequestThrottling)!=null&&g.enabled&&t.googletag.cmd.push(()=>{t.googletag.pubads().addEventListener("slotRequested",S=>{o==null||o.onSlotRequested(S)})}),(A=i.frequencyCap)!=null&&A.enabled&&(t.pbjs.que.push(()=>{t.pbjs.onEvent("bidWon",S=>{i.frequencyCap&&(s==null||s.onBidWon(S))})}),t.googletag.cmd.push(()=>{t.googletag.pubads().addEventListener("slotRenderEnded",S=>{s==null||s.onSlotRenderEnded(S)}),t.googletag.pubads().addEventListener("impressionViewable",S=>{s==null||s.onImpressionViewable(S)})}),r.addEventListener("afterRequestAds",()=>{s==null||s.afterRequestAds()}));let u=V("GlobalAuctionContext",S=>(s==null||s.updateAdUnitPaths(S.m),Promise.resolve()));return{isSlotThrottled(S,P){return!!(o!=null&&o.isThrottled(S)||s!=null&&s.isAdUnitCapped(P))},isBidderFrequencyCappedOnSlot(S,P){var v;return(v=s==null?void 0:s.isFrequencyCapped(S,P))!=null?v:!1},getLastBidCpmsOfAdUnit(S){var P;return(P=d==null?void 0:d.getLastBidCpms(S))!=null?P:[]},isBidderDisabled(S,P){var v;return(v=n==null?void 0:n.isBidderDisabled(S,P))!=null?v:!1},configureStep(){return u}}};var Oe=t=>t!==null&&typeof t=="object"&&!Array.isArray(t);function Je(t,...e){if(!e.length)return t;let r=e.shift();if(Oe(t)&&Oe(r))for(let i in r)Oe(r[i])?(t[i]||Object.assign(t,{[i]:{}}),Je(t[i],r[i])):Array.isArray(r[i])?t[i]?Array.isArray(t[i])&&(t[i]=t[i].concat(r[i])):Object.assign(t,{[i]:r[i]}):Object.assign(t,{[i]:r[i]});return Je(t,...e)}var Ir=(t,e)=>e.pubads().getSlots().find(r=>r.getSlotElementId()===t.domId||r.getAdUnitPath()===t.adUnitPath),to=t=>{try{let e=typeof t=="string"?JSON.parse(t):Oe(t)?t:null;switch(e==null?void 0:e.event){case"h5.adunit.passback":return e.passbackOrigin&&(e.domId||e.adUnitPath)?e:null;case"h5.adunit.refresh":return e;default:return null}}catch(e){return null}},ro=(t,e)=>{let r=e.r.slots.find(n=>n.domId===t.domId&&n.behaviour.loaded==="backfill"),i=Ir(t,e.e.googletag);r&&i&&(e.t.debug("bridge",`Refresh ad slot ${t.domId}`),e.e.googletag.destroySlots([i]),e.e.moli.refreshAdSlot(t.domId,{loaded:"backfill"}).catch(n=>e.t.error("bridge",`failed to refresh ${t.domId}`,n)))},io=(t,e)=>{let r=Ir(t,e.e.googletag),i="passback";r&&r.getTargeting(i).length===0&&(e.t.debug("passback",`Process passback for ad slot ${r.getAdUnitPath()}`),r.setTargeting(i,"true"),r.setTargeting("passbackOrigin",t.passbackOrigin),e.e.googletag.pubads().refresh([r]))},Sr=()=>_("bridge",t=>{var e;return(e=t.r.bridge)!=null&&e.enabled&&(t.t.debug("bridge","add message listener"),t.e.addEventListener("message",r=>{let i=to(r.data);if(i)switch(i.event){case"h5.adunit.passback":io(i,t);break;case"h5.adunit.refresh":ro(i,t);break}})),Promise.resolve()});var oo=t=>t.behaviour.loaded==="manual",no=t=>t.behaviour.loaded==="infinite",so=t=>t.behaviour.loaded==="backfill",ht=t=>e=>!!t.document.getElementById(e.domId)||e.position==="interstitial"||e.position==="out-of-page"||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor",Pr=(t,e)=>t?typeof t=="string"?t:t[e]||"default":"default",Ar=(t,e,r,i,n)=>{let{loaded:o}=h({loaded:"manual"},n);return e.slots.filter(ht(t)).filter(s=>Pr(s.behaviour.bucket,r)===i&&(s.behaviour.loaded===o||s.behaviour.loaded==="infinite")).map(s=>n!=null&&n.sizesOverride?x(h({},s),{sizes:n.sizesOverride}):s)},Xe=class t{constructor(e,r,i,n){this.assetService=e;this.eventService=r;this.window=i;this.adPipelineConfig=n;this.requestAdsCalls=0;this.adPipeline=new Se({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},le(),this.window,Ye(this.window,le(),this.eventService));this.initialize=(e,r)=>{var c;let i=t.getEnvironment(r),n=e.adServer||"gam",o=n==="gam",s=((c=e.spa)==null?void 0:c.enabled)===!0;this.logger.setLogger(q(r,this.window)),this.logger.debug("AdService",`Initializing with environment ${i} and ad server ${n}`);let d=o?[Ft(),Sr()]:[],u=o?[$t()]:[];o&&s&&u.push(zt(),jt());let l=[];o&&l.push(Gt(),Wt());let a=[];e.prebid&&i==="production"&&(d.push(Zt(this.assetService)),u.push(rr(e.prebid,e.schain)),s&&(u.push(er(e.prebid)),e.prebid.clearAllAuctions&&u.push(tr())),l.push(ir(e.prebid)),a.push(or(e.prebid,n))),e.a9&&i==="production"&&o&&(d.push(dr(e.a9,this.assetService)),u.push(lr(e.a9,e.schain)),u.push(ur(e.a9)),l.push(pr()),a.push(cr(e.a9)));let p=Ye(this.window,this.logger,this.eventService,e.globalAuctionContext);if(u.push(p.configureStep()),d.push(...r.adPipelineConfig.initSteps),u.push(...r.adPipelineConfig.configureSteps),l.push(...r.adPipelineConfig.prepareRequestAdsSteps),a.push(...r.adPipelineConfig.requestBidsSteps),i==="test"){let m=gr(this.window);m&&u.push(()=>mr(this.window,m))}return this.adPipeline=new Se({init:d,configure:u,defineSlots:o?Ht():nr(),prepareRequestAds:l,requestBids:a,requestAds:o?Kt():sr()},this.logger,this.window,p),new Promise(m=>{_e(this.window,()=>{this.logger.debug("DOM","dom ready"),m(e)})})};this.requestAds=(e,r)=>Ue(this,null,function*(){var u;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:i,refreshInfiniteSlots:n,refreshBuckets:o}=r,s=bt(this.window,r,e.labelSizeConfig,e.targeting),d=o.flatMap(l=>Ar(this.window,e,s,l.bucket,l.options).map(a=>a.domId));this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,i,o),this.eventService.emit("beforeRequestAds",{runtimeConfig:r});try{let l=e.slots.map(a=>oo(a)?i.includes(a.domId)||d.includes(a.domId)?a:null:no(a)?n.some(p=>p.artificialDomId===a.domId)?a:null:so(a)?null:a).filter(z).filter(ht(this.window));if((u=e.buckets)!=null&&u.enabled){let a=new Map;l.forEach(c=>{let m=Pr(c.behaviour.bucket,s),f=a.get(m);f?f.push(c):a.set(m,[c])});let p=a.size===0?this.adPipeline.run([],e,r,this.requestAdsCalls).then(()=>[]):Promise.all(Array.from(a.entries()).map(([c,m])=>(this.logger.debug("AdPipeline",`running bucket ${c}, slots:`,m),this.adPipeline.run(m,e,r,this.requestAdsCalls).then(()=>m))));return this.eventService.emit("afterRequestAds",{state:"finished"}),p.then(c=>fe(c))}else return yield this.adPipeline.run(l,e,r,this.requestAdsCalls),this.eventService.emit("afterRequestAds",{state:"finished"}),l}catch(l){return this.logger.error("AdPipeline","slot filtering failed",l),this.eventService.emit("afterRequestAds",{state:"error"}),Promise.reject(l)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.logger=new ze(le()),n&&(this.adPipeline=new Se(n,this.logger,i,Ye(i,this.logger,this.eventService)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,r,i,n){if(e.length===0)return Promise.resolve();let{loaded:o}=h({loaded:"manual"},n),s=new Set(["infinite"]);o==="eager"?(s.add("manual"),s.add("eager")):s.add(o);let d=r.slots.filter(u=>e.some(l=>l===u.domId)&&s.has(u.behaviour.loaded)).filter(ht(this.window)).map(u=>n!=null&&n.sizesOverride?x(h({},u),{sizes:n.sizesOverride}):u);if(e.length!==d.length){let u=d.filter(a=>e.every(p=>p!==a.domId)),l=e.filter(a=>d.every(p=>p.domId!==a));u.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",u),l.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",u)}return this.logger.debug("AdService","refresh ad slots",d),this.adPipeline.run(d,r,i,this.requestAdsCalls,{options:n})}refreshBucket(e,r,i,n){var d;if(!((d=r.buckets)!=null&&d.enabled))return Promise.resolve();let o=bt(this.window,i,r.labelSizeConfig,r.targeting),s=Ar(this.window,r,o,e,n);return s.length===0?(this.logger.warn("AdService","No slots found in bucket",e),Promise.resolve()):(this.logger.debug("AdService","refresh ad buckets",s,r.targeting),this.adPipeline.run(s,r,i,this.requestAdsCalls,{bucketName:e,options:n}))}};var Cr=()=>{let t=new Map,e=new Map;return{addEventListener(r,i,n={}){var s;let o=n.once?e:t;o.has(r)||o.set(r,new Set),(s=o.get(r))==null||s.add(i)},removeEventListener(r,i){var n,o;(n=t.get(r))==null||n.delete(i),(o=e.get(r))==null||o.delete(i)},emit(r,i){var o;(o=t.get(r))==null||o.forEach(s=>{try{s(i)}catch(d){console.error(`Error in event listener for ${String(r)}:`,d)}});let n=e.get(r);n&&(n.forEach(s=>{try{s(i)}catch(d){console.error(`Error in one-time event listener for ${String(r)}:`,d)}finally{n.delete(s)}}),n.size===0&&e.delete(r))}}};var Be={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var we=(t,e,r,i=n=>!0)=>[{source:"queryParam",value:Ie(t.location.search).get(e)},{source:"sessionStorage",value:be(r,t.sessionStorage)},{source:"localStorage",value:be(r,t.localStorage)}].map(({source:n,value:o})=>o&&i(o)?{source:n,value:o}:void 0).filter(z);var ao=t=>!!["production","test"].find(r=>r===t),Rr=t=>we(t,Be.moliEnv,ne.moliEnv,ao)[0]||void 0,Er=(t,e)=>Te(ne.moliEnv,t,e);var qe=(t,e,r)=>{switch(t){case"none":return!0;case"href":return r.href===e;case"path":try{let i=new URL(e);return r.pathname===i.pathname}catch(i){return!0}}},Mr=(t,e,r)=>{switch(t){case"none":return!0;case"href":return r.href!==e;case"path":try{let i=new URL(e);return r.pathname!==i.pathname}catch(i){return!0}}};var Tr=t=>{let e=Ve(t),r=Cr(),i=new Xe(e,r,t),n=t,o={state:"configurable",initialize:!1,runtimeConfig:X(),modules:[]};function s(I,M){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.keyValues[I]=M;break}case"spa-finished":case"spa-requestAds":{o.nextRuntimeConfig.keyValues[I]=M;break}default:{q(o.runtimeConfig,t).error("MoliGlobal",`Setting key-value after configuration: ${I} : ${M}`);break}}}function d(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.labels.push(I);break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.labels.push(I);break}default:{q(o.runtimeConfig,t).error("MoliGlobal",`Adding label after configure: ${I}`);break}}}function u(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.adUnitPathVariables=I;break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.adUnitPathVariables=I;break}default:{q(o.runtimeConfig,t).error("MoliGlobal",`Setting unit path variables after configuration: ${I}`);break}}}function l(){let I=ye(t.location.hostname)||"unknown";switch(o.state){case"configurable":return x(h({},o.runtimeConfig.adUnitPathVariables),{domain:I,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let M=Me(o.config.labelSizeConfig||[],[],t);return x(h({},g().adUnitPathVariables),{domain:o.config.domain||I,device:M.getDeviceLabel()})}}function a(I,M){let w=(M||{}).removeNetworkChildId||!1,L=J(I,l());return w?$e(L):L}function p(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.logger=I;break}default:{I.error("Setting a custom logger is not allowed after configuration");break}}}function c(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.beforeRequestAds.push(I);break}default:{q(o.runtimeConfig,t).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",o.config);break}}}function m(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.afterRequestAds.push(I);break}default:{q(o.runtimeConfig,t).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",o.config);break}}}function f(){switch(o.state){case"configurable":return null;case"configured":return o.config;case"requestAds":return o.config;case"spa-requestAds":case"spa-finished":return o.config;case"finished":return o.config;case"error":return o.config}}function y(){return o.runtimeConfig}function g(){var I,M,k,w,L,H,O;return{keyValues:h(h({},(M=(I=o.config)==null?void 0:I.targeting)==null?void 0:M.keyValues),o.runtimeConfig.keyValues),labels:[...(L=(w=(k=o.config)==null?void 0:k.targeting)==null?void 0:w.labels)!=null?L:[],...o.runtimeConfig.labels],adUnitPathVariables:h(h({},(O=(H=o.config)==null?void 0:H.targeting)==null?void 0:O.adUnitPathVariables),o.runtimeConfig.adUnitPathVariables)}}function A(I){switch(o.state){case"configurable":case"configured":{o.modules.push(I);return}default:q(o.runtimeConfig,t).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function S(I){var M;switch(o.state){case"configurable":{let k=o.initialize,w=Rr(t),L=o.modules;w&&(o.runtimeConfig.environment=w.value),(w==null?void 0:w.source)==="queryParam"&&Er(w.value,t.sessionStorage);let H=q(o.runtimeConfig,t);return H.debug("MoliGlobal","configure modules",(M=I.modules)!=null?M:{}),L.forEach(O=>{var Q;try{O.n((Q=I.modules)!=null?Q:{}),H.debug("MoliGlobal",`configure ${O.moduleType} module ${O.name}`,O.r()),o.runtimeConfig.adPipelineConfig.initSteps.push(...O.s()),o.runtimeConfig.adPipelineConfig.configureSteps.push(...O.a()),o.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...O.d()),O.A&&o.runtimeConfig.adPipelineConfig.requestBidsSteps.push(...O.A()),O.v&&o.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.push(...O.v())}catch(G){H.error("MoliGlobal",`failed to configure ${O.moduleType} module ${O.name}`,G)}}),o={state:"configured",config:I,runtimeConfig:o.runtimeConfig,modules:L},k||I.requestAds===!0?P():Promise.resolve(o)}case"configured":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",o.config),Promise.resolve(o);case"requestAds":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(o);case"finished":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(o);case"error":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",o.error),Promise.resolve(o)}return Promise.resolve(null)}function P(){var I;switch(o.state){case"configurable":return o.initialize=!0,Promise.resolve(o);case"configured":{j(),W(o.config.domain);let{refreshInfiniteSlots:M}=o.runtimeConfig,k=o.config;M.length>0&&M.forEach(O=>{k=je(k,O.idOfConfiguredSlot,O.artificialDomId,q(o.runtimeConfig,t))});let w=q(o.runtimeConfig,t);o.runtimeConfig.hooks&&o.runtimeConfig.hooks.beforeRequestAds&&o.runtimeConfig.hooks.beforeRequestAds.forEach(O=>{try{O(k,o.runtimeConfig)}catch(Q){w.error("MoliGlobal","beforeRequestAds hook failed",Q)}});let L=o.runtimeConfig.hooks.afterRequestAds;if(((I=k.spa)==null?void 0:I.enabled)===!0){let O=o.runtimeConfig,Q=i.initialize(k,O);return o={state:"spa-requestAds",config:k,initialized:Q,modules:o.modules,href:t.location.href,runtimeConfig:Object.freeze(X(o.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:X(o.runtimeConfig)},Q.then(()=>i.requestAds(k,O)).then(()=>{var R,ee;let G=(ee=(R=k.spa)==null?void 0:R.validateLocation)!=null?ee:"href";if(o.state==="spa-requestAds"&&qe(G,o.href,t.location)){let{config:se,runtimeConfig:Ee}=o;o.runtimeConfig.refreshSlots.length>0&&i.refreshAdSlots(Ee.refreshSlots,se,Ee),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(he=>{i.refreshBucket(he.bucket,se,Ee,he.options)}),L.forEach(he=>he("spa-finished"));let De=x(h({},o),{state:"spa-finished",nextRuntimeConfig:X(o.runtimeConfig),runtimeConfig:X(o.runtimeConfig,{keepTargeting:!0})});return o=De,De}else return o.state==="spa-finished"||o.state==="spa-requestAds"?(q(o.runtimeConfig,t).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),o):Promise.reject(`reached invalid state [${o.state}]`)})}else return o={state:"requestAds",config:k,modules:o.modules,runtimeConfig:Object.freeze(o.runtimeConfig)},i.initialize(k,o.runtimeConfig).then(O=>i.requestAds(O,o.runtimeConfig)).then(()=>(o={state:"finished",config:k,runtimeConfig:o.runtimeConfig,modules:o.modules},L.forEach(O=>O("finished")),Promise.resolve(o))).catch(O=>(q(o.runtimeConfig,t).error("MoliGlobal",O),o={state:"error",config:k,runtimeConfig:o.runtimeConfig,error:O,modules:o.modules},L.forEach(Q=>Q("error")),Promise.resolve(o)))}case"spa-requestAds":case"spa-finished":{o.state==="spa-requestAds"&&q(o.runtimeConfig,t).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),j(),W(o.config.domain);let{modules:M}=o,k=o.nextRuntimeConfig.hooks.afterRequestAds,w=o.nextRuntimeConfig.hooks.beforeRequestAds,L=o;w.forEach(G=>{try{G(L.config,o.runtimeConfig)}catch(R){q(o.runtimeConfig,t).error("MoliGlobal","beforeRequestAds hook failed",R)}});let{initialized:H,href:O,nextRuntimeConfig:Q}=o;return o=x(h({},L),{state:"spa-requestAds",runtimeConfig:X(o.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:X(o.runtimeConfig)}),H.then(G=>{var ee,se;let R=(se=(ee=G.spa)==null?void 0:ee.validateLocation)!=null?se:"href";return Mr(R,O,t.location)?i.requestAds(G,Q).then(()=>G):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${R} for validation.`)}).then(G=>{let R=o.runtimeConfig;return o.runtimeConfig.refreshSlots.length>0&&i.refreshAdSlots(o.runtimeConfig.refreshSlots,G,o.runtimeConfig),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(ee=>{i.refreshBucket(ee.bucket,G,R,ee.options)}),o={state:"spa-finished",config:G,initialized:H,modules:M,href:t.location.href,runtimeConfig:o.runtimeConfig,nextRuntimeConfig:X(o.runtimeConfig)},k.forEach(ee=>ee("spa-finished")),o})}case"requestAds":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return q(o.runtimeConfig,t).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",o.error),Promise.reject()}}function v(I,M){var w,L;let k=typeof I=="string"?[I]:I;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued");case"spa-finished":let H=(L=(w=o.config.spa)==null?void 0:w.validateLocation)!=null?L:"href";return qe(H,o.href,t.location)?i.refreshAdSlots(k,o.config,o.runtimeConfig,M).then(()=>"refreshed"):(o.nextRuntimeConfig.refreshSlots.push(...k),Promise.resolve("queued"));case"finished":case"requestAds":return i.refreshAdSlots(k,o.config,o.runtimeConfig,M).then(()=>"refreshed");default:return q(o.runtimeConfig,t).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function b(I,M){var k,w;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:M}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:M}),Promise.resolve("queued");case"spa-finished":let L=(w=(k=o.config.spa)==null?void 0:k.validateLocation)!=null?w:"href";return qe(L,o.href,t.location)?(o=x(h({},o),{config:je(o.config,M,I,q(o.runtimeConfig,t))}),i.refreshAdSlots([I],o.config,o.runtimeConfig).then(()=>"refreshed")):(o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:M}),Promise.resolve("queued"));case"finished":case"requestAds":return o=x(h({},o),{config:je(o.config,M,I,q(o.runtimeConfig,t))}),i.refreshAdSlots([I],o.config,o.runtimeConfig).then(()=>"refreshed");default:return q(o.runtimeConfig,t).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function C(I,M){var k,w;switch(o.state){case"configurable":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:M}),Promise.resolve("queued");case"configured":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:M}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:M}),Promise.resolve("queued");case"spa-finished":{let L=(w=(k=o.config.spa)==null?void 0:k.validateLocation)!=null?w:"href";return qe(L,o.href,t.location)?i.refreshBucket(I,o.config,o.runtimeConfig,M).then(()=>"refreshed"):(o.runtimeConfig.refreshBuckets.push({bucket:I,options:M}),Promise.resolve("queued"))}case"finished":case"requestAds":return i.refreshBucket(I,o.config,o.runtimeConfig,M).then(()=>"refreshed");default:return q(o.runtimeConfig,t).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function E(){t.dispatchEvent(new CustomEvent("h5v.trigger-delay"))}function D(){return o.state}function N(I){switch(o.state){case"configurable":{q(o.runtimeConfig,t).error("MoliGlobal","Cannot open console before configuration");break}default:e.loadScript({assetUrl:I!=null?I:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${xe.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(M=>console.error("failed to load moli debugger",M))}}function j(){let I="ABtest",k=Ie(t.location.search).get(I),w=k?Number(k):Math.floor(Math.random()*100)+1;s(I,w.toString())}function W(I){let M=I||ye(t.location.hostname);M&&d(M)}function X(I,M){var k,w,L,H,O,Q,G,R;return{environment:(k=I==null?void 0:I.environment)!=null?k:"production",hooks:{beforeRequestAds:(w=I==null?void 0:I.hooks.beforeRequestAds)!=null?w:[],afterRequestAds:(L=I==null?void 0:I.hooks.afterRequestAds)!=null?L:[]},logger:(H=I==null?void 0:I.logger)!=null?H:void 0,adUnitPathVariables:(M==null?void 0:M.keepTargeting)===!0?(O=I==null?void 0:I.adUnitPathVariables)!=null?O:{}:{},labels:(M==null?void 0:M.keepTargeting)===!0?(Q=I==null?void 0:I.labels)!=null?Q:[]:[],keyValues:(M==null?void 0:M.keepTargeting)===!0?(G=I==null?void 0:I.keyValues)!=null?G:{}:{},refreshSlots:[],refreshInfiniteSlots:[],refreshBuckets:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[],requestBidsSteps:[],prebidBidsBackHandler:(R=I==null?void 0:I.adPipelineConfig.prebidBidsBackHandler)!=null?R:[]}}}return{que:{push(I){I(n.moli)}},version:xe.version,setTargeting:s,addLabel:d,setLogger:p,setAdUnitPathVariables:u,resolveAdUnitPath:a,beforeRequestAds:c,afterRequestAds:m,getConfig:f,getRuntimeConfig:y,getPageTargeting:g,registerModule:A,configure:S,requestAds:P,refreshAdSlot:v,refreshBucket:C,refreshInfiniteAdSlot:b,triggerDelay:E,getState:D,openConsole:N,addEventListener:r.addEventListener,removeEventListener:r.removeEventListener}};var xr=t=>{let e=t,r=e.moli?[...e.moli.que]:[],i=Tr(t);return e.moli=i,r.forEach(n=>n(i)),i};xr(window);var lo=t=>t==="android"?"aaid":t==="ios"?"idfa":void 0,kr=(t,e,r,i,n,o,s,d)=>{let u=lo(typeof n=="string"?n:n[0]),l=i.reduce((c,m)=>h(h({},c),m),{}),a=i.length?`&kv=${JSON.stringify(l)}`:"",p=d?`&gdpr_consent=${d}`:"";o(`https://api.theadex.com/collector/v1/ifa/c/${t}/t/${e}/request?&ifa=${r}&ifa_type=${u}${a}${p}`).catch(c=>s.error(c))};var Or=(t,e,r)=>{let i=t[e.key],n=It(t,e.valueType,e.valueKey);if(!i||Array.isArray(i)||n===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(n)&&e.defaultValue===void 0){r.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,i,n);return}let o=Dr(n,e,r);return{[e.attribute]:{[i]:o}}},Br=(t,e,r)=>{let i=It(t,e.adexValueType,e.key);if(i===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(i)&&e.defaultValue===void 0||Array.isArray(i))){r.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,i);return}let n=Dr(i,e,r);return{[e.attribute]:n}},wr=(t,e,r)=>{let i=It(t,"string",e.key);if(i===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof i=="number"){r.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,i);return}let n=po(i,e,r);return{[e.attribute]:n}},qr=t=>Object.fromEntries(t.sort().map(e=>[e,1])),uo=t=>t.sort().join(","),It=(t,e,r)=>e==="number"?Number(t[r]):t[r],Dr=(t,e,r)=>t!==void 0&&!Number.isNaN(t)?Array.isArray(t)?uo(t):t:Lr(e,r),po=(t,e,r)=>t===void 0?Lr(e,r):Array.isArray(t)?qr(t):{[t]:1},Lr=(t,e)=>(e.warn("Adex DMP","using defaultValue",t.defaultValue,"as fallback for key",t.key),t.adexValueType==="list"?t.defaultValue?qr(t.defaultValue):void 0:t.defaultValue);var Ur=(t,e)=>{var r;e.Utiq||(e.Utiq={queue:[]}),(r=e.Utiq).queue||(r.queue=[]),e.Utiq.queue.push(()=>{var i,n;(n=(i=e.Utiq)==null?void 0:i.API)==null||n.addEventListener("onIdsAvailable",({mtid:o})=>{e._adexc.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"cm","_cm",[308,o]])})})};var ue=T.responses.TCPurpose,Qe=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[ue.STORE_INFORMATION_ON_DEVICE,ue.SELECT_BASIC_ADS,ue.CREATE_PERSONALISED_ADS_PROFILE,ue.SELECT_PERSONALISED_ADS,ue.CREATE_PERSONALISED_CONTENT_PROFILE,ue.SELECT_PERSONALISED_CONTENT,ue.MEASURE_AD_PERFORMANCE,ue.MEASURE_CONTENT_PERFORMANCE,ue.APPLY_MARKET_RESEARCH,ue.DEVELOP_IMPROVE_PRODUCTS].every(r=>e.purpose.consents[r]);this.getOrInitAdexQueue=e=>{let r=e;return r._adexc=r._adexc||[],r};this.getAdexKeyValues=(e,r)=>{var n;let i=h(h({},(n=e.r.targeting)==null?void 0:n.keyValues),e.l.keyValues);if(Object.keys(i).length>0)return r.mappingDefinitions.map(o=>{switch(o.adexValueType){case"map":return Or(i,o,e.t);case"list":return wr(i,o,e.t);default:return Br(i,o,e.t)}}).filter(z)};this.configureAdexC=(e,r)=>{var o;let i=this.getOrInitAdexQueue(e.e),n=this.getAdexKeyValues(e,r);n?i._adexc.push([`/${r.adexCustomerId}/${r.adexTagId}/`,"ut","_kv",[n.reduce((s,d)=>h(h({},s),d),{}),r.spaMode?1:0]]):e.t.warn("Adex DMP","targeting key/values are empty"),(o=r.enabledPartners)!=null&&o.includes("utiq")&&Ur(r,e.e)}}r(){return this.adexConfig}n(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}s(){let e=this.adexConfig;return e?[_("DMP module setup",r=>this.track(r,e))]:[]}a(){let e=this.adexConfig;return e!=null&&e.spaMode?[V("DMP module setup",r=>(this.configureAdexC(r,e),Promise.resolve()))]:[]}track(e,r){var u,l;let{adexCustomerId:i,adexTagId:n,appConfig:o}=r;this.configureAdexC(e,r);let s=this.getAdexKeyValues(e,r),d=h(h({},(u=e.r.targeting)==null?void 0:u.keyValues),e.l.keyValues);if(this.hasRequiredConsent(e.o)&&!this.isLoaded&&Object.keys(d).length>0){this.isLoaded=!0;let a=z(o)&&z(d[o.advertiserIdKey])&&(d[o.clientTypeKey]==="android"||d[o.clientTypeKey]==="ios");if(o!=null&&o.advertiserIdKey&&a){let p=e.o.gdprApplies?e.o.tcString:void 0,c=d[o.advertiserIdKey];typeof c=="string"&&s&&kr(i,o.adexMobileTagId?o.adexMobileTagId:n,c,s,(l=d[o.clientTypeKey])!=null?l:"",e.e.fetch,e.t,p)}else e.p.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${i}/${n}/s/adex.js`,loadMethod:1}).catch(p=>e.t.error("failed to load adex",p))}return Promise.resolve()}d(){return[]}};window.moli.registerModule(new Qe);var Pe=class Pe{constructor(e,r,i,n,o,s,d,u){this.userActivityService=e;this.refreshInterval=r;this.refreshIntervalOverrides=i;this.useIntersectionObserver=n;this.disableAdVisibilityChecks=o;this.viewabilityOverrides=s;this.window=d;this.logger=u;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var i;(i=this.logger)==null||i.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId());let r=this.observedDomElementForSlot(e);this.intersectionObserver&&r&&this.intersectionObserver.unobserve(r.target)};this.handleGoogletagAdVisibilityChanged=e=>{var n;let r=e.slot,i=this.visibilityRecordForGoogletagEvent(e);i&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${r.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(i,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,r)=>{var i,n,o;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(i=this.logger)==null||i.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}r>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(o=this.logger)==null||o.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var a;this.minimalAdVisibilityRatio=o?0:.5,this.visibilityRecords=new Map,(n||Object.values(s).some(p=>(p==null?void 0:p.variant)==="css"))&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new this.window.IntersectionObserver(p=>this.handleObservedAdVisibilityChanged(p),{threshold:this.minimalAdVisibilityRatio})),n||this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged)}),this.userActivityService.addUserActivityChangedListener(p=>this.handleUserActivityChanged(p)),this.setUpdateTimer(!0),(a=this.logger)==null||a.debug("AdVisibilityService","initialized")}trackSlot(e,r,i){var s;let n=e.getSlotElementId(),o=this.observedDomElementForSlot(e);if(o){(s=this.logger)==null||s.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(n)&&this.removeSlotTracking(e);let d=o.viewabilityOverride;this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks||(d==null?void 0:d.variant)==="disabled"&&(d.disableAllAdVisibilityChecks||!(d.disabledAdVisibilityCheckAdvertiserIds&&d.disabledAdVisibilityCheckAdvertiserIds.length>0&&i)||d.disabledAdVisibilityCheckAdvertiserIds.includes(i))?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:r}),this.intersectionObserver&&(o.targetOverride||this.useIntersectionObserver)&&this.intersectionObserver.observe(o.target)}}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),Pe.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var r;if(e.latestStartVisible){let i=this.window.performance.now(),n=Math.round(i-e.latestStartVisible);e.durationVisibleSum+=n,e.latestStartVisible=i,(r=this.logger)==null||r.debug("AdVisibilityService",`added ${n}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let r=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>r}).forEach(e=>{var r;(r=this.logger)==null||r.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-Pe.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(r=>{var n;let i=this.visibilityRecordForEntry(r);i&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${i.slot.getSlotElementId()} changed. Visible area: ${r.intersectionRatio*100}%`),this.updateVisibilityRecord(i,r.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(r=>{r.latestStartVisible&&(r.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}observedDomElementForSlot(e){let r=e.getSlotElementId(),i=this.viewabilityOverrides[r],n=this.window.document.getElementById(r),o=i&&i.variant==="css"?this.window.document.querySelector(i.cssSelector):null;return o?{target:o,targetOverride:!0,viewabilityOverride:i}:n?{target:n,targetOverride:!1,viewabilityOverride:i}:null}};Pe.updateVisibilityInterval=1e3,Pe.consecutiveDurationToRefresh=1500;var Ze=Pe;var co=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Ce=class Ce{constructor(e,r={level:"strict"},i){this.window=e;this.userActivityLevelControl=r;this.logger=i;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var n;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(n=this.logger)==null||n.debug("UserActivityService","initialized"),r.level){case"custom":this.userActivityDuration=r.userActivityDuration,this.userBecomingInactiveDuration=r.userBecomingInactiveDuration;break;default:let{userActivityDuration:o,userBecomingInactiveDuration:s}=co.get(r.level);this.userActivityDuration=o,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(r=>r(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Ce.observedEvents.forEach(r=>this.window.removeEventListener(r,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Ce.observedEvents.forEach(r=>this.window.addEventListener(r,this.handleUserInteraction)),this.listener.forEach(r=>r(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Ce.observedEvents.forEach(r=>this.window.addEventListener(r,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Ce.observedEvents=["mousemove","touchstart","scroll","keypress"];var et=Ce;var tt=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,r,i,n)=>{if(e.i==="test"){e.t.info("AdReload","disabled in environment test");return}this.initialized||(e.t.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(r,e.e,e.t),this.setupSlotRenderListener(r,i,n,e.e,e.t),this.initialized=!0)};this.setupAdVisibilityService=(e,r,i)=>{var n,o;this.adVisibilityService=new Ze(new et(r,e.userActivityLevelControl,i),this.refreshIntervalMs,(n=e.refreshIntervalMsOverrides)!=null?n:{},!1,!!e.disableAdVisibilityChecks,(o=e.viewabilityOverrides)!=null?o:{},r,i)};this.setupSlotRenderListener=(e,r,i,n,o)=>n.googletag.pubads().addEventListener("slotRenderEnded",s=>{var v;let{slot:d,campaignId:u,advertiserId:l,yieldGroupIds:a,isEmpty:p}=s,c=d.getSlotElementId(),m=r.indexOf(c)>-1,f=!u||e.excludeOrderIds.indexOf(u)===-1,y=!!u&&e.includeOrderIds.indexOf(u)>-1,g=!!l&&e.includeAdvertiserIds.indexOf(l)>-1,A=!!a&&e.includeYieldGroupIds.some(b=>a.indexOf(b)>-1),S=!p&&m&&f&&(y||g||A);S||this.logTrackingDisallowedReason(c,{slotIsEmpty:p,slotIsMonitored:m,orderIdNotExcluded:f,orderIdIncluded:y,advertiserIdIncluded:g,yieldGroupIdIncluded:A},o,a,u,l);let P=!!((v=this.adVisibilityService)!=null&&v.isSlotTracked(c));S?this.adVisibilityService.trackSlot(d,i,l):P&&this.adVisibilityService.removeSlotTracking(d)});this.reloadAdSlot=(e,r)=>i=>{let n=i.getSlotElementId(),o=r.r.slots.find(s=>s.domId===n);if(o&&o.behaviour.loaded!=="infinite"){r.t.debug("AdReload","fired slot reload",o.domId);let s=this.maybeOptimizeSlotForCls(e,o,i,r.t,r.e);i.setTargeting(this.reloadKeyValue,"true");let u=(()=>{var a,p;if(((p=(a=e.viewabilityOverrides)==null?void 0:a[n])==null?void 0:p.refreshBucket)===!0){let c=o.behaviour.loaded,m=o.behaviour.bucket,f=typeof m=="string"?m:m==null?void 0:m[r.u.getDeviceLabel()];return f&&c!=="infinite"?{name:f,loaded:c}:void 0}})();u?r.e.moli.refreshBucket(u.name,{loaded:u.loaded}).then(l=>r.t.debug("AdReload",`refreshBucket '${u.name}' result`,l)).catch(l=>r.t.error("AdReload",`refreshBucket '${u.name}' failed`,l)):r.e.moli.refreshAdSlot(n,h({loaded:o.behaviour.loaded},s&&{sizesOverride:s})).catch(l=>r.t.error("AdReload",`refreshing ${n} failed`,l))}};this.maybeOptimizeSlotForCls=(e,r,i,n,o)=>{let s=r.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let d=o.document.getElementById(s);if(d&&d.style){let u=d.scrollHeight;d.style.setProperty("height",`${u}px`);let l=r.sizes.filter(a=>a!=="fluid"&&a[1]<=u);return n.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${u}px`,"new sizes:",l),l.length<r.sizes.filter(a=>a!=="fluid").length&&o.googletag.destroySlots([i]),l}n.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return r.sizes};this.logTrackingDisallowedReason=(e,r,i,n,o,s)=>{let{slotIsEmpty:d,slotIsMonitored:u,orderIdNotExcluded:l,orderIdIncluded:a,advertiserIdIncluded:p,yieldGroupIdIncluded:c}=r;d&&i.debug("AdReload",e,"slot not tracked: reported empty"),u||i.debug("AdReload",e,"slot not tracked: excluded by DOM id"),l||i.debug("AdReload",e,"slot not tracked: excluded by order id",o),a||p||c||i.debug("AdReload",e,"slot not tracked: neither order id",o,"nor advertiser id",s,"nor yieldGroup id",n,"included")}}r(){return this.moduleConfig}isInitialized(){return this.initialized}n(e){var r;(r=e==null?void 0:e.adReload)!=null&&r.enabled&&(this.moduleConfig=e.adReload)}s(){return[]}a(){let e=this.moduleConfig;return e?[V(this.name,r=>{let i=r.r.slots.filter(o=>e.excludeAdSlotDomIds.indexOf(o.domId)===-1).map(o=>o.domId).filter(z),n=this.reloadAdSlot(e,r);return r.t.debug("AdReload","monitoring slots",i),this.initialize(r,e,i,n),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new tt);var Vr=(t,e)=>r=>{switch(r.matchType){case"exact":return t===r.pattern;case"contains":return t.indexOf(r.pattern)>-1;case"regex":try{return RegExp(r.pattern).test(t)}catch(i){return e.error(`Invalid regex pattern: ${r.pattern}`,i),!1}default:return!1}},_r=(t,e,r)=>t.urls.some(Vr(e,r)),Nr=()=>{let t=null,e=null,r=()=>t,i=l=>{l!=null&&l.blocklist&&l.blocklist.enabled&&(t=l.blocklist)},n=(l,a,p)=>{switch(l.provider){case"static":return()=>Promise.resolve(l.blocklist);case"dynamic":let c;return()=>(c||(c=o(a,l.endpoint,3).catch(m=>(p.error("Blocklist URLs","Fetching blocklisted urls failed",m),{urls:[]}))),c)}},o=(l,a,p,c=null)=>p<=0?Promise.reject(c):(e||(e=l.loadJson("blocklist-urls.json",a).catch(m=>new Promise(y=>setTimeout(y,100/p)).then(()=>o(l,a,p-1,m)))),e);return{name:"Blocklist URLs",description:"",moduleType:"policy",r,n:i,s:()=>t?[_("blocklist-urls-init",l=>{switch(t==null?void 0:t.mode){case"key-value":let a=t.key,p=t.isBlocklistedValue||"true";return n(t.blocklist,l.p,l.t)().then(c=>{_r(c,l.e.location.href,l.t)&&l.e.googletag.pubads().setTargeting(a,p)});case"block":return n(t.blocklist,l.p,l.t)().then(c=>{if(l.t.debug("Blocklist URLs","using blocklist",c),_r(c,l.e.location.href,l.t))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[],a:()=>{let l=t;return l?[V("blocklist-labels",a=>Ue(void 0,null,function*(){var m;let p=yield n(l.blocklist,a.p,a.t)(),c=Vr(a.e.location.href,a.t);(m=p.labels)==null||m.forEach(f=>{(f.reverseMatch===!0?!c(f):c(f))&&a.u.addLabel(f.label)})}))]:[]},d:()=>[]}};window.moli.registerModule(Nr());var rt=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(e,r)=>{r.forEach(i=>{"cssSelectors"in i.deleteMethod?i.deleteMethod.cssSelectors.forEach(n=>{let o=e.e.document.querySelectorAll(n);e.t.debug("Cleanup Module",`Remove elements with selector ${n} from dom`,o),o.forEach(s=>{try{s.remove()}catch(d){e.t.error("Cleanup Module",`Error removing element with selector ${n}`,d)}})}):i.deleteMethod.jsAsString.forEach(n=>{try{e.t.debug("Cleanup Module",`Try to execute string as JS: '${n}'`),new Function(n)()}catch(o){e.t.error("Cleanup Module",`Error executing JS string: '${n}'`,o)}})})};this.hasBidderWonLastAuction=(e,r)=>{var o;return((o=e.e.pbjs.getAllWinningBids().filter(s=>s.adUnitCode===r.domId).at(-1))==null?void 0:o.bidder)===r.bidder}}n(e){e!=null&&e.cleanup&&e.cleanup.enabled&&(this.cleanupConfig=e.cleanup)}r(){return this.cleanupConfig}s(){return[]}a(){let e=this.cleanupConfig;return e?[oe("destroy-out-of-page-ad-format",r=>(r.l.environment==="test"||r.e.pbjs.que.push(()=>{let i=e.configs.filter(n=>this.hasBidderWonLastAuction(r,n));this.cleanUp(r,i)}),Promise.resolve()))]:[]}d(){let e=this.cleanupConfig;return e?[$("cleanup-before-ad-reload",Ge,(r,i)=>(r.l.environment==="test"||r.e.pbjs.que.push(()=>{let n=e.configs.filter(o=>i.map(s=>s.moliSlot.domId).includes(o.domId)).filter(o=>this.hasBidderWonLastAuction(r,o));this.cleanUp(r,n)}),Promise.resolve()))]:[]}};window.moli.registerModule(new rt);var it=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}r(){return this.confiantConfig}n(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}s(){let e=this.confiantConfig;return e?[_("confiant-init",r=>this.loadConfiant(r,e))]:[]}loadConfiant(e,r){var i;return e.i==="test"||e.o.gdprApplies&&(!e.o.purpose.consents[1]||!(!((i=this.confiantConfig)!=null&&i.checkGVLID)||e.o.vendor.consents[this.gvlid]))||e.p.loadScript({name:this.name,loadMethod:1,assetUrl:r.assetUrl}).catch(n=>e.t.error("failed to load confiant",n)),Promise.resolve()}a(){return[]}d(){return[]}};window.moli.registerModule(new it);var mo=(t,e)=>{var i;let r=(i=t.r.targeting)==null?void 0:i.keyValues[e];return r?`&device_id=${typeof r=="string"?r:r[0]}`:""},Fr=(t,e,r,i,n)=>{let o=mo(t,e.advertiserIdKey),s=t.o.gdprApplies?`gdpr=1&gdpr_consent=${t.o.tcString}`:"gdpr=0",d=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",u=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",l="",a=h(h({},e.additionalIdentifier),r);Object.entries(a).forEach(([f,y])=>{l+=`&${f}=${encodeURIComponent(y)}`});let p="",c=h(h({},e.customKeywords),i);Object.entries(c).forEach(([f,y])=>{p+=`&${f}=${encodeURIComponent(y)}`});let m=n.createElement("img");m.src=`https://aps.xplosion.de/data?sid=${e.sid}${o}&os=${e.os}&app_id=${e.appId}${u}${d}${l}${p}&${s}`,m.width=1,m.height=1,n.body.append(m)};var go=(t,e)=>{var i;if(e.os==="web")return;let r=(i=t.r.targeting)==null?void 0:i.keyValues[e.advertiserIdKey];if(r)return typeof r=="string"?r:r[0]},zr=(t,e,r)=>{try{let n="moli_emetriq",o=t.getItem(n),s=o?Number.parseInt(o,10):0,d=e-864e5>s;return d&&(t.setItem(n,e.toString()),r.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),d}catch(i){return r.error("emetriq","could not access session storage",i),!1}},jr=(t,e,r,i)=>{if(!e.login){i.warn("emetriq","login configuration missing!");return}let n=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);n.searchParams.append("guid",e.login.guid),t.o.gdprApplies?(n.searchParams.append("gdpr","1"),n.searchParams.append("gdpr_consent",t.o.tcString)):n.searchParams.append("gdpr","0");let o=go(t,e);if(o)switch(e.os){case"android":n.searchParams.append("adid",o);break;case"ios":n.searchParams.append("idfa",o);break}let s=r.createElement("img");s.src=n.href,s.width=1,s.height=1,r.body.append(s)};var ot=class t{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}r(){return this.emetriqConfig}n(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}s(){let e=this.emetriqConfig;return e?[_("load-emetriq",r=>{var n;let i=t.staticCustomParams(h(h({},(n=r.r.targeting)==null?void 0:n.keyValues),r.l.keyValues),e.customMappingDefinition);return r.i==="test"||this.checkIfConsentIsMissing(r)||t.syncDelay(r,e.syncDelay).then(o=>{switch(e.os){case"web":this.loadEmetriqScript(r,e,o,i);break}}),Promise.resolve()})]:[]}a(){let e=this.emetriqConfig;return e?[oe("track-emetriq",r=>{var n;let i=t.staticCustomParams(h(h({},(n=r.r.targeting)==null?void 0:n.keyValues),r.l.keyValues),e.customMappingDefinition);return r.i==="test"||this.checkIfConsentIsMissing(r)||(e.login&&zr(r.e.sessionStorage,Date.now(),r.t)&&jr(r,e,r.e.document,r.t),t.syncDelay(r,e.syncDelay).then(o=>{switch(e.os){case"android":case"ios":Fr(r,e,o,i,r.e.document);break}})),Promise.resolve()})]:[]}d(){return[]}checkIfConsentIsMissing(e){return e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid]?(e.t.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,r,i,n){let o=e.e;return o._enqAdpParam=h(h(h({},r._enqAdpParam),i),n),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${r._enqAdpParam.sid}/default.js`}).catch(s=>e.t.error("failed to load emetriq",s))}static syncDelay(e,r){return r?typeof r=="number"?new Promise(i=>e.e.setTimeout(()=>i({}),r)):e.e.pbjs?new Promise(i=>{e.e.pbjs.que.push(()=>{let n=()=>{i(t.prebidIdentifiers(e)),e.e.pbjs.offEvent("auctionEnd",n)};e.e.pbjs.onEvent("auctionEnd",n)})}):(e.t.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,r){let i={};return(r!=null?r:[]).forEach(({param:n,key:o})=>{let s=e[o];s&&(i[n]=typeof s=="string"?s:s.join(","))}),i}static prebidIdentifiers(e){let r={},i=e.e.pbjs.getUserIds();return i.amxId&&(r.id_amxid=i.amxId),i.idl_env&&(r.id_liveramp=i.idl_env),i.IDP&&(r.id_zeotap=i.IDP),i.pubcid&&(r.id_sharedid=i.pubcid),i.id5id&&(r.id_id5=i.id5id.uid),r}};window.moli.registerModule(new ot);var nt=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}r(){return this.identityLinkConfig}n(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}s(){let e=this.identityLinkConfig;return e?[_(this.name,r=>(this.loadAts(r,e),Promise.resolve()))]:[]}a(){return[]}d(){return[]}loadAts(e,r){if(e.i==="test"||e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid])return Promise.resolve();let i=e.e;return i.addEventListener("envelopeModuleReady",()=>{i.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:r.hashedEmailAddresses})}),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${r.launchPadId}/launchpad-liveramp.js`}).catch(n=>e.t.error("failed to load emetriq",n))}};window.moli.registerModule(new nt);var $r=t=>{let e=t.filter(i=>i.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:i=>{let n=i.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:n?e.find(s=>s.domId===n):e[0],configSlotDomId:n}}}};var st=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,r)=>{var l;if(this.initialized)return;this.initialized=!0,(l=e.t)==null||l.debug(this.name,"initialize moli lazy load module");let i=r.slots,n=r.buckets,o=r.infiniteSlots,s=e.e;i.forEach(a=>{let p=new s.IntersectionObserver(c=>{var m;(m=e.t)==null||m.debug(this.name,"lazy-load slots called with",c),c.forEach(f=>{var y;f.isIntersecting&&((y=e.t)==null||y.debug(this.name,`Trigger ad slot with DOM ID ${f.target.id}`),s.moli.refreshAdSlot(f.target.id),p.unobserve(f.target))})},{root:a.options.rootId?s.document.getElementById(a.options.rootId):null,threshold:a.options.threshold,rootMargin:a.options.rootMargin});this.observers.push(p),a.domIds.forEach(c=>{var f,y;let m=e.r.slots.find(g=>g.domId===c);if(!m)(f=e.t)==null||f.warn(this.name,`Lazy-load non-existing slot with domID ${c}`);else if(m.behaviour.loaded!=="manual")(y=e.t)==null||y.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${c}`);else if(m.behaviour.loaded==="manual"){let g=s.document.getElementById(c);g&&p.observe(g)}})}),n.forEach(a=>{var c,m,f,y;let p=new s.IntersectionObserver(g=>{g.forEach(A=>{var S,P,v;if(A.isIntersecting&&A.target.id===a.observedDomId)if(((S=e.r.slots.find(C=>C.domId===a.observedDomId))==null?void 0:S.behaviour.bucket)!==a.bucket)(P=e.t)==null||P.warn(this.name,`${a.observedDomId} doesn't belong to ${a.bucket}`);else{let C=e.r.slots.filter(E=>E.behaviour.bucket===a.bucket).map(E=>E.domId);(v=e.t)==null||v.debug(`Refresh ${a.bucket}`,`Trigger ad slots with DOM IDs [${C.join(", ")}]`),s.moli.refreshBucket(a.bucket),p.unobserve(A.target)}})},{root:a.options.rootId?s.document.getElementById(a.options.rootId):null,threshold:a.options.threshold,rootMargin:a.options.rootMargin});if(this.observers.push(p),(c=e.r.buckets)!=null&&c.enabled||(m=e.t)==null||m.warn(this.name,"GlobalBucket config isn't enabled"),!((f=e.r.buckets)!=null&&f.bucket&&e.r.buckets.bucket[a.bucket]))(y=e.t)==null||y.error(this.name,`Lazy-load non-existing bucket with name ${a.bucket}`);else{let g=s.document.getElementById(a.observedDomId);g&&p.observe(g)}});let{configuredInfiniteSlots:d,findSlot:u}=$r(e.r.slots);(o||[]).forEach(a=>{var c;let p="data-h5-serial-number";if(d.length>0){let m=new s.IntersectionObserver(y=>{y.forEach(g=>{var A,S,P,v;if(g.isIntersecting){let{configuredInfiniteSlot:b,configSlotDomId:C}=u(g.target);if(b){let E=(S=(A=g.target.attributes)==null?void 0:A.getNamedItem(p))==null?void 0:S.value,D=`${b.domId}-${E}`;g.target.setAttribute("id",D),(P=e.t)==null||P.debug(this.name,`Trigger ad slot with newly created DOM ID ${D}`),s.moli.refreshInfiniteAdSlot(D,b.domId),m.unobserve(g.target)}else(v=e.t)==null||v.error(this.name,`No infinite-scrolling slot configured for ${C}`),m.unobserve(g.target)}})},{root:a.options.rootId?s.document.getElementById(a.options.rootId):null,threshold:a.options.threshold,rootMargin:a.options.rootMargin});this.observers.push(m),s.document.querySelectorAll(a.selector).forEach((y,g)=>{y.setAttribute(p,`${g+1}`),y&&m.observe(y)})}else(c=e.t)==null||c.warn(this.name,"No infinite-scrolling slots configured!")})}}r(){return this.lazyloadConfig}n(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}s(){return[]}a(){let e=this.lazyloadConfig;return e?[oe("lazy-module-configuration",r=>(this.initialized=!1,this.observers.forEach(i=>i.disconnect()),this.observers.length=0,this.registerIntersectionObservers(r,e),Promise.resolve()))]:[]}d(){return[$("lazy-module-delay",Z,(e,r)=>new Promise((i,n)=>{var s,d,u;let o=(d=(s=e.S)==null?void 0:s.options)==null?void 0:d.delay;if(o){(u=e.t)==null||u.debug(this.name,"delaying slots",r);let l=new Promise(p=>{e.e.addEventListener("h5v.trigger-delay",()=>p(!0),{once:!0})}),a=new Promise(p=>{var c;e.e.setTimeout(()=>p(!1),(c=o.timeoutMs)!=null?c:3e4)});return Promise.race([l,a]).then(p=>p?i():n(new Error("Delay timeout exceeded")))}else i()}))]}};window.moli.registerModule(new st);var at=class t{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}r(){return this.moduleConfig}n(e){var r;if((r=e==null?void 0:e.prebidFirstPartyData)!=null&&r.enabled){let i=e.prebidFirstPartyData;this._configureSteps=[V("prebid-fpd-module-configure",n=>t.setPrebidFpdConfig(n,i,n.t))]}}s(){return[]}a(){return this._configureSteps}d(){return[]}static setPrebidFpdConfig(e,r,i){var n;if(e.r.prebid){let o=((n=e.r.targeting)==null?void 0:n.keyValues)||{},s=r.gptTargetingMappings;e.e.pbjs.que.push(()=>{var l,a,p,c,m,f,y,g,A;let d=e.e.pbjs.readConfig().ortb2||{},u=Je({},r.staticPrebidFirstPartyData,d);if(s){let S=h({cat:[],sectioncat:[],pagecat:[]},u.site);if(s.cat){let v=t.extractKeyValueArray(s.cat,o);(l=S.cat)==null||l.push(...v),(a=S.pagecat)==null||a.push(...v),(p=S.sectioncat)==null||p.push(...v)}s.sectionCat&&(S.sectioncat=t.extractKeyValueArray(s.sectionCat,o)),s.pageCat&&(S.pagecat=t.extractKeyValueArray(s.pageCat,o)),S.cat&&(S.cat=S.cat.filter(Y)),S.sectioncat&&(S.sectioncat=S.sectioncat.filter(Y)),S.pagecat&&(S.pagecat=S.pagecat.filter(Y));let P=(c=r.iabDataProviderName)!=null?c:ye(e.e.location.hostname);if(!r.iabDataProviderName&&(s.iabV2||s.iabV3)&&i.debug("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Use tld as fallback",P),S.content=x(h({},S.content),{data:(y=(f=(m=S.content)==null?void 0:m.data)==null?void 0:f.filter(v=>v.name!==P))!=null?y:[]}),s.iabV2&&P){let v=t.extractKeyValueArray(s.iabV2,o),b={name:P,ext:{segtax:6},segment:v.map(C=>({id:C})).filter(Y)};(g=S.content.data)==null||g.push(b)}if(s.iabV3&&P){let v=t.extractKeyValueArray(s.iabV3,o),b={name:P,ext:{segtax:7},segment:v.map(C=>({id:C})).filter(Y)};(A=S.content.data)==null||A.push(b)}u.site=S}e.e.pbjs.setConfig({ortb2:u})})}return Promise.resolve()}static extractKeyValueArray(e,r){let i=r[e];return i?typeof i=="string"?[i]:i:[]}};window.moli.registerModule(new at);var dt=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}r(){return this.pubstackConfig}n(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}s(){let e=this.pubstackConfig;return e?[_("pubstack-init",r=>(r.i==="test"||r.p.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(i=>r.t.error("failed to load pubstack",i)),Promise.resolve()))]:[]}a(){return this.pubstackConfig?[V("pubstack-configure",r=>{if(r.i==="test")return Promise.resolve();let i=["0","1","2","3"],n=r.e.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return n&&n.content&&i.includes(n.content)&&r.e.googletag.pubads().setTargeting("pbstck_ab_test",n.content),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new dt);var Wr="footer-ad-close-button",fo="[data-ref=h5-footer-ad-container]",yo=`[data-ref=${Wr}]`,lt={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},Gr=(t,e,r,i)=>n=>{let o=n.slot,s=t.document.body.querySelector(fo),d=t.document.getElementById(e),u=()=>{var a;o.getSlotElementId()===e&&s&&((a=t.googletag)==null||a.destroySlots([o]),s.remove())};if(!s||!d||o.getSlotElementId()!==e||n.isEmpty||n.advertiserId&&r.includes(n.advertiserId)||t.matchMedia("(max-width: 767px)").matches){i.debug("[footer-ad]","remove footer ad container");return}if(t.document.body.querySelector(yo))return;let l=document.createElement("button");l.classList.add(lt.footerAdClose),l.setAttribute("aria-label","Anzeige entfernen"),l.setAttribute("data-ref",Wr),d.classList.add(lt.adSlot),Array.isArray(n.size)&&n.size[1]>200&&t.matchMedia("(max-height: 800px)").matches&&d.classList.add(lt.isShiftedBottom),s.classList.add(lt.container),s.style.setProperty("display","block"),s.appendChild(l),l.addEventListener("click",()=>u())},Hr=(t,e,r,i,n)=>{e==="production"?t.googletag.pubads().addEventListener("slotRenderEnded",Gr(t,i,n,r)):Gr(t,i,n,r)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>i}})};var Kr="[data-ref=sticky-ad]",Yr="[data-ref=sticky-ad-close]",Zr="h5-sticky-ad--visible",St=t=>{t.style.setProperty("display","none"),t.classList.remove(Zr)},Jr=t=>{t.style.setProperty("display","block"),t.classList.add(Zr)},Xr=(t,e,r,i)=>new Promise(n=>{let o=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(t&&St(t),n("empty")):s.advertiserId&&r.includes(s.advertiserId)?n("disallowed"):n("standard"),i.googletag.pubads().removeEventListener("slotRenderEnded",o))};i.googletag.cmd.push(()=>{i.googletag.pubads().addEventListener("slotRenderEnded",o)})}),Qr=(t,e)=>new Promise(r=>{let i=n=>{n.slot.getSlotElementId()===t&&(r(),e.googletag.pubads().removeEventListener("slotOnload",i))};e.googletag.pubads().addEventListener("slotOnload",i)}),ei=(t,e,r,i,n,o)=>{let s=t.document.querySelector(Kr),d=t.document.querySelector(Yr);if(s&&d){if(r.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),o||Jr(s),d.addEventListener("click",()=>{St(s);let u=t.googletag.pubads().getSlots().find(l=>l.getSlotElementId()===i);u&&t.googletag.destroySlots([u])},{once:!0,passive:!0}),e==="production"){let u=([l])=>(r.debug("mobile-sticky-ad",`result ${l}`),l==="disallowed"?(r.debug("mobile-sticky-ad","hide mobile sticky container"),s&&St(s),Promise.resolve()):l==="standard"?(o&&Jr(s),Promise.all([Xr(s,i,n,t),Qr(i,t)]).then(u)):Promise.resolve());Promise.all([Xr(s,i,n,t),Qr(i,t)]).then(u)}}else r.warn("[mobile-sticky]",`Could not find adSticky container ${Kr} or closeButton ${Yr}`,s,d)};var ut=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}r(){return this.stickyFooterAdConfig}n(e){var r;(r=e==null?void 0:e.stickyFooterAd)!=null&&r.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}d(){let e=this.stickyFooterAdConfig;return e?[$(this.name,Z,(r,i)=>{var n;return e.mobileStickyDomId&&i.some(o=>{var s;return o.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&ei(r.e,r.i,r.t,e.mobileStickyDomId,e.disallowedAdvertiserIds,(n=e.initiallyHidden)!=null?n:!1),e.desktopFloorAdDomId&&i.some(o=>o.moliSlot.domId===e.desktopFloorAdDomId)&&Hr(r.e,r.i,r.t,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new ut);var At="[data-ref=h5v-sticky-ad]",Pt="[data-ref=h5v-sticky-ad-close]",ti=".h5v-closeButtonContent",ni="h5v-footerAd--hidden",bo="h5v-footerAd--hidden-d",vo="h5v-footerAd--hidden-m",ri=(t,e,r)=>new Promise(i=>{let n=o=>{o.slot.getSlotElementId()===t&&(o.isEmpty?i("empty"):o.advertiserId&&e.includes(o.advertiserId)?i("disallowed"):i("standard"),r.googletag.pubads().removeEventListener("slotRenderEnded",n))};r.googletag.cmd.push(()=>{r.googletag.pubads().addEventListener("slotRenderEnded",n)})}),ii=(t,e)=>new Promise(r=>{let i=n=>{n.slot.getSlotElementId()===t&&(r(),e.googletag.pubads().removeEventListener("slotOnload",i))};e.googletag.pubads().addEventListener("slotOnload",i)}),oi=t=>{t.classList.add(ni)},ho=t=>{t.classList.remove(ni,bo,vo)},si=(t,e,r,i,n,o)=>{let s="sticky-ad",d=t.document.querySelector(At),u=t.document.querySelector(Pt),l=t.document.querySelector(ti);if(d&&u){if(r.debug(s,"Running initAdSticky with defined sticky container and close button"),!l){if(o)u.textContent=o;else if(!u.querySelector("svg")){let p=t.document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("width","24"),p.setAttribute("height","24");let c=t.document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add(ti),c.setAttribute("d","M7 10l5 5 5-5z"),p.appendChild(c),u.appendChild(p)}}u.addEventListener("click",()=>{d.addEventListener("transitionend",function(){var c;d.remove();let p=(c=t.googletag)==null?void 0:c.pubads().getSlots().find(m=>m.getSlotElementId()===i);p&&t.googletag.destroySlots([p])},{once:!0}),oi(d)});let a=p=>{if(r.debug(s,`result ${p}`),p==="disallowed"||p==="empty")return r.debug(s,"stickyFooter container"),oi(d),Promise.resolve();if(p==="standard"){ho(d);let c=ii(i,t);return ri(i,n,t).then(m=>m==="empty"||m==="disallowed"?Promise.resolve(m):c.then(()=>m)).then(a)}return Promise.resolve()};if(e==="production")if(i){let p=ii(i,t);ri(i,n,t).then(c=>c==="empty"||c==="disallowed"?Promise.resolve(c):p.then(()=>c)).then(a)}else r.warn("[sticky-footer-ad]",`Could not find adSticky container ${At} or closeButton ${Pt}`,d,u);else a("standard")}else r.warn("[sticky-footer-ad]",`Could not find adSticky container ${At} or closeButton ${Pt}`,d,u)};var pt=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}r(){return this.stickyFooterAdConfig}n(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}d(){let e=this.stickyFooterAdConfig;return e?[$(this.name,Z,(r,i)=>{let n=i.find(d=>d.moliSlot.domId===e.stickyFooterDomIds.desktop),o=i.find(d=>d.moliSlot.domId===e.stickyFooterDomIds.mobile),s=o||n;return o&&n&&r.t.warn(this.name,"mobile and desktop sticky footer are called!"),s&&si(r.e,r.i,r.t,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new pt);var ai=(t,e,r,i,n,o)=>s=>{s.forEach(d=>{e&&d.target===e?r.then(u=>{d.isIntersecting||!d.isIntersecting&&d.boundingClientRect.y<0||u==="empty"||u==="disallowed"?t.classList.add(o):d.boundingClientRect.y>=0&&u==="standard"&&t.classList.remove(o)}):d.target===i&&n&&(d.isIntersecting?t.classList.remove(n):t.classList.add(n))})};var di=(t,e,r,i)=>new Promise(n=>{if(t.i==="test"){n("standard");return}let o=s=>{s.slot.getSlotElementId()===e.domId&&(s.advertiserId&&r.includes(s.advertiserId)?n("disallowed"):s.isEmpty?n("empty"):i>0?t.e.setTimeout(()=>n("standard"),i):n("standard"),t.e.googletag.pubads().removeEventListener("slotRenderEnded",o))};t.e.googletag.pubads().addEventListener("slotRenderEnded",o)});var ct=class{constructor(){this.name="sticky-header-ads";this.description="sticky header ad creatives";this.moduleType="creatives";this.containerSelector='[data-ref="header-ad"]';this.buttonSelector='[data-ref="header-ad-close-button"]';this.navbarHiddenClassName="h5v-header-ad--navbarHidden";this.observer=null;this.stickyHeaderAdConfig=null}n(e){var r;(r=e==null?void 0:e.stickyHeaderAd)!=null&&r.enabled&&(this.stickyHeaderAdConfig=e.stickyHeaderAd)}r(){return this.stickyHeaderAdConfig}s(){return[]}a(){return this.stickyHeaderAdConfig?[oe("sticky-header-ads:cleanup",()=>(this.observer&&(this.observer.disconnect(),this.observer=null),Promise.resolve()))]:[]}d(){let e=this.stickyHeaderAdConfig;return e?[$(this.name,Z,(r,i)=>{var u,l,a;if(this.observer)return Promise.resolve();let n=i.find(p=>p.moliSlot.domId===e.headerAdDomId);if(!n)return Promise.resolve();let o=r.e.document.querySelector(this.containerSelector);if(!o)return r.t.warn(this.name,`Could not find sticky header container with selector '${this.containerSelector}'`),Promise.resolve();let s=(u=e.minVisibleDurationMs)!=null?u:0;if(e.fadeOutTrigger!==!1){let p=(l=e.fadeOutTrigger.options)!=null?l:{rootMargin:"0px"},c=r.e.document.querySelectorAll(e.fadeOutTrigger.selector),m=c.length>0?c.item(0):null,f=e.navbarConfig,y=(a=f==null?void 0:f.navbarHiddenClassName)!=null?a:this.navbarHiddenClassName,g=f?r.e.document.querySelector(f.selector):null;if(m){let A=di(r,n.moliSlot,e.disallowedAdvertiserIds,s);this.observer=new IntersectionObserver(ai(o,m,A,g,y,e.fadeOutClassName),p),this.observer.observe(m),g&&this.observer.observe(g)}else r.t.error(this.name,`No DOM element found for selector ${e.fadeOutTrigger.selector}. Sticky header may never fade out`)}let d=r.e.document.querySelector(this.buttonSelector);return d&&d.addEventListener("click",()=>{o.classList.add(e.fadeOutClassName),this.observer&&this.observer.disconnect(),r.i==="production"&&r.e.googletag.destroySlots([n.adSlot]),e.destroySlot&&o&&o.remove()}),Promise.resolve()})]:[]}};window.moli.registerModule(new ct);var Io=(t,e)=>{let r=Object.keys(t);return fe(r.map(i=>h({adSlotId:i},t[i])).filter(i=>e.indexOf(i.adSlotId)>-1).filter(i=>z(i.bids)).map(i=>i.bids.sort((n,o)=>o.cpm-n.cpm).slice(0,1)))},mt=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.bidsBackHandler=[];this.getConfigEffect=(e,r,i,n)=>{let o=r[e.skinAdSlotDomId],s=p=>{let c=e.formatFilter.some(m=>{switch(m.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return p.bidder===me.AppNexusAst||p.bidder===me.AppNexus;case"improvedigital":return p.bidder===me.ImproveDigital;case"gumgum":return p.bidder===me.GumGum&&(m.auid===void 0||typeof p.ad!="string"&&p.ad.auid===m.auid);case"dspx":return p.bidder===me.DSPX;case"visx":return p.bidder===me.Visx;case"yieldlab":return p.bidder===me.Yieldlab;default:return!1}});return p.cpm>0&&c},d=Io(r,e.blockedAdSlotDomIds),u=d.reduce((p,c)=>p+c.cpm,0),l=o?o.bids.filter(s).sort((p,c)=>c.cpm-p.cpm):[],a=l.length>0?l[0].cpm>u?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return n.debug(this.name,"nonSkinBids",d),n.debug(this.name,"skinBids",l),i&&a==="BlockSkinSlot"&&(i({skin:l[0].cpm,combinedNonSkinSlots:u},e,l[0]),n.debug(this.name,"trackSkinCpmLow",d)),e.enableCpmComparison?a:l.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,r,i)=>e.configs.map(n=>({skinConfig:n,configEffect:this.getConfigEffect(n,r,e.trackSkinCpmLow,i)})).find(({configEffect:n})=>n!=="NoBlocking");this.destroyAdSlot=(e,r)=>i=>{let n=e.map(o=>o.adSlot).filter(o=>o.getSlotElementId()===i);r.googletag.destroySlots(n)};this.runSkinConfigs=e=>(r,i,n)=>{var d,u,l;let o=null,s=this.selectConfig(e,i,r.t);if(s){let{skinConfig:a,configEffect:p}=s;if(p==="BlockOtherSlots"){r.t.debug("SkinModule","Skin configuration applied",a),a.blockedAdSlotDomIds.forEach(this.destroyAdSlot(n,r.e)),a.hideBlockedSlots&&a.blockedAdSlotDomIds.forEach(this.hideAdSlot(r.e,r.t)),a.hideSkinAdSlot&&this.hideAdSlot(r.e,r.t)(a.skinAdSlotDomId),a.hideBlockedSlotsSelector&&r.e.document.querySelectorAll(a.hideBlockedSlotsSelector).forEach(f=>{r.t.debug("SkinModule",`Set display:none for container with selector ${a.hideBlockedSlotsSelector}`),f.style.setProperty("display","none")});let c=(d=i[a.skinAdSlotDomId])==null?void 0:d.bids.sort((f,y)=>y.cpm-f.cpm)[0],m=f=>r.e.googletag.pubads().getSlots().find(g=>g.getSlotElementId()===f);if((u=a.adReload)!=null&&u.intervalMs&&(c!=null&&c.bidder)&&a.adReload.allowed.includes(c.bidder)){let f=n.filter(g=>g.moliSlot.domId===a.skinAdSlotDomId||a.blockedAdSlotDomIds.includes(g.moliSlot.domId)).map(g=>g.moliSlot.behaviour.loaded);f.every(g=>g===f[0])&&f[0]!=="infinite"?(o&&clearTimeout(o),o=r.e.setTimeout(()=>{var g;r.e.moli.refreshAdSlot([...a.blockedAdSlotDomIds,a.skinAdSlotDomId],{loaded:f[0]}),(g=m(a.skinAdSlotDomId))==null||g.setTargeting("native-ad-reload","true"),r.t.info("SkinModule","Ad reload for skin and blocked slots triggered",a.skinAdSlotDomId,a.blockedAdSlotDomIds)},(l=a.adReload)==null?void 0:l.intervalMs)):r.t.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",f)}}else a.enableCpmComparison&&(r.t.debug("SkinModule","Skin configuration ignored because cpm was low",a),this.destroyAdSlot(n,r.e)(a.skinAdSlotDomId))}else e.configs.filter(a=>a.destroySkinSlot).map(a=>a.skinAdSlotDomId).filter(Y).forEach(this.destroyAdSlot(n,r.e))};this.hideAdSlot=(e,r)=>i=>{let n=e.document.getElementById(i);try{n&&(r.debug("SkinModule",`Set display:none for ${i}`),n.style.setProperty("display","none"))}catch(o){r.error("SkinModule",`Couldn't set the the wallpaper div ${i} to display:none;`,o)}}}r(){return this.skinModuleConfig}n(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin,this.bidsBackHandler.push(this.runSkinConfigs(e.skin)))}s(){return[]}a(){return[]}d(){return[]}v(){return this.bidsBackHandler}};window.moli.registerModule(new mt);var So=[T.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,T.responses.TCPurpose.SELECT_BASIC_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_ADS,T.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,T.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,T.responses.TCPurpose.MEASURE_AD_PERFORMANCE,T.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,T.responses.TCPurpose.APPLY_MARKET_RESEARCH,T.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS,T.responses.TCPurpose.USE_LIMITED_DATA_TO_SElECT_CONTENT],li=()=>{let t=null,e=(r,i)=>{if(i.i==="test")return Promise.resolve();let n=i.e;return n.Utiq=n.Utiq?x(h({},n.Utiq),{config:h(h({},n.Utiq.config),r.options)}):{queue:[],config:r.options},n.Utiq.queue=n.Utiq.queue||[],i.o.gdprApplies&&So.some(o=>i.o.gdprApplies&&!i.o.purpose.consents[o])?Promise.resolve():i.p.loadScript({name:"utiq",loadMethod:1,assetUrl:r.assetUrl}).catch(o=>i.t.error("failed to load utiq",o))};return{name:"utiq",description:"user module",moduleType:"identity",r(){return t},n(r){r!=null&&r.utiq&&r.utiq.enabled&&(t=r.utiq)},s(){return t!=null&&t.enabled?[_("utiq",r=>e(t,r))]:[]},a(){return[]},d(){return[]}}};window.moli.registerModule(li());var ui=t=>{var e;return t?((e=t.dynamicFloorPrices)==null?void 0:e.strategy)!==void 0:!1};var Ao=t=>{if(t.length===0)return null;{let e=Math.max(...t);return Math.round(e*100)}},Po=t=>{if(t.length===0)return null;{let e=Math.min(...t);return Math.round(e*100)}},Co=t=>{if(!t||t.length===0)return null;if(t.length===1)return Math.round(t[0]*100);{let e=t.sort()[t.length-2];return Math.round(e*100)}},Ro=(t,e)=>{switch(t){case"max":return Ao(e);case"min":return Po(e);case"second-highest":return Co(e);default:return null}},gt=t=>Math.floor(t),Eo=t=>{let e=gt(t.priceInCents),r=gt(t.roundingStepsInCents),i=t.maxPriceRuleInCents!==void 0?gt(t.maxPriceRuleInCents):void 0,n=t.minPriceRuleInCents!==void 0?gt(t.minPriceRuleInCents):void 0,o=Math.floor(e/r)*r;return i!==void 0&&o>i?i:n!==void 0&&o<n?n:o},pi=({strategy:t,previousCpms:e,standardRule:r,roundingStepsInCents:i=5,maxPriceRuleInCents:n=500,minPriceRuleInCents:o=5})=>{let s=Array.isArray(e)?e==null?void 0:e.filter(l=>l>0&&!isNaN(l)):[];if(!s||s.length===0||!t)return r;let d=Ro(t,s);if(d===null)return r;let u=Eo({priceInCents:d,roundingStepsInCents:i,maxPriceRuleInCents:n,minPriceRuleInCents:o});return x(h({},r),{floorprice:u/100,priceRuleId:u})};var ci=t=>{let e={rules:{},browser:"None"},r=Promise.resolve(e),i=!1,n="mobile",o={},s=(f,y,g,A,S)=>{switch(n=f,o=y,t.provider){case"none":S.warn("YieldOptimizationService","Yield optimization is disabled!"),i=!1,r=Promise.resolve(e);break;case"static":S.warn("YieldOptimizationService","Yield optimization is static!"),i=!0,r=Promise.resolve({rules:t.config.rules,browser:"None"});break;case"dynamic":i=!0;let P=t.excludedAdUnitPaths,b=g.filter(C=>P.indexOf(C)<0).map(C=>J(C,o));r=a(t.configEndpoint,3,b,A).then(C=>(S.info("YieldOptimizationService",`loaded pricing rules for device ${n}`,C),C)).catch(C=>(S.error("YieldOptimizationService","failed to initialize service",C),e));break;default:i=!1,r=Promise.reject("Unknown config provider")}return Promise.resolve()},d=f=>r.then(y=>y.rules[J(f,o)]),u=()=>r.then(f=>f.browser||"None"),l=(f,y,g,A,S)=>{let P=J(f.getAdUnitPath(),o);return r.then(v=>{let b=v.rules[P];if(y==="gam")if(b)if(f.setTargeting("upr_model",b.model||"static"),b.main){f.setTargeting("upr_main","true");let C=S==null?void 0:S.getLastBidCpmsOfAdUnit(f.getSlotElementId());if(C&&(C==null?void 0:C.length)>0&&ui(A)&&A.dynamicFloorPrices){let{strategy:E,roundingStepsInCents:D,maxPriceRuleInCents:N,minPriceRuleInCents:j}=A.dynamicFloorPrices,W=pi({strategy:E,previousCpms:C,standardRule:b,roundingStepsInCents:D,maxPriceRuleInCents:N,minPriceRuleInCents:j});return g.debug("YieldOptimizationService",`set dynamic price rule id ${W.priceRuleId} for ${P} based on previous bid cpms on same position. Stategy is '${E}'. Main traffic share ${b.main}. Cpm is ${W.floorprice}.`),f.setTargeting("upr_id",W.priceRuleId.toFixed(0)),W}else f.setTargeting("upr_id",b.priceRuleId.toFixed(0))}else g.debug("YieldOptimizationService",`set price rule id ${b.priceRuleId} for ${P}. Main traffic share ${b.main}. cpm is ${b.floorprice}`),f.setTargeting("upr_id",b.priceRuleId.toFixed(0));else i&&g.warn("YieldOptimizationService",`No price rule found for ${P}`);return b})},a=(f,y,g,A,S=null)=>y<=0?Promise.reject(S):A(f,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:n,key:"adUnitPath",adUnitPaths:g})}).then(P=>P.ok?P.json():P.text().then(v=>Promise.reject(`${P.statusText}: ${v}`))).then(P=>typeof P!="object"||P===null?Promise.reject("Invalid response"):p(P)?m(P.rules)?P:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(P=>new Promise(b=>setTimeout(b,100/y)).then(()=>a(f,y-1,g,A,P))),p=f=>f.hasOwnProperty("rules"),c=f=>typeof f=="object"&&f!==null,m=f=>c(f)?Object.keys(f).every(y=>{let g=f[y];return typeof g=="object"&&g!==null&&typeof g.main=="boolean"&&typeof g.floorprice=="number"&&typeof g.priceRuleId=="number"}):!1;return{init:s,getPriceRule:d,getBrowser:u,setTargeting:l}};var mi=t=>{let e="YieldOptimization",r="Provides floors and UPR ids",i="yield",n=null,o=[],s=[],d=()=>n,u=f=>{var y;if((y=f==null?void 0:f.yieldOptimization)!=null&&y.enabled){n=f.yieldOptimization;let g=t!=null?t:ci(f.yieldOptimization);o.push(c(g)),s.push(m(g))}},l=()=>o,a=()=>[],p=()=>s,c=f=>_("yield-optimization-init",y=>{let g=y.r.slots.filter(A=>y.u.filterSlot(A)).map(A=>A.adUnitPath).filter(Y);return f.init(y.u.getDeviceLabel(),y.m,g,y.e.fetch,y.t)}),m=f=>$("yield-optimization",Ge,(y,g)=>{y.t.debug("YieldOptimizationService",y.c,"applying price rules");let A=y.r.adServer||"gam",S=g.map(P=>f.setTargeting(P.adSlot,A,y.t,n,y.g).then(v=>P.priceRule=v));return Promise.all(S).then(()=>f.getBrowser()).then(P=>{y.i==="production"&&A==="gam"&&y.e.googletag.pubads().setTargeting("upr_browser",P)})});return{name:e,description:r,moduleType:i,r:d,n:u,s:l,a,d:p}};window.moli.registerModule(mi());var gi,Re=(gi=window.document.currentScript)!=null?gi:document.getElementById("moli-ad-tag"),fi,Ct=(fi=we(window,Be.moliPubCode,ne.moliPubCode)[0])==null?void 0:fi.value,yi,Rt=(yi=we(window,Be.moliVersion,ne.moliVersion)[0])==null?void 0:yi.value,bi,vi,hi,Ii;if(Re){let t=Ct!=null?Ct:Re.getAttribute("data-publisher-code"),e=(bi=Rt!=null?Rt:Re.getAttribute("data-version"))!=null?bi:"production",r=((vi=Re.getAttribute("data-labels"))!=null?vi:"").split(",").map(o=>o.trim()).filter(o=>o.length>0);r.length>0&&window.moli.que.push(o=>{o.beforeRequestAds(()=>r.forEach(s=>o.addLabel(s)))}),window.moli.configLabel=e;let i=(hi=Re.getAttribute("data-endpoint"))!=null?hi:"api.h5v.eu/publishers",n=(Ii=Re.getAttribute("data-endpoint-fallback"))!=null?Ii:"cdn.h5v.eu/publishers";if(t){let o=`/${t}/configs/${e}/config.json`,s=`//${i}${o}`;fetch(s,{mode:"cors"}).then(d=>d.json()).catch(d=>(console.error(`Failed to load configuration from ${s}. Using fallback`,d),fetch(`//${n}${o}`,{mode:"cors"}))).then(d=>window.moli.configure(d)).catch(d=>console.error(`Failed to load configuration from ${s}:`,d))}else console.error('No publisher code provided for ad tag configuration! Add the `data-publisher-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");})();
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
