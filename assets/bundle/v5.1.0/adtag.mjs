/* ad tag library 5.1.0 by highfivve.com */
"use strict";(()=>{var hr=Object.defineProperty,Sr=Object.defineProperties;var Ir=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable;var Lt=r=>{throw TypeError(r)};var Dt=(r,e,t)=>e in r?hr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,y=(r,e)=>{for(var t in e||(e={}))Bt.call(e,t)&&Dt(r,t,e[t]);if(Be)for(var t of Be(e))qt.call(e,t)&&Dt(r,t,e[t]);return r},w=(r,e)=>Sr(r,Ir(e));var Ut=(r,e)=>{var t={};for(var o in r)Bt.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&Be)for(var o of Be(r))e.indexOf(o)<0&&qt.call(r,o)&&(t[o]=r[o]);return t};var vr=(r,e,t)=>e.has(r)||Lt("Cannot "+t);var he=(r,e,t)=>(vr(r,e,"read from private field"),t?t.call(r):e.get(r)),At=(r,e,t)=>e.has(r)?Lt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);var _t=(r,e,t)=>new Promise((o,i)=>{var n=d=>{try{a(t.next(d))}catch(u){i(u)}},s=d=>{try{a(t.throw(d))}catch(u){i(u)}},a=d=>d.done?o(d.value):Promise.resolve(d.value).then(n,s);a((t=t.apply(r,e)).next())});var Ar=r=>{let e=r.indexOf("=");if(e>=0){let t=decodeURIComponent(r.slice(0,e)),o=decodeURIComponent(r.slice(e+1));return[t,o]}else return[decodeURIComponent(r),""]},Se=r=>{try{let e=r.startsWith("?")?r.slice(1):r;return e.length>0?new Map(e.split("&").filter(t=>t.length>0).map(Ar)):new Map}catch(e){return console.error(e),new Map}};var qe=(r,e)=>{let t=[],o,i=typeof r.document=="object"&&r.document,n=i&&i.documentElement.doScroll,s="DOMContentLoaded",a=i&&(n?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);!a&&i&&i.addEventListener(s,o=()=>{if(i)for(i.removeEventListener(s,o),a=!0;o=t.shift();)o()}),a?setTimeout(e,0):t.push(e)};var Pt=class{constructor(e){this.window=e}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,t);case 1:return this.loadAssetViaTag(e,t)}})}loadJson(e,t){return this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(o=>o.ok?o.json():o.text().then(i=>Promise.reject(`${o.statusText}: ${i}`))).catch(o=>Promise.reject(o))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then(o=>o.ok?Promise.resolve(o):Promise.reject(o)).then(o=>o.text()).then(o=>this.scriptTagWithBody(o)).then(o=>t.appendChild(o))}scriptTagWithBody(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){let o=this.scriptTag(e);return new Promise((i,n)=>{o.onload=i,o.onerror=n,t.appendChild(o)})}scriptTag(e){let t=this.window.document.createElement("script");return e.type==="module"?t.type="module":e.type==="nomodule"?(t.type="text/javascript",t.setAttribute("nomodule","")):e.assetUrl.endsWith("mjs")?t.type="module":t.type="text/javascript",t.async=!0,t.src=e.assetUrl,t}awaitDomReady(){return new Promise(e=>{qe(this.window,e)})}},Le=r=>new Pt(r);function Pr(r){try{let e="moliDebug";return!!Se(r.location.search).get(e)||!!r.sessionStorage.getItem(e)||!!r.localStorage.getItem(e)}catch(e){return!1}}function Cr(){let r=()=>{};return{debug:r,info:r,warn:r,error:console.error}}function Y(r){return`background:${r}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function Ue(r){switch(r){case"debug":return Y("#49A0CC");case"info":return Y("#61A172");case"warn":return Y("#FFC300");case"error":return Y("#C70039")}}function _e(r){switch(r){case"AdPipeline":return Y("#74ABC6");case"GAM":return Y("#BA0E5F");case"MoliGlobal":return Y("#403073");case"Prebid":return Y("#4357AD");case"AdVisibilityService":return Y("#d5ba3c");case"UserActivityService":return Y("#19ad0e");case"Adex DMP":return Y("#003E74");default:return Y("#052E53")}}function oe(){return{debug(r,e,...t){console.debug(`%c[DEBUG]%c${r}%c${e}`,Ue("debug"),_e(r),"",...t)},info(r,e,...t){console.info(`%c[INFO]%c${r}%c${e}`,Ue("info"),_e(r),"",...t)},warn(r,e,...t){console.warn(`%c[WARN]%c${r}%c${e}`,Ue("warn"),_e(r),"",...t)},error(r,e,...t){console.error(`%c[ERROR]%c${r}%c${e}`,Ue("error"),_e(r),"",...t)}}}function x(r,e){return Pr(e)?oe():r&&r.logger?r.logger:Cr()}var Ve=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}};var Ne=(r,e,t,o)=>{let i=r.slots.find(n=>n.domId===e);if(i){let n=w(y({},i),{domId:t});return w(y({},r),{slots:[...r.slots,n]})}else return o.error("MoliGlobal","no infinite ad slot configured!",r),r};function ce(r){return r.reduce((e,t)=>e.concat(t),[])}function j(r,e,t){return t.indexOf(r)===e}function V(r){return r!=null}var ge=class{constructor(e,t,o){this.labelSizeConfig=e;this.extraLabels=t;this.window=o;this.possibleDevices=["mobile","desktop","android","ios"];let i=t.some(a=>this.possibleDevices.indexOf(a)>-1),n=e.filter(a=>o.matchMedia(a.mediaQuery).matches);this.isValid=e.length===0||!(e.length>0&&n.length===0);let s=ce(n.map(a=>a.labelsSupported));this.supportedLabels=[...i?[]:s,...t].filter(j)}filterSlot(e){var o,i;let t=!0;return this.supportedLabels.length&&((o=e.labelAll)!=null&&o.length)&&(t=e.labelAll.every(n=>this.supportedLabels.indexOf(n)>-1)),this.supportedLabels.length&&e.labelAny&&!((i=e.labelAll)!=null&&i.length)&&(t=e.labelAny.some(n=>this.supportedLabels.indexOf(n)>-1)),t}getSupportedLabels(){return this.supportedLabels}getDeviceLabel(){return this.getSupportedLabels().find(e=>this.possibleDevices.indexOf(e)>-1)||"mobile"}},Ct=(r,e,t,o)=>new ge(t!=null?t:[],[...(o==null?void 0:o.labels)||[],...e.labels],r).getDeviceLabel();var S;(t=>{let r;(n=>{let o;(h=>(h[h.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",h[h.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",h[h.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",h[h.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",h[h.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",h[h.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",h[h.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",h[h.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",h[h.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",h[h.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",h[h.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(o=n.TCPurpose||(n.TCPurpose={}));let i;(u=>(u[u.NOT_ALLOWED=0]="NOT_ALLOWED",u[u.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",u[u.REQUIRE_LI=2]="REQUIRE_LI"))(i=n.RestrictionType||(n.RestrictionType={}))})(r=t.responses||(t.responses={}));let e;(s=>{let o;(l=>(l.VISIBLE="visible",l.HIDDEN="hidden",l.DISABLED="disabled"))(o=s.DisplayStatus||(s.DisplayStatus={}));let i;(p=>(p.STUB="stub",p.LOADING="loading",p.LOADED="loaded",p.ERROR="error"))(i=s.CmpStatus||(s.CmpStatus={}));let n;(l=>(l.TC_LOADED="tcloaded",l.CMP_UI_SHOWN="cmpuishown",l.USER_ACTION_COMPLETE="useractioncomplete"))(n=s.EventStatus||(s.EventStatus={}))})(e=t.status||(t.status={}))})(S||(S={}));var Rr=S.status.EventStatus,wr=S.status.CmpStatus,Mr=[S.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,S.responses.TCPurpose.SELECT_BASIC_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,S.responses.TCPurpose.MEASURE_AD_PERFORMANCE,S.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,S.responses.TCPurpose.APPLY_MARKET_RESEARCH,S.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],Er=r=>!!r.gdprApplies&&Mr.some(e=>!r.purpose.consents[e]&&r.purpose.legitimateInterests[e]),Vt=(r,e,t,o)=>(o==="test"&&t.info("gdprApplies is set to false in test mode!"),o==="test"||r.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:Rr.TC_LOADED,cmpStatus:wr.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((i,n)=>{if(e.__tcfapi){let s=a=>{a.cmpStatus==="error"?n(a):(a.eventStatus==="useractioncomplete"||a.eventStatus==="tcloaded")&&(t.debug("Consent","consent ready",a),r.disableLegitimateInterest&&Er(a)?n("user consent is missing for some purposes"):i(a),a.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},a.listenerId))};e.__tcfapi("addEventListener",2,s)}else n("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var Me=r=>{if(r){let[e,t,o]=r.split(".").reverse();switch(`${t}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${o}.${t}.${e}`;default:return t?`${t}.${e}`:e}}else return};var ze=r=>{let[e,t,...o]=r.split("/"),[i,...n]=t.split(",");return n.length===0?r:["",i,...o].join("/")},W=(r,e)=>{let t=/[^{]+(?=})/g,o=/([A-Za-z0-9\_]+)/g,i=r.match(t);return!e||!i?r:(i.forEach(n=>{if(!n.match(o))throw new SyntaxError(`invalid variable "${n}" in path`);if(!e[n])throw new ReferenceError(`path variable "${n}" is not defined`)}),r.replace(new RegExp(Object.keys(e).map(n=>`{${n}}`).join("|"),"g"),n=>e[n.substr(1,n.length-2)]))},Nt=(r,e)=>r.split("/").slice(0,e+1).join("/"),zt=(r,e,t,o)=>y({device:e,domain:o||Me(r)||"unknown"},t);var Ft=r=>{var e;return typeof((e=r.crypto)==null?void 0:e.randomUUID)=="function"?r.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let o=Math.random()*16|0;return(t==="x"?o:o&3|8).toString(16)})};var Tr=S.responses.TCPurpose,je=100,G=10,q=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),N=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),J=(r,e)=>{Object.defineProperty(e,"name",{value:r});let t=0;return N(r,(o,i)=>t!==o.requestAdsCalls?(t=o.requestAdsCalls,e(o,i)):Promise.resolve())},$t=(r,e)=>(Object.defineProperty(e,"name",{value:r}),N(r,(t,o)=>t.requestAdsCalls===1&&t.requestId===1?e(t,o):Promise.resolve())),_=(r,e,t)=>{let o=Object.assign(t,{priority:e});return Object.defineProperty(t,"name",{value:r}),o},Fe=(r,e)=>(Object.defineProperty(e,"name",{value:r}),e),Ie=class{constructor(e,t,o,i){this.config=e;this.logger=t;this.window=o;this.auction=i;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,t)=>{let o=new Map;return this.config.prepareRequestAds.forEach(i=>{let n=o.get(i.priority);n?n.push(i):o.set(i.priority,[i])}),Array.from(o.entries()).sort(([i],[n])=>i>n?-1:1).reduce((i,[n,s])=>i.then(()=>(e.logger.debug("AdPipeline",e.requestId,`run prepareRequestAds with priority ${n}`),Promise.all(s.map(a=>a(e,t))))),Promise.resolve(void 0))}}run(e,t,o,i,n){if(e.length===0)return Promise.resolve();this.requestId=this.requestId+1;let s=this.requestId,a=Ft(this.window);this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${i}. call. AuctionId ${a}`,e);let d=t.consent||{};return this.tcData=this.tcData?this.tcData:Vt(d,this.window,this.logger,o.environment),this.tcData.then(u=>{var b,h,M;let l=[...((b=t.targeting)==null?void 0:b.labels)||[],...o.labels];u.gdprApplies&&u.purpose.consents[Tr.STORE_INFORMATION_ON_DEVICE]?l.push("purpose-1"):u.gdprApplies||l.push("purpose-1");let p=new ge(t.labelSizeConfig||[],l,this.window),c=n&&((h=t.buckets)!=null&&h.bucket)&&t.buckets.bucket[n]?t.buckets.bucket[n]:null,m=zt(this.window.location.hostname,p.getDeviceLabel(),(M=t.targeting)==null?void 0:M.adUnitPathVariables,t.domain),f={auctionId:a,requestId:s,requestAdsCalls:i,logger:this.logger,env:o.environment||"production",config:t,runtimeConfig:o,labelConfigService:p,window:this.window,tcData:u,bucket:c,adUnitPathVariables:m,auction:this.auction,assetLoaderService:Le(this.window)};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(C=>C(f))));let I="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(C=>C(f,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(f,e))).then(C=>C.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(f,C)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(D=>D(f,C)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(f,C)):Promise.reject(I)).catch(C=>{switch(C){case I:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",C),Promise.reject(C)}})})}getAuction(){return this.auction}logStage(e,t){return new Promise(o=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),o()})}};var $e=(r,e)=>r[0]===e[0]&&r[1]===e[1];var K=class{constructor(e,t,o){this.sizeConfig=e;this.supportedLabels=t;this.window=o;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:this.supportedSizes.filter(t=>e.some(o=>t==="fluid"?o==="fluid":o==="fluid"?!1:$e(o,t))):[];this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every(o=>t.some(i=>i===o)))&&(!e.labelNone||!e.labelNone.some(o=>t.some(i=>i===o)));let i=e.length!==0?e.filter(n=>o.matchMedia(n.mediaQuery).matches&&this.areLabelsMatching(n,t)):[];this.isValid=e.length===0||!(e.length>0&&i.length===0),this.supportedSizes=ce(i.map(n=>n.sizesSupported)).map(n=>JSON.stringify(n)).filter(j).map(n=>JSON.parse(n))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var Z={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:r=>`moli-test-slot-size-${r}`,debugDelay:"moli-debug-delay"};var me=(r,e=localStorage)=>{try{return e.getItem(r)}catch(t){return oe().debug(`Could not read value with key ${r} from browser storage`,e),null}},Ee=(r,e,t=localStorage)=>{try{t.setItem(r,e)}catch(o){oe().debug(`Could not set key ${r} with value ${e} to browser storage`,t)}};var xr=r=>r==="hidden"||Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number",Wt=r=>`${r}__container`,Ge=(r,e)=>{let t=Or(r,e);return t.forEach(({slot:o,container:i})=>{i.innerHTML="",i.appendChild(Br(o))}),t};var kr=(r,e)=>{let t=document.getElementById(r);t&&(t.innerHTML=e)},Or=(r,e)=>(e.forEach(t=>{let{moliSlot:o}=t,i=Wt(o.domId),n=document.createElement("div");n.id=i;let s=document.getElementById(o.domId);s&&s.setAttribute("data-google-query-id","test"),kr(o.domId,n.outerHTML),r.logger.debug("GAM",`Set content for slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath}`)}),Dr(e)),Dr=r=>r.map(e=>{let t=document.getElementById(Wt(e.moliSlot.domId));return t?{slot:e,container:t}:void 0}).filter(V),Br=r=>{let e=qr(r),t=Lr(r.moliSlot,e);if(t==="hidden")return document.createElement("div");{let o=document.createElement("div"),[i,n]=t;o.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${i}px; height: ${n}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${r.moliSlot.domId}</strong>`,o.appendChild(s);let a=document.createElement("span");a.style.color="#656565";let d=([b,h])=>a.innerText=`(${b}x${h})`;d([i,n]),s.appendChild(a);let u=document.createElement("div");u.style.cssText="position: absolute; top: 5px; left: 5px",o.appendChild(u);let l=(b,h)=>{if(b==="hidden")o.style.display="none";else{let[M,C]=b;o.style.width=`${M}px`,o.style.height=`${C}px`,d(b),I(h)}Ur(r.moliSlot,b)},p="1px dotted white",c="1px solid black",m=document.createElement("button");m.innerText="hide",m.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",m.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${p};`,m.addEventListener("click",()=>l("hidden",m));let f=[...e.map(b=>{let[h,M]=b,C=Kt(t,b),D=document.createElement("button");return D.innerText=`${h}x${M}`,D.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${C?c:p};`,D.addEventListener("click",()=>l(b,D)),D}),m];f.forEach(b=>u.appendChild(b));let I=b=>{f.forEach(h=>h.style.border=p),b.style.border=c};return o}},qr=r=>r.filterSupportedSizes(r.moliSlot.sizes).filter(K.isFixedSize).filter(([e,t])=>e>1&&t>1),Lr=(r,e)=>{let t=_r(r);if(t&&(t==="hidden"||Vr(e,t)))return t;{let o=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[o]}},Ur=(r,e)=>Ee(Z.testSlotSize(r.domId),JSON.stringify(e)),_r=r=>{let e=me(Z.testSlotSize(r.domId));if(e)try{let t=JSON.parse(e);return xr(t)?t:void 0}catch(t){return}},Kt=(r,e)=>{let[t,o]=r,[i,n]=e;return t===i&&o===n},Vr=(r,e)=>r.some(t=>Kt(t,e));var Nr=(r,e)=>({setCollapseEmptyDiv(){},addService(t){},getSlotElementId(){return r},getAdUnitPath(){return e},setTargeting(t,o){return this},getTargeting(t){return[]},getTargetingKeys(){return[]},clearTargeting(t){},getResponseInformation(){return null}}),Ht=(r,e,t)=>{var n;let o=t?t.keyValues:{},i=(n=t==null?void 0:t.adManagerExcludes)!=null?n:[];[o,e].forEach(s=>{Object.keys(s).filter(a=>!i.includes(a)).forEach(a=>{let d=s[a];d&&r.googletag.pubads().setTargeting(a,d)})})},Yt=(r,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!r.gdprApplies||r.vendor.consents[755]&&r.purpose.consents[S.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[S.responses.TCPurpose.SELECT_BASIC_ADS,S.responses.TCPurpose.MEASURE_AD_PERFORMANCE,S.responses.TCPurpose.APPLY_MARKET_RESEARCH,S.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(t=>r.purpose.consents[t]||r.purpose.legitimateInterests[t]),Jt=()=>{let r;return q("gpt-init",e=>e.env==="test"?Promise.resolve():(r||(r=new Promise(t=>{e.logger.debug("GAM","init googletag stub"),e.window.googletag=e.window.googletag||{},e.window.googletag.cmd=e.window.googletag.cmd||[],e.window.googletag.cmd.push(t),e.assetLoaderService.loadScript({name:"gpt",loadMethod:1,assetUrl:Yt(e.tcData,e.config.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(o=>e.logger.error("failed to load gpt.js",o))})),r))},Xt=()=>{let r=0;return N("gpt-destroy-ad-slots",(e,t)=>{var o;if(e.env==="test")return Promise.resolve();if(((o=e.config.spa)==null?void 0:o.destroyAllAdSlots)===!1){let i=e.window.googletag.pubads().getSlots(),n=t.map(s=>i.find(a=>a.getSlotElementId()===s.domId)).filter(V);n.length===0?e.logger.debug("GAM","no ad slots to destroy"):(e.logger.debug("GAM",`destroy ${n.length} ad slots`,n),e.window.googletag.destroySlots(n))}else r!==e.requestAdsCalls&&(r=e.requestAdsCalls,e.logger.debug("GAM","destroy all ad slots"),e.window.googletag.destroySlots());return Promise.resolve()})},Qt=()=>J("gpt-reset-targeting",r=>new Promise(e=>{r.env==="production"&&(r.logger.debug("GAM","reset top level targeting"),r.window.googletag.pubads().clearTargeting(),Ht(r.window,r.runtimeConfig.keyValues,r.config.targeting)),e()})),Zt=()=>{let r;return N("gpt-configure",(e,t)=>(r||(r=new Promise(o=>{var n;let i=e.runtimeConfig.environment||"production";switch(e.logger.debug("GAM","configure googletag"),i){case"production":Ht(e.window,e.runtimeConfig.keyValues,e.config.targeting),e.window.googletag.pubads().enableAsyncRendering(),e.window.googletag.pubads().disableInitialLoad(),e.window.googletag.pubads().enableSingleRequest(),(n=e.config.gpt)!=null&&n.pageSettingsConfig&&e.window.googletag.setConfig(e.config.gpt.pageSettingsConfig);let s=!Yt(e.tcData,e.config.consent);e.logger.debug("GAM","use limited ads",s),e.window.googletag.pubads().setPrivacySettings({limitedAds:s}),e.window.googletag.enableServices(),o();return;case"test":o();return}})),r))},ei=()=>_("gpt-device-label-keyValue",G,r=>r.env==="test"?Promise.resolve():new Promise(e=>{let t=r.labelConfigService.getDeviceLabel();r.logger.debug("GAM",'adding "device_label" key-value with values',t),r.window.googletag.pubads().setTargeting("device_label",t),e()})),ti=()=>_("gpt-consent-keyValue",G,r=>r.env==="test"?Promise.resolve():new Promise(e=>{let t=r.tcData,o=!t.gdprApplies||[S.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,S.responses.TCPurpose.SELECT_BASIC_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,S.responses.TCPurpose.MEASURE_AD_PERFORMANCE,S.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,S.responses.TCPurpose.APPLY_MARKET_RESEARCH,S.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(i=>t.purpose.consents[i]);r.window.googletag.pubads().setTargeting("consent",o?"full":"none"),e()})),ii=()=>(r,e)=>{let t=e.map(o=>{var m;let i=new K(o.sizeConfig,r.labelConfigService.getSupportedLabels(),r.window),n=i.filterSupportedSizes;if(!(i.filterSlot(o)&&r.labelConfigService.filterSlot(o)))return Promise.resolve(null);let s=n(o.sizes),a=W(o.adUnitPath,r.adUnitPathVariables),d=()=>{switch(o.position){case"in-page":return r.window.googletag.defineSlot(a,s,o.domId);case"interstitial":if(!r.window.document.getElementById(o.domId)){let f=r.window.document.createElement("div");f.id=o.domId,f.setAttribute("data-h5v-position",o.position),f.style.setProperty("display","none"),r.window.document.body.appendChild(f)}return r.window.googletag.defineSlot(a,s,o.domId);case"out-of-page":return r.window.googletag.defineOutOfPageSlot(a,o.domId);case"out-of-page-interstitial":return r.window.googletag.defineOutOfPageSlot(a,r.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);case"out-of-page-bottom-anchor":return r.window.googletag.defineOutOfPageSlot(a,r.window.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);case"out-of-page-top-anchor":return r.window.googletag.defineOutOfPageSlot(a,r.window.googletag.enums.OutOfPageFormat.TOP_ANCHOR)}},u=()=>{if(r.env==="test")return null;let f=d();return f&&r.window.googletag.display(f),f},p=(r.env==="test"?[]:r.window.googletag.pubads().getSlots()).find(f=>f.getSlotElementId()===o.domId),c=p||u();switch(r.env){case"production":if(c)return c.setCollapseEmptyDiv(((m=o.gpt)==null?void 0:m.collapseEmptyDiv)!==!1),c.addService(r.window.googletag.pubads()),r.logger.debug("GAM",`Register slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath}`),Promise.resolve({moliSlot:o,adSlot:c,filterSupportedSizes:n});if(o.position==="out-of-page-interstitial"||o.position==="out-of-page-top-anchor"||o.position==="out-of-page-bottom-anchor")return r.logger.warn("GAM",`${o.position} is not supported`),Promise.resolve(null);{let f=`Slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath} is already defined. You may have called requestAds() multiple times`;return r.logger.error("GAM",f),Promise.reject(new Error(f))}case"test":return Promise.resolve({moliSlot:o,adSlot:Nr(o.domId,o.adUnitPath),filterSupportedSizes:n});default:return Promise.reject(`invalid environment: ${r.runtimeConfig.environment}`)}});return Promise.all(t).then(o=>o.filter(V))},zr=(r,e)=>{let t=r.find(({moliSlot:o})=>o.position==="interstitial");if(t&&t.adSlot.getTargeting("hb_pb").length===0){e.window.googletag.destroySlots([t.adSlot]);let i=e.window.googletag.defineOutOfPageSlot(W(t.moliSlot.adUnitPath,e.adUnitPathVariables),e.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);if(i)return console.log("GAM","Display out-of-page-interstitial slot"),i.addService(e.window.googletag.pubads()),e.window.googletag.display(i),[...r.filter(({moliSlot:n})=>n.position!=="interstitial"),w(y({},t),{adSlot:i})];e.logger.error("GAM","Failed to define out-of-page-interstitial slot")}return r},ri=()=>(r,e)=>new Promise(t=>{switch(r.logger.debug("GAM","requestAds"),r.env){case"test":Ge(r,e);break;case"production":let o=e.filter(({moliSlot:s})=>!r.auction.isSlotThrottled(s.domId));if(o.length===0)break;let i=zr(o,r);r.window.googletag.pubads().refresh(i.map(({adSlot:s})=>s));let n=i.map(({moliSlot:s})=>`[DomID] ${s.domId} [AdUnitPath] ${s.adUnitPath}`).join(`
`);r.logger.debug("GAM",`Refresh ${e.length} slot(s):
${n}`);break}t()});var ue;(A=>{let r;(te=>{let de;(ie=>(ie[ie.Unknown=0]="Unknown",ie[ie.ProfessionallyProduced=1]="ProfessionallyProduced",ie[ie.Prosumer=2]="Prosumer",ie[ie.UGC=3]="UGC"))(de=te.ContentQuality||(te.ContentQuality={}))})(r=A.firstpartydata||(A.firstpartydata={}));let e;(z=>{let de;(le=>(le[le.NO=0]="NO",le[le.YES=1]="YES"))(de=z.Skip||(z.Skip={}));let te;(U=>(U[U.VAST_1=1]="VAST_1",U[U.VAST_2=2]="VAST_2",U[U.VAST_3=3]="VAST_3",U[U.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",U[U.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",U[U.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",U[U.VAST_4=7]="VAST_4",U[U.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",U[U.DAAST_1=9]="DAAST_1",U[U.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(te=z.Protocol||(z.Protocol={}));let we;(B=>(B[B.AutoPlaySoundOff=1]="AutoPlaySoundOff",B[B.AutoPlaySoundOn=2]="AutoPlaySoundOn",B[B.ClickToPlay=3]="ClickToPlay",B[B.MousOver=4]="MousOver",B[B.InViewportSoundsOn=5]="InViewportSoundsOn",B[B.InViewportSoundsOff=6]="InViewportSoundsOff"))(we=z.PlaybackMethod||(z.PlaybackMethod={}));let vt;(B=>(B[B.VPAID_1=1]="VPAID_1",B[B.VPAID_2=2]="VPAID_2",B[B.MRAID_1=3]="MRAID_1",B[B.ORMMA=4]="ORMMA",B[B.MRAID_2=5]="MRAID_2",B[B.MRAID_3=6]="MRAID_3"))(vt=z.Api||(z.Api={}));let fr;(re=>(re[re.InStream=1]="InStream",re[re.InBanner=2]="InBanner",re[re.InArticle=3]="InArticle",re[re.InFeed=4]="InFeed",re[re.Interstitial=5]="Interstitial"))(fr=z.Placement||(z.Placement={}));let yr;(pe=>(pe[pe.Instream=1]="Instream",pe[pe.AccompanyingContent=2]="AccompanyingContent",pe[pe.Interstitial=3]="Interstitial",pe[pe.NoContentStandalone=4]="NoContentStandalone"))(yr=z.Plcmt||(z.Plcmt={}));let ie;(E=>(E[E.AudioAdAutoPlay=1]="AudioAdAutoPlay",E[E.AudioAdUserInitiated=2]="AudioAdUserInitiated",E[E.ExpandableAutomatic=3]="ExpandableAutomatic",E[E.ExpandableOnClick=4]="ExpandableOnClick",E[E.ExpandableOnRollover=5]="ExpandableOnRollover",E[E.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",E[E.InBannerVideoAdClick=7]="InBannerVideoAdClick",E[E.Pop=8]="Pop",E[E.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",E[E.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",E[E.Surveys=11]="Surveys",E[E.TextOnly=12]="TextOnly",E[E.UserInteractive=13]="UserInteractive",E[E.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",E[E.HasAudioOnOffButton=15]="HasAudioOnOffButton",E[E.HasSkipButton=16]="HasSkipButton",E[E.AdobeFlash=16]="AdobeFlash"))(ie=z.CreativeAttributes||(z.CreativeAttributes={}));let br;(le=>(le[le.LinerInStream=1]="LinerInStream",le[le.NonLinearOverlay=2]="NonLinearOverlay"))(br=z.Linearity||(z.Linearity={}))})(e=A.video||(A.video={})),A.Adagio="adagio",A.AdaptMx="amx",A.Adform="adf",A.AdUp="aduptech",A.Criteo="criteo",A.ConnectAd="connectad",A.AppNexusAst="appnexusAst",A.AppNexus="appnexus",A.GumGum="gumgum",A.ImproveDigital="improvedigital",A.IndexExchange="ix",A.Invibes="invibes",A.NanoInteractive="nanointeractive",A.PubMatic="pubmatic",A.Ogury="ogury",A.OneTag="onetag",A.OpenX="openx",A.SmartAdServer="smartadserver",A.Smartx="smartx",A.Unruly="unruly",A.Teads="teads",A.TheTradeDesk="ttd",A.Triplelift="triplelift",A.Yieldlab="yieldlab",A.Seedtag="seedtag",A.Spotx="spotx",A.ShowHeroes="showheroesBs",A.StroeerCore="stroeerCore",A.StailaMedia="stailamedia",A.Xaxis="xhb",A.DSPX="dspx",A.RichAudience="ra",A.Rubicon="rubicon",A.Recognified="rads",A.Visx="visx",A.Vlyby="vlyby",A.Orbidder="orbidder"})(ue||(ue={}));var oi=(r,e)=>{var t;return w(y({},r),{ext:w(y({},r.ext),{prebid:w(y({},(t=r.ext)==null?void 0:t.prebid),{storedrequest:e})})})};var Te={version:"5.1.0"};var ni=(r,e,t={})=>({url:e,render:o=>jr(o,r,t),backupOnly:!0}),jr=(r,e,t={})=>{if(!r.renderer){oe().error("Can not initialize prebid outstream player, because bid.renderer is not defined");return}r.renderer.push(()=>{var o;return(o=window.outstreamPlayer)==null?void 0:o.call(window,r,e,t)})};var Fr=r=>new Promise((e,t)=>{r.window.setTimeout(()=>t("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),$r=r=>new Promise(e=>r.pbjs.que.push(e)),si=r=>!!r.moliSlot.prebid,Gr=(r,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(t=>r.code===t.code):!1,ai=(r,e,t)=>t.filter(si).map(({moliSlot:i,priceRule:n,filterSupportedSizes:s})=>{let a=n?{floors:{currency:e.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":n.floorprice}}}:null;return r.logger.debug("Prebid",r.requestId,"Price Rule",n,i.domId,a),Wr(i.prebid).map(d=>{var Q,ae,ye,be;let u=d.adUnit.mediaTypes.banner,l=d.adUnit.mediaTypes.video,p=d.adUnit.mediaTypes.native,c=u?s(u.sizes).filter(K.isFixedSize):[],m=l?Kr(l.playerSize,s):[],f=d.adUnit.bids.filter(H=>r.labelConfigService.filterSlot(H)).filter(H=>H.bidder&&r.auction.biddersDisabling?!r.auction.biddersDisabling.isBidderDisabled(i.domId,H.bidder):!0).filter(H=>H.bidder&&r.auction.frequencyCapping?!r.auction.isBidderFrequencyCappedOnSlot(i.domId,H.bidder):!0).map(H=>{let v=H,{labelAny:ee,labelAll:Ot}=v;return Ut(v,["labelAny","labelAll"])}),I=m.length>0&&!(l!=null&&l.w)&&!(l!=null&&l.h)?{w:m[0][0],h:m[0][1]}:{},b=e.backupVideoRenderer,h=l?{video:y(y(w(y({},l),{playerSize:m.length===0?void 0:m}),I),b?{renderer:ni(i.domId,b.url)}:{})}:void 0,M=u&&c.length>0?{banner:w(y({},u),{sizes:c})}:void 0,C=p?{native:y({},p)}:void 0,D=w(y({},d.adUnit.pubstack),{adUnitPath:W(((Q=d.adUnit.pubstack)==null?void 0:Q.adUnitPath)||i.adUnitPath,r.adUnitPathVariables)}),F=(be=(ye=(ae=d.adUnit.ortb2Imp)==null?void 0:ae.ext)==null?void 0:ye.prebid)==null?void 0:be.storedrequest,X=F&&F.id?w(y({},F),{id:W(F.id,r.adUnitPathVariables)}):null;return y(w(y(w(y(y({},d.adUnit),F&&X&&{ortb2Imp:oi(d.adUnit.ortb2Imp,X)}),{code:d.adUnit.code||i.domId}),d.adUnit.pubstack?{pubstack:D}:{}),{mediaTypes:y(y(y({},h),M),C),bids:f}),a)}).filter(d=>d.bids.length>0&&d.mediaTypes&&(d.mediaTypes.banner||d.mediaTypes.video||d.mediaTypes.native)&&!Gr(d,r.window))}).reduce((i,n)=>[...i,...n],[]),di=r=>q("prebid-init",e=>{var t;return e.window.pbjs=e.window.pbjs||{que:[]},e.window.pbjs.libLoaded?Promise.resolve():(t=e.config.prebid)!=null&&t.distributionUrl?(r.loadScript({name:"prebid",assetUrl:e.config.prebid.distributionUrl,loadMethod:1}),Promise.resolve()):Promise.race([$r(e.window),Fr(e)])}),li=r=>N("prebid-remove-adunits",e=>new Promise(t=>{if(r.ephemeralAdUnits!==!0){e.window.pbjs=e.window.pbjs||{que:[]};let o=e.window.pbjs.adUnits;o&&e.window.pbjs.que.push(()=>{e.logger.debug("Prebid","Destroying prebid adUnits",o),o.forEach(i=>e.window.pbjs.removeAdUnit(i.code))})}t()})),ui=(r,e)=>{let t,o=i=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:i}});return N("prebid-configure",(i,n)=>(t||(t=new Promise(s=>{r.bidderSettings&&(i.window.pbjs.bidderSettings=r.bidderSettings),i.window.pbjs.que.push(()=>{r.config.s2sConfig&&(Array.isArray(r.config.s2sConfig)?r.config.s2sConfig:[r.config.s2sConfig]).forEach(u=>{var p,c;let l=(c=(p=u.extPrebid)==null?void 0:p.analytics)==null?void 0:c.h5v;l&&(l.configLabel=i.window.moli.configLabel,l.moliVersion=Te.version)}),i.window.pbjs.setConfig(w(y({},r.config),{schain:o([e.supplyChainStartNode]),floors:r.config.floors||{}})),r.schain.nodes.forEach(({bidder:d,node:u,appendNode:l})=>{let p=[e.supplyChainStartNode];l&&p.push(u),i.window.pbjs.setBidderConfig({bidders:[d],config:{schain:o(p)}},!0)}),i.window.pbjs.registerSignalSources&&i.window.pbjs.registerSignalSources()}),s()})),t))},Wr=r=>Array.isArray(r)?r:[r],pi=r=>_("prebid-prepare-adunits",G,(e,t)=>new Promise(o=>{r.ephemeralAdUnits||e.window.pbjs.que.push(()=>{let i=ai(e,r,t);i.forEach(n=>{e.logger.debug("Prebid",e.requestId,`Prebid add ad unit: [Code] ${n.code}`,n)}),e.window.pbjs.addAdUnits(i)}),o()})),ci=(r,e)=>Fe("prebid-request-bids",(t,o)=>{var a,d;let i=Math.max(((a=r.config.bidderTimeout)!=null?a:2e3)+3e3,(d=r.failsafeTimeout)!=null?d:0),n=new Promise(u=>t.window.setTimeout(u,i)),s=new Promise(u=>{var I;let l=o.filter(b=>!t.auction.isSlotThrottled(b.moliSlot.domId)),p=r.ephemeralAdUnits?{adUnits:ai(t,r,l)}:{adUnitCodes:l.filter(si).map(b=>b.moliSlot.domId)},c=p.adUnitCodes||((I=p.adUnits)==null?void 0:I.map(b=>b.code).filter(V).filter(j))||[];if(c.length===0)return t.logger.debug("Prebid","skip request bids. All slots were filtered.",l.map(b=>b.moliSlot)),u();let m=!1;t.logger.debug("Prebid",`Prebid request bids: 
			${c.join(`
			`)}`);let f=(b,h,M)=>{t.logger.info("Prebid",M,b,o.map(C=>C.moliSlot.domId));try{if(m){t.logger.warn("Prebid",`ad server request already sent [${t.requestId}]. AuctionId ${M}`);return}if(!b)return t.logger.warn("Prebid",`Undefined bid response map for ad unit codes: ${c.join(", ")}`),u();m=!0,e==="gam"&&(t.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.forEach(C=>C(t,b,o)),t.window.pbjs.setTargetingForGPTAsync(c)),u()}catch(C){t.logger.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(C)),u()}};t.window.pbjs.que.push(()=>{var b;t.window.pbjs.requestBids(w(y({},p),{auctionId:t.auctionId,timeout:(b=t.bucket)==null?void 0:b.timeout,bidsBackHandler:f}))})});return Promise.race([n,s])}),gi=()=>(r,e)=>{let t=e.map(o=>{let i=new K(o.sizeConfig,r.labelConfigService.getSupportedLabels(),r.window),n=i.filterSupportedSizes;if(!(i.filterSlot(o)&&r.labelConfigService.filterSlot(o)))return Promise.resolve(null);let s={getAdUnitPath:()=>o.adUnitPath};switch(r.env){case"production":return Promise.resolve({moliSlot:o,adSlot:s,filterSupportedSizes:n});case"test":return Promise.resolve({moliSlot:o,adSlot:s,filterSupportedSizes:n});default:return Promise.reject(`invalid environment: ${r.runtimeConfig.environment}`)}});return Promise.all(t).then(o=>o.filter(V))},mi=()=>(r,e)=>new Promise((t,o)=>{r.logger.debug("Prebid","start rendering");try{switch(r.env){case"test":r.logger.debug("Prebid","Rendering test slots"),Ge(r,e);break;case"production":r.window.pbjs.getHighestCpmBids().filter(i=>i&&i.adId).forEach(i=>{var s;let n=r.window.document.getElementById(i.adUnitCode);if(n){let a=document.createElement("div");a.style.setProperty("border","0pt none");let d=document.createElement("iframe");d.scrolling="no",d.frameBorder="0",d.marginHeight="0",d.marginHeight="0",d.name=`prebid_ads_iframe_${i.adUnitCode}`,d.title="3rd party ad content",d.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),d.setAttribute("aria-label","Advertisment"),d.style.setProperty("border","0"),d.style.setProperty("margin","0"),d.style.setProperty("overflow","hidden"),a.appendChild(d),n.appendChild(a);let u=(s=d.contentWindow)==null?void 0:s.document;if(u){r.window.pbjs.renderAd(u,i.adId);let l="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",p=u.createElement("style");p.appendChild(u.createTextNode(l)),u.head.appendChild(p)}else r.logger.error("Prebid",`No access to iframe contentWindow for ad unit${i.adUnitCode}`)}else r.logger.error("Prebid",`Could not locate ad slot with id ${i.adUnitCode}`)});break}t()}catch(i){o(i)}}),Kr=(r,e)=>{let t=o=>!!o&&o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number";return r?e(t(r)?[r]:r).filter(K.isFixedSize):[]};var fe=S.responses.TCPurpose,Hr=r=>!!r.moliSlot.a9,fi=r=>!r.gdprApplies||r.vendor.consents[793]&&[fe.STORE_INFORMATION_ON_DEVICE,fe.SELECT_BASIC_ADS,fe.CREATE_PERSONALISED_ADS_PROFILE,fe.SELECT_PERSONALISED_ADS,fe.MEASURE_AD_PERFORMANCE,fe.APPLY_MARKET_RESEARCH,fe.DEVELOP_IMPROVE_PRODUCTS].every(e=>r.purpose.consents[e]),yi=(r,e)=>q("a9-init",t=>new Promise(o=>{t.window.apstag=t.window.apstag||{_Q:[],init:function(){t.window.apstag._Q.push(["i",arguments])},fetchBids:function(){t.window.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){t.window.apstag._Q.push(["di",arguments])},rpa:function(){t.window.apstag._Q.push(["ri",arguments])},upa:function(){t.window.apstag._Q.push(["ui",arguments])}},t.env!=="test"&&fi(t.tcData)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:r.scriptUrl?r.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(i=>t.logger.error("failed to load apstag.js",i)),o()})),bi=(r,e)=>N("a9-configure",(t,o)=>new Promise(i=>{t.window.apstag.init({pubID:r.pubID,adServer:"googletag",bidTimeout:r.timeout,gdpr:{cmpTimeout:r.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:[e.supplyChainStartNode,r.schainNode]}}),i()})),hi=r=>$t("a9-publisher-audiences",(e,t)=>new Promise(o=>{let i=r.publisherAudience;if(i&&i.enabled){let n={hashedRecords:[{type:"email",record:i.sha256Email}]};if(e.logger.debug("A9","Enable publisher audiences"),e.window.apstag.rpa(n),e.window.__tcfapi){let s=!0;e.window.__tcfapi("addEventListener",2,a=>{if(s){s=!1;return}a.eventStatus===S.status.EventStatus.USER_ACTION_COMPLETE&&(e.logger.debug("A9","Update publisher audience token"),e.window.apstag.upa(n))})}}o()})),Si=()=>_("a9-clear-targeting",G,(r,e)=>r.requestId===0?(r.logger.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(t=>{r.logger.debug("A9","clear a9 targetings"),e.forEach(({adSlot:o})=>{o.getTargetingKeys().filter(i=>i==="amznp"||i==="amznsz"||i==="amznbid").forEach(i=>o.clearTargeting(i))}),t()})),Yr=(r,e,t)=>{let o=ze(r),i=e?Nt(o,e):o;return W(i,t)},Ii=r=>Fe("a9-fetch-bids",(e,t)=>new Promise(o=>{var n;if(!fi(e.tcData)){e.logger.debug("A9","Skip any due to missing consent"),o();return}let i=t.filter(Hr).filter(s=>!e.auction.isSlotThrottled(s.moliSlot.domId)).filter(s=>{let a=s.moliSlot.a9.mediaType==="video",d=e.labelConfigService.filterSlot(s.moliSlot.a9),u=s.filterSupportedSizes(s.moliSlot.sizes).filter(K.isFixedSize).length>0;return d&&(a||u)}).map(({moliSlot:s,priceRule:a,filterSupportedSizes:d})=>{var u,l;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let p=r.supportedSizes?s.sizes.filter(m=>{var f;return(f=r.supportedSizes)==null?void 0:f.some(I=>$e(I,m))}):s.sizes,c=Yr(s.adUnitPath,(u=s.a9.slotNamePathDepth)!=null?u:r.slotNamePathDepth,e.adUnitPathVariables);return y({slotID:s.domId,slotName:c,sizes:d(p).filter(K.isFixedSize)},r.enableFloorPrices&&a?{floor:{value:Math.ceil((l=e.window.pbjs)!=null&&l.convertCurrency?e.window.pbjs.convertCurrency(a.floorprice,"EUR",r.floorPriceCurrency||"USD")*100:a.floorprice*100*1.19),currency:r.floorPriceCurrency||"USD"}}:{})}});e.logger.debug("A9",`Fetch '${i.length}' A9 slots: ${i.map(s=>`[slotID] ${s.slotID}`)}`),i.length===0?o():e.window.apstag.fetchBids(y({slots:i},((n=e.bucket)==null?void 0:n.timeout)&&{bidTimeout:e.bucket.timeout}),s=>{e.window.apstag.setDisplayBids(),o()})}));var vi=r=>_("passback-prepare-slots",G,(e,t)=>new Promise(o=>{t.filter(i=>i.moliSlot.passbackSupport).forEach(i=>{e.logger.debug("passback","add passback support for slot",i.moliSlot.domId),r.addAdSlot(i)}),o()}));var We=class{constructor(e,t){this.logger=e;this.window=t;this.isInitialized=!1;this.adSlots={};this.passbackKeyValue="passback";this.passbackOriginKeyValue="passbackOrigin";this.findAdSlot=e=>e.adUnitPath?this.adSlots[e.adUnitPath]:e.domId?this.adSlots[e.domId]:void 0}addAdSlot(e){this.isInitialized||(this.isInitialized=!0,this.initMessageListener()),this.adSlots[e.moliSlot.domId]=e,this.adSlots[e.moliSlot.adUnitPath]=e}initMessageListener(){this.logger.debug("Passback Service","Add message listener"),this.window.addEventListener("message",e=>{let t=this.parseMessageData(e.data);if(!t)return;this.logger.debug("Passback Service","Received passback message",t);let o=this.findAdSlot(t);o&&(this.logger.debug("Passback Service","Process passback for ad slot"),o.adSlot.setTargeting(this.passbackKeyValue,"true"),o.adSlot.setTargeting(this.passbackOriginKeyValue,t.passbackOrigin),this.window.googletag.pubads().refresh([o.adSlot]),delete this.adSlots[o.moliSlot.domId],delete this.adSlots[o.moliSlot.adUnitPath])})}parseMessageData(e){if(typeof e=="string")try{let t=JSON.parse(e);return t.type==="passback"&&t.passbackOrigin&&(t.domId||t.adUnitPath)?t:null}catch(t){return null}return null}};var Ai=(r,e)=>e?new Promise(t=>r.setTimeout(t,e)):Promise.resolve(),Pi=r=>Number(me(Z.debugDelay,r.localStorage))||void 0;var Ke=class{constructor(e,t){this.config=e;this.window=t;this.participationInfo=new Map;var o;(o=this.logger)==null||o.info(`Bidders disabling feature is ${e.enabled?"enabled":"disabled"}`)}isBidderDisabled(e,t){var o,i,n;return(n=(i=(o=this.participationInfo.get(e))==null?void 0:o.get(t))==null?void 0:i.disabled)!=null?n:!1}onAuctionEnd(e){var t,o;(t=e.bidderRequests)==null||t.forEach(i=>{var n;(n=i==null?void 0:i.bids)==null||n.forEach(s=>{var p,c,m;let a=s.bidder,d=s.adUnitCode;this.participationInfo.get(d)||this.participationInfo.set(d,new Map);let l=(p=this.participationInfo.get(d))==null?void 0:p.get(a);if(l){let f=l.bidRequestCount+1;(c=this.participationInfo.get(d))==null||c.set(a,w(y({},l),{bidRequestCount:f}))}else(m=this.participationInfo.get(d))==null||m.set(a,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),(o=e.bidsReceived)==null||o.forEach(i=>{var d,u,l;let n=i.bidderCode,s=i.adUnitCode,a=(d=this.participationInfo.get(s))==null?void 0:d.get(n);a?(u=this.participationInfo.get(s))==null||u.set(n,w(y({},a),{bidReceivedCount:a.bidReceivedCount+1})):(l=this.participationInfo.get(s))==null||l.set(n,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),this.deactivateBidderForTTL()}deactivateBidderForTTL(){this.participationInfo.forEach((e,t)=>{e.forEach((o,i)=>{this.shouldDisableBidder(o)&&(this.disableBidder(t,i),this.window.setTimeout(()=>{this.enableBidder(t,i)},this.config.reactivationPeriod))})})}shouldDisableBidder(e){return e.bidRequestCount>this.config.minBidRequests&&e.bidReceivedCount/e.bidRequestCount<this.config.minRate&&!e.disabled}disableBidder(e,t){var i,n;let o=(i=this.participationInfo.get(e))==null?void 0:i.get(t);o&&(o.disabled=!0,(n=this.logger)==null||n.info(`Bidder ${t} for position ${e} is now disabled.`))}enableBidder(e,t){var i,n;let o=(i=this.participationInfo.get(e))==null?void 0:i.get(t);o&&(o.disabled=!1,(n=this.logger)==null||n.info(`Bidder ${t} for position ${e} is now enabled.`))}};var He=class{constructor(e,t){this.config=e;this._window=t;this.slotsRequested=new Set}onSlotRequested(e){let t=e.slot.getSlotElementId();(!this.config.includedDomIds||this.config.includedDomIds.length===0||this.config.includedDomIds.includes(t))&&(this.slotsRequested.add(t),this._window.setTimeout(()=>{this.slotsRequested.delete(t)},this.config.throttle*1e3))}isThrottled(e){return this.slotsRequested.has(e)}};var Ci=(r,e)=>Math.max(r.wait-(e-r.ts),0);var Ri="h5v-fc",ve,xe,Ye=class{constructor(e,t,o,i){this.config=e;this._window=t;this.now=o;this.logger=i;this.frequencyCaps=new Map;At(this,ve,(e,t,o)=>{if(t.bidder===o.bidder&&t.domId===o.adUnitCode){let i=`${o.adUnitCode}:${o.bidder}`;this.logger.debug("fc",`adding ${i}`),this.frequencyCaps.set(i,{ts:e,wait:t.blockedForMs,bid:{bidder:o.bidder,adUnitCode:o.adUnitCode}}),this._window.setTimeout(()=>{this.logger.debug("fc",`removing ${i}`),this.frequencyCaps.delete(i)},t.blockedForMs)}});At(this,xe,()=>{if(this.config.persistent===!0){let e={caps:Array.from(this.frequencyCaps.values())};this._window.sessionStorage.setItem(Ri,JSON.stringify(e))}});if(this.bidWonConfigs=this.config.configs.filter(n=>{var s;return!n.events||((s=n.events)==null?void 0:s.includes("bidWon"))}),this.bidRequestedConfigs=this.config.configs.filter(n=>{var s;return(s=n.events)==null?void 0:s.includes("bidRequested")}),e.persistent===!0){let n=this._window.sessionStorage.getItem(Ri);if(n)try{JSON.parse(n).caps.forEach(a=>{let d=Ci(a,this.now());he(this,ve).call(this,a.ts,{bidder:a.bid.bidder,domId:a.bid.adUnitCode,blockedForMs:d},a.bid)})}catch(s){this.logger.error("fc","failed to parse fc state",s)}}}onAuctionEnd(e){this.bidRequestedConfigs.forEach(t=>{var o;(o=e.bidderRequests)==null||o.forEach(i=>{var n;(n=i==null?void 0:i.bids)==null||n.forEach(s=>{he(this,ve).call(this,this.now(),t,s)})})}),he(this,xe).call(this)}onBidWon(e){this.bidWonConfigs.forEach(t=>he(this,ve).call(this,this.now(),t,e)),he(this,xe).call(this)}isFrequencyCapped(e,t){return this.frequencyCaps.has(`${e}:${t}`)}};ve=new WeakMap,xe=new WeakMap;var Je=class{constructor(){this.lastBidCpms=new Map}groupReceivedBidsByAdUnitCode(e){return e.reduce((t,o)=>{let{adUnitCode:i,cpm:n}=o;return t[i]||(t[i]=[]),t[i].push(n),t},{})}onAuctionEnd(e){let t=this.groupReceivedBidsByAdUnitCode(e);this.lastBidCpms.forEach((o,i)=>{t[i]||this.lastBidCpms.delete(i)}),Object.entries(t).forEach(([o,i])=>{var s;let n=(s=this.getLastBidCpms(o))!=null?s:[];this.lastBidCpms.set(o,Array.from(new Set([...i,...n])))})}getLastBidCpms(e){var t;return(t=this.lastBidCpms.get(e))!=null?t:null}};var Ae=class{constructor(e,t,o={}){this.window=e;this.logger=t;this.config=o;var i,n,s,a,d,u,l,p;(i=o.biddersDisabling)!=null&&i.enabled&&(this.biddersDisabling=new Ke(o.biddersDisabling,this.window)),(n=o.adRequestThrottling)!=null&&n.enabled&&(this.adRequestThrottling=new He(o.adRequestThrottling,this.window)),(s=o.frequencyCap)!=null&&s.enabled&&(this.frequencyCapping=new Ye(o.frequencyCap,this.window,this.window.Date.now,this.logger)),(a=o.previousBidCpms)!=null&&a.enabled&&(this.previousBidCpms=new Je),this.window.pbjs=this.window.pbjs||{que:[]},this.window.googletag=this.window.googletag||{cmd:[]},((d=this.config.biddersDisabling)!=null&&d.enabled||(u=this.config.previousBidCpms)!=null&&u.enabled)&&this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("auctionEnd",c=>{var m,f,I,b;(m=this.config.biddersDisabling)!=null&&m.enabled&&((f=this.biddersDisabling)==null||f.onAuctionEnd(c)),(I=this.config.previousBidCpms)!=null&&I.enabled&&c.bidsReceived&&((b=this.previousBidCpms)==null||b.onAuctionEnd(c.bidsReceived))})}),(l=this.config.adRequestThrottling)!=null&&l.enabled&&this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotRequested",c=>{var m;(m=this.adRequestThrottling)==null||m.onSlotRequested(c)})}),(p=this.config.frequencyCap)!=null&&p.enabled&&this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("bidWon",c=>{var m;this.config.frequencyCap&&((m=this.frequencyCapping)==null||m.onBidWon(c))})})}isSlotThrottled(e){var t,o;return(o=(t=this.adRequestThrottling)==null?void 0:t.isThrottled(e))!=null?o:!1}isBidderFrequencyCappedOnSlot(e,t){var o,i;return(i=(o=this.frequencyCapping)==null?void 0:o.isFrequencyCapped(e,t))!=null?i:!1}getLastBidCpmsOfAdUnit(e){var t,o;return(o=(t=this.previousBidCpms)==null?void 0:t.getLastBidCpms(e))!=null?o:[]}};var Xe=class r{constructor(e,t,o){this.assetService=e;this.window=t;this.adPipelineConfig=o;this.requestAdsCalls=0;this.adPipeline=new Ie({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},oe(),this.window,new Ae(this.window,oe()));this.initialize=(e,t)=>{var p;let o=r.getEnvironment(t),i=e.adServer||"gam",n=i==="gam",s=((p=e.spa)==null?void 0:p.enabled)===!0;this.logger.setLogger(x(t,this.window)),this.logger.debug("AdService",`Initializing with environment ${o} and ad server ${i}`);let a=n?[Jt()]:[],d=n?[Zt()]:[];n&&s&&d.push(Xt(),Qt());let u=[];n&&u.push(ei(),ti(),vi(new We(this.logger,this.window)));let l=[];if(e.prebid&&o==="production"&&(a.push(di(this.assetService)),d.push(ui(e.prebid,e.schain)),s&&d.push(li(e.prebid)),u.push(pi(e.prebid)),l.push(ci(e.prebid,i))),e.a9&&o==="production"&&n&&(a.push(yi(e.a9,this.assetService)),d.push(bi(e.a9,e.schain)),d.push(hi(e.a9)),u.push(Si()),l.push(Ii(e.a9))),a.push(...t.adPipelineConfig.initSteps),d.push(...t.adPipelineConfig.configureSteps),u.push(...t.adPipelineConfig.prepareRequestAdsSteps),l.push(...t.adPipelineConfig.requestBidsSteps),o==="test"){let c=Pi(this.window);c&&d.push(()=>Ai(this.window,c))}return this.adPipeline=new Ie({init:a,configure:d,defineSlots:n?ii():gi(),prepareRequestAds:u,requestBids:l,requestAds:n?ri():mi()},this.logger,this.window,new Ae(this.window,this.logger,e.globalAuctionContext)),new Promise(c=>{qe(this.window,()=>{this.logger.debug("DOM","dom ready"),c(e)})})};this.requestAds=(e,t)=>_t(this,null,function*(){var n;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:o,refreshInfiniteSlots:i}=t;this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,o);try{let s=e.slots.map(a=>this.isManualSlot(a)?o.some(d=>d===a.domId)?a:null:this.isInfiniteSlot(a)?i.some(d=>d.artificialDomId===a.domId)?a:null:this.isBackfillSlot(a)?null:a).filter(V).filter(this.isSlotAvailable);if((n=e.buckets)!=null&&n.enabled){let a=Ct(this.window,t,e.labelSizeConfig,e.targeting),d=new Map;s.forEach(l=>{let p=this.getBucketName(l.behaviour.bucket,a),c=d.get(p);c?c.push(l):d.set(p,[l])});let u=yield Promise.all(Array.from(d.entries()).map(([l,p])=>(this.logger.debug("AdPipeline",`running bucket ${l}, slots:`,p),this.adPipeline.run(p,e,t,this.requestAdsCalls).then(()=>p))));return ce(u)}else return yield this.adPipeline.run(s,e,t,this.requestAdsCalls),s}catch(s){return this.logger.error("AdPipeline","slot filtering failed",s),Promise.reject(s)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.isManualSlot=e=>e.behaviour.loaded==="manual";this.isInfiniteSlot=e=>e.behaviour.loaded==="infinite";this.isBackfillSlot=e=>e.behaviour.loaded==="backfill";this.isSlotAvailable=e=>!!this.window.document.getElementById(e.domId)||e.position==="interstitial"||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor";this.getBucketName=(e,t)=>e?typeof e=="string"?e:e[t]||"default":"default";this.logger=new Ve(oe()),o&&(this.adPipeline=new Ie(o,this.logger,t,new Ae(t,this.logger)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,t,o,i){if(e.length===0)return Promise.resolve();let{loaded:n}=y({loaded:"manual"},i),s=t.slots.filter(a=>e.some(d=>d===a.domId)&&(a.behaviour.loaded===n||a.behaviour.loaded==="infinite")).filter(this.isSlotAvailable).map(a=>i!=null&&i.sizesOverride?w(y({},a),{sizes:i.sizesOverride}):a);if(e.length!==s.length){let a=s.filter(u=>e.every(l=>l!==u.domId)),d=e.filter(u=>s.every(l=>l.domId!==u));a.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",a),d.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",a)}return this.logger.debug("AdService","refresh ad slots",s),this.adPipeline.run(s,t,o,this.requestAdsCalls)}refreshBucket(e,t,o,i){var d;if(!((d=t.buckets)!=null&&d.enabled))return Promise.resolve();let n=Ct(this.window,o,t.labelSizeConfig,t.targeting),{loaded:s}=y({loaded:"manual"},i),a=t.slots.filter(this.isSlotAvailable).filter(u=>this.getBucketName(u.behaviour.bucket,n)===e&&(u.behaviour.loaded===s||u.behaviour.loaded==="infinite")).map(u=>i!=null&&i.sizesOverride?w(y({},u),{sizes:i.sizesOverride}):u);return a.length===0?(this.logger.warn("AdService","No slots found in bucket",e),Promise.resolve()):(this.logger.debug("AdService","refresh ad buckets",a,t.targeting),this.adPipeline.run(a,t,o,this.requestAdsCalls,e))}};var ke={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var Oe=(r,e,t,o=i=>!0)=>[{source:"queryParam",value:Se(r.location.search).get(e)},{source:"sessionStorage",value:me(t,r.sessionStorage)},{source:"localStorage",value:me(t,r.localStorage)}].map(({source:i,value:n})=>n&&o(n)?{source:i,value:n}:void 0).filter(V);var Jr=r=>!!["production","test"].find(t=>t===r),wi=r=>Oe(r,ke.moliEnv,Z.moliEnv,Jr)[0]||void 0,Mi=(r,e)=>Ee(Z.moliEnv,r,e);var De=(r,e,t)=>{switch(r){case"none":return!0;case"href":return t.href===e;case"path":try{let o=new URL(e);return t.pathname===o.pathname}catch(o){return!0}}},Ei=(r,e,t)=>{switch(r){case"none":return!0;case"href":return t.href!==e;case"path":try{let o=new URL(e);return t.pathname!==o.pathname}catch(o){return!0}}};var Ti=r=>{let e=Le(r),t=new Xe(e,r),o=r,i={state:"configurable",initialize:!1,runtimeConfig:ee(),modules:[]};function n(g,v){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.keyValues[g]=v;break}case"spa-finished":case"spa-requestAds":{i.nextRuntimeConfig.keyValues[g]=v;break}default:{x(i.runtimeConfig,r).error("MoliGlobal",`Setting key-value after configuration: ${g} : ${v}`);break}}}function s(g){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.labels.push(g);break}case"spa-requestAds":case"spa-finished":{i.nextRuntimeConfig.labels.push(g);break}default:{x(i.runtimeConfig,r).error("MoliGlobal",`Adding label after configure: ${g}`);break}}}function a(g){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.adUnitPathVariables=g;break}case"spa-requestAds":case"spa-finished":{i.nextRuntimeConfig.adUnitPathVariables=g;break}default:{x(i.runtimeConfig,r).error("MoliGlobal",`Setting unit path variables after configuration: ${g}`);break}}}function d(){let g=Me(r.location.hostname)||"unknown";switch(i.state){case"configurable":return w(y({},i.runtimeConfig.adUnitPathVariables),{domain:g,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let v=new ge(i.config.labelSizeConfig||[],[],r);return w(y({},I().adUnitPathVariables),{domain:i.config.domain||g,device:v.getDeviceLabel()})}}function u(g,v){let T=(v||{}).removeNetworkChildId||!1,O=W(g,d());return T?ze(O):O}function l(g){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.logger=g;break}default:{g.error("Setting a custom logger is not allowed after configuration");break}}}function p(g){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.hooks.beforeRequestAds.push(g);break}default:{x(i.runtimeConfig,r).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",i.config);break}}}function c(g){switch(i.state){case"configurable":case"configured":{i.runtimeConfig.hooks.afterRequestAds.push(g);break}default:{x(i.runtimeConfig,r).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",i.config);break}}}function m(){switch(i.state){case"configurable":return null;case"configured":return i.config;case"requestAds":return i.config;case"spa-requestAds":case"spa-finished":return i.config;case"finished":return i.config;case"error":return i.config}}function f(){return i.runtimeConfig}function I(){var g,v,R,T,O,k,P;return{keyValues:y(y({},(v=(g=i.config)==null?void 0:g.targeting)==null?void 0:v.keyValues),i.runtimeConfig.keyValues),labels:[...(O=(T=(R=i.config)==null?void 0:R.targeting)==null?void 0:T.labels)!=null?O:[],...i.runtimeConfig.labels],adUnitPathVariables:y(y({},(P=(k=i.config)==null?void 0:k.targeting)==null?void 0:P.adUnitPathVariables),i.runtimeConfig.adUnitPathVariables)}}function b(g){switch(i.state){case"configurable":case"configured":{i.modules.push(g);return}default:x(i.runtimeConfig,r).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function h(g){var v;switch(i.state){case"configurable":{let R=i.initialize,T=wi(r),O=i.modules;T&&(i.runtimeConfig.environment=T.value),(T==null?void 0:T.source)==="queryParam"&&Mi(T.value,r.sessionStorage);let k=x(i.runtimeConfig,r);return k.debug("MoliGlobal","configure modules",(v=g.modules)!=null?v:{}),O.forEach(P=>{var L;try{P.configure((L=g.modules)!=null?L:{}),k.debug("MoliGlobal",`configure ${P.moduleType} module ${P.name}`,P.config()),i.runtimeConfig.adPipelineConfig.initSteps.push(...P.initSteps()),i.runtimeConfig.adPipelineConfig.configureSteps.push(...P.configureSteps()),i.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...P.prepareRequestAdsSteps()),P.requestBidsSteps&&i.runtimeConfig.adPipelineConfig.requestBidsSteps.push(...P.requestBidsSteps()),P.prebidBidsBackHandler&&i.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.push(...P.prebidBidsBackHandler())}catch($){k.error("MoliGlobal",`failed to configure ${P.moduleType} module ${P.name}`,$)}}),i={state:"configured",config:g,runtimeConfig:i.runtimeConfig,modules:O},R||g.requestAds===!0?M():Promise.resolve(i)}case"configured":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",i.config),Promise.resolve(i);case"requestAds":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(i);case"finished":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(i);case"error":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",i.error),Promise.resolve(i)}return Promise.resolve(null)}function M(){var g;switch(i.state){case"configurable":return i.initialize=!0,Promise.resolve(i);case"configured":{ye(),be(i.config.domain);let{refreshInfiniteSlots:v}=i.runtimeConfig,R=i.config;v.length>0&&v.forEach(P=>{R=Ne(R,P.idOfConfiguredSlot,P.artificialDomId,x(i.runtimeConfig,r))});let T=x(i.runtimeConfig,r);i.runtimeConfig.hooks&&i.runtimeConfig.hooks.beforeRequestAds&&i.runtimeConfig.hooks.beforeRequestAds.forEach(P=>{try{P(R,i.runtimeConfig)}catch(L){T.error("MoliGlobal","beforeRequestAds hook failed",L)}});let O=i.runtimeConfig.hooks.afterRequestAds;if(((g=R.spa)==null?void 0:g.enabled)===!0){let P=i.runtimeConfig,L=t.initialize(R,P);return i={state:"spa-requestAds",config:R,initialized:L,modules:i.modules,href:r.location.href,runtimeConfig:Object.freeze(ee(i.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:ee(i.runtimeConfig)},L.then(()=>t.requestAds(R,P)).then(()=>{var A,de;let $=(de=(A=R.spa)==null?void 0:A.validateLocation)!=null?de:"href";if(i.state==="spa-requestAds"&&De($,i.href,r.location)){t.refreshAdSlots(i.runtimeConfig.refreshSlots,i.config,i.runtimeConfig),O.forEach(we=>we("spa-finished"));let te=w(y({},i),{state:"spa-finished",nextRuntimeConfig:ee(i.runtimeConfig),runtimeConfig:ee(i.runtimeConfig,{keepTargeting:!0})});return i=te,te}else return i.state==="spa-finished"||i.state==="spa-requestAds"?(x(i.runtimeConfig,r).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),i):Promise.reject(`reached invalid state [${i.state}]`)})}else return i={state:"requestAds",config:R,modules:i.modules,runtimeConfig:Object.freeze(i.runtimeConfig)},t.initialize(R,i.runtimeConfig).then(P=>t.requestAds(P,i.runtimeConfig)).then(()=>(i={state:"finished",config:R,runtimeConfig:i.runtimeConfig,modules:i.modules},O.forEach(P=>P("finished")),Promise.resolve(i))).catch(P=>(x(i.runtimeConfig,r).error("MoliGlobal",P),i={state:"error",config:R,runtimeConfig:i.runtimeConfig,error:P,modules:i.modules},O.forEach(L=>L("error")),Promise.resolve(i)))}case"spa-requestAds":case"spa-finished":{i.state==="spa-requestAds"&&x(i.runtimeConfig,r).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),ye(),be(i.config.domain);let{modules:v}=i,R=i.nextRuntimeConfig.hooks.afterRequestAds,T=i.nextRuntimeConfig.hooks.beforeRequestAds,O=i,{initialized:k,href:P,nextRuntimeConfig:L}=i;return i=w(y({},O),{state:"spa-requestAds",runtimeConfig:ee(i.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:ee(i.runtimeConfig)}),k.then($=>{var de,te;let A=(te=(de=$.spa)==null?void 0:de.validateLocation)!=null?te:"href";return Ei(A,P,r.location)?(T.forEach(we=>{try{we($,i.runtimeConfig)}catch(vt){x(i.runtimeConfig,r).error("MoliGlobal","beforeRequestAds hook failed",vt)}}),t.requestAds($,L).then(()=>$)):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${A} for validation.`)}).then($=>(t.refreshAdSlots(i.runtimeConfig.refreshSlots,$,i.runtimeConfig),i={state:"spa-finished",config:$,initialized:k,modules:v,href:r.location.href,runtimeConfig:i.runtimeConfig,nextRuntimeConfig:ee(i.runtimeConfig)},R.forEach(A=>A("spa-finished")),i))}case"requestAds":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return x(i.runtimeConfig,r).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",i.error),Promise.reject()}}function C(g,v){var T,O;let R=typeof g=="string"?[g]:g;switch(i.state){case"configurable":case"configured":return i.runtimeConfig.refreshSlots.push(...R),Promise.resolve("queued");case"spa-requestAds":return i.runtimeConfig.refreshSlots.push(...R),Promise.resolve("queued");case"spa-finished":let k=(O=(T=i.config.spa)==null?void 0:T.validateLocation)!=null?O:"href";return De(k,i.href,r.location)?t.refreshAdSlots(R,i.config,i.runtimeConfig,v).then(()=>"refreshed"):(i.nextRuntimeConfig.refreshSlots.push(...R),Promise.resolve("queued"));case"finished":case"requestAds":return t.refreshAdSlots(R,i.config,i.runtimeConfig,v).then(()=>"refreshed");default:return x(i.runtimeConfig,r).error("MoliGlobal",`refreshAdSlot is not allowed in state ${i.state}`,i.config),Promise.reject(`not allowed in state ${i.state}`)}}function D(g,v){var R,T;switch(i.state){case"configurable":case"configured":return i.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:v}),Promise.resolve("queued");case"spa-requestAds":return i.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:v}),Promise.resolve("queued");case"spa-finished":let O=(T=(R=i.config.spa)==null?void 0:R.validateLocation)!=null?T:"href";return De(O,i.href,r.location)?(i=w(y({},i),{config:Ne(i.config,v,g,x(i.runtimeConfig,r))}),t.refreshAdSlots([g],i.config,i.runtimeConfig).then(()=>"refreshed")):(i.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:v}),Promise.resolve("queued"));case"finished":case"requestAds":return i=w(y({},i),{config:Ne(i.config,v,g,x(i.runtimeConfig,r))}),t.refreshAdSlots([g],i.config,i.runtimeConfig).then(()=>"refreshed");default:return x(i.runtimeConfig,r).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${i.state}`,i.config),Promise.reject(`not allowed in state ${i.state}`)}}function F(g){var R,T,O;function v(k){let P=k.slots.filter(L=>L.behaviour.bucket===g);return P==null?void 0:P.map(L=>L.domId)}switch(i.state){case"configurable":{let k=(R=o.moli.getConfig())==null?void 0:R.slots.filter(L=>L.behaviour.bucket===g),P=k==null?void 0:k.map(L=>L.domId);return P!=null&&P.length?(i.runtimeConfig.refreshSlots.push(...P),Promise.resolve("queued")):Promise.reject("no configurable domIds for buckets")}case"configured":{let k=v(i.config);return i.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued")}case"spa-requestAds":{let k=v(i.config);return i.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued")}case"spa-finished":{let k=(O=(T=i.config.spa)==null?void 0:T.validateLocation)!=null?O:"href";if(De(k,i.href,r.location))return t.refreshBucket(g,i.config,i.runtimeConfig).then(()=>"refreshed");{let P=v(i.config);return i.runtimeConfig.refreshSlots.push(...P),Promise.resolve("queued")}}case"finished":case"requestAds":return t.refreshBucket(g,i.config,i.runtimeConfig).then(()=>"refreshed");default:return x(i.runtimeConfig,r).error("MoliGlobal",`refreshAdSlot is not allowed in state ${i.state}`,i.config),Promise.reject(`not allowed in state ${i.state}`)}}function X(){return i.state}function Q(){return i.modules}function ae(g){switch(i.state){case"configurable":{x(i.runtimeConfig,r).error("MoliGlobal","Cannot open console before configuration");break}default:e.loadScript({assetUrl:g!=null?g:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${Te.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(v=>console.error("failed to load moli debugger",v))}}function ye(){let g="ABtest",R=Se(r.location.search).get(g),T=R?Number(R):Math.floor(Math.random()*100)+1;n(g,T.toString())}function be(g){let v=g||Me(r.location.hostname);v&&s(v)}function H(){return e}function ee(g,v){var R,T,O,k,P,L,$;return{environment:(R=g==null?void 0:g.environment)!=null?R:"production",hooks:{beforeRequestAds:(T=g==null?void 0:g.hooks.beforeRequestAds)!=null?T:[],afterRequestAds:(O=g==null?void 0:g.hooks.afterRequestAds)!=null?O:[]},logger:(k=g==null?void 0:g.logger)!=null?k:void 0,adUnitPathVariables:(v==null?void 0:v.keepTargeting)===!0?(P=g==null?void 0:g.adUnitPathVariables)!=null?P:{}:{},labels:(v==null?void 0:v.keepTargeting)===!0?(L=g==null?void 0:g.labels)!=null?L:[]:[],keyValues:(v==null?void 0:v.keepTargeting)===!0?($=g==null?void 0:g.keyValues)!=null?$:{}:{},refreshSlots:[],refreshInfiniteSlots:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[],requestBidsSteps:[],prebidBidsBackHandler:[]}}}return{que:{push(g){g(o.moli)}},version:Te.version,setTargeting:n,addLabel:s,setLogger:l,setAdUnitPathVariables:a,resolveAdUnitPath:u,beforeRequestAds:p,afterRequestAds:c,getConfig:m,getRuntimeConfig:f,getPageTargeting:I,registerModule:b,configure:h,requestAds:M,refreshAdSlot:C,refreshBucket:F,refreshInfiniteAdSlot:D,getModuleMeta:Q,getState:X,openConsole:ae,getAssetLoaderService:H}};var xi=r=>{let e=r,t=e.moli?[...e.moli.que]:[],o=Ti(r);return e.moli=o,t.forEach(i=>i(o)),o};xi(window);var Xr=r=>r==="android"?"aaid":r==="ios"?"idfa":void 0,ki=(r,e,t,o,i,n,s,a)=>{let d=Xr(typeof i=="string"?i:i[0]),u=o.reduce((c,m)=>y(y({},c),m),{}),l=o.length?`&kv=${JSON.stringify(u)}`:"",p=a?`&gdpr_consent=${a}`:"";n(`https://api.theadex.com/collector/v1/ifa/c/${r}/t/${e}/request?&ifa=${t}&ifa_type=${d}${l}${p}`).catch(c=>s.error(c))};var Oi=(r,e,t)=>{let o=r[e.key],i=Rt(r,e.valueType,e.valueKey);if(!o||Array.isArray(o)||i===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(i)&&e.defaultValue===void 0){t.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,o,i);return}let n=Li(i,e,t);return{[e.attribute]:{[o]:n}}},Di=(r,e,t)=>{let o=Rt(r,e.adexValueType,e.key);if(o===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(o)&&e.defaultValue===void 0||Array.isArray(o))){t.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,o);return}let i=Li(o,e,t);return{[e.attribute]:i}},Bi=(r,e,t)=>{let o=Rt(r,"string",e.key);if(o===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof o=="number"){t.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,o);return}let i=Zr(o,e,t);return{[e.attribute]:i}},qi=r=>Object.fromEntries(r.sort().map(e=>[e,1])),Qr=r=>r.sort().join(","),Rt=(r,e,t)=>e==="number"?Number(r[t]):r[t],Li=(r,e,t)=>r!==void 0&&!Number.isNaN(r)?Array.isArray(r)?Qr(r):r:Ui(e,t),Zr=(r,e,t)=>r===void 0?Ui(e,t):Array.isArray(r)?qi(r):{[r]:1},Ui=(r,e)=>(e.warn("Adex DMP","using defaultValue",r.defaultValue,"as fallback for key",r.key),r.adexValueType==="list"?r.defaultValue?qi(r.defaultValue):void 0:r.defaultValue);var se=S.responses.TCPurpose,Qe=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[se.STORE_INFORMATION_ON_DEVICE,se.SELECT_BASIC_ADS,se.CREATE_PERSONALISED_ADS_PROFILE,se.SELECT_PERSONALISED_ADS,se.CREATE_PERSONALISED_CONTENT_PROFILE,se.SELECT_PERSONALISED_CONTENT,se.MEASURE_AD_PERFORMANCE,se.MEASURE_CONTENT_PERFORMANCE,se.APPLY_MARKET_RESEARCH,se.DEVELOP_IMPROVE_PRODUCTS].every(t=>e.purpose.consents[t]);this.getOrInitAdexQueue=e=>{let t=e;return t._adexc=t._adexc||[],t};this.getAdexKeyValues=(e,t)=>{var i;let o=y(y({},(i=e.config.targeting)==null?void 0:i.keyValues),e.runtimeConfig.keyValues);if(Object.keys(o).length>0)return t.mappingDefinitions.map(n=>{switch(n.adexValueType){case"map":return Oi(o,n,e.logger);case"list":return Bi(o,n,e.logger);default:return Di(o,n,e.logger)}}).filter(V)};this.configureAdexC=(e,t)=>{let o=this.getOrInitAdexQueue(e.window),i=this.getAdexKeyValues(e,t);i?o._adexc.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"ut","_kv",[i.reduce((n,s)=>y(y({},n),s),{}),t.spaMode?1:0]]):e.logger.warn("Adex DMP","targeting key/values are empty")}}config(){return this.adexConfig}configure(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}initSteps(){let e=this.adexConfig;return e?[q("DMP module setup",t=>this.track(t,e))]:[]}configureSteps(){let e=this.adexConfig;return e!=null&&e.spaMode?[N("DMP module setup",t=>(this.configureAdexC(t,e),Promise.resolve()))]:[]}track(e,t){var d,u;let{adexCustomerId:o,adexTagId:i,appConfig:n}=t;this.configureAdexC(e,t);let s=this.getAdexKeyValues(e,t),a=y(y({},(d=e.config.targeting)==null?void 0:d.keyValues),e.runtimeConfig.keyValues);if(this.hasRequiredConsent(e.tcData)&&!this.isLoaded&&Object.keys(a).length>0){this.isLoaded=!0;let l=V(n)&&V(a[n.advertiserIdKey])&&(a[n.clientTypeKey]==="android"||a[n.clientTypeKey]==="ios");if(n!=null&&n.advertiserIdKey&&l){let p=e.tcData.gdprApplies?e.tcData.tcString:void 0,c=a[n.advertiserIdKey];typeof c=="string"&&s&&ki(o,n.adexMobileTagId?n.adexMobileTagId:i,c,s,(u=a[n.clientTypeKey])!=null?u:"",e.window.fetch,e.logger,p)}else e.assetLoaderService.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${o}/${i}/s/adex.js`,loadMethod:1}).catch(p=>e.logger.error("failed to load adex",p))}return Promise.resolve()}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new Qe);var Pe=class Pe{constructor(e,t,o,i,n,s,a){this.userActivityService=e;this.refreshInterval=t;this.refreshIntervalOverrides=o;this.useIntersectionObserver=i;this.disableAdVisibilityChecks=n;this.window=s;this.logger=a;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId())};this.handleGoogletagAdVisibilityChanged=e=>{var i;let t=e.slot,o=this.visibilityRecordForGoogletagEvent(e);o&&((i=this.logger)==null||i.debug("AdVisibilityService",`Visibility of slot ${t.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(o,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,t)=>{var o,i,n;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(o=this.logger)==null||o.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}t>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(i=this.logger)==null||i.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var d;this.minimalAdVisibilityRatio=n?0:.5,this.visibilityRecords=new Map,i&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new IntersectionObserver(u=>this.handleObservedAdVisibilityChanged(u),{threshold:this.minimalAdVisibilityRatio})),i||this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged),this.userActivityService.addUserActivityChangedListener(u=>this.handleUserActivityChanged(u)),this.setUpdateTimer(!0),(d=this.logger)==null||d.debug("AdVisibilityService","initialized")}trackSlot(e,t){var n;let o=e.getSlotElementId(),i=this.window.document.getElementById(o);i&&((n=this.logger)==null||n.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(o)&&this.removeSlotTracking(e),this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:t}),this.intersectionObserver&&this.intersectionObserver.observe(i))}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),Pe.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var t;if(e.latestStartVisible){let o=this.window.performance.now(),i=Math.round(o-e.latestStartVisible);e.durationVisibleSum+=i,e.latestStartVisible=o,(t=this.logger)==null||t.debug("AdVisibilityService",`added ${i}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let t=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>t}).forEach(e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-Pe.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(t=>{var i;let o=this.visibilityRecordForEntry(t);o&&((i=this.logger)==null||i.debug("AdVisibilityService",`Visibility of slot ${o.slot.getSlotElementId()} changed. Visible area: ${t.intersectionRatio*100}%`),this.updateVisibilityRecord(o,t.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(t=>{t.latestStartVisible&&(t.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}};Pe.updateVisibilityInterval=1e3,Pe.consecutiveDurationToRefresh=1500;var Ze=Pe;var eo=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Ce=class Ce{constructor(e,t={level:"strict"},o){this.window=e;this.userActivityLevelControl=t;this.logger=o;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var i;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(i=this.logger)==null||i.debug("UserActivityService","initialized"),t.level){case"custom":this.userActivityDuration=t.userActivityDuration,this.userBecomingInactiveDuration=t.userBecomingInactiveDuration;break;default:let{userActivityDuration:n,userBecomingInactiveDuration:s}=eo.get(t.level);this.userActivityDuration=n,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Ce.observedEvents.forEach(t=>this.window.removeEventListener(t,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Ce.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Ce.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Ce.observedEvents=["mousemove","touchstart","scroll","keypress"];var et=Ce;var tt=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,t,o,i)=>{if(e.env==="test"){e.logger.info("AdReload","disabled in environment test");return}this.initialized||(e.logger.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(t,e.window,e.logger),this.setupSlotRenderListener(t,o,i,e.window,e.logger),this.initialized=!0)};this.setupAdVisibilityService=(e,t,o)=>{this.adVisibilityService=new Ze(new et(t,e.userActivityLevelControl,o),this.refreshIntervalMs,e.refreshIntervalMsOverrides||{},!1,!!e.disableAdVisibilityChecks,t,o)};this.setupSlotRenderListener=(e,t,o,i,n)=>i.googletag.pubads().addEventListener("slotRenderEnded",s=>{var D;let{slot:a,campaignId:d,advertiserId:u,yieldGroupIds:l,isEmpty:p}=s,c=a.getSlotElementId(),m=t.indexOf(c)>-1,f=!d||e.excludeOrderIds.indexOf(d)===-1,I=!!d&&e.includeOrderIds.indexOf(d)>-1,b=!!u&&e.includeAdvertiserIds.indexOf(u)>-1,h=!!l&&e.includeYieldGroupIds.some(F=>l.indexOf(F)>-1),M=!p&&m&&f&&(I||b||h);M||this.logTrackingDisallowedReason(c,{slotIsEmpty:p,slotIsMonitored:m,orderIdNotExcluded:f,orderIdIncluded:I,advertiserIdIncluded:b,yieldGroupIdIncluded:h},n,l,d,u);let C=!!((D=this.adVisibilityService)!=null&&D.isSlotTracked(c));M?this.adVisibilityService.trackSlot(a,o):C&&this.adVisibilityService.removeSlotTracking(a)});this.reloadAdSlot=(e,t)=>o=>{let i=o.getSlotElementId(),n=t.config.slots.find(s=>s.domId===i);if(n&&n.behaviour.loaded!=="infinite"){t.logger.debug("AdReload","fired slot reload",n.domId);let s=this.maybeOptimizeSlotForCls(e,n,o,t.logger,t.window);o.setTargeting(this.reloadKeyValue,"true"),t.window.moli.refreshAdSlot(i,y({loaded:n.behaviour.loaded},s&&{sizesOverride:s}))}};this.maybeOptimizeSlotForCls=(e,t,o,i,n)=>{let s=t.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let a=n.document.getElementById(s);if(a&&a.style){let d=a.scrollHeight;a.style.setProperty("height",`${d}px`);let u=t.sizes.filter(l=>l!=="fluid"&&l[1]<=d);return i.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${d}px`,"new sizes:",u),u.length<t.sizes.filter(l=>l!=="fluid").length&&n.googletag.destroySlots([o]),u}i.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return t.sizes};this.logTrackingDisallowedReason=(e,t,o,i,n,s)=>{let{slotIsEmpty:a,slotIsMonitored:d,orderIdNotExcluded:u,orderIdIncluded:l,advertiserIdIncluded:p,yieldGroupIdIncluded:c}=t;a&&o.debug("AdReload",e,"slot not tracked: reported empty"),d||o.debug("AdReload",e,"slot not tracked: excluded by DOM id"),u||o.debug("AdReload",e,"slot not tracked: excluded by order id",n),l||p||c||o.debug("AdReload",e,"slot not tracked: neither order id",n,"nor advertiser id",s,"nor yieldGroup id",i,"included")}}config(){return this.moduleConfig}isInitialized(){return this.initialized}configure(e){var t;(t=e==null?void 0:e.adReload)!=null&&t.enabled&&(this.moduleConfig=e.adReload)}initSteps(){return[]}configureSteps(){let e=this.moduleConfig;return e?[N(this.name,t=>{let o=t.config.slots.filter(n=>e.excludeAdSlotDomIds.indexOf(n.domId)===-1).map(n=>n.domId),i=this.reloadAdSlot(e,t);return t.logger.debug("AdReload","monitoring slots",o),this.initialize(t,e,o,i),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new tt);var it=class{constructor(){this.name="Blocklist URLs";this.description="Blocks ad requests entirely or adds key-values for blocklistd urls";this.moduleType="policy";this.blocklistConfig=null;this.isBlocklisted=(e,t,o)=>e.urls.some(({pattern:i,matchType:n})=>{switch(n){case"exact":return t===i;case"contains":return t.indexOf(i)>-1;case"regex":try{let s=RegExp(i).test(t);return s&&o.debug(this.name,`Url '${t}' matched pattern '${i}'`),s}catch(s){return o.error(this.name,`Invalid pattern ${i}`,s),!1}}});this.blocklistCache=null}config(){return this.blocklistConfig}configure(e){e!=null&&e.blocklist&&e.blocklist.enabled&&(this.blocklistConfig=e.blocklist)}initSteps(){return this.blocklistConfig?[q("blocklist-urls-init",t=>{var o;switch((o=this.blocklistConfig)==null?void 0:o.mode){case"key-value":let i=this.blocklistConfig.key,n=this.blocklistConfig.isBlocklistedValue||"true";return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{this.isBlocklisted(s,t.window.location.href,t.logger)&&t.window.googletag.pubads().setTargeting(i,n)});case"block":return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{if(t.logger.debug(this.name,"using blocklist",s),this.isBlocklisted(s,t.window.location.href,t.logger))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[]}getBlocklist(e,t,o){switch(e.provider){case"static":return()=>Promise.resolve(e.blocklist);case"dynamic":let i;return()=>(i||(i=this.loadConfigWithRetry(t,e.endpoint,3).catch(n=>(o.error(this.name,"Fetching blocklisted urls failed",n),{urls:[]}))),i)}}loadConfigWithRetry(e,t,o,i=null){return o<=0?Promise.reject(i):(this.blocklistCache||(this.blocklistCache=e.loadJson("blocklist-urls.json",t).catch(n=>new Promise(a=>setTimeout(a,100/o)).then(()=>this.loadConfigWithRetry(e,t,o-1,n)))),this.blocklistCache)}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new it);var rt=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(e,t)=>{t.forEach(o=>{"cssSelectors"in o.deleteMethod?o.deleteMethod.cssSelectors.forEach(i=>{let n=e.window.document.querySelectorAll(i);e.logger.debug("Cleanup Module",`Remove elements with selector ${i} from dom`,n),n.forEach(s=>{try{s.remove()}catch(a){e.logger.error("Cleanup Module",`Error removing element with selector ${i}`,a)}})}):o.deleteMethod.jsAsString.forEach(i=>{try{e.logger.debug("Cleanup Module",`Try to execute string as JS: '${i}'`),new Function(i)()}catch(n){e.logger.error("Cleanup Module",`Error executing JS string: '${i}'`,n)}})})};this.hasBidderWonLastAuction=(e,t)=>{var n;return((n=e.window.pbjs.getAllWinningBids().find(s=>s.adUnitCode===t.domId))==null?void 0:n.bidder)===t.bidder}}configure(e){e!=null&&e.cleanup&&e.cleanup.enabled&&(this.cleanupConfig=e.cleanup)}config(){return this.cleanupConfig}initSteps(){return[]}configureSteps(){let e=this.cleanupConfig;return e?[J("destroy-out-of-page-ad-format",t=>(t.runtimeConfig.environment==="test"||this.cleanUp(t,e.configs),Promise.resolve()))]:[]}prepareRequestAdsSteps(){let e=this.cleanupConfig;return e?[_("cleanup-before-ad-reload",je,(t,o)=>{if(t.runtimeConfig.environment==="test")return Promise.resolve();let i=e.configs.filter(n=>o.map(s=>s.moliSlot.domId).includes(n.domId)).filter(n=>this.hasBidderWonLastAuction(t,n));return this.cleanUp(t,i),Promise.resolve()})]:[]}};window.moli.registerModule(new rt);var ot=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}config(){return this.confiantConfig}configure(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}initSteps(){let e=this.confiantConfig;return e?[q("confiant-init",t=>this.loadConfiant(t,e))]:[]}loadConfiant(e,t){var o;return e.env==="test"||e.tcData.gdprApplies&&(!e.tcData.purpose.consents[1]||!(!((o=this.confiantConfig)!=null&&o.checkGVLID)||e.tcData.vendor.consents[this.gvlid]))||e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:t.assetUrl}).catch(i=>e.logger.error("failed to load confiant",i)),Promise.resolve()}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new ot);var to=(r,e)=>{var o;let t=(o=r.config.targeting)==null?void 0:o.keyValues[e];return t?`&device_id=${typeof t=="string"?t:t[0]}`:""},_i=(r,e,t,o,i)=>{let n=to(r,e.advertiserIdKey),s=r.tcData.gdprApplies?`gdpr=1&gdpr_consent=${r.tcData.tcString}`:"gdpr=0",a=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",d=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",u="",l=y(y({},e.additionalIdentifier),t);Object.entries(l).forEach(([f,I])=>{u+=`&${f}=${encodeURIComponent(I)}`});let p="",c=y(y({},e.customKeywords),o);Object.entries(c).forEach(([f,I])=>{p+=`&${f}=${encodeURIComponent(I)}`});let m=i.createElement("img");m.src=`https://aps.xplosion.de/data?sid=${e.sid}${n}&os=${e.os}&app_id=${e.appId}${d}${a}${u}${p}&${s}`,m.width=1,m.height=1,i.body.append(m)};var io=(r,e)=>{var o;if(e.os==="web")return;let t=(o=r.config.targeting)==null?void 0:o.keyValues[e.advertiserIdKey];if(t)return typeof t=="string"?t:t[0]},Vi=(r,e,t)=>{try{let i="moli_emetriq",n=r.getItem(i),s=n?Number.parseInt(n,10):0,a=e-864e5>s;return a&&(r.setItem(i,e.toString()),t.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),a}catch(o){return t.error("emetriq","could not access session storage",o),!1}},Ni=(r,e,t,o)=>{if(!e.login){o.warn("emetriq","login configuration missing!");return}let i=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);i.searchParams.append("guid",e.login.guid),r.tcData.gdprApplies?(i.searchParams.append("gdpr","1"),i.searchParams.append("gdpr_consent",r.tcData.tcString)):i.searchParams.append("gdpr","0");let n=io(r,e);if(n)switch(e.os){case"android":i.searchParams.append("adid",n);break;case"ios":i.searchParams.append("idfa",n);break}let s=t.createElement("img");s.src=i.href,s.width=1,s.height=1,t.body.append(s)};var nt=class r{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}config(){return this.emetriqConfig}configure(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}initSteps(){let e=this.emetriqConfig;return e?[q("load-emetriq",t=>{var i;let o=r.staticCustomParams(y(y({},(i=t.config.targeting)==null?void 0:i.keyValues),t.runtimeConfig.keyValues),e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||r.syncDelay(t,e.syncDelay).then(n=>{switch(e.os){case"web":this.loadEmetriqScript(t,e,n,o);break}}),Promise.resolve()})]:[]}configureSteps(){let e=this.emetriqConfig;return e?[J("track-emetriq",t=>{var i;let o=r.staticCustomParams(y(y({},(i=t.config.targeting)==null?void 0:i.keyValues),t.runtimeConfig.keyValues),e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||(e.login&&Vi(t.window.sessionStorage,Date.now(),t.logger)&&Ni(t,e,t.window.document,t.logger),r.syncDelay(t,e.syncDelay).then(n=>{switch(e.os){case"android":case"ios":_i(t,e,n,o,t.window.document);break}})),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}checkIfConsentIsMissing(e){return e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid]?(e.logger.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,t,o,i){let n=e.window;return n._enqAdpParam=y(y(y({},t._enqAdpParam),o),i),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${t._enqAdpParam.sid}/default.js`}).catch(s=>e.logger.error("failed to load emetriq",s))}static syncDelay(e,t){return t?typeof t=="number"?new Promise(o=>e.window.setTimeout(()=>o({}),t)):e.window.pbjs?new Promise(o=>{e.window.pbjs.que.push(()=>{let i=()=>{o(r.prebidIdentifiers(e)),e.window.pbjs.offEvent("auctionEnd",i)};e.window.pbjs.onEvent("auctionEnd",i)})}):(e.logger.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,t){let o={};return(t!=null?t:[]).forEach(({param:i,key:n})=>{let s=e[n];s&&(o[i]=typeof s=="string"?s:s.join(","))}),o}static prebidIdentifiers(e){let t={},o=e.window.pbjs.getUserIds();return o.amxId&&(t.id_amxid=o.amxId),o.idl_env&&(t.id_liveramp=o.idl_env),o.IDP&&(t.id_zeotap=o.IDP),o.pubcid&&(t.id_sharedid=o.pubcid),o.id5id&&(t.id_id5=o.id5id.uid),t}};window.moli.registerModule(new nt);var st=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}config(){return this.identityLinkConfig}configure(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}initSteps(){let e=this.identityLinkConfig;return e?[q(this.name,t=>(this.loadAts(t,e),Promise.resolve()))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}loadAts(e,t){if(e.env==="test"||e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid])return Promise.resolve();let o=e.window;return o.addEventListener("envelopeModuleReady",()=>{o.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:t.hashedEmailAddresses})}),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${t.launchPadId}/launchpad-liveramp.js`}).catch(i=>e.logger.error("failed to load emetriq",i))}};window.moli.registerModule(new st);var zi=r=>{let e=r.filter(o=>o.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:o=>{let i=o.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:i?e.find(s=>s.domId===i):e[0],configSlotDomId:i}}}};var at=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,t)=>{var u;if(this.initialized)return;this.initialized=!0,(u=e.logger)==null||u.debug(this.name,"initialize moli lazy load module");let o=t.slots,i=t.buckets,n=t.infiniteSlots,s=e.window;o.forEach(l=>{let p=new s.IntersectionObserver(c=>{var m;(m=e.logger)==null||m.debug(this.name,"lazy-load slots called with",c),c.forEach(f=>{var I;f.isIntersecting&&((I=e.logger)==null||I.debug(this.name,`Trigger ad slot with DOM ID ${f.target.id}`),s.moli.refreshAdSlot(f.target.id),p.unobserve(f.target))})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});this.observers.push(p),l.domIds.forEach(c=>{var f,I;let m=e.config.slots.find(b=>b.domId===c);if(!m)(f=e.logger)==null||f.warn(this.name,`Lazy-load non-existing slot with domID ${c}`);else if(m.behaviour.loaded!=="manual")(I=e.logger)==null||I.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${c}`);else if(m.behaviour.loaded==="manual"){let b=s.document.getElementById(c);b&&p.observe(b)}})}),i.forEach(l=>{var c,m,f,I;let p=new s.IntersectionObserver(b=>{b.forEach(h=>{var M,C,D;if(h.isIntersecting&&h.target.id===l.observedDomId)if(((M=e.config.slots.find(X=>X.domId===l.observedDomId))==null?void 0:M.behaviour.bucket)!==l.bucket)(C=e.logger)==null||C.warn(this.name,`${l.observedDomId} doesn't belong to ${l.bucket}`);else{let X=e.config.slots.filter(Q=>Q.behaviour.bucket===l.bucket).map(Q=>Q.domId);(D=e.logger)==null||D.debug(`Refresh ${l.bucket}`,`Trigger ad slots with DOM IDs [${X.join(", ")}]`),s.moli.refreshBucket(l.bucket),p.unobserve(h.target)}})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});if(this.observers.push(p),(c=e.config.buckets)!=null&&c.enabled||(m=e.logger)==null||m.warn(this.name,"GlobalBucket config isn't enabled"),!((f=e.config.buckets)!=null&&f.bucket&&e.config.buckets.bucket[l.bucket]))(I=e.logger)==null||I.error(this.name,`Lazy-load non-existing bucket with name ${l.bucket}`);else{let b=s.document.getElementById(l.observedDomId);b&&p.observe(b)}});let{configuredInfiniteSlots:a,findSlot:d}=zi(e.config.slots);(n||[]).forEach(l=>{var c;let p="data-h5-serial-number";if(a.length>0){let m=new s.IntersectionObserver(I=>{I.forEach(b=>{var h,M,C,D;if(b.isIntersecting){let{configuredInfiniteSlot:F,configSlotDomId:X}=d(b.target);if(F){let Q=(M=(h=b.target.attributes)==null?void 0:h.getNamedItem(p))==null?void 0:M.value,ae=`${F.domId}-${Q}`;b.target.setAttribute("id",ae),(C=e.logger)==null||C.debug(this.name,`Trigger ad slot with newly created DOM ID ${ae}`),s.moli.refreshInfiniteAdSlot(ae,F.domId),m.unobserve(b.target)}else(D=e.logger)==null||D.error(this.name,`No infinite-scrolling slot configured for ${X}`),m.unobserve(b.target)}})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});this.observers.push(m),s.document.querySelectorAll(l.selector).forEach((I,b)=>{I.setAttribute(p,`${b+1}`),I&&m.observe(I)})}else(c=e.logger)==null||c.warn(this.name,"No infinite-scrolling slots configured!")})}}config(){return this.lazyloadConfig}configure(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}initSteps(){return[]}configureSteps(){let e=this.lazyloadConfig;return e?[J("lazy-module-configuration",t=>(this.initialized=!1,this.observers.forEach(o=>o.disconnect()),this.observers.length=0,this.registerIntersectionObservers(t,e),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new at);function wt(r){return toString.call(r)==="[object Object]"}function dt(r,...e){if(!e.length)return r;let t=e.shift();if(wt(r)&&wt(t))for(let o in t)wt(t[o])?(r[o]||Object.assign(r,{[o]:{}}),dt(r[o],t[o])):Array.isArray(t[o])?r[o]?Array.isArray(r[o])&&(r[o]=r[o].concat(t[o])):Object.assign(r,{[o]:t[o]}):Object.assign(r,{[o]:t[o]});return dt(r,...e)}var lt=class r{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}config(){return this.moduleConfig}configure(e){var t;if((t=e==null?void 0:e.prebidFirstPartyData)!=null&&t.enabled){let o=e.prebidFirstPartyData;this._configureSteps=[N("prebid-fpd-module-configure",i=>r.setPrebidFpdConfig(i,o,i.logger))]}}initSteps(){return[]}configureSteps(){return this._configureSteps}prepareRequestAdsSteps(){return[]}static setPrebidFpdConfig(e,t,o){var i;if(e.config.prebid){let n=((i=e.config.targeting)==null?void 0:i.keyValues)||{},s=t.gptTargetingMappings;e.window.pbjs.que.push(()=>{var u,l,p,c,m,f,I,b;let a=e.window.pbjs.readConfig().ortb2||{},d=dt({},t.staticPrebidFirstPartyData,a);if(s){let h=y({cat:[],sectioncat:[],pagecat:[]},d.site);if(s.cat){let M=r.extractKeyValueArray(s.cat,n);(u=h.cat)==null||u.push(...M),(l=h.pagecat)==null||l.push(...M),(p=h.sectioncat)==null||p.push(...M)}if(s.sectionCat&&(h.sectioncat=r.extractKeyValueArray(s.sectionCat,n)),s.pageCat&&(h.pagecat=r.extractKeyValueArray(s.pageCat,n)),h.cat&&(h.cat=h.cat.filter(j)),h.sectioncat&&(h.sectioncat=h.sectioncat.filter(j)),h.pagecat&&(h.pagecat=h.pagecat.filter(j)),!t.iabDataProviderName&&(s.iabV2||s.iabV3)&&o.error("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Data Segments will not be set."),h.content=w(y({},h.content),{data:(f=(m=(c=h.content)==null?void 0:c.data)==null?void 0:m.filter(M=>M.name!==t.iabDataProviderName))!=null?f:[]}),s.iabV2&&t.iabDataProviderName){let M=r.extractKeyValueArray(s.iabV2,n),C={name:t.iabDataProviderName,ext:{segtax:6},segment:M.map(D=>({id:D})).filter(j)};(I=h.content.data)==null||I.push(C)}if(s.iabV3&&t.iabDataProviderName){let M=r.extractKeyValueArray(s.iabV3,n),C={name:t.iabDataProviderName,ext:{segtax:7},segment:M.map(D=>({id:D})).filter(j)};(b=h.content.data)==null||b.push(C)}d.site=h}e.window.pbjs.setConfig({ortb2:d})})}return Promise.resolve()}static extractKeyValueArray(e,t){let o=t[e];return o?typeof o=="string"?[o]:o:[]}};window.moli.registerModule(new lt);var ut=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}config(){return this.pubstackConfig}configure(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}initSteps(){let e=this.pubstackConfig;return e?[q("pubstack-init",t=>(t.env==="test"||t.assetLoaderService.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(o=>t.logger.error("failed to load pubstack",o)),Promise.resolve()))]:[]}configureSteps(){return this.pubstackConfig?[N("pubstack-configure",t=>{if(t.env==="test")return Promise.resolve();let o=["0","1","2","3"],i=t.window.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return i&&i.content&&o.includes(i.content)&&t.window.googletag.pubads().setTargeting("pbstck_ab_test",i.content),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new ut);var Fi="footer-ad-close-button",ro="[data-ref=h5-footer-ad-container]",oo=`[data-ref=${Fi}]`,pt={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},ji=(r,e,t,o)=>i=>{let n=i.slot,s=r.document.body.querySelector(ro),a=r.document.getElementById(e),d=()=>{var l;n.getSlotElementId()===e&&s&&((l=r.googletag)==null||l.destroySlots([n]),s.remove())};if(!s||!a||n.getSlotElementId()!==e||i.isEmpty||i.advertiserId&&t.includes(i.advertiserId)||r.matchMedia("(max-width: 767px)").matches){o.debug("[footer-ad]","remove footer ad container");return}if(r.document.body.querySelector(oo))return;let u=document.createElement("button");u.classList.add(pt.footerAdClose),u.setAttribute("aria-label","Anzeige entfernen"),u.setAttribute("data-ref",Fi),a.classList.add(pt.adSlot),Array.isArray(i.size)&&i.size[1]>200&&r.matchMedia("(max-height: 800px)").matches&&a.classList.add(pt.isShiftedBottom),s.classList.add(pt.container),s.style.setProperty("display","block"),s.appendChild(u),u.addEventListener("click",()=>d())},$i=(r,e,t,o,i)=>{e==="production"?r.googletag.pubads().addEventListener("slotRenderEnded",ji(r,o,i,t)):ji(r,o,i,t)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>o}})};var Gi="[data-ref=sticky-ad]",Wi="[data-ref=sticky-ad-close]",Ji="h5-sticky-ad--visible",Mt=r=>{r.style.setProperty("display","none"),r.classList.remove(Ji)},Ki=r=>{r.style.setProperty("display","block"),r.classList.add(Ji)},Hi=(r,e,t,o)=>new Promise(i=>{let n=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(r&&Mt(r),i("empty")):s.advertiserId&&t.includes(s.advertiserId)?i("disallowed"):i("standard"),o.googletag.pubads().removeEventListener("slotRenderEnded",n))};o.googletag.pubads().addEventListener("slotRenderEnded",n)}),Yi=(r,e)=>new Promise(t=>{let o=i=>{i.slot.getSlotElementId()===r&&(t(),e.googletag.pubads().removeEventListener("slotOnload",o))};e.googletag.pubads().addEventListener("slotOnload",o)}),Xi=(r,e,t,o,i,n)=>{let s=r.document.querySelector(Gi),a=r.document.querySelector(Wi);if(s&&a){if(t.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),n||Ki(s),a.addEventListener("click",()=>{Mt(s);let d=r.googletag.pubads().getSlots().find(u=>u.getSlotElementId()===o);d&&r.googletag.destroySlots([d])},{once:!0,passive:!0}),e==="production"){let d=([u])=>(t.debug("mobile-sticky-ad",`result ${u}`),u==="disallowed"?(t.debug("mobile-sticky-ad","hide mobile sticky container"),s&&Mt(s),Promise.resolve()):u==="standard"?(n&&Ki(s),Promise.all([Hi(s,o,i,r),Yi(o,r)]).then(d)):Promise.resolve());Promise.all([Hi(s,o,i,r),Yi(o,r)]).then(d)}}else t.warn("[mobile-sticky]",`Could not find adSticky container ${Gi} or closeButton ${Wi}`,s,a)};var ct=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){var t;(t=e==null?void 0:e.stickyFooterAd)!=null&&t.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[_(this.name,G,(t,o)=>{var i;return e.mobileStickyDomId&&o.some(n=>{var s;return n.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&Xi(t.window,t.env,t.logger,e.mobileStickyDomId,e.disallowedAdvertiserIds,(i=e.initiallyHidden)!=null?i:!1),e.desktopFloorAdDomId&&o.some(n=>n.moliSlot.domId===e.desktopFloorAdDomId)&&$i(t.window,t.env,t.logger,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new ct);var Et="[data-ref=h5v-sticky-ad]",Tt="[data-ref=h5v-sticky-ad-close]",Qi=".h5v-closeButtonContent",ir="h5v-footerAd--hidden",Zi=(r,e,t)=>new Promise(o=>{let i=n=>{n.slot.getSlotElementId()===r&&(n.isEmpty?o("empty"):n.advertiserId&&e.includes(n.advertiserId)?o("disallowed"):o("standard"),t.googletag.pubads().removeEventListener("slotRenderEnded",i))};t.googletag.pubads().addEventListener("slotRenderEnded",i)}),er=(r,e)=>new Promise(t=>{let o=i=>{i.slot.getSlotElementId()===r&&(t(),e.googletag.pubads().removeEventListener("slotOnload",o))};e.googletag.pubads().addEventListener("slotOnload",o)}),tr=r=>{r.classList.add(ir)},no=r=>{r.classList.remove(ir)},rr=(r,e,t,o,i,n)=>{let s="sticky-ad",a=r.document.querySelector(Et),d=r.document.querySelector(Tt),u=r.document.querySelector(Qi);if(a&&d){if(t.debug(s,"Running initAdSticky with defined sticky container and close button"),!u){if(n)d.textContent=n;else if(!d.querySelector("svg")){let p=r.document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("width","24"),p.setAttribute("height","24");let c=r.document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add(Qi),c.setAttribute("d","M7 10l5 5 5-5z"),p.appendChild(c),d.appendChild(p)}}d.addEventListener("click",()=>{a.addEventListener("transitionend",function(){var c;a.remove();let p=(c=r.googletag)==null?void 0:c.pubads().getSlots().find(m=>m.getSlotElementId()===o);p&&r.googletag.destroySlots([p])},{once:!0}),tr(a)});let l=p=>{if(t.debug(s,`result ${p}`),p==="disallowed"||p==="empty")return t.debug(s,"stickyFooter container"),tr(a),Promise.resolve();if(p==="standard"){no(a);let c=er(o,r);return Zi(o,i,r).then(m=>m==="empty"||m==="disallowed"?Promise.resolve(m):c.then(()=>m)).then(l)}return Promise.resolve()};if(e==="production")if(o){let p=er(o,r);Zi(o,i,r).then(c=>c==="empty"||c==="disallowed"?Promise.resolve(c):p.then(()=>c)).then(l)}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${Et} or closeButton ${Tt}`,a,d);else l("standard")}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${Et} or closeButton ${Tt}`,a,d)};var gt=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[_(this.name,G,(t,o)=>{let i=o.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.desktop),n=o.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.mobile),s=n||i;return n&&i&&t.logger.warn(this.name,"mobile and desktop sticky footer are called!"),s&&rr(t.window,t.env,t.logger,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new gt);var or=(r,e,t,o,i,n)=>s=>{s.forEach(a=>{e&&a.target===e?t.then(d=>{a.isIntersecting||!a.isIntersecting&&a.boundingClientRect.y<0||d==="empty"||d==="disallowed"?r.classList.add(n):a.boundingClientRect.y>=0&&d==="standard"&&r.classList.remove(n)}):a.target===o&&i&&(a.isIntersecting?r.classList.remove(i):r.classList.add(i))})};var nr=(r,e,t,o)=>new Promise(i=>{if(r.env==="test"){i("standard");return}let n=s=>{s.slot.getSlotElementId()===e.domId&&(s.advertiserId&&t.includes(s.advertiserId)?i("disallowed"):s.isEmpty?i("empty"):o>0?r.window.setTimeout(()=>i("standard"),o):i("standard"),r.window.googletag.pubads().removeEventListener("slotRenderEnded",n))};r.window.googletag.pubads().addEventListener("slotRenderEnded",n)});var mt=class{constructor(){this.name="sticky-header-ads";this.description="sticky header ad creatives";this.moduleType="creatives";this.containerSelector='[data-ref="header-ad"]';this.buttonSelector='[data-ref="header-ad-close-button"]';this.navbarHiddenClassName="h5v-header-ad--navbarHidden";this.observer=null;this.stickyHeaderAdConfig=null}configure(e){var t;(t=e==null?void 0:e.stickyHeaderAd)!=null&&t.enabled&&(this.stickyHeaderAdConfig=e.stickyHeaderAd)}config(){return this.stickyHeaderAdConfig}initSteps(){return[]}configureSteps(){return this.stickyHeaderAdConfig?[J("sticky-header-ads:cleanup",()=>(this.observer&&(this.observer.disconnect(),this.observer=null),Promise.resolve()))]:[]}prepareRequestAdsSteps(){let e=this.stickyHeaderAdConfig;return e?[_(this.name,G,(t,o)=>{var d,u,l;if(this.observer)return Promise.resolve();let i=o.find(p=>p.moliSlot.domId===e.headerAdDomId);if(!i)return Promise.resolve();let n=t.window.document.querySelector(this.containerSelector);if(!n)return t.logger.warn(this.name,`Could not find sticky header container with selector '${this.containerSelector}'`),Promise.resolve();let s=(d=e.minVisibleDurationMs)!=null?d:0;if(e.fadeOutTrigger!==!1){let p=(u=e.fadeOutTrigger.options)!=null?u:{rootMargin:"0px"},c=t.window.document.querySelectorAll(e.fadeOutTrigger.selector),m=c.length>0?c.item(0):null,f=e.navbarConfig,I=(l=f==null?void 0:f.navbarHiddenClassName)!=null?l:this.navbarHiddenClassName,b=f?t.window.document.querySelector(f.selector):null;if(m){let h=nr(t,i.moliSlot,e.disallowedAdvertiserIds,s);this.observer=new IntersectionObserver(or(n,m,h,b,I,e.fadeOutClassName),p),this.observer.observe(m),b&&this.observer.observe(b)}else t.logger.error(this.name,`No DOM element found for selector ${e.fadeOutTrigger.selector}. Sticky header may never fade out`)}let a=t.window.document.querySelector(this.buttonSelector);return a&&a.addEventListener("click",()=>{n.classList.add(e.fadeOutClassName),this.observer&&this.observer.disconnect(),t.env==="production"&&t.window.googletag.destroySlots([i.adSlot]),e.destroySlot&&n&&n.remove()}),Promise.resolve()})]:[]}};window.moli.registerModule(new mt);var so=(r,e)=>{let t=Object.keys(r);return ce(t.map(o=>y({adSlotId:o},r[o])).filter(o=>e.indexOf(o.adSlotId)>-1).filter(o=>V(o.bids)).map(o=>o.bids.sort((i,n)=>n.cpm-i.cpm).slice(0,1)))},ft=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.bidsBackHandler=[];this.getConfigEffect=(e,t,o,i)=>{let n=t[e.skinAdSlotDomId],s=p=>{let c=e.formatFilter.some(m=>{switch(m.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return p.bidder===ue.AppNexusAst||p.bidder===ue.AppNexus;case"improvedigital":return p.bidder===ue.ImproveDigital;case"gumgum":return p.bidder===ue.GumGum&&(m.auid===void 0||typeof p.ad!="string"&&p.ad.auid===m.auid);case"dspx":return p.bidder===ue.DSPX;case"visx":return p.bidder===ue.Visx;case"yieldlab":return p.bidder===ue.Yieldlab;default:return!1}});return p.cpm>0&&c},a=so(t,e.blockedAdSlotDomIds),d=a.reduce((p,c)=>p+c.cpm,0),u=n?n.bids.filter(s).sort((p,c)=>c.cpm-p.cpm):[],l=u.length>0?u[0].cpm>d?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return i.debug(this.name,"nonSkinBids",a),i.debug(this.name,"skinBids",u),o&&l==="BlockSkinSlot"&&(o({skin:u[0].cpm,combinedNonSkinSlots:d},e,u[0]),i.debug(this.name,"trackSkinCpmLow",a)),e.enableCpmComparison?l:u.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,t,o)=>e.configs.map(i=>({skinConfig:i,configEffect:this.getConfigEffect(i,t,e.trackSkinCpmLow,o)})).find(({configEffect:i})=>i!=="NoBlocking");this.destroyAdSlot=(e,t)=>o=>{let i=e.map(n=>n.adSlot).filter(n=>n.getSlotElementId()===o);t.googletag.destroySlots(i)};this.runSkinConfigs=e=>(t,o,i)=>{var a,d,u;let n=null,s=this.selectConfig(e,o,t.logger);if(s){let{skinConfig:l,configEffect:p}=s;if(p==="BlockOtherSlots"){t.logger.debug("SkinModule","Skin configuration applied",l),l.blockedAdSlotDomIds.forEach(this.destroyAdSlot(i,t.window)),l.hideBlockedSlots&&l.blockedAdSlotDomIds.forEach(this.hideAdSlot(t.window,t.logger)),l.hideSkinAdSlot&&this.hideAdSlot(t.window,t.logger)(l.skinAdSlotDomId),l.hideBlockedSlotsSelector&&t.window.document.querySelectorAll(l.hideBlockedSlotsSelector).forEach(f=>{t.logger.debug("SkinModule",`Set display:none for container with selector ${l.hideBlockedSlotsSelector}`),f.style.setProperty("display","none")});let c=(a=o[l.skinAdSlotDomId])==null?void 0:a.bids.sort((f,I)=>I.cpm-f.cpm)[0],m=f=>t.window.googletag.pubads().getSlots().find(b=>b.getSlotElementId()===f);if((d=l.adReload)!=null&&d.intervalMs&&(c!=null&&c.bidder)&&l.adReload.allowed.includes(c.bidder)){let f=i.filter(b=>b.moliSlot.domId===l.skinAdSlotDomId||l.blockedAdSlotDomIds.includes(b.moliSlot.domId)).map(b=>b.moliSlot.behaviour.loaded);f.every(b=>b===f[0])&&f[0]!=="infinite"?(n&&clearTimeout(n),n=t.window.setTimeout(()=>{var b;t.window.moli.refreshAdSlot([...l.blockedAdSlotDomIds,l.skinAdSlotDomId],{loaded:f[0]}),(b=m(l.skinAdSlotDomId))==null||b.setTargeting("native-ad-reload","true"),t.logger.info("SkinModule","Ad reload for skin and blocked slots triggered",l.skinAdSlotDomId,l.blockedAdSlotDomIds)},(u=l.adReload)==null?void 0:u.intervalMs)):t.logger.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",f)}}else l.enableCpmComparison&&(t.logger.debug("SkinModule","Skin configuration ignored because cpm was low",l),this.destroyAdSlot(i,t.window)(l.skinAdSlotDomId))}else e.configs.filter(l=>l.destroySkinSlot).map(l=>l.skinAdSlotDomId).filter(j).forEach(this.destroyAdSlot(i,t.window))};this.hideAdSlot=(e,t)=>o=>{let i=e.document.getElementById(o);try{i&&(t.debug("SkinModule",`Set display:none for ${o}`),i.style.setProperty("display","none"))}catch(n){t.error("SkinModule",`Couldn't set the the wallpaper div ${o} to display:none;`,n)}}}config(){return this.skinModuleConfig}configure(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin,this.bidsBackHandler.push(this.runSkinConfigs(e.skin)))}initSteps(){return[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}prebidBidsBackHandler(){return this.bidsBackHandler}};window.moli.registerModule(new ft);var yt=class{constructor(){this.name="utiq";this.description="user module";this.moduleType="identity";this.requiredPurposeIds=[S.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,S.responses.TCPurpose.SELECT_BASIC_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_ADS,S.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,S.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,S.responses.TCPurpose.MEASURE_AD_PERFORMANCE,S.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,S.responses.TCPurpose.APPLY_MARKET_RESEARCH,S.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS,S.responses.TCPurpose.USE_LIMITED_DATA_TO_SElECT_CONTENT];this.utiqConfig=null}config(){return this.utiqConfig}configure(e){e!=null&&e.utiq&&e.utiq.enabled&&(this.utiqConfig=e.utiq)}initSteps(){let e=this.utiqConfig;return e!=null&&e.enabled?[q(this.name,t=>this.loadUtiq(e,t))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}loadUtiq(e,t){if(t.env==="test")return Promise.resolve();let o=t.window;return o.Utiq=o.Utiq?w(y({},o.Utiq),{config:y(y({},o.Utiq.config),e.options)}):{config:e.options},t.tcData.gdprApplies&&this.requiredPurposeIds.some(i=>t.tcData.gdprApplies&&!t.tcData.purpose.consents[i])?Promise.resolve():t.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:e.assetUrl}).catch(i=>t.logger.error("failed to load utiq",i))}};window.moli.registerModule(new yt);var sr=r=>{var e;return r?((e=r.dynamicFloorPrices)==null?void 0:e.strategy)!==void 0:!1};var ao=r=>{if(r.length===0)return null;{let e=Math.max(...r);return Math.round(e*100)}},lo=r=>{if(r.length===0)return null;{let e=Math.min(...r);return Math.round(e*100)}},uo=r=>{if(!r||r.length===0)return null;if(r.length===1)return Math.round(r[0]*100);{let e=r.sort()[r.length-2];return Math.round(e*100)}},po=(r,e)=>{switch(r){case"max":return ao(e);case"min":return lo(e);case"second-highest":return uo(e);default:return null}},bt=r=>Math.floor(r),co=r=>{let e=bt(r.priceInCents),t=bt(r.roundingStepsInCents),o=r.maxPriceRuleInCents!==void 0?bt(r.maxPriceRuleInCents):void 0,i=r.minPriceRuleInCents!==void 0?bt(r.minPriceRuleInCents):void 0,n=Math.floor(e/t)*t;return o!==void 0&&n>o?o:i!==void 0&&n<i?i:n},ar=({strategy:r,previousCpms:e,standardRule:t,roundingStepsInCents:o=5,maxPriceRuleInCents:i=500,minPriceRuleInCents:n=5})=>{let s=Array.isArray(e)?e==null?void 0:e.filter(u=>u>0&&!isNaN(u)):[];if(!s||s.length===0||!r)return t;let a=po(r,s);if(a===null)return t;let d=co({priceInCents:a,roundingStepsInCents:o,maxPriceRuleInCents:i,minPriceRuleInCents:n});return w(y({},t),{floorprice:d/100,priceRuleId:d})};var ht=class{constructor(e){this.yieldConfig=e;this.emptyAdUnitPriceRulesResponse={rules:{},browser:"None"};this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);this.isEnabled=!1;this.device="mobile";this.adUnitPathVariables={}}init(e,t,o,i,n){switch(this.device=e,this.adUnitPathVariables=t,this.yieldConfig.provider){case"none":n.warn("YieldOptimizationService","Yield optimization is disabled!"),this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);break;case"static":n.warn("YieldOptimizationService","Yield optimization is static!"),this.isEnabled=!0,this.adUnitPricingRuleResponse=Promise.resolve({rules:this.yieldConfig.config.rules,browser:"None"});break;case"dynamic":this.isEnabled=!0;let s=this.yieldConfig.excludedAdUnitPaths,d=o.filter(u=>s.indexOf(u)<0).map(u=>W(u,this.adUnitPathVariables));this.adUnitPricingRuleResponse=this.loadConfigWithRetry(this.yieldConfig.configEndpoint,3,d,i).then(u=>(n.info("YieldOptimizationService",`loaded pricing rules for device ${this.device}`,u),u)).catch(u=>(n.error("YieldOptimizationService","failed to initialize service",u),this.emptyAdUnitPriceRulesResponse));break;default:this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.reject("Unknown config provider")}return Promise.resolve()}getPriceRule(e){return this.adUnitPricingRuleResponse.then(t=>t.rules[W(e,this.adUnitPathVariables)])}getBrowser(){return this.adUnitPricingRuleResponse.then(e=>e.browser||"None")}setTargeting(e,t,o,i,n){let s=W(e.getAdUnitPath(),this.adUnitPathVariables);return this.adUnitPricingRuleResponse.then(a=>{let d=a.rules[s];if(t==="gam")if(d)if(e.setTargeting("upr_model",d.model||"static"),d.main){e.setTargeting("upr_main","true");let u=n==null?void 0:n.getLastBidCpmsOfAdUnit(e.getSlotElementId());if(u&&(u==null?void 0:u.length)>0&&sr(i)&&i.dynamicFloorPrices){let{strategy:l,roundingStepsInCents:p,maxPriceRuleInCents:c,minPriceRuleInCents:m}=i.dynamicFloorPrices,f=ar({strategy:l,previousCpms:u,standardRule:d,roundingStepsInCents:p,maxPriceRuleInCents:c,minPriceRuleInCents:m});return o.debug("YieldOptimizationService",`set dynamic price rule id ${f.priceRuleId} for ${s} based on previous bid cpms on same position. Stategy is '${l}'. Main traffic share ${d.main}. Cpm is ${f.floorprice}.`),e.setTargeting("upr_id",f.priceRuleId.toFixed(0)),f}else e.setTargeting("upr_id",d.priceRuleId.toFixed(0))}else o.debug("YieldOptimizationService",`set price rule id ${d.priceRuleId} for ${s}. Main traffic share ${d.main}. cpm is ${d.floorprice}`),e.setTargeting("upr_id",d.priceRuleId.toFixed(0));else this.isEnabled&&o.warn("YieldOptimizationService",`No price rule found for ${s}`);return d})}loadConfigWithRetry(e,t,o,i,n=null){return t<=0?Promise.reject(n):i(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:this.device,key:"adUnitPath",adUnitPaths:o})}).then(s=>s.ok?s.json():s.text().then(a=>Promise.reject(`${s.statusText}: ${a}`))).then(s=>typeof s!="object"?Promise.reject("response is not an object"):s===null?Promise.reject("response is null"):this.isAdunitPricesRulesResponse(s)?this.validateRules(s.rules)?s:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(s=>new Promise(d=>setTimeout(d,100/t)).then(()=>this.loadConfigWithRetry(e,t-1,o,i,s)))}isAdunitPricesRulesResponse(e){return e.hasOwnProperty("rules")}isPriceRules(e){return typeof e=="object"&&e!==null}validateRules(e){return this.isPriceRules(e)?Object.keys(e).every(t=>{let o=e[t];return typeof o=="object"&&o!==null&&typeof o.main=="boolean"&&typeof o.floorprice=="number"&&typeof o.priceRuleId=="number"}):!1}};var St=class{constructor(){this.name="YieldOptimization";this.description="Provides floors and UPR ids";this.moduleType="yield";this.yieldModuleConfig=null;this._initSteps=[];this._prepareRequestAdsSteps=[];this.yieldOptimizationInit=e=>q("yield-optimization-init",t=>{let o=t.config.slots.filter(i=>t.labelConfigService.filterSlot(i)).map(i=>i.adUnitPath).filter(j);return e.init(t.labelConfigService.getDeviceLabel(),t.adUnitPathVariables,o,t.window.fetch,t.logger)});this.yieldOptimizationPrepareRequestAds=e=>_("yield-optimization",je,(t,o)=>{t.logger.debug("YieldOptimizationService",t.requestId,"applying price rules");let i=t.config.adServer||"gam",n=o.map(s=>e.setTargeting(s.adSlot,i,t.logger,this.yieldModuleConfig,t.auction).then(a=>s.priceRule=a));return Promise.all(n).then(()=>e.getBrowser()).then(s=>{t.env==="production"&&i==="gam"&&t.window.googletag.pubads().setTargeting("upr_browser",s)})})}config(){return this.yieldModuleConfig}configure(e){var t;if((t=e==null?void 0:e.yieldOptimization)!=null&&t.enabled){this.yieldModuleConfig=e.yieldOptimization;let o=new ht(e.yieldOptimization);this._initSteps.push(this.yieldOptimizationInit(o)),this._prepareRequestAdsSteps.push(this.yieldOptimizationPrepareRequestAds(o))}}initSteps(){return this._initSteps}configureSteps(){return[]}prepareRequestAdsSteps(){return this._prepareRequestAdsSteps}};window.moli.registerModule(new St);var It=class{constructor(){this.name="zeotap";this.description="Provides Zeotap functionality (data collection and identity plus) to Moli.";this.moduleType="identity";this.gvlid=301;this.loadScriptCount=0;this.zeotapConfig=null;this.hasConsent=e=>e.gdprApplies?e.vendor.consents[this.gvlid]&&e.purpose.consents[S.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&e.purpose.consents[S.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE]&&e.purpose.consents[S.responses.TCPurpose.SELECT_PERSONALISED_ADS]&&e.purpose.consents[S.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE]&&e.purpose.consents[S.responses.TCPurpose.SELECT_PERSONALISED_CONTENT]&&e.purpose.consents[S.responses.TCPurpose.MEASURE_AD_PERFORMANCE]&&e.purpose.consents[S.responses.TCPurpose.APPLY_MARKET_RESEARCH]&&e.purpose.consents[S.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS]:!0;this.loadScript=(e,t,o)=>{var f;let{mode:i,dataKeyValues:n,exclusionKeyValues:s,assetUrl:a,hashedEmailAddress:d,countryCode:u}=o;if(!t)return Promise.reject("Zeotap module :: no asset loader found, module not initialized yet?");if(i==="default"&&this.loadScriptCount>0)return Promise.reject("Zeotap module :: can't reload script in default mode.");let l=this.makeKeyValuesMap((f=e.targeting)==null?void 0:f.keyValues);if(s.some(I=>this.isExclusionKeyValueSet(I,l)))return Promise.reject("Zeotap module :: targeting exclusions prevented loading the script.");let p=n.map(I=>this.parameterFromKeyValue(I,l)).join("&"),c=!!o.hashedEmailAddress&&this.loadScriptCount===0,m=a+`&idp=${c?1:0}`+(p.length>0?`&${p}`:"")+(u?`&ctry=${u}`:"")+(d?`&z_e_sha2_l=${d}`:"");return this.loadScriptCount++,t.loadScript({name:this.name,loadMethod:1,assetUrl:m})};this.parameterFromKeyValue=(e,t)=>{let o=t.get(e.keyValueKey);return Array.isArray(o)?`${e.parameterKey}=${encodeURIComponent(o.join(","))}`:`${e.parameterKey}=${encodeURIComponent(o||"")}`};this.isExclusionKeyValueSet=(e,t)=>{let o=t.get(e.keyValueKey);return Array.isArray(o)?o.indexOf(e.disableOnValue)>-1:o===e.disableOnValue};this.makeKeyValuesMap=e=>e?new Map(Object.keys(e).map(t=>[t,e[t]]).filter(([,t])=>!!t)):new Map}config(){return this.zeotapConfig}configure(e){e!=null&&e.zeotap&&e.zeotap.enabled&&(this.zeotapConfig=e.zeotap)}initSteps(){let e=this.zeotapConfig;return e&&e.mode==="default"?[q(this.name,t=>(this.hasConsent(t.tcData)&&this.loadScript(t.config,t.assetLoaderService,e).catch(o=>t.logger.error(this.name,o)),Promise.resolve()))]:[]}configureSteps(){let e=this.zeotapConfig;return e&&e.mode==="spa"?[J(this.name,t=>(this.loadScript(t.config,t.assetLoaderService,e).catch(o=>t.logger.error(this.name,o)),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new It);var dr,Re=(dr=window.document.currentScript)!=null?dr:document.getElementById("moli-ad-tag"),lr,xt=(lr=Oe(window,ke.moliPubCode,Z.moliPubCode)[0])==null?void 0:lr.value,ur,kt=(ur=Oe(window,ke.moliVersion,Z.moliVersion)[0])==null?void 0:ur.value,pr,cr,gr,mr;if(Re){let r=xt!=null?xt:Re.getAttribute("data-publisher-code"),e=(pr=kt!=null?kt:Re.getAttribute("data-version"))!=null?pr:"production",t=((cr=Re.getAttribute("data-labels"))!=null?cr:"").split(",").map(n=>n.trim()).filter(n=>n.length>0);t.length>0&&window.moli.que.push(n=>{n.beforeRequestAds(()=>t.forEach(s=>n.addLabel(s)))}),window.moli.configLabel=e;let o=(gr=Re.getAttribute("data-endpoint"))!=null?gr:"api.h5v.eu/publishers",i=(mr=Re.getAttribute("data-endpoint-fallback"))!=null?mr:"cdn.h5v.eu/publishers";if(r){let n=`/${r}/configs/${e}/config.json`,s=`//${o}${n}`;fetch(s,{mode:"cors"}).then(a=>a.json()).catch(a=>(console.error(`Failed to load configuration from ${s}. Using fallback`,a),fetch(`//${i}${n}`,{mode:"cors"}))).then(a=>window.moli.configure(a)).catch(a=>console.error(`Failed to load configuration from ${s}:`,a))}else console.error('No publisher code provided for ad tag configuration! Add the `data-publisher-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");})();
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
