/* ad tag library 5.0.0-alpha.17 by highfivve.com */
var Ji=Object.defineProperty,Xi=Object.defineProperties;var Qi=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var Rt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var Pt=(i,e,t)=>e in i?Ji(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,b=(i,e)=>{for(var t in e||(e={}))Rt.call(e,t)&&Pt(i,t,e[t]);if(Te)for(var t of Te(e))Ct.call(e,t)&&Pt(i,t,e[t]);return i},E=(i,e)=>Xi(i,Qi(e));var wt=(i,e)=>{var t={};for(var o in i)Rt.call(i,o)&&e.indexOf(o)<0&&(t[o]=i[o]);if(i!=null&&Te)for(var o of Te(i))e.indexOf(o)<0&&Ct.call(i,o)&&(t[o]=i[o]);return t};var Mt=(i,e,t)=>new Promise((o,r)=>{var n=l=>{try{a(t.next(l))}catch(d){r(d)}},s=l=>{try{a(t.throw(l))}catch(d){r(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(n,s);a((t=t.apply(i,e)).next())});var Zi=i=>{let e=i.indexOf("=");if(e>=0){let t=decodeURIComponent(i.slice(0,e)),o=decodeURIComponent(i.slice(e+1));return[t,o]}else return[decodeURIComponent(i),""]},ye=i=>{try{let e=i.startsWith("?")?i.slice(1):i;return e.length>0?new Map(e.split("&").filter(t=>t.length>0).map(Zi)):new Map}catch(e){return console.error(e),new Map}};var Ee=(i,e)=>{let t=[],o,r=typeof i.document=="object"&&i.document,n=r&&r.documentElement.doScroll,s="DOMContentLoaded",a=r&&(n?/^loaded|^c/:/^loaded|^i|^c/).test(r.readyState);!a&&r&&r.addEventListener(s,o=()=>{if(r)for(r.removeEventListener(s,o),a=!0;o=t.shift();)o()}),a?setTimeout(e,0):t.push(e)};var gt=class{constructor(e){this.window=e}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,t);case 1:return this.loadAssetViaTag(e,t)}})}loadJson(e,t){return this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(o=>o.ok?o.json():o.text().then(r=>Promise.reject(`${o.statusText}: ${r}`))).catch(o=>Promise.reject(o))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then(o=>o.ok?Promise.resolve(o):Promise.reject(o)).then(o=>o.text()).then(o=>this.scriptTagWithBody(o)).then(o=>t.appendChild(o))}scriptTagWithBody(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){let o=this.scriptTagWithSrc(e.assetUrl);return new Promise((r,n)=>{o.onload=r,o.onerror=n,t.appendChild(o)})}scriptTagWithSrc(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.src=e,t}awaitDomReady(){return new Promise(e=>{Ee(this.window,e)})}},xe=i=>new gt(i);function er(i){try{let e="moliDebug";return!!ye(i.location.search).get(e)||!!i.sessionStorage.getItem(e)||!!i.localStorage.getItem(e)}catch(e){return!1}}function tr(){let i=()=>{};return{debug:i,info:i,warn:i,error:console.error}}function Y(i){return`background:${i}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function ke(i){switch(i){case"debug":return Y("#49A0CC");case"info":return Y("#61A172");case"warn":return Y("#FFC300");case"error":return Y("#C70039")}}function Oe(i){switch(i){case"AdPipeline":return Y("#74ABC6");case"GAM":return Y("#BA0E5F");case"MoliGlobal":return Y("#403073");case"Prebid":return Y("#4357AD");case"AdVisibilityService":return Y("#d5ba3c");case"UserActivityService":return Y("#19ad0e");case"Adex DMP":return Y("#003E74");default:return Y("#052E53")}}function pe(){return{debug(i,e,...t){console.debug(`%c[DEBUG]%c${i}%c${e}`,ke("debug"),Oe(i),"",...t)},info(i,e,...t){console.info(`%c[INFO]%c${i}%c${e}`,ke("info"),Oe(i),"",...t)},warn(i,e,...t){console.warn(`%c[WARN]%c${i}%c${e}`,ke("warn"),Oe(i),"",...t)},error(i,e,...t){console.error(`%c[ERROR]%c${i}%c${e}`,ke("error"),Oe(i),"",...t)}}}function k(i,e){return er(e)?pe():i&&i.logger?i.logger:tr()}var De=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}};var qe=(i,e,t,o)=>{let r=i.slots.find(n=>n.domId===e);if(r){let n=E(b({},r),{domId:t});return E(b({},i),{slots:[...i.slots,n]})}else return o.error("MoliGlobal","no infinite ad slot configured!",i),i};function le(i){return i.reduce((e,t)=>e.concat(t),[])}function j(i,e,t){return t.indexOf(i)===e}function V(i){return i!=null}var be=class{constructor(e,t,o){this.labelSizeConfig=e;this.extraLabels=t;this.window=o;this.possibleDevices=["mobile","desktop","android","ios"];let r=t.some(a=>this.possibleDevices.indexOf(a)>-1),n=e.filter(a=>o.matchMedia(a.mediaQuery).matches);this.isValid=e.length===0||!(e.length>0&&n.length===0);let s=le(n.map(a=>a.labelsSupported));this.supportedLabels=[...r?[]:s,...t].filter(j)}filterSlot(e){var o,r;let t=!0;return this.supportedLabels.length&&((o=e.labelAll)!=null&&o.length)&&(t=e.labelAll.every(n=>this.supportedLabels.indexOf(n)>-1)),this.supportedLabels.length&&e.labelAny&&!((r=e.labelAll)!=null&&r.length)&&(t=e.labelAny.some(n=>this.supportedLabels.indexOf(n)>-1)),t}getSupportedLabels(){return this.supportedLabels}getDeviceLabel(){return this.getSupportedLabels().find(e=>this.possibleDevices.indexOf(e)>-1)||"mobile"}};var A;(t=>{let i;(n=>{let o;(y=>(y[y.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",y[y.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",y[y.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",y[y.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",y[y.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",y[y.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",y[y.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",y[y.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",y[y.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",y[y.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",y[y.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(o=n.TCPurpose||(n.TCPurpose={}));let r;(d=>(d[d.NOT_ALLOWED=0]="NOT_ALLOWED",d[d.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",d[d.REQUIRE_LI=2]="REQUIRE_LI"))(r=n.RestrictionType||(n.RestrictionType={}))})(i=t.responses||(t.responses={}));let e;(s=>{let o;(u=>(u.VISIBLE="visible",u.HIDDEN="hidden",u.DISABLED="disabled"))(o=s.DisplayStatus||(s.DisplayStatus={}));let r;(c=>(c.STUB="stub",c.LOADING="loading",c.LOADED="loaded",c.ERROR="error"))(r=s.CmpStatus||(s.CmpStatus={}));let n;(u=>(u.TC_LOADED="tcloaded",u.CMP_UI_SHOWN="cmpuishown",u.USER_ACTION_COMPLETE="useractioncomplete"))(n=s.EventStatus||(s.EventStatus={}))})(e=t.status||(t.status={}))})(A||(A={}));var ir=A.status.EventStatus,rr=A.status.CmpStatus,or=[A.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,A.responses.TCPurpose.SELECT_BASIC_ADS,A.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,A.responses.TCPurpose.SELECT_PERSONALISED_ADS,A.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,A.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,A.responses.TCPurpose.MEASURE_AD_PERFORMANCE,A.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,A.responses.TCPurpose.APPLY_MARKET_RESEARCH,A.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],nr=i=>!!i.gdprApplies&&or.some(e=>!i.purpose.consents[e]&&i.purpose.legitimateInterests[e]),Tt=(i,e,t,o)=>(o==="test"&&t.info("gdprApplies is set to false in test mode!"),o==="test"||i.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:ir.TC_LOADED,cmpStatus:rr.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((r,n)=>{if(e.__tcfapi){let s=a=>{a.cmpStatus==="error"?n(a):(a.eventStatus==="useractioncomplete"||a.eventStatus==="tcloaded")&&(t.debug("Consent","consent ready",a),i.disableLegitimateInterest&&nr(a)?n("user consent is missing for some purposes"):r(a),a.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},a.listenerId))};e.__tcfapi("addEventListener",2,s)}else n("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var Ae=i=>{if(i){let[e,t,o]=i.split(".").reverse();switch(`${t}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${o}.${t}.${e}`;default:return t?`${t}.${e}`:e}}else return};var Be=i=>{let[e,t,...o]=i.split("/"),[r,...n]=t.split(",");return n.length===0?i:["",r,...o].join("/")},$=(i,e)=>{let t=/[^{]+(?=})/g,o=/([A-Za-z0-9\_]+)/g,r=i.match(t);return!e||!r?i:(r.forEach(n=>{if(!n.match(o))throw new SyntaxError(`invalid variable "${n}" in path`);if(!e[n])throw new ReferenceError(`path variable "${n}" is not defined`)}),i.replace(new RegExp(Object.keys(e).map(n=>`{${n}}`).join("|"),"g"),n=>e[n.substr(1,n.length-2)]))},Et=(i,e)=>i.split("/").slice(0,e+1).join("/"),xt=(i,e,t,o)=>b({device:e,domain:o||Ae(i)||"unknown"},t);var sr=A.responses.TCPurpose,Le=100,F=10,q=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),_=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),ie=(i,e)=>{Object.defineProperty(e,"name",{value:i});let t=0;return _(i,(o,r)=>t!==o.requestAdsCalls?(t=o.requestAdsCalls,e(o,r)):Promise.resolve())},Ot=(i,e)=>(Object.defineProperty(e,"name",{value:i}),_(i,(t,o)=>t.requestAdsCalls===1&&t.requestId===1?e(t,o):Promise.resolve())),N=(i,e,t)=>{let o=Object.assign(t,{priority:e});return Object.defineProperty(t,"name",{value:i}),o},Ue=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),he=class{constructor(e,t,o,r){this.config=e;this.logger=t;this.window=o;this.auction=r;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,t)=>{let o=new Map;return this.config.prepareRequestAds.forEach(r=>{let n=o.get(r.priority);n?n.push(r):o.set(r.priority,[r])}),Array.from(o.entries()).sort(([r],[n])=>r>n?-1:1).reduce((r,[n,s])=>r.then(()=>(e.logger.debug("AdPipeline",e.requestId,`run prepareRequestAds with priority ${n}`),Promise.all(s.map(a=>a(e,t))))),Promise.resolve(void 0))}}run(e,t,o,r,n){if(e.length===0)return Promise.resolve();this.requestId=this.requestId+1;let s=this.requestId;this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${r}. call`,e);let a=t.consent||{};return this.tcData=this.tcData?this.tcData:Tt(a,this.window,this.logger,o.environment),this.tcData.then(l=>{var h,S,y;let d=[...((h=t.targeting)==null?void 0:h.labels)||[]];l.gdprApplies&&l.purpose.consents[sr.STORE_INFORMATION_ON_DEVICE]?d.push("purpose-1"):l.gdprApplies||d.push("purpose-1");let u=new be(t.labelSizeConfig||[],d,this.window),c=n&&((S=t.buckets)!=null&&S.bucket)&&t.buckets.bucket[n]?t.buckets.bucket[n]:null,m=xt(this.window.location.hostname,u.getDeviceLabel(),(y=t.targeting)==null?void 0:y.adUnitPathVariables,t.domain),p={requestId:s,requestAdsCalls:r,logger:this.logger,env:o.environment||"production",config:t,runtimeConfig:o,labelConfigService:u,window:this.window,tcData:l,bucket:c,adUnitPathVariables:m,auction:this.auction,assetLoaderService:xe(this.window)};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(R=>R(p))));let f="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(R=>R(p,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(p,e))).then(R=>R.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(p,R)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(O=>O(p,R)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(p,R)):Promise.reject(f)).catch(R=>{switch(R){case f:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",R),Promise.reject(R)}})})}getAuction(){return this.auction}logStage(e,t){return new Promise(o=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),o()})}};var Ve=(i,e)=>i[0]===e[0]&&i[1]===e[1];var W=class{constructor(e,t,o){this.sizeConfig=e;this.supportedLabels=t;this.window=o;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:this.supportedSizes.filter(t=>e.some(o=>t==="fluid"?o==="fluid":o==="fluid"?!1:Ve(o,t))):[];this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every(o=>t.some(r=>r===o)))&&(!e.labelNone||!e.labelNone.some(o=>t.some(r=>r===o)));let r=e.length!==0?e.filter(n=>o.matchMedia(n.mediaQuery).matches&&this.areLabelsMatching(n,t)):[];this.isValid=e.length===0||!(e.length>0&&r.length===0),this.supportedSizes=le(r.map(n=>n.sizesSupported)).map(n=>JSON.stringify(n)).filter(j).map(n=>JSON.parse(n))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var Z={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:i=>`moli-test-slot-size-${i}`,debugDelay:"moli-debug-delay"};var ce=(i,e=localStorage)=>{try{return e.getItem(i)}catch(t){return pe().debug(`Could not read value with key ${i} from browser storage`,e),null}},Pe=(i,e,t=localStorage)=>{try{t.setItem(i,e)}catch(o){pe().debug(`Could not set key ${i} with value ${e} to browser storage`,t)}};var ar=i=>i==="hidden"||Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number",qt=i=>`${i}__container`,_e=(i,e)=>{let t=lr(i,e);return t.forEach(({slot:o,container:r})=>{r.innerHTML="",r.appendChild(pr(o))}),t};var dr=(i,e)=>{let t=document.getElementById(i);t&&(t.innerHTML=e)},lr=(i,e)=>(e.forEach(t=>{let{moliSlot:o}=t,r=qt(o.domId),n=document.createElement("div");n.id=r;let s=document.getElementById(o.domId);s&&s.setAttribute("data-google-query-id","test"),dr(o.domId,n.outerHTML),i.logger.debug("GAM",`Set content for slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath}`)}),ur(e)),ur=i=>i.map(e=>{let t=document.getElementById(qt(e.moliSlot.domId));return t?{slot:e,container:t}:void 0}).filter(V),pr=i=>{let e=cr(i),t=gr(i.moliSlot,e);if(t==="hidden")return document.createElement("div");{let o=document.createElement("div"),[r,n]=t;o.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${r}px; height: ${n}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${i.moliSlot.domId}</strong>`,o.appendChild(s);let a=document.createElement("span");a.style.color="#656565";let l=([S,y])=>a.innerText=`(${S}x${y})`;l([r,n]),s.appendChild(a);let d=document.createElement("div");d.style.cssText="position: absolute; top: 5px; left: 5px",o.appendChild(d);let u=(S,y)=>{if(S==="hidden")o.style.display="none";else{let[R,O]=S;o.style.width=`${R}px`,o.style.height=`${O}px`,l(S),h(y)}mr(i.moliSlot,S)},c="1px dotted white",m="1px solid black",p=document.createElement("button");p.innerText="hide",p.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",p.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${c};`,p.addEventListener("click",()=>u("hidden",p));let f=[...e.map(S=>{let[y,R]=S,O=Bt(t,S),w=document.createElement("button");return w.innerText=`${y}x${R}`,w.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${O?m:c};`,w.addEventListener("click",()=>u(S,w)),w}),p];f.forEach(S=>d.appendChild(S));let h=S=>{f.forEach(y=>y.style.border=c),S.style.border=m};return o}},cr=i=>i.filterSupportedSizes(i.moliSlot.sizes).filter(W.isFixedSize).filter(([e,t])=>e>1&&t>1),gr=(i,e)=>{let t=fr(i);if(t&&(t==="hidden"||yr(e,t)))return t;{let o=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[o]}},mr=(i,e)=>Pe(Z.testSlotSize(i.domId),JSON.stringify(e)),fr=i=>{let e=ce(Z.testSlotSize(i.domId));if(e)try{let t=JSON.parse(e);return ar(t)?t:void 0}catch(t){return}},Bt=(i,e)=>{let[t,o]=i,[r,n]=e;return t===r&&o===n},yr=(i,e)=>i.some(t=>Bt(t,e));var br=(i,e)=>({setCollapseEmptyDiv(){},addService(t){},getSlotElementId(){return i},getAdUnitPath(){return e},setTargeting(t,o){return this},getTargeting(t){return[]},getTargetingKeys(){return[]},clearTargeting(t){},getResponseInformation(){return null}}),Lt=(i,e,t)=>{var n;let o=t?t.keyValues:{},r=(n=t==null?void 0:t.adManagerExcludes)!=null?n:[];[o,e].forEach(s=>{Object.keys(s).filter(a=>!r.includes(a)).forEach(a=>{let l=s[a];l&&i.googletag.pubads().setTargeting(a,l)})})},Ut=(i,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!i.gdprApplies||i.vendor.consents[755]&&i.purpose.consents[A.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[A.responses.TCPurpose.SELECT_BASIC_ADS,A.responses.TCPurpose.MEASURE_AD_PERFORMANCE,A.responses.TCPurpose.APPLY_MARKET_RESEARCH,A.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(t=>i.purpose.consents[t]||i.purpose.legitimateInterests[t]),Vt=()=>{let i;return q("gpt-init",e=>e.env==="test"?Promise.resolve():(i||(i=new Promise(t=>{e.logger.debug("GAM","init googletag stub"),e.window.googletag=e.window.googletag||{},e.window.googletag.cmd=e.window.googletag.cmd||[],e.window.googletag.cmd.push(t),e.assetLoaderService.loadScript({name:"gpt",loadMethod:1,assetUrl:Ut(e.tcData,e.config.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(o=>e.logger.error("failed to load gpt.js",o))})),i))},_t=()=>{let i=0;return _("gpt-destroy-ad-slots",(e,t)=>{var o;if(e.env==="test")return Promise.resolve();if(((o=e.config.spa)==null?void 0:o.destroyAllAdSlots)===!1){let r=e.window.googletag.pubads().getSlots(),n=t.map(s=>r.find(a=>a.getSlotElementId()===s.domId)).filter(V);n.length===0?e.logger.debug("GAM","no ad slots to destroy"):(e.logger.debug("GAM",`destroy ${n.length} ad slots`,n),e.window.googletag.destroySlots(n))}else i!==e.requestAdsCalls&&(i=e.requestAdsCalls,e.logger.debug("GAM","destroy all ad slots"),e.window.googletag.destroySlots());return Promise.resolve()})},Nt=()=>ie("gpt-reset-targeting",i=>new Promise(e=>{i.env==="production"&&(i.logger.debug("GAM","reset top level targeting"),i.window.googletag.pubads().clearTargeting(),Lt(i.window,i.runtimeConfig.keyValues,i.config.targeting)),e()})),zt=()=>{let i;return _("gpt-configure",(e,t)=>(i||(i=new Promise(o=>{let r=e.runtimeConfig.environment||"production";switch(e.logger.debug("GAM","configure googletag"),r){case"production":Lt(e.window,e.runtimeConfig.keyValues,e.config.targeting),e.window.googletag.pubads().enableAsyncRendering(),e.window.googletag.pubads().disableInitialLoad(),e.window.googletag.pubads().enableSingleRequest();let n=!Ut(e.tcData,e.config.consent);e.logger.debug("GAM","use limited ads",n),e.window.googletag.pubads().setPrivacySettings({limitedAds:n}),e.window.googletag.enableServices(),o();return;case"test":o();return}})),i))},jt=()=>N("gpt-device-label-keyValue",F,i=>i.env==="test"?Promise.resolve():new Promise(e=>{let t=i.labelConfigService.getDeviceLabel();i.logger.debug("GAM",'adding "device_label" key-value with values',t),i.window.googletag.pubads().setTargeting("device_label",t),e()})),Gt=()=>N("gpt-consent-keyValue",F,i=>i.env==="test"?Promise.resolve():new Promise(e=>{let t=i.tcData,o=!t.gdprApplies||[A.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,A.responses.TCPurpose.SELECT_BASIC_ADS,A.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,A.responses.TCPurpose.SELECT_PERSONALISED_ADS,A.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,A.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,A.responses.TCPurpose.MEASURE_AD_PERFORMANCE,A.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,A.responses.TCPurpose.APPLY_MARKET_RESEARCH,A.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(r=>t.purpose.consents[r]);i.window.googletag.pubads().setTargeting("consent",o?"full":"none"),e()})),$t=()=>(i,e)=>{let t=e.map(o=>{var p;let r=new W(o.sizeConfig,i.labelConfigService.getSupportedLabels(),i.window),n=r.filterSupportedSizes;if(!(r.filterSlot(o)&&i.labelConfigService.filterSlot(o)))return Promise.resolve(null);let s=n(o.sizes),a=$(o.adUnitPath,i.adUnitPathVariables),l=()=>{switch(o.position){case"in-page":return i.window.googletag.defineSlot(a,s,o.domId);case"out-of-page":return i.window.googletag.defineOutOfPageSlot(a,o.domId);case"out-of-page-interstitial":return i.logger.debug("GAM",`defined web interstitial for ${a}`),i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);case"out-of-page-bottom-anchor":return i.logger.debug("GAM",`defined bottom anchor for ${a}`),i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);case"out-of-page-top-anchor":return i.logger.debug("GAM",`defined top anchor for ${a}`),i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.TOP_ANCHOR)}},d=()=>{if(i.env==="test")return null;let f=l();return f&&i.window.googletag.display(f),f},c=(i.env==="test"?[]:i.window.googletag.pubads().getSlots()).find(f=>f.getSlotElementId()===o.domId),m=c||d();switch(i.env){case"production":if(m)return m.setCollapseEmptyDiv(((p=o.gpt)==null?void 0:p.collapseEmptyDiv)!==!1),m.addService(i.window.googletag.pubads()),i.logger.debug("GAM",`Register slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath}`),Promise.resolve({moliSlot:o,adSlot:m,filterSupportedSizes:n});if(o.position==="out-of-page-interstitial"||o.position==="out-of-page-top-anchor"||o.position==="out-of-page-bottom-anchor")return i.logger.warn("GAM",`${o.position} is not supported`),Promise.resolve(null);{let f=`Slot: [DomID] ${o.domId} [AdUnitPath] ${o.adUnitPath} is already defined. You may have called requestAds() multiple times`;return i.logger.error("GAM",f),Promise.reject(new Error(f))}case"test":return Promise.resolve({moliSlot:o,adSlot:br(o.domId,o.adUnitPath),filterSupportedSizes:n});default:return Promise.reject(`invalid environment: ${i.runtimeConfig.environment}`)}});return Promise.all(t).then(o=>o.filter(V))},Ft=()=>(i,e)=>new Promise(t=>{switch(i.logger.debug("GAM","requestAds"),i.env){case"test":_e(i,e);break;case"production":let o=e.filter(({moliSlot:n})=>!i.auction.isSlotThrottled(n.domId));if(o.length===0)break;i.window.googletag.pubads().refresh(o.map(({adSlot:n})=>n));let r=o.map(({moliSlot:n})=>`[DomID] ${n.domId} [AdUnitPath] ${n.adUnitPath}`).join(`
`);i.logger.debug("GAM",`Refresh ${e.length} slot(s):
${r}`);break}t()});var ae;(v=>{let i;(T=>{let ne;(H=>(H[H.Unknown=0]="Unknown",H[H.ProfessionallyProduced=1]="ProfessionallyProduced",H[H.Prosumer=2]="Prosumer",H[H.UGC=3]="UGC"))(ne=T.ContentQuality||(T.ContentQuality={}))})(i=v.firstpartydata||(v.firstpartydata={}));let e;(z=>{let ne;(se=>(se[se.NO=0]="NO",se[se.YES=1]="YES"))(ne=z.Skip||(z.Skip={}));let T;(L=>(L[L.VAST_1=1]="VAST_1",L[L.VAST_2=2]="VAST_2",L[L.VAST_3=3]="VAST_3",L[L.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",L[L.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",L[L.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",L[L.VAST_4=7]="VAST_4",L[L.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",L[L.DAAST_1=9]="DAAST_1",L[L.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(T=z.Protocol||(z.Protocol={}));let U;(D=>(D[D.AutoPlaySoundOff=1]="AutoPlaySoundOff",D[D.AutoPlaySoundOn=2]="AutoPlaySoundOn",D[D.ClickToPlay=3]="ClickToPlay",D[D.MousOver=4]="MousOver",D[D.InViewportSoundsOn=5]="InViewportSoundsOn",D[D.InViewportSoundsOff=6]="InViewportSoundsOff"))(U=z.PlaybackMethod||(z.PlaybackMethod={}));let Q;(D=>(D[D.VPAID_1=1]="VPAID_1",D[D.VPAID_2=2]="VPAID_2",D[D.MRAID_1=3]="MRAID_1",D[D.ORMMA=4]="ORMMA",D[D.MRAID_2=5]="MRAID_2",D[D.MRAID_3=6]="MRAID_3"))(Q=z.Api||(z.Api={}));let fe;(te=>(te[te.InStream=1]="InStream",te[te.InBanner=2]="InBanner",te[te.InArticle=3]="InArticle",te[te.InFeed=4]="InFeed",te[te.Interstitial=5]="Interstitial"))(fe=z.Placement||(z.Placement={}));let Me;(de=>(de[de.Instream=1]="Instream",de[de.AccompanyingContent=2]="AccompanyingContent",de[de.Interstitial=3]="Interstitial",de[de.NoContentStandalone=4]="NoContentStandalone"))(Me=z.Plcmt||(z.Plcmt={}));let H;(C=>(C[C.AudioAdAutoPlay=1]="AudioAdAutoPlay",C[C.AudioAdUserInitiated=2]="AudioAdUserInitiated",C[C.ExpandableAutomatic=3]="ExpandableAutomatic",C[C.ExpandableOnClick=4]="ExpandableOnClick",C[C.ExpandableOnRollover=5]="ExpandableOnRollover",C[C.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",C[C.InBannerVideoAdClick=7]="InBannerVideoAdClick",C[C.Pop=8]="Pop",C[C.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",C[C.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",C[C.Surveys=11]="Surveys",C[C.TextOnly=12]="TextOnly",C[C.UserInteractive=13]="UserInteractive",C[C.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",C[C.HasAudioOnOffButton=15]="HasAudioOnOffButton",C[C.HasSkipButton=16]="HasSkipButton",C[C.AdobeFlash=16]="AdobeFlash"))(H=z.CreativeAttributes||(z.CreativeAttributes={}));let ct;(se=>(se[se.LinerInStream=1]="LinerInStream",se[se.NonLinearOverlay=2]="NonLinearOverlay"))(ct=z.Linearity||(z.Linearity={}))})(e=v.video||(v.video={})),v.Adagio="adagio",v.AdaptMx="amx",v.Adform="adf",v.AdUp="aduptech",v.Criteo="criteo",v.ConnectAd="connectad",v.AppNexusAst="appnexusAst",v.AppNexus="appnexus",v.GumGum="gumgum",v.ImproveDigital="improvedigital",v.IndexExchange="ix",v.Invibes="invibes",v.NanoInteractive="nanointeractive",v.PubMatic="pubmatic",v.Ogury="ogury",v.OneTag="onetag",v.OpenX="openx",v.SmartAdServer="smartadserver",v.Smartx="smartx",v.Unruly="unruly",v.Teads="teads",v.Triplelift="triplelift",v.Yieldlab="yieldlab",v.Seedtag="seedtag",v.Spotx="spotx",v.ShowHeroes="showheroesBs",v.StroeerCore="stroeerCore",v.Xaxis="xhb",v.DSPX="dspx",v.Rubicon="rubicon",v.Recognified="rads",v.Visx="visx",v.Vlyby="vlyby",v.Orbidder="orbidder"})(ae||(ae={}));var Wt=(i,e)=>{var t;return E(b({},i),{ext:E(b({},i.ext),{prebid:E(b({},(t=i.ext)==null?void 0:t.prebid),{storedrequest:e})})})};var hr=i=>new Promise((e,t)=>{i.window.setTimeout(()=>t("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),Sr=i=>new Promise(e=>{i.pbjs=i.pbjs||{que:[]},i.pbjs.que.push(e)}),Kt=i=>!!i.moliSlot.prebid,vr=(i,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(t=>i.code===t.code):!1,Ht=(i,e,t)=>t.filter(Kt).map(({moliSlot:r,priceRule:n,filterSupportedSizes:s})=>{let a=n?{floors:{currency:e.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":n.floorprice}}}:null;return i.logger.debug("Prebid",i.requestId,"Price Rule",n,r.domId,a),Ir(r.prebid).map(l=>{var J,X,oe,me;let d=l.adUnit.mediaTypes.banner,u=l.adUnit.mediaTypes.video,c=l.adUnit.mediaTypes.native,m=d?s(d.sizes).filter(W.isFixedSize):[],p=u?Ar(u.playerSize,s):[],f=l.adUnit.bids.filter(G=>i.labelConfigService.filterSlot(G)).filter(G=>G.bidder&&i.auction.biddersDisabling?!i.auction.biddersDisabling.isBidderDisabled(r.domId,G.bidder):!0).filter(G=>G.bidder&&i.auction.frequencyCapping?!i.auction.isBidderFrequencyCappedOnSlot(r.domId,G.bidder):!0).map(G=>{let g=G,{labelAny:pt,labelAll:ee}=g;return wt(g,["labelAny","labelAll"])}),h=p.length>0&&!(u!=null&&u.w)&&!(u!=null&&u.h)?{w:p[0][0],h:p[0][1]}:{},S=u?{video:b(E(b({},u),{playerSize:p.length===0?void 0:p}),h)}:void 0,y=d&&m.length>0?{banner:E(b({},d),{sizes:m})}:void 0,R=c?{native:b({},c)}:void 0,O=E(b({},l.adUnit.pubstack),{adUnitPath:$(((J=l.adUnit.pubstack)==null?void 0:J.adUnitPath)||r.adUnitPath,i.adUnitPathVariables)}),w=(me=(oe=(X=l.adUnit.ortb2Imp)==null?void 0:X.ext)==null?void 0:oe.prebid)==null?void 0:me.storedrequest,K=w&&w.id?E(b({},w),{id:$(w.id,i.adUnitPathVariables)}):null;return b(E(b(E(b(b({},l.adUnit),w&&K&&{ortb2Imp:Wt(l.adUnit.ortb2Imp,K)}),{code:l.adUnit.code||r.domId}),l.adUnit.pubstack?{pubstack:O}:{}),{mediaTypes:b(b(b({},S),y),R),bids:f}),a)}).filter(l=>l.bids.length>0&&l.mediaTypes&&(l.mediaTypes.banner||l.mediaTypes.video||l.mediaTypes.native)&&!vr(l,i.window))}).reduce((r,n)=>[...r,...n],[]),Yt=()=>q("prebid-init",i=>Promise.race([Sr(i.window),hr(i)])),Jt=i=>_("prebid-remove-adunits",e=>new Promise(t=>{if(i.ephemeralAdUnits!==!0){e.window.pbjs=e.window.pbjs||{que:[]};let o=e.window.pbjs.adUnits;o&&(e.logger.debug("Prebid","Destroying prebid adUnits",o),o.forEach(r=>e.window.pbjs.removeAdUnit(r.code)))}t()})),Xt=(i,e)=>{let t,o=r=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:r}});return _("prebid-configure",(r,n)=>(t||(t=new Promise(s=>{i.bidderSettings&&(r.window.pbjs.bidderSettings=i.bidderSettings),r.window.pbjs.setConfig(E(b({},i.config),{schain:o([e.supplyChainStartNode]),floors:i.config.floors||{}})),i.schain.nodes.forEach(({bidder:a,node:l,appendNode:d})=>{let u=[e.supplyChainStartNode];d&&u.push(l),r.window.pbjs.setBidderConfig({bidders:[a],config:{schain:o(u)}},!0)}),r.window.pbjs.registerSignalSources&&typeof r.window.pbjs.registerSignalSources=="function"&&r.window.pbjs.registerSignalSources(),s()})),t))},Ir=i=>Array.isArray(i)?i:[i],Qt=i=>N("prebid-prepare-adunits",F,(e,t)=>new Promise(o=>{if(i.ephemeralAdUnits)o();else{let r=Ht(e,i,t);r.forEach(n=>{e.logger.debug("Prebid",e.requestId,`Prebid add ad unit: [Code] ${n.code}`,n)}),e.window.pbjs.addAdUnits(r),o()}})),Zt=(i,e)=>Ue("prebid-request-bids",(t,o)=>{var a,l;let r=Math.max(((a=i.config.bidderTimeout)!=null?a:2e3)+3e3,(l=i.failsafeTimeout)!=null?l:0),n=new Promise(d=>t.window.setTimeout(d,r)),s=new Promise(d=>{var h,S;let u=o.filter(y=>!t.auction.isSlotThrottled(y.moliSlot.domId)),c=i.ephemeralAdUnits?{adUnits:Ht(t,i,u)}:{adUnitCodes:u.filter(Kt).map(y=>y.moliSlot.domId)},m=c.adUnitCodes||((h=c.adUnits)==null?void 0:h.map(y=>y.code).filter(V).filter(j))||[];if(m.length===0)return t.logger.debug("Prebid","skip request bids. All slots were filtered.",u.map(y=>y.moliSlot)),d();let p=!1;t.logger.debug("Prebid",`Prebid request bids: 
			${m.join(`
			`)}`);let f=(y,R,O)=>{t.logger.info("Prebid",O,y,o.map(w=>w.moliSlot.domId));try{if(p){t.logger.warn("Prebid",`ad server request already sent [${t.requestId}]. AuctionId ${O}`);return}if(!y)return t.logger.warn("Prebid",`Undefined bid response map for ad unit codes: ${m.join(", ")}`),d();p=!0,e==="gam"&&t.window.pbjs.setTargetingForGPTAsync(m),d()}catch(w){t.logger.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(w)),d()}};t.window.pbjs.requestBids(E(b({},c),{timeout:(S=t.bucket)==null?void 0:S.timeout,bidsBackHandler:f}))});return Promise.race([n,s])}),ei=()=>(i,e)=>{let t=e.map(o=>{let r=new W(o.sizeConfig,i.labelConfigService.getSupportedLabels(),i.window),n=r.filterSupportedSizes;if(!(r.filterSlot(o)&&i.labelConfigService.filterSlot(o)))return Promise.resolve(null);let s={getAdUnitPath:()=>o.adUnitPath};switch(i.env){case"production":return Promise.resolve({moliSlot:o,adSlot:s,filterSupportedSizes:n});case"test":return Promise.resolve({moliSlot:o,adSlot:s,filterSupportedSizes:n});default:return Promise.reject(`invalid environment: ${i.runtimeConfig.environment}`)}});return Promise.all(t).then(o=>o.filter(V))},ti=()=>(i,e)=>new Promise((t,o)=>{i.logger.debug("Prebid","start rendering");try{switch(i.env){case"test":i.logger.debug("Prebid","Rendering test slots"),_e(i,e);break;case"production":i.window.pbjs.getHighestCpmBids().filter(r=>r&&r.adId).forEach(r=>{var s;let n=i.window.document.getElementById(r.adUnitCode);if(n){let a=document.createElement("div");a.style.setProperty("border","0pt none");let l=document.createElement("iframe");l.scrolling="no",l.frameBorder="0",l.marginHeight="0",l.marginHeight="0",l.name=`prebid_ads_iframe_${r.adUnitCode}`,l.title="3rd party ad content",l.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),l.setAttribute("aria-label","Advertisment"),l.style.setProperty("border","0"),l.style.setProperty("margin","0"),l.style.setProperty("overflow","hidden"),a.appendChild(l),n.appendChild(a);let d=(s=l.contentWindow)==null?void 0:s.document;if(d){i.window.pbjs.renderAd(d,r.adId);let u="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",c=d.createElement("style");c.appendChild(d.createTextNode(u)),d.head.appendChild(c)}else i.logger.error("Prebid",`No access to iframe contentWindow for ad unit${r.adUnitCode}`)}else i.logger.error("Prebid",`Could not locate ad slot with id ${r.adUnitCode}`)});break}t()}catch(r){o(r)}}),Ar=(i,e)=>{let t=o=>!!o&&o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number";return i?e(t(i)?[i]:i).filter(W.isFixedSize):[]};var ge=A.responses.TCPurpose,Pr=i=>!!i.moliSlot.a9,ii=i=>!i.gdprApplies||i.vendor.consents[793]&&[ge.STORE_INFORMATION_ON_DEVICE,ge.SELECT_BASIC_ADS,ge.CREATE_PERSONALISED_ADS_PROFILE,ge.SELECT_PERSONALISED_ADS,ge.MEASURE_AD_PERFORMANCE,ge.APPLY_MARKET_RESEARCH,ge.DEVELOP_IMPROVE_PRODUCTS].every(e=>i.purpose.consents[e]),ri=(i,e)=>q("a9-init",t=>new Promise(o=>{t.window.apstag=t.window.apstag||{_Q:[],init:function(){t.window.apstag._Q.push(["i",arguments])},fetchBids:function(){t.window.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){t.window.apstag._Q.push(["di",arguments])},rpa:function(){t.window.apstag._Q.push(["ri",arguments])},upa:function(){t.window.apstag._Q.push(["ui",arguments])}},t.env!=="test"&&ii(t.tcData)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:i.scriptUrl?i.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(r=>t.logger.error("failed to load apstag.js",r)),o()})),oi=(i,e)=>_("a9-configure",(t,o)=>new Promise(r=>{t.window.apstag.init({pubID:i.pubID,adServer:"googletag",bidTimeout:i.timeout,gdpr:{cmpTimeout:i.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:[e.supplyChainStartNode,i.schainNode]}}),r()})),ni=i=>Ot("a9-publisher-audiences",(e,t)=>new Promise(o=>{let r=i.publisherAudience;if(r&&r.enabled){let n={hashedRecords:[{type:"email",record:r.sha256Email}]};if(e.logger.debug("A9","Enable publisher audiences"),e.window.apstag.rpa(n),e.window.__tcfapi){let s=!0;e.window.__tcfapi("addEventListener",2,a=>{if(s){s=!1;return}a.eventStatus===A.status.EventStatus.USER_ACTION_COMPLETE&&(e.logger.debug("A9","Update publisher audience token"),e.window.apstag.upa(n))})}}o()})),si=()=>N("a9-clear-targeting",F,(i,e)=>i.requestId===0?(i.logger.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(t=>{i.logger.debug("A9","clear a9 targetings"),e.forEach(({adSlot:o})=>{o.getTargetingKeys().filter(r=>r==="amznp"||r==="amznsz"||r==="amznbid").forEach(r=>o.clearTargeting(r))}),t()})),Rr=(i,e,t)=>{let o=Be(i),r=e?Et(o,e):o;return $(r,t)},ai=i=>Ue("a9-fetch-bids",(e,t)=>new Promise(o=>{var n;if(!ii(e.tcData)){e.logger.debug("A9","Skip any due to missing consent"),o();return}let r=t.filter(Pr).filter(s=>!e.auction.isSlotThrottled(s.moliSlot.domId)).filter(s=>{let a=s.moliSlot.a9.mediaType==="video",l=e.labelConfigService.filterSlot(s.moliSlot.a9),d=s.filterSupportedSizes(s.moliSlot.sizes).filter(W.isFixedSize).length>0;return l&&(a||d)}).map(({moliSlot:s,priceRule:a,filterSupportedSizes:l})=>{var d,u;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let c=i.supportedSizes?s.sizes.filter(p=>{var f;return(f=i.supportedSizes)==null?void 0:f.some(h=>Ve(h,p))}):s.sizes,m=Rr(s.adUnitPath,(d=s.a9.slotNamePathDepth)!=null?d:i.slotNamePathDepth,e.adUnitPathVariables);return b({slotID:s.domId,slotName:m,sizes:l(c).filter(W.isFixedSize)},i.enableFloorPrices&&a?{floor:{value:Math.ceil((u=e.window.pbjs)!=null&&u.convertCurrency?e.window.pbjs.convertCurrency(a.floorprice,"EUR",i.floorPriceCurrency||"USD")*100:a.floorprice*100*1.19),currency:i.floorPriceCurrency||"USD"}}:{})}});e.logger.debug("A9",`Fetch '${r.length}' A9 slots: ${r.map(s=>`[slotID] ${s.slotID}`)}`),r.length===0?o():e.window.apstag.fetchBids(b({slots:r},((n=e.bucket)==null?void 0:n.timeout)&&{bidTimeout:e.bucket.timeout}),s=>{e.window.apstag.setDisplayBids(),o()})}));var di=i=>N("passback-prepare-slots",F,(e,t)=>new Promise(o=>{t.filter(r=>r.moliSlot.passbackSupport).forEach(r=>{e.logger.debug("passback","add passback support for slot",r.moliSlot.domId),i.addAdSlot(r)}),o()}));var Ne=class{constructor(e,t){this.logger=e;this.window=t;this.isInitialized=!1;this.adSlots={};this.passbackKeyValue="passback";this.passbackOriginKeyValue="passbackOrigin";this.findAdSlot=e=>e.adUnitPath?this.adSlots[e.adUnitPath]:e.domId?this.adSlots[e.domId]:void 0}addAdSlot(e){this.isInitialized||(this.isInitialized=!0,this.initMessageListener()),this.adSlots[e.moliSlot.domId]=e,this.adSlots[e.moliSlot.adUnitPath]=e}initMessageListener(){this.logger.debug("Passback Service","Add message listener"),this.window.addEventListener("message",e=>{let t=this.parseMessageData(e.data);if(!t)return;this.logger.debug("Passback Service","Received passback message",t);let o=this.findAdSlot(t);o&&(this.logger.debug("Passback Service","Process passback for ad slot"),o.adSlot.setTargeting(this.passbackKeyValue,"true"),o.adSlot.setTargeting(this.passbackOriginKeyValue,t.passbackOrigin),this.window.googletag.pubads().refresh([o.adSlot]),delete this.adSlots[o.moliSlot.domId],delete this.adSlots[o.moliSlot.adUnitPath])})}parseMessageData(e){if(typeof e=="string")try{let t=JSON.parse(e);return t.type==="passback"&&t.passbackOrigin&&(t.domId||t.adUnitPath)?t:null}catch(t){return null}return null}};var li=(i,e)=>e?new Promise(t=>i.setTimeout(t,e)):Promise.resolve(),ui=i=>Number(ce(Z.debugDelay,i.localStorage))||void 0;var ze=class{constructor(e,t){this.config=e;this.window=t;this.participationInfo=new Map;var o;(o=this.logger)==null||o.info(`Bidders disabling feature is ${e.enabled?"enabled":"disabled"}`)}isBidderDisabled(e,t){var o,r,n;return(n=(r=(o=this.participationInfo.get(e))==null?void 0:o.get(t))==null?void 0:r.disabled)!=null?n:!1}onAuctionEnd(e){e.bidderRequests.forEach(t=>{t.bids.forEach(o=>{var l,d,u;let r=o.bidder,n=o.adUnitCode;this.participationInfo.get(n)||this.participationInfo.set(n,new Map);let a=(l=this.participationInfo.get(n))==null?void 0:l.get(r);if(a){let c=a.bidRequestCount+1;(d=this.participationInfo.get(n))==null||d.set(r,E(b({},a),{bidRequestCount:c}))}else(u=this.participationInfo.get(n))==null||u.set(r,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),e.bidsReceived.forEach(t=>{var s,a,l;let o=t.bidderCode,r=t.adUnitCode,n=(s=this.participationInfo.get(r))==null?void 0:s.get(o);n?(a=this.participationInfo.get(r))==null||a.set(o,E(b({},n),{bidReceivedCount:n.bidReceivedCount+1})):(l=this.participationInfo.get(r))==null||l.set(o,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),this.deactivateBidderForTTL()}deactivateBidderForTTL(){this.participationInfo.forEach((e,t)=>{e.forEach((o,r)=>{this.shouldDisableBidder(o)&&(this.disableBidder(t,r),this.window.setTimeout(()=>{this.enableBidder(t,r)},this.config.reactivationPeriod))})})}shouldDisableBidder(e){return e.bidRequestCount>this.config.minBidRequests&&e.bidReceivedCount/e.bidRequestCount<this.config.minRate&&!e.disabled}disableBidder(e,t){var r,n;let o=(r=this.participationInfo.get(e))==null?void 0:r.get(t);o&&(o.disabled=!0,(n=this.logger)==null||n.info(`Bidder ${t} for position ${e} is now disabled.`))}enableBidder(e,t){var r,n;let o=(r=this.participationInfo.get(e))==null?void 0:r.get(t);o&&(o.disabled=!1,(n=this.logger)==null||n.info(`Bidder ${t} for position ${e} is now enabled.`))}};var je=class{constructor(e,t){this.config=e;this._window=t;this.slotsRequested=new Set}onSlotRequested(e){this.slotsRequested.add(e.slot.getSlotElementId()),this._window.setTimeout(()=>{this.slotsRequested.delete(e.slot.getSlotElementId())},this.config.throttle*1e3)}isThrottled(e){return this.slotsRequested.has(e)}};var Ge=class{constructor(e,t){this.config=e;this._window=t;this.frequencyCaps=new Set}onBidWon(e,t){t.forEach(o=>{if(o.bidder===e.bidder&&o.domId===e.adUnitCode){let r=`${e.adUnitCode}-${e.bidder}`;this.frequencyCaps.add(r),this._window.setTimeout(()=>{this.frequencyCaps.delete(r)},o.blockedForMs)}})}isFrequencyCapped(e,t){return this.frequencyCaps.has(`${e}-${t}`)}};var Se=class{constructor(e,t={}){this.window=e;this.config=t;var o,r,n,s,a,l;(o=t.biddersDisabling)!=null&&o.enabled&&(this.biddersDisabling=new ze(t.biddersDisabling,this.window)),(r=t.adRequestThrottling)!=null&&r.enabled&&(this.adRequestThrottling=new je(t.adRequestThrottling,this.window)),(n=t.frequencyCap)!=null&&n.enabled&&(this.frequencyCapping=new Ge(t.frequencyCap,this.window)),this.window.pbjs=this.window.pbjs||{que:[]},this.window.googletag=this.window.googletag||{cmd:[]},(s=this.config.biddersDisabling)!=null&&s.enabled&&this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("auctionEnd",d=>{this.handleAuctionEndEvent(d)})}),(a=this.config.adRequestThrottling)!=null&&a.enabled&&this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotRequested",d=>{var u;(u=this.adRequestThrottling)==null||u.onSlotRequested(d)})}),(l=this.config.frequencyCap)!=null&&l.enabled&&this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("bidWon",d=>{var u;this.config.frequencyCap&&((u=this.frequencyCapping)==null||u.onBidWon(d,this.config.frequencyCap.configs))})})}isSlotThrottled(e){var t,o;return(o=(t=this.adRequestThrottling)==null?void 0:t.isThrottled(e))!=null?o:!1}isBidderFrequencyCappedOnSlot(e,t){var o,r;return(r=(o=this.frequencyCapping)==null?void 0:o.isFrequencyCapped(e,t))!=null?r:!1}handleAuctionEndEvent(e){var t;(t=this.biddersDisabling)==null||t.onAuctionEnd(e)}};var $e=class i{constructor(e,t,o){this.assetService=e;this.window=t;this.adPipelineConfig=o;this.requestAdsCalls=0;this.adPipeline=new he({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},pe(),this.window,new Se(this.window));this.initialize=(e,t)=>{var c;let o=i.getEnvironment(t),r=e.adServer||"gam",n=r==="gam",s=((c=e.spa)==null?void 0:c.enabled)===!0;this.logger.setLogger(k(t,this.window)),this.logger.debug("AdService",`Initializing with environment ${o} and ad server ${r}`);let a=n?[Vt()]:[],l=n?[zt()]:[];n&&s&&l.push(_t(),Nt());let d=[];n&&d.push(jt(),Gt(),di(new Ne(this.logger,this.window)));let u=[];if(e.prebid&&o==="production"&&(a.push(Yt()),l.push(Xt(e.prebid,e.schain)),s&&l.push(Jt(e.prebid)),d.push(Qt(e.prebid)),u.push(Zt(e.prebid,r))),e.a9&&o==="production"&&n&&(a.push(ri(e.a9,this.assetService)),l.push(oi(e.a9,e.schain)),l.push(ni(e.a9)),d.push(si()),u.push(ai(e.a9))),o==="test"){let m=ui(this.window);m&&l.push(()=>li(this.window,m))}return this.adPipeline=new he({init:a,configure:l,defineSlots:n?$t():ei(),prepareRequestAds:d,requestBids:u,requestAds:n?Ft():ti()},this.logger,this.window,new Se(this.window,e.globalAuctionContext)),new Promise(m=>{Ee(this.window,()=>{this.logger.debug("DOM","dom ready"),m(e)})})};this.requestAds=(e,t)=>Mt(this,null,function*(){var n;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:o,refreshInfiniteSlots:r}=t;this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,o);try{let s=e.slots.map(a=>this.isManualSlot(a)?o.some(l=>l===a.domId)?a:null:this.isInfiniteSlot(a)?r.some(l=>l.artificialDomId===a.domId)?a:null:this.isBackfillSlot(a)?null:a).filter(V).filter(this.isSlotAvailable);if((n=e.buckets)!=null&&n.enabled){let a=new Map;s.forEach(d=>{let u=d.behaviour.bucket||"default",c=a.get(u);c?c.push(d):a.set(u,[d])});let l=yield Promise.all(Array.from(a.entries()).map(([d,u])=>(this.logger.debug("AdPipeline",`running bucket ${d}, slots:`,u),this.adPipeline.run(u,e,t,this.requestAdsCalls).then(()=>u))));return le(l)}else return yield this.adPipeline.run(s,e,t,this.requestAdsCalls),s}catch(s){return this.logger.error("AdPipeline","slot filtering failed",s),Promise.reject(s)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.isManualSlot=e=>e.behaviour.loaded==="manual";this.isInfiniteSlot=e=>e.behaviour.loaded==="infinite";this.isBackfillSlot=e=>e.behaviour.loaded==="backfill";this.isSlotAvailable=e=>!!this.window.document.getElementById(e.domId)||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor";this.logger=new De(pe()),o&&(this.adPipeline=new he(o,this.logger,t,new Se(t)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,t,o,r){if(e.length===0)return Promise.resolve();let{loaded:n}=b({loaded:"manual"},r),s=t.slots.filter(a=>e.some(l=>l===a.domId)&&(a.behaviour.loaded===n||a.behaviour.loaded==="infinite")).filter(this.isSlotAvailable).map(a=>r!=null&&r.sizesOverride?E(b({},a),{sizes:r.sizesOverride}):a);if(e.length!==s.length){let a=s.filter(d=>e.every(u=>u!==d.domId)),l=e.filter(d=>s.every(u=>u.domId!==d));a.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",a),l.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",a)}return this.logger.debug("AdService","refresh ad slots",s),this.adPipeline.run(s,t,o,this.requestAdsCalls)}refreshBucket(e,t,o){var s;if(!((s=t.buckets)!=null&&s.enabled))return Promise.resolve();let n=t.slots.filter(this.isManualSlot).filter(a=>a.behaviour.bucket===e);return this.logger.debug("AdService","refresh ad buckets",n,t.targeting),this.adPipeline.run(n,t,o,this.requestAdsCalls,e)}};var Re={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var Ce=(i,e,t,o=r=>!0)=>[{source:"queryParam",value:ye(i.location.search).get(e)},{source:"sessionStorage",value:ce(t,i.sessionStorage)},{source:"localStorage",value:ce(t,i.localStorage)}].map(({source:r,value:n})=>n&&o(n)?{source:r,value:n}:void 0).filter(V);var Cr=i=>!!["production","test"].find(t=>t===i),pi=i=>Ce(i,Re.moliEnv,Z.moliEnv,Cr)[0]||void 0,ci=(i,e)=>Pe(Z.moliEnv,i,e);var mt={version:"5.0.0-alpha.17"};var gi=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href===e;case"path":try{let o=new URL(e);return t.pathname===o.pathname}catch(o){return!0}}},mi=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href!==e;case"path":try{let o=new URL(e);return t.pathname!==o.pathname}catch(o){return!0}}};var fi=i=>{let e=xe(i),t=new $e(e,i),o=i,r={state:"configurable",initialize:!1,runtimeConfig:ee(),modules:[]};function n(g,I){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.keyValues[g]=I;break}case"spa-finished":case"spa-requestAds":{r.nextRuntimeConfig.keyValues[g]=I;break}default:{k(r.runtimeConfig,i).error("MoliGlobal",`Setting key-value after configuration: ${g} : ${I}`);break}}}function s(g){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.labels.push(g);break}case"spa-requestAds":case"spa-finished":{r.nextRuntimeConfig.labels.push(g);break}default:{k(r.runtimeConfig,i).error("MoliGlobal",`Adding label after configure: ${g}`);break}}}function a(g){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.adUnitPathVariables=g;break}case"spa-requestAds":case"spa-finished":{r.nextRuntimeConfig.adUnitPathVariables=g;break}default:{k(r.runtimeConfig,i).error("MoliGlobal",`Setting unit path variables after configuration: ${g}`);break}}}function l(){let g=Ae(i.location.hostname)||"unknown";switch(r.state){case"configurable":return E(b({},r.runtimeConfig.adUnitPathVariables),{domain:g,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let I=new be(r.config.labelSizeConfig||[],[],i);return E(b({},h().adUnitPathVariables),{domain:r.config.domain||g,device:I.getDeviceLabel()})}}function d(g,I){let P=(I||{}).removeNetworkChildId||!1,x=$(g,l());return P?Be(x):x}function u(g){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.logger=g;break}default:{g.error("Setting a custom logger is not allowed after configuration");break}}}function c(g){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.hooks.beforeRequestAds.push(g);break}default:{k(r.runtimeConfig,i).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",r.config);break}}}function m(g){switch(r.state){case"configurable":case"configured":{r.runtimeConfig.hooks.afterRequestAds.push(g);break}default:{k(r.runtimeConfig,i).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",r.config);break}}}function p(){switch(r.state){case"configurable":return null;case"configured":return r.config;case"requestAds":return r.config;case"spa-requestAds":case"spa-finished":return r.config;case"finished":return r.config;case"error":return r.config}}function f(){return r.runtimeConfig}function h(){var g,I,M,P,x,B,v;return{keyValues:b(b({},(I=(g=r.config)==null?void 0:g.targeting)==null?void 0:I.keyValues),r.runtimeConfig.keyValues),labels:[...(x=(P=(M=r.config)==null?void 0:M.targeting)==null?void 0:P.labels)!=null?x:[],...r.runtimeConfig.labels],adUnitPathVariables:b(b({},(v=(B=r.config)==null?void 0:B.targeting)==null?void 0:v.adUnitPathVariables),r.runtimeConfig.adUnitPathVariables)}}function S(g){switch(r.state){case"configurable":case"configured":{r.modules.push(g),r.runtimeConfig.adPipelineConfig.initSteps.push(...g.initSteps()),r.runtimeConfig.adPipelineConfig.configureSteps.push(...g.configureSteps()),r.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...g.prepareRequestAdsSteps());return}default:k(r.runtimeConfig,i).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function y(g){switch(r.state){case"configurable":{let I=r.initialize,M=pi(i),P=r.modules;return M&&(r.runtimeConfig.environment=M.value),(M==null?void 0:M.source)==="queryParam"&&ci(M.value,i.sessionStorage),r={state:"configured",config:g,runtimeConfig:r.runtimeConfig,modules:P},I||g.requestAds===!0?R():Promise.resolve(r)}case"configured":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",r.config),Promise.resolve(r);case"requestAds":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(r);case"finished":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(r);case"error":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",r.error),Promise.resolve(r)}return Promise.resolve(null)}function R(){var g,I;switch(r.state){case"configurable":return r.initialize=!0,Promise.resolve(r);case"configured":{me(),G(r.config.domain);let{refreshInfiniteSlots:M}=r.runtimeConfig,P=r.config;M.length>0&&M.forEach(T=>{P=qe(P,T.idOfConfiguredSlot,T.artificialDomId,k(r.runtimeConfig,i))});let x=r.modules,B=k(r.runtimeConfig,i);B.debug("MoliGlobal","configure modules",(g=P.modules)!=null?g:{}),x.forEach(T=>{var U;try{T.configure((U=P.modules)!=null?U:{}),B.debug("MoliGlobal",`configure ${T.moduleType} module ${T.name}`,T.config())}catch(Q){B.error("MoliGlobal",`failed to configure ${T.moduleType} module ${T.name}`,Q)}}),r.runtimeConfig.hooks&&r.runtimeConfig.hooks.beforeRequestAds&&r.runtimeConfig.hooks.beforeRequestAds.forEach(T=>{try{T(P,r.runtimeConfig)}catch(U){B.error("MoliGlobal","beforeRequestAds hook failed",U)}});let v=r.runtimeConfig.hooks.afterRequestAds;if(((I=P.spa)==null?void 0:I.enabled)===!0){let T=r.runtimeConfig,U=t.initialize(P,T);return r={state:"spa-requestAds",config:P,initialized:U,modules:x,href:i.location.href,runtimeConfig:Object.freeze(ee(r.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:ee(r.runtimeConfig)},U.then(()=>t.requestAds(P,T)).then(()=>{if(r.state==="spa-requestAds"&&r.href===i.location.href){t.refreshAdSlots(r.runtimeConfig.refreshSlots,r.config,r.runtimeConfig),v.forEach(fe=>fe("spa-finished"));let Q=E(b({},r),{state:"spa-finished",nextRuntimeConfig:ee(r.runtimeConfig),runtimeConfig:ee(r.runtimeConfig,{keepTargeting:!0})});return r=Q,Q}else return r.state==="spa-finished"||r.state==="spa-requestAds"?(k(r.runtimeConfig,i).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),r):Promise.reject(`reached invalid state [${r.state}]`)})}else return r={state:"requestAds",config:P,modules:x,runtimeConfig:Object.freeze(r.runtimeConfig)},t.initialize(P,r.runtimeConfig).then(T=>t.requestAds(T,r.runtimeConfig)).then(()=>(r={state:"finished",config:P,runtimeConfig:r.runtimeConfig,modules:x},v.forEach(T=>T("finished")),Promise.resolve(r))).catch(T=>(k(r.runtimeConfig,i).error("MoliGlobal",T),r={state:"error",config:P,runtimeConfig:r.runtimeConfig,error:T,modules:x},v.forEach(U=>U("error")),Promise.resolve(r)))}case"spa-requestAds":case"spa-finished":{r.state==="spa-requestAds"&&k(r.runtimeConfig,i).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),me(),G(r.config.domain);let{modules:M}=r,P=r.nextRuntimeConfig.hooks.afterRequestAds,x=r.nextRuntimeConfig.hooks.beforeRequestAds,B=r,{initialized:v,href:ne,nextRuntimeConfig:T}=r;return r=E(b({},B),{state:"spa-requestAds",runtimeConfig:ee(r.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:ee(r.runtimeConfig)}),v.then(U=>{var fe,Me;let Q=(Me=(fe=U.spa)==null?void 0:fe.validateLocation)!=null?Me:"href";return mi(Q,ne,i.location)?(x.forEach(H=>{try{H(U,r.runtimeConfig)}catch(ct){k(r.runtimeConfig,i).error("MoliGlobal","beforeRequestAds hook failed",ct)}}),t.requestAds(U,T).then(()=>U)):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${Q} for validation.`)}).then(U=>(t.refreshAdSlots(r.runtimeConfig.refreshSlots,U,r.runtimeConfig),r={state:"spa-finished",config:U,initialized:v,modules:M,href:i.location.href,runtimeConfig:r.runtimeConfig,nextRuntimeConfig:ee(r.runtimeConfig)},P.forEach(Q=>Q("spa-finished")),r))}case"requestAds":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return k(r.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",r.error),Promise.reject()}}function O(g,I){var P,x;let M=typeof g=="string"?[g]:g;switch(r.state){case"configurable":case"configured":return r.runtimeConfig.refreshSlots.push(...M),Promise.resolve("queued");case"spa-requestAds":return r.runtimeConfig.refreshSlots.push(...M),Promise.resolve("queued");case"spa-finished":let B=(x=(P=r.config.spa)==null?void 0:P.validateLocation)!=null?x:"href";return gi(B,r.href,i.location)?t.refreshAdSlots(M,r.config,r.runtimeConfig,I).then(()=>"refreshed"):(r.nextRuntimeConfig.refreshSlots.push(...M),Promise.resolve("queued"));case"finished":case"requestAds":return t.refreshAdSlots(M,r.config,r.runtimeConfig,I).then(()=>"refreshed");default:return k(r.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${r.state}`,r.config),Promise.reject(`not allowed in state ${r.state}`)}}function w(g,I){switch(r.state){case"configurable":case"configured":return r.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:I}),Promise.resolve("queued");case"spa-requestAds":return r.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:I}),Promise.resolve("queued");case"spa-finished":return r.href===i.location.href?(r=E(b({},r),{config:qe(r.config,I,g,k(r.runtimeConfig,i))}),t.refreshAdSlots([g],r.config,r.runtimeConfig).then(()=>"refreshed")):(r.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:g,idOfConfiguredSlot:I}),Promise.resolve("queued"));case"finished":case"requestAds":return r=E(b({},r),{config:qe(r.config,I,g,k(r.runtimeConfig,i))}),t.refreshAdSlots([g],r.config,r.runtimeConfig).then(()=>"refreshed");default:return k(r.runtimeConfig,i).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${r.state}`,r.config),Promise.reject(`not allowed in state ${r.state}`)}}function K(g){var M;function I(P){let x=P.slots.filter(B=>B.behaviour.bucket===g);return x==null?void 0:x.map(B=>B.domId)}switch(r.state){case"configurable":{let P=(M=o.moli.getConfig())==null?void 0:M.slots.filter(B=>B.behaviour.bucket===g),x=P==null?void 0:P.map(B=>B.domId);return x!=null&&x.length?(r.runtimeConfig.refreshSlots.push(...x),Promise.resolve("queued")):Promise.reject("no configurable domIds for buckets")}case"configured":{let P=I(r.config);return r.runtimeConfig.refreshSlots.push(...P),Promise.resolve("queued")}case"spa-requestAds":{let P=I(r.config);return r.runtimeConfig.refreshSlots.push(...P),Promise.resolve("queued")}case"spa-finished":{if(r.href===i.location.href)return t.refreshBucket(g,r.config,r.runtimeConfig).then(()=>"refreshed");{let P=I(r.config);return r.runtimeConfig.refreshSlots.push(...P),Promise.resolve("queued")}}case"finished":case"requestAds":return t.refreshBucket(g,r.config,r.runtimeConfig).then(()=>"refreshed");default:return k(r.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${r.state}`,r.config),Promise.reject(`not allowed in state ${r.state}`)}}function J(){return r.state}function X(){return r.modules}function oe(g){switch(r.state){case"configurable":break;default:e.loadScript({assetUrl:g!=null?g:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${mt.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(I=>console.error("failed to load moli debugger",I))}}function me(){let g="ABtest",M=ye(i.location.search).get(g),P=M?Number(M):Math.floor(Math.random()*100)+1;n(g,P.toString())}function G(g){let I=g||Ae(i.location.hostname);I&&s(I)}function pt(){return e}function ee(g,I){var M,P,x,B,v,ne,T;return{environment:(M=g==null?void 0:g.environment)!=null?M:"production",hooks:{beforeRequestAds:(P=g==null?void 0:g.hooks.beforeRequestAds)!=null?P:[],afterRequestAds:(x=g==null?void 0:g.hooks.afterRequestAds)!=null?x:[]},logger:(B=g==null?void 0:g.logger)!=null?B:void 0,adUnitPathVariables:(I==null?void 0:I.keepTargeting)===!0?(v=g==null?void 0:g.adUnitPathVariables)!=null?v:{}:{},labels:(I==null?void 0:I.keepTargeting)===!0?(ne=g==null?void 0:g.labels)!=null?ne:[]:[],keyValues:(I==null?void 0:I.keepTargeting)===!0?(T=g==null?void 0:g.keyValues)!=null?T:{}:{},refreshSlots:[],refreshInfiniteSlots:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[]}}}return{que:{push(g){g(o.moli)}},version:mt.version,setTargeting:n,addLabel:s,setLogger:u,setAdUnitPathVariables:a,resolveAdUnitPath:d,beforeRequestAds:c,afterRequestAds:m,getConfig:p,getRuntimeConfig:f,getPageTargeting:h,registerModule:S,configure:y,requestAds:R,refreshAdSlot:O,refreshBucket:K,refreshInfiniteAdSlot:w,getModuleMeta:X,getState:J,openConsole:oe,getAssetLoaderService:pt}};var yi=i=>{let e=i,t=e.moli?[...e.moli.que]:[],o=fi(i);return e.moli=o,t.forEach(r=>r(o)),o};yi(window);var wr=i=>i==="android"?"aaid":i==="ios"?"idfa":void 0,bi=(i,e,t,o,r,n,s,a)=>{let l=wr(typeof r=="string"?r:r[0]),d=o.reduce((m,p)=>b(b({},m),p),{}),u=o.length?`&kv=${JSON.stringify(d)}`:"",c=a?`&gdpr_consent=${a}`:"";n(`https://api.theadex.com/collector/v1/ifa/c/${i}/t/${e}/request?&ifa=${t}&ifa_type=${l}${u}${c}`).catch(m=>s.error(m))};var hi=(i,e,t)=>{let o=i[e.key],r=ft(i,e.valueType,e.valueKey);if(!o||Array.isArray(o)||r===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(r)&&e.defaultValue===void 0){t.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,o,r);return}let n=Ai(r,e,t);return{[e.attribute]:{[o]:n}}},Si=(i,e,t)=>{let o=ft(i,e.adexValueType,e.key);if(o===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(o)&&e.defaultValue===void 0||Array.isArray(o))){t.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,o);return}let r=Ai(o,e,t);return{[e.attribute]:r}},vi=(i,e,t)=>{let o=ft(i,"string",e.key);if(o===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof o=="number"){t.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,o);return}let r=Tr(o,e,t);return{[e.attribute]:r}},Ii=i=>Object.fromEntries(i.sort().map(e=>[e,1])),Mr=i=>i.sort().join(","),ft=(i,e,t)=>e==="number"?Number(i[t]):i[t],Ai=(i,e,t)=>i!==void 0&&!Number.isNaN(i)?Array.isArray(i)?Mr(i):i:Pi(e,t),Tr=(i,e,t)=>i===void 0?Pi(e,t):Array.isArray(i)?Ii(i):{[i]:1},Pi=(i,e)=>(e.warn("Adex DMP","using defaultValue",i.defaultValue,"as fallback for key",i.key),i.adexValueType==="list"?i.defaultValue?Ii(i.defaultValue):void 0:i.defaultValue);var re=A.responses.TCPurpose,Fe=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[re.STORE_INFORMATION_ON_DEVICE,re.SELECT_BASIC_ADS,re.CREATE_PERSONALISED_ADS_PROFILE,re.SELECT_PERSONALISED_ADS,re.CREATE_PERSONALISED_CONTENT_PROFILE,re.SELECT_PERSONALISED_CONTENT,re.MEASURE_AD_PERFORMANCE,re.MEASURE_CONTENT_PERFORMANCE,re.APPLY_MARKET_RESEARCH,re.DEVELOP_IMPROVE_PRODUCTS].every(t=>e.purpose.consents[t]);this.getAdexKeyValues=(e,t)=>{var r;let o=(r=e.config.targeting)==null?void 0:r.keyValues;if(o)return t.mappingDefinitions.map(n=>{switch(n.adexValueType){case"map":return hi(o,n,e.logger);case"list":return vi(o,n,e.logger);default:return Si(o,n,e.logger)}}).filter(V)};this.configureAdexC=(e,t)=>{var o;if(e.config.targeting){let r=this.getAdexKeyValues(e,t);r&&((o=e.window._adexc)==null||o.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"ut","_kv",[r.reduce((n,s)=>b(b({},n),s),{}),t.spaMode?1:0]]))}else return e.logger.warn("Adex DMP","targeting key/values are empty"),Promise.resolve()}}config(){return this.adexConfig}configure(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}initSteps(){let e=this.adexConfig;return e?[q("DMP module setup",t=>this.track(t,e))]:[]}configureSteps(){let e=this.adexConfig;return e!=null&&e.spaMode?[_("DMP module setup",t=>(this.configureAdexC(t,e),Promise.resolve()))]:[]}track(e,t){var u,c;let{adexCustomerId:o,adexTagId:r,mappingDefinitions:n,spaMode:s,appConfig:a}=t;this.configureAdexC(e,t);let l=this.getAdexKeyValues(e,t),d=(u=e.config.targeting)==null?void 0:u.keyValues;if(this.hasRequiredConsent(e.tcData)&&!this.isLoaded&&d){this.isLoaded=!0;let m=V(a)&&V(d[a.advertiserIdKey])&&(d[a.clientTypeKey]==="android"||d[a.clientTypeKey]==="ios");if(a!=null&&a.advertiserIdKey&&m){let p=e.tcData.gdprApplies?e.tcData.tcString:void 0,f=d[a.advertiserIdKey];typeof f=="string"&&l&&bi(o,a.adexMobileTagId?a.adexMobileTagId:r,f,l,(c=d[a.clientTypeKey])!=null?c:"",e.window.fetch,e.logger,p)}else e.assetLoaderService.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${o}/${r}/s/adex.js`,loadMethod:1}).catch(p=>e.logger.error("failed to load adex",p))}return Promise.resolve()}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new Fe);var ve=class ve{constructor(e,t,o,r,n,s,a){this.userActivityService=e;this.refreshInterval=t;this.refreshIntervalOverrides=o;this.useIntersectionObserver=r;this.disableAdVisibilityChecks=n;this.window=s;this.logger=a;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId())};this.handleGoogletagAdVisibilityChanged=e=>{var r;let t=e.slot,o=this.visibilityRecordForGoogletagEvent(e);o&&((r=this.logger)==null||r.debug("AdVisibilityService",`Visibility of slot ${t.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(o,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,t)=>{var o,r,n;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(o=this.logger)==null||o.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}t>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(r=this.logger)==null||r.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var l;this.minimalAdVisibilityRatio=n?0:.5,this.visibilityRecords=new Map,r&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new IntersectionObserver(d=>this.handleObservedAdVisibilityChanged(d),{threshold:this.minimalAdVisibilityRatio})),r||this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged),this.userActivityService.addUserActivityChangedListener(d=>this.handleUserActivityChanged(d)),this.setUpdateTimer(!0),(l=this.logger)==null||l.debug("AdVisibilityService","initialized")}trackSlot(e,t){var n;let o=e.getSlotElementId(),r=this.window.document.getElementById(o);r&&((n=this.logger)==null||n.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(o)&&this.removeSlotTracking(e),this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:t}),this.intersectionObserver&&this.intersectionObserver.observe(r))}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),ve.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var t;if(e.latestStartVisible){let o=this.window.performance.now(),r=Math.round(o-e.latestStartVisible);e.durationVisibleSum+=r,e.latestStartVisible=o,(t=this.logger)==null||t.debug("AdVisibilityService",`added ${r}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let t=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>t}).forEach(e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-ve.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(t=>{var r;let o=this.visibilityRecordForEntry(t);o&&((r=this.logger)==null||r.debug("AdVisibilityService",`Visibility of slot ${o.slot.getSlotElementId()} changed. Visible area: ${t.intersectionRatio*100}%`),this.updateVisibilityRecord(o,t.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(t=>{t.latestStartVisible&&(t.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}};ve.updateVisibilityInterval=1e3,ve.consecutiveDurationToRefresh=1500;var We=ve;var Er=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Ie=class Ie{constructor(e,t={level:"strict"},o){this.window=e;this.userActivityLevelControl=t;this.logger=o;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var r;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(r=this.logger)==null||r.debug("UserActivityService","initialized"),t.level){case"custom":this.userActivityDuration=t.userActivityDuration,this.userBecomingInactiveDuration=t.userBecomingInactiveDuration;break;default:let{userActivityDuration:n,userBecomingInactiveDuration:s}=Er.get(t.level);this.userActivityDuration=n,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Ie.observedEvents.forEach(t=>this.window.removeEventListener(t,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Ie.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Ie.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Ie.observedEvents=["mousemove","touchstart","scroll","keypress"];var Ke=Ie;var He=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,t,o,r)=>{if(e.env==="test"){e.logger.info("AdReload","disabled in environment test");return}this.initialized||(e.logger.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(t,e.window,e.logger),this.setupSlotRenderListener(t,o,r,e.window,e.logger),this.initialized=!0)};this.setupAdVisibilityService=(e,t,o)=>{this.adVisibilityService=new We(new Ke(t,e.userActivityLevelControl,o),this.refreshIntervalMs,e.refreshIntervalMsOverrides||{},!1,!!e.disableAdVisibilityChecks,t,o)};this.setupSlotRenderListener=(e,t,o,r,n)=>r.googletag.pubads().addEventListener("slotRenderEnded",s=>{var w;let{slot:a,campaignId:l,advertiserId:d,yieldGroupIds:u,isEmpty:c}=s,m=a.getSlotElementId(),p=t.indexOf(m)>-1,f=!l||e.excludeOrderIds.indexOf(l)===-1,h=!!l&&e.includeOrderIds.indexOf(l)>-1,S=!!d&&e.includeAdvertiserIds.indexOf(d)>-1,y=!!u&&e.includeYieldGroupIds.some(K=>u.indexOf(K)>-1),R=!c&&p&&f&&(h||S||y);R||this.logTrackingDisallowedReason(m,{slotIsEmpty:c,slotIsMonitored:p,orderIdNotExcluded:f,orderIdIncluded:h,advertiserIdIncluded:S,yieldGroupIdIncluded:y},n,u,l,d);let O=!!((w=this.adVisibilityService)!=null&&w.isSlotTracked(m));R?this.adVisibilityService.trackSlot(a,o):O&&this.adVisibilityService.removeSlotTracking(a)});this.reloadAdSlot=(e,t)=>o=>{let r=o.getSlotElementId(),n=t.config.slots.find(s=>s.domId===r);if(n&&n.behaviour.loaded!=="infinite"){t.logger.debug("AdReload","fired slot reload",n.domId);let s=this.maybeOptimizeSlotForCls(e,n,o,t.logger,t.window);o.setTargeting(this.reloadKeyValue,"true"),t.window.moli.refreshAdSlot(r,b({loaded:n.behaviour.loaded},s&&{sizesOverride:s}))}};this.maybeOptimizeSlotForCls=(e,t,o,r,n)=>{let s=t.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let a=n.document.getElementById(s);if(a&&a.style){let l=a.scrollHeight;a.style.setProperty("height",`${l}px`);let d=t.sizes.filter(u=>u!=="fluid"&&u[1]<=l);return r.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${l}px`,"new sizes:",d),d.length<t.sizes.filter(u=>u!=="fluid").length&&n.googletag.destroySlots([o]),d}r.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return t.sizes};this.logTrackingDisallowedReason=(e,t,o,r,n,s)=>{let{slotIsEmpty:a,slotIsMonitored:l,orderIdNotExcluded:d,orderIdIncluded:u,advertiserIdIncluded:c,yieldGroupIdIncluded:m}=t;a&&o.debug("AdReload",e,"slot not tracked: reported empty"),l||o.debug("AdReload",e,"slot not tracked: excluded by DOM id"),d||o.debug("AdReload",e,"slot not tracked: excluded by order id",n),u||c||m||o.debug("AdReload",e,"slot not tracked: neither order id",n,"nor advertiser id",s,"nor yieldGroup id",r,"included")}}config(){return this.moduleConfig}isInitialized(){return this.initialized}configure(e){var t;(t=e==null?void 0:e.adReload)!=null&&t.enabled&&(this.moduleConfig=e.adReload)}initSteps(){return[]}configureSteps(){let e=this.moduleConfig;return e?[_(this.name,t=>{let o=t.config.slots.filter(n=>e.excludeAdSlotDomIds.indexOf(n.domId)===-1).map(n=>n.domId),r=this.reloadAdSlot(e,t);return t.logger.debug("AdReload","monitoring slots",o),this.initialize(t,e,o,r),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new He);var Ye=class{constructor(){this.name="Blocklist URLs";this.description="Blocks ad requests entirely or adds key-values for blocklistd urls";this.moduleType="policy";this.blocklistConfig=null;this.isBlocklisted=(e,t,o)=>e.urls.some(({pattern:r,matchType:n})=>{switch(n){case"exact":return t===r;case"contains":return t.indexOf(r)>-1;case"regex":try{let s=RegExp(r).test(t);return s&&o.debug(this.name,`Url '${t}' matched pattern '${r}'`),s}catch(s){return o.error(this.name,`Invalid pattern ${r}`,s),!1}}});this.blocklistCache=null}config(){return this.blocklistConfig}configure(e){e!=null&&e.blocklist&&e.blocklist.enabled&&(this.blocklistConfig=e.blocklist)}initSteps(){return this.blocklistConfig?[q("blocklist-urls-init",t=>{var o;switch((o=this.blocklistConfig)==null?void 0:o.mode){case"key-value":let r=this.blocklistConfig.key,n=this.blocklistConfig.isBlocklistedValue||"true";return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{this.isBlocklisted(s,t.window.location.href,t.logger)&&t.window.googletag.pubads().setTargeting(r,n)});case"block":return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{if(t.logger.debug(this.name,"using blocklist",s),this.isBlocklisted(s,t.window.location.href,t.logger))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[]}getBlocklist(e,t,o){switch(e.provider){case"static":return()=>Promise.resolve(e.blocklist);case"dynamic":let r;return()=>(r||(r=this.loadConfigWithRetry(t,e.endpoint,3).catch(n=>(o.error(this.name,"Fetching blocklisted urls failed",n),{urls:[]}))),r)}}loadConfigWithRetry(e,t,o,r=null){return o<=0?Promise.reject(r):(this.blocklistCache||(this.blocklistCache=e.loadJson("blocklist-urls.json",t).catch(n=>new Promise(a=>setTimeout(a,100/o)).then(()=>this.loadConfigWithRetry(e,t,o-1,n)))),this.blocklistCache)}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new Ye);var Je=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(context,configs)=>{configs.forEach(config=>{"cssSelectors"in config.deleteMethod?config.deleteMethod.cssSelectors.forEach(i=>{let e=context.window.document.querySelectorAll(i);context.logger.debug("Cleanup Module",`Remove elements with selector ${i} from dom`,e),e.forEach(t=>{try{t.remove()}catch(o){context.logger.error("Cleanup Module",`Error removing element with selector ${i}`,o)}})}):config.deleteMethod.jsAsString.forEach(jsLineAsString=>{try{context.logger.debug("Cleanup Module",`Try to execute JS line string: '${jsLineAsString}'`),eval(jsLineAsString)}catch(i){context.logger.error("Cleanup Module",`Error executing JS string: '${jsLineAsString}'`,i)}})})};this.hasBidderWonLastAuction=(i,e)=>{var r;return((r=i.window.pbjs.getAllWinningBids().find(n=>n.adUnitCode===e.domId))==null?void 0:r.bidder)===e.bidder}}configure(i){i!=null&&i.cleanup&&i.cleanup.enabled&&(this.cleanupConfig=i.cleanup)}config(){return this.cleanupConfig}initSteps(){return[]}configureSteps(){let i=this.cleanupConfig;return i?[ie("destroy-out-of-page-ad-format",e=>(this.cleanUp(e,i.configs),Promise.resolve()))]:[]}prepareRequestAdsSteps(){let i=this.cleanupConfig;return i?[N("cleanup-before-ad-reload",Le,(e,t)=>{let o=i.configs.filter(r=>t.map(n=>n.moliSlot.domId).includes(r.domId)).filter(r=>this.hasBidderWonLastAuction(e,r));return this.cleanUp(e,o),Promise.resolve()})]:[]}};window.moli.registerModule(new Je);var Xe=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}config(){return this.confiantConfig}configure(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}initSteps(){let e=this.confiantConfig;return e?[q("confiant-init",t=>this.loadConfiant(t,e))]:[]}loadConfiant(e,t){var o;return e.env==="test"||e.tcData.gdprApplies&&(!e.tcData.purpose.consents[1]||!(!((o=this.confiantConfig)!=null&&o.checkGVLID)||e.tcData.vendor.consents[this.gvlid]))||e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:t.assetUrl}).catch(r=>e.logger.error("failed to load confiant",r)),Promise.resolve()}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new Xe);var xr=(i,e)=>{var o;let t=(o=i.config.targeting)==null?void 0:o.keyValues[e];return t?`&device_id=${typeof t=="string"?t:t[0]}`:""},Ri=(i,e,t,o,r)=>{let n=xr(i,e.advertiserIdKey),s=i.tcData.gdprApplies?`gdpr=1&gdpr_consent=${i.tcData.tcString}`:"gdpr=0",a=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",l=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",d="",u=b(b({},e.additionalIdentifier),t);Object.entries(u).forEach(([f,h])=>{d+=`&${f}=${encodeURIComponent(h)}`});let c="",m=b(b({},e.customKeywords),o);Object.entries(m).forEach(([f,h])=>{c+=`&${f}=${encodeURIComponent(h)}`});let p=r.createElement("img");p.src=`https://aps.xplosion.de/data?sid=${e.sid}${n}&os=${e.os}&app_id=${e.appId}${l}${a}${d}${c}&${s}`,p.width=1,p.height=1,r.body.append(p)};var kr=(i,e)=>{var o;if(e.os==="web")return;let t=(o=i.config.targeting)==null?void 0:o.keyValues[e.advertiserIdKey];if(t)return typeof t=="string"?t:t[0]},Ci=(i,e,t)=>{try{let r="moli_emetriq",n=i.getItem(r),s=n?Number.parseInt(n,10):0,a=e-864e5>s;return a&&(i.setItem(r,e.toString()),t.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),a}catch(o){return t.error("emetriq","could not access session storage",o),!1}},wi=(i,e,t,o)=>{if(!e.login){o.warn("emetriq","login configuration missing!");return}let r=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);r.searchParams.append("guid",e.login.guid),i.tcData.gdprApplies?(r.searchParams.append("gdpr","1"),r.searchParams.append("gdpr_consent",i.tcData.tcString)):r.searchParams.append("gdpr","0");let n=kr(i,e);if(n)switch(e.os){case"android":r.searchParams.append("adid",n);break;case"ios":r.searchParams.append("idfa",n);break}let s=t.createElement("img");s.src=r.href,s.width=1,s.height=1,t.body.append(s)};var Qe=class i{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}config(){return this.emetriqConfig}configure(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}initSteps(){let e=this.emetriqConfig;return e?[q("load-emetriq",t=>{var r;let o=i.staticCustomParams((r=t.config.targeting)==null?void 0:r.keyValues,e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||i.syncDelay(t,e.syncDelay).then(n=>{switch(e.os){case"web":this.loadEmetriqScript(t,e,n,o);break}}),Promise.resolve()})]:[]}configureSteps(){let e=this.emetriqConfig;return e?[ie("track-emetriq",t=>{var r;let o=i.staticCustomParams((r=t.config.targeting)==null?void 0:r.keyValues,e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||(e.login&&Ci(t.window.sessionStorage,Date.now(),t.logger)&&wi(t,e,t.window.document,t.logger),i.syncDelay(t,e.syncDelay).then(n=>{switch(e.os){case"android":case"ios":Ri(t,e,n,o,t.window.document);break}})),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}checkIfConsentIsMissing(e){return e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid]?(e.logger.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,t,o,r){let n=e.window;return n._enqAdpParam=b(b(b({},t._enqAdpParam),o),r),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${t._enqAdpParam.sid}/default.js`}).catch(s=>e.logger.error("failed to load emetriq",s))}static syncDelay(e,t){return t?typeof t=="number"?new Promise(o=>e.window.setTimeout(()=>o({}),t)):e.window.pbjs?new Promise(o=>{e.window.pbjs.que.push(()=>{let r=()=>{o(i.prebidIdentifiers(e)),e.window.pbjs.offEvent("auctionEnd",r)};e.window.pbjs.onEvent("auctionEnd",r)})}):(e.logger.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,t){let o=e!=null?e:{},r={};return(t!=null?t:[]).forEach(({param:n,key:s})=>{let a=o[s];a&&(r[n]=typeof a=="string"?a:a.join(","))}),r}static prebidIdentifiers(e){let t={},o=e.window.pbjs.getUserIds();return o.amxId&&(t.id_amxid=o.amxId),o.idl_env&&(t.id_liveramp=o.idl_env),o.IDP&&(t.id_zeotap=o.IDP),o.pubcid&&(t.id_sharedid=o.pubcid),o.id5id&&(t.id_id5=o.id5id.uid),t}};window.moli.registerModule(new Qe);var Ze=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}config(){return this.identityLinkConfig}configure(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}initSteps(){let e=this.identityLinkConfig;return e?[q(this.name,t=>(this.loadAts(t,e),Promise.resolve()))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}loadAts(e,t){if(e.env==="test"||e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid])return Promise.resolve();let o=e.window;return o.addEventListener("envelopeModuleReady",()=>{o.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:t.hashedEmailAddresses})}),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${t.launchPadId}/launchpad-liveramp.js`}).catch(r=>e.logger.error("failed to load emetriq",r))}};window.moli.registerModule(new Ze);var Mi=i=>{let e=i.filter(o=>o.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:o=>{let r=o.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:r?e.find(s=>s.domId===r):e[0],configSlotDomId:r}}}};var et=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,t)=>{var d;if(this.initialized)return;this.initialized=!0,(d=e.logger)==null||d.debug(this.name,"initialize moli lazy load module");let o=t.slots,r=t.buckets,n=t.infiniteSlots,s=e.window;o.forEach(u=>{let c=new s.IntersectionObserver(m=>{var p;(p=e.logger)==null||p.debug(this.name,"lazy-load slots called with",m),m.forEach(f=>{var h;f.isIntersecting&&((h=e.logger)==null||h.debug(this.name,`Trigger ad slot with DOM ID ${f.target.id}`),s.moli.refreshAdSlot(f.target.id),c.unobserve(f.target))})},{root:u.options.rootId?s.document.getElementById(u.options.rootId):null,threshold:u.options.threshold,rootMargin:u.options.rootMargin});this.observers.push(c),u.domIds.forEach(m=>{var f,h;let p=e.config.slots.find(S=>S.domId===m);if(!p)(f=e.logger)==null||f.warn(this.name,`Lazy-load non-existing slot with domID ${m}`);else if(p.behaviour.loaded!=="manual")(h=e.logger)==null||h.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${m}`);else if(p.behaviour.loaded==="manual"){let S=s.document.querySelector(`#${m}`);S&&c.observe(S)}})}),r.forEach(u=>{var m,p,f,h;let c=new s.IntersectionObserver(S=>{S.forEach(y=>{var R,O,w;if(y.isIntersecting&&y.target.id===u.observedDomId)if(((R=e.config.slots.find(J=>J.domId===u.observedDomId))==null?void 0:R.behaviour.bucket)!==u.bucket)(O=e.logger)==null||O.warn(this.name,`${u.observedDomId} doesn't belong to ${u.bucket}`);else{let J=e.config.slots.filter(X=>X.behaviour.bucket===u.bucket).map(X=>X.domId);(w=e.logger)==null||w.debug(`Refresh ${u.bucket}`,`Trigger ad slots with DOM IDs [${J.join(", ")}]`),s.moli.refreshBucket(u.bucket),c.unobserve(y.target)}})},{root:u.options.rootId?s.document.getElementById(u.options.rootId):null,threshold:u.options.threshold,rootMargin:u.options.rootMargin});if(this.observers.push(c),(m=e.config.buckets)!=null&&m.enabled||(p=e.logger)==null||p.warn(this.name,"GlobalBucket config isn't enabled"),!((f=e.config.buckets)!=null&&f.bucket&&e.config.buckets.bucket[u.bucket]))(h=e.logger)==null||h.error(this.name,`Lazy-load non-existing bucket with name ${u.bucket}`);else{let S=s.document.querySelector(`#${u.observedDomId}`);S&&c.observe(S)}});let{configuredInfiniteSlots:a,findSlot:l}=Mi(e.config.slots);(n||[]).forEach(u=>{var m;let c="data-h5-serial-number";if(a.length>0){let p=new s.IntersectionObserver(h=>{h.forEach(S=>{var y,R,O,w;if(S.isIntersecting){let{configuredInfiniteSlot:K,configSlotDomId:J}=l(S.target);if(K){let X=(R=(y=S.target.attributes)==null?void 0:y.getNamedItem(c))==null?void 0:R.value,oe=`${K.domId}-${X}`;S.target.setAttribute("id",oe),(O=e.logger)==null||O.debug(this.name,`Trigger ad slot with newly created DOM ID ${oe}`),s.moli.refreshInfiniteAdSlot(oe,K.domId),p.unobserve(S.target)}else(w=e.logger)==null||w.error(this.name,`No infinite-scrolling slot configured for ${J}`),p.unobserve(S.target)}})},{root:u.options.rootId?s.document.getElementById(u.options.rootId):null,threshold:u.options.threshold,rootMargin:u.options.rootMargin});this.observers.push(p),s.document.querySelectorAll(u.selector).forEach((h,S)=>{h.setAttribute(c,`${S+1}`),h&&p.observe(h)})}else(m=e.logger)==null||m.warn(this.name,"No infinite-scrolling slots configured!")})}}config(){return this.lazyloadConfig}configure(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}initSteps(){return[]}configureSteps(){let e=this.lazyloadConfig;return e?[ie("lazy-module-configuration",t=>(this.initialized=!1,this.observers.forEach(o=>o.disconnect()),this.observers.length=0,this.registerIntersectionObservers(t,e),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new et);function yt(i){return toString.call(i)==="[object Object]"}function tt(i,...e){if(!e.length)return i;let t=e.shift();if(yt(i)&&yt(t))for(let o in t)yt(t[o])?(i[o]||Object.assign(i,{[o]:{}}),tt(i[o],t[o])):Array.isArray(t[o])?i[o]?Array.isArray(i[o])&&(i[o]=i[o].concat(t[o])):Object.assign(i,{[o]:t[o]}):Object.assign(i,{[o]:t[o]});return tt(i,...e)}var it=class i{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}config(){return this.moduleConfig}configure(e){var t;if((t=e==null?void 0:e.prebidFirstPartyData)!=null&&t.enabled){let o=e.prebidFirstPartyData;this._configureSteps=[_("prebid-fpd-module-configure",r=>i.setPrebidFpdConfig(r,o,r.logger))]}}initSteps(){return[]}configureSteps(){return this._configureSteps}prepareRequestAdsSteps(){return[]}static setPrebidFpdConfig(e,t,o){var r,n,s,a,l,d,u,c,m;if(e.config.prebid){let p=((r=e.config.targeting)==null?void 0:r.keyValues)||{},f=t.gptTargetingMappings,h=e.window.pbjs.readConfig().ortb2||{},S=tt({},t.staticPrebidFirstPartyData,h);if(f){let y=b({cat:[],sectioncat:[],pagecat:[]},S.site);if(f.cat){let R=i.extractKeyValueArray(f.cat,p);(n=y.cat)==null||n.push(...R),(s=y.pagecat)==null||s.push(...R),(a=y.sectioncat)==null||a.push(...R)}if(f.sectionCat&&(y.sectioncat=i.extractKeyValueArray(f.sectionCat,p)),f.pageCat&&(y.pagecat=i.extractKeyValueArray(f.pageCat,p)),y.cat&&(y.cat=y.cat.filter(j)),y.sectioncat&&(y.sectioncat=y.sectioncat.filter(j)),y.pagecat&&(y.pagecat=y.pagecat.filter(j)),!t.iabDataProviderName&&(f.iabV2||f.iabV3)&&o.error("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Data Segments will not be set."),y.content=E(b({},y.content),{data:(u=(d=(l=y.content)==null?void 0:l.data)==null?void 0:d.filter(R=>R.name!==t.iabDataProviderName))!=null?u:[]}),f.iabV2&&t.iabDataProviderName){let R=i.extractKeyValueArray(f.iabV2,p),O={name:t.iabDataProviderName,ext:{segtax:6},segment:R.map(w=>({id:w})).filter(j)};(c=y.content.data)==null||c.push(O)}if(f.iabV3&&t.iabDataProviderName){let R=i.extractKeyValueArray(f.iabV3,p),O={name:t.iabDataProviderName,ext:{segtax:7},segment:R.map(w=>({id:w})).filter(j)};(m=y.content.data)==null||m.push(O)}S.site=y}e.window.pbjs.setConfig({ortb2:S})}return Promise.resolve()}static extractKeyValueArray(e,t){let o=t[e];return o?typeof o=="string"?[o]:o:[]}};window.moli.registerModule(new it);var rt=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}config(){return this.pubstackConfig}configure(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}initSteps(){let e=this.pubstackConfig;return e?[q("pubstack-init",t=>(t.env==="test"||t.assetLoaderService.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(o=>t.logger.error("failed to load pubstack",o)),Promise.resolve()))]:[]}configureSteps(){return this.pubstackConfig?[_("pubstack-configure",t=>{if(t.env==="test")return Promise.resolve();let o=["0","1","2","3"],r=t.window.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return r&&r.content&&o.includes(r.content)&&t.window.googletag.pubads().setTargeting("pbstck_ab_test",r.content),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new rt);var Ei="footer-ad-close-button",Or="[data-ref=h5-footer-ad-container]",Dr=`[data-ref=${Ei}]`,ot={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},Ti=(i,e,t,o)=>r=>{let n=r.slot,s=i.document.body.querySelector(Or),a=i.document.getElementById(e),l=()=>{n.getSlotElementId()===e&&s&&(i.googletag.destroySlots([n]),s.remove())};if(!s||!a||n.getSlotElementId()!==e||r.isEmpty||r.advertiserId&&t.includes(r.advertiserId)||i.matchMedia("(max-width: 767px)").matches){o.debug("[footer-ad]","remove footer ad container");return}if(i.document.body.querySelector(Dr))return;let d=document.createElement("button");d.classList.add(ot.footerAdClose),d.setAttribute("aria-label","Anzeige entfernen"),d.setAttribute("data-ref",Ei),a.classList.add(ot.adSlot),Array.isArray(r.size)&&r.size[1]>200&&i.matchMedia("(max-height: 800px)").matches&&a.classList.add(ot.isShiftedBottom),s.classList.add(ot.container),s.style.setProperty("display","block"),s.appendChild(d),d.addEventListener("click",()=>l())},xi=(i,e,t,o,r)=>{e==="production"?i.googletag.pubads().addEventListener("slotRenderEnded",Ti(i,o,r,t)):Ti(i,o,r,t)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>o}})};var ki="[data-ref=sticky-ad]",Oi="[data-ref=sticky-ad-close]",Li="h5-sticky-ad--visible",bt=i=>{i.style.setProperty("display","none"),i.classList.remove(Li)},Di=i=>{i.style.setProperty("display","block"),i.classList.add(Li)},qi=(i,e,t,o)=>new Promise(r=>{let n=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(i&&bt(i),r("empty")):s.advertiserId&&t.includes(s.advertiserId)?r("disallowed"):r("standard"),o.googletag.pubads().removeEventListener("slotRenderEnded",n))};o.googletag.pubads().addEventListener("slotRenderEnded",n)}),Bi=(i,e)=>new Promise(t=>{let o=r=>{r.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",o))};e.googletag.pubads().addEventListener("slotOnload",o)}),Ui=(i,e,t,o,r,n)=>{let s=i.document.querySelector(ki),a=i.document.querySelector(Oi);if(s&&a){if(t.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),n||Di(s),a.addEventListener("click",()=>{bt(s);let l=i.googletag.pubads().getSlots().find(d=>d.getSlotElementId()===o);l&&i.googletag.destroySlots([l])},{once:!0,passive:!0}),e==="production"){let l=([d])=>(t.debug("mobile-sticky-ad",`result ${d}`),d==="disallowed"?(t.debug("mobile-sticky-ad","hide mobile sticky container"),s&&bt(s),Promise.resolve()):d==="standard"?(n&&Di(s),Promise.all([qi(s,o,r,i),Bi(o,i)]).then(l)):Promise.resolve());Promise.all([qi(s,o,r,i),Bi(o,i)]).then(l)}}else t.warn("[mobile-sticky]",`Could not find adSticky container ${ki} or closeButton ${Oi}`,s,a)};var nt=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){var t;(t=e==null?void 0:e.stickyFooterAd)!=null&&t.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[N(this.name,F,(t,o)=>{var r;return e.mobileStickyDomId&&o.some(n=>{var s;return n.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&Ui(t.window,t.env,t.logger,e.mobileStickyDomId,e.disallowedAdvertiserIds,(r=e.initiallyHidden)!=null?r:!1),e.desktopFloorAdDomId&&o.some(n=>n.moliSlot.domId===e.desktopFloorAdDomId)&&xi(t.window,t.env,t.logger,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new nt);var ht="[data-ref=h5v-sticky-ad]",St="[data-ref=h5v-sticky-ad-close]",Vi=".h5v-closeButtonContent",ji="h5v-footerAd--hidden",_i=(i,e,t)=>new Promise(o=>{let r=n=>{n.slot.getSlotElementId()===i&&(n.isEmpty?o("empty"):n.advertiserId&&e.includes(n.advertiserId)?o("disallowed"):o("standard"),t.googletag.pubads().removeEventListener("slotRenderEnded",r))};t.googletag.pubads().addEventListener("slotRenderEnded",r)}),Ni=(i,e)=>new Promise(t=>{let o=r=>{r.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",o))};e.googletag.pubads().addEventListener("slotOnload",o)}),zi=i=>{i.classList.add(ji)},qr=i=>{i.classList.remove(ji)},Gi=(i,e,t,o,r,n)=>{let s="sticky-ad",a=i.document.querySelector(ht),l=i.document.querySelector(St),d=i.document.querySelector(Vi);if(a&&l){if(t.debug(s,"Running initAdSticky with defined sticky container and close button"),!d){if(n)l.textContent=n;else if(!l.querySelector("svg")){let c=i.document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","24"),c.setAttribute("height","24");let m=i.document.createElementNS("http://www.w3.org/2000/svg","path");m.classList.add(Vi),m.setAttribute("d","M7 10l5 5 5-5z"),c.appendChild(m),l.appendChild(c)}}l.addEventListener("click",()=>{zi(a),a.addEventListener("transitionend",function(){a.remove();let c=i.googletag.pubads().getSlots().find(m=>m.getSlotElementId()===o);c&&i.googletag.destroySlots([c])},{once:!0})});let u=c=>{if(t.debug(s,`result ${c}`),c==="disallowed"||c==="empty")return t.debug(s,"stickyFooter container"),zi(a),Promise.resolve();if(c==="standard"){qr(a);let m=Ni(o,i);return _i(o,r,i).then(p=>p==="empty"||p==="disallowed"?Promise.resolve(p):m.then(()=>p)).then(u)}return Promise.resolve()};if(e==="production")if(o){let c=Ni(o,i);_i(o,r,i).then(m=>m==="empty"||m==="disallowed"?Promise.resolve(m):c.then(()=>m)).then(u)}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${ht} or closeButton ${St}`,a,l);else u("standard")}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${ht} or closeButton ${St}`,a,l)};var st=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[N(this.name,F,(t,o)=>{let r=o.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.desktop),n=o.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.mobile),s=n||r;return n&&r&&t.logger.warn(this.name,"mobile and desktop sticky footer are called!"),s&&Gi(t.window,t.env,t.logger,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new st);var at=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.currentSkinAdReloadSetTimeoutId=null;this.getConfigEffect=(e,t,o,r)=>{var m;let n=(m=t.bidsReceived)==null?void 0:m.filter(p=>p.adUnitCode===e.skinAdSlotDomId),s=p=>{let f=e.formatFilter.some(h=>{switch(h.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return p.bidder===ae.AppNexusAst||p.bidder===ae.AppNexus;case"improvedigital":return p.bidder===ae.ImproveDigital;case"gumgum":return p.bidder===ae.GumGum&&(h.auid===void 0||typeof p.ad!="string"&&p.ad.auid===h.auid);case"dspx":return p.bidder===ae.DSPX;case"visx":return p.bidder===ae.Visx;case"yieldlab":return p.bidder===ae.Yieldlab;default:return!1}});return p.cpm>0&&f},a=t.adUnitCodes||[],l=le(a.filter(p=>e.blockedAdSlotDomIds.indexOf(p)>-1).map(p=>{var f;return{adSlotId:p,bids:(f=t.bidsReceived)==null?void 0:f.filter(h=>h.adUnitCode===p)}}).filter(p=>V(p.bids)).map(p=>p.bids.sort((f,h)=>h.cpm-f.cpm).slice(0,1))),d=l.reduce((p,f)=>p+f.cpm,0),u=n?n.filter(s).sort((p,f)=>f.cpm-p.cpm):[],c=u.length>0?u[0].cpm>d?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return o.debug(this.name,"nonSkinBids",l),o.debug(this.name,"skinBids",u),r&&c==="BlockSkinSlot"&&(r({skin:u[0].cpm,combinedNonSkinSlots:d},e,u[0]),this.log&&this.log.debug(this.name,"trackSkinCpmLow",l)),e.enableCpmComparison?c:u.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,t,o)=>e.configs.map(r=>({skinConfig:r,configEffect:this.getConfigEffect(r,t,o,e.trackSkinCpmLow)})).find(({configEffect:r})=>r!=="NoBlocking");this.destroyAdSlots=(e,t)=>{let o=t.googletag.pubads().getSlots().filter(r=>e.includes(r.getSlotElementId()));o.length>0&&t.googletag.destroySlots(o)};this.runSkinConfigs=(e,t,o)=>{var s,a,l;let r=this.selectConfig(e,t,o.logger),n=d=>o.window.googletag.pubads().getSlots().find(c=>c.getSlotElementId()===d);if(r){let{skinConfig:d,configEffect:u}=r;if(u==="BlockOtherSlots"){o.logger.debug("SkinModule","Skin configuration applied",d),this.destroyAdSlots(d.blockedAdSlotDomIds,o.window),d.hideBlockedSlots&&d.blockedAdSlotDomIds.forEach(this.hideAdSlot(o.logger,o.window)),d.hideSkinAdSlot&&this.hideAdSlot(o.logger,o.window)(d.skinAdSlotDomId),d.hideBlockedSlotsSelector&&o.window.document.querySelectorAll(d.hideBlockedSlotsSelector).forEach(m=>{o.logger.debug("SkinModule",`Set display:none for container with selector ${d.hideBlockedSlotsSelector}`),m.style.setProperty("display","none")});let c=(s=t.bidsReceived)==null?void 0:s.filter(m=>m.adUnitCode===d.skinAdSlotDomId).sort((m,p)=>p.cpm-m.cpm)[0];if((a=d.adReload)!=null&&a.intervalMs&&(c!=null&&c.bidder)&&d.adReload.allowed.includes(c.bidder)){let m=o.config.slots.filter(f=>f.domId===d.skinAdSlotDomId||d.blockedAdSlotDomIds.includes(f.domId)).map(f=>f.behaviour.loaded);m.every(f=>f===m[0])&&m[0]!=="infinite"?(this.currentSkinAdReloadSetTimeoutId&&clearTimeout(this.currentSkinAdReloadSetTimeoutId),this.currentSkinAdReloadSetTimeoutId=o.window.setTimeout(()=>{var f;o.window.moli.refreshAdSlot([...d.blockedAdSlotDomIds,d.skinAdSlotDomId],{loaded:m[0]}),(f=n(d.skinAdSlotDomId))==null||f.setTargeting("native-reload","true"),o.logger.info("SkinModule","Ad reload for skin and blocked slots triggered",d.skinAdSlotDomId,d.blockedAdSlotDomIds)},(l=d.adReload)==null?void 0:l.intervalMs)):o.logger.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",m)}}else d.enableCpmComparison&&(o.logger.debug("SkinModule","Skin configuration ignored because cpm was low",d),this.destroyAdSlots([d.skinAdSlotDomId],o.window))}else{let d=e.configs.filter(u=>u.destroySkinSlot).map(u=>u.skinAdSlotDomId).filter(j).filter(u=>{var c;return((c=t.adUnitCodes)==null?void 0:c.includes(u))===!1});this.destroyAdSlots(d,o.window)}};this.hideAdSlot=(e,t)=>o=>{let r=t.document.getElementById(o);try{r&&(e.debug("SkinModule",`Set display:none for ${o}`),r.style.setProperty("display","none"))}catch(n){e.error("SkinModule",`Couldn't set the the wallpaper div ${o} to display:none;`,n)}}}config(){return this.skinModuleConfig}configure(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin)}initSteps(){let e=this.skinModuleConfig;return e?[q("skin-init",t=>(t.env==="test"||t.window.pbjs.que.push(()=>{t.window.pbjs.onEvent("auctionEnd",o=>{this.runSkinConfigs(e,o,t)})}),Promise.resolve()))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new at);var dt=class{constructor(e){this.yieldConfig=e;this.emptyAdUnitPriceRulesResponse={rules:{},browser:"None"};this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);this.isEnabled=!1;this.device="mobile";this.adUnitPathVariables={}}init(e,t,o,r,n){switch(this.device=e,this.adUnitPathVariables=t,this.yieldConfig.provider){case"none":n.warn("YieldOptimizationService","Yield optimization is disabled!"),this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);break;case"static":n.warn("YieldOptimizationService","Yield optimization is static!"),this.isEnabled=!0,this.adUnitPricingRuleResponse=Promise.resolve({rules:this.yieldConfig.config.rules,browser:"None"});break;case"dynamic":this.isEnabled=!0;let s=this.yieldConfig.excludedAdUnitPaths,l=o.filter(d=>s.indexOf(d)<0).map(d=>$(d,this.adUnitPathVariables));this.adUnitPricingRuleResponse=this.loadConfigWithRetry(this.yieldConfig.configEndpoint,3,l,r).then(d=>(n.info("YieldOptimizationService",`loaded pricing rules for device ${this.device}`,d),d)).catch(d=>(n.error("YieldOptimizationService","failed to initialize service",d),this.emptyAdUnitPriceRulesResponse));break;default:this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.reject("Unknown config provider")}return Promise.resolve()}getPriceRule(e){return this.adUnitPricingRuleResponse.then(t=>t.rules[$(e,this.adUnitPathVariables)])}getBrowser(){return this.adUnitPricingRuleResponse.then(e=>e.browser||"None")}setTargeting(e,t,o){let r=$(e.getAdUnitPath(),this.adUnitPathVariables);return this.adUnitPricingRuleResponse.then(n=>{let s=n.rules[r];return t==="gam"&&(s?(o.debug("YieldOptimizationService",`set price rule id ${s.priceRuleId} for ${r}. Main traffic share ${s.main}. cpm is ${s.floorprice}`),e.setTargeting("upr_id",s.priceRuleId.toFixed(0)),e.setTargeting("upr_model",s.model||"static"),s.main&&e.setTargeting("upr_main","true")):this.isEnabled&&o.warn("YieldOptimizationService",`No price rule found for ${r}`)),s})}loadConfigWithRetry(e,t,o,r,n=null){return t<=0?Promise.reject(n):r(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:this.device,key:"adUnitPath",adUnitPaths:o})}).then(s=>s.ok?s.json():s.text().then(a=>Promise.reject(`${s.statusText}: ${a}`))).then(s=>typeof s!="object"?Promise.reject("response is not an object"):s===null?Promise.reject("response is null"):this.isAdunitPricesRulesResponse(s)?this.validateRules(s.rules)?s:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(s=>new Promise(l=>setTimeout(l,100/t)).then(()=>this.loadConfigWithRetry(e,t-1,o,r,s)))}isAdunitPricesRulesResponse(e){return e.hasOwnProperty("rules")}isPriceRules(e){return typeof e=="object"&&e!==null}validateRules(e){return this.isPriceRules(e)?Object.keys(e).every(t=>{let o=e[t];return typeof o=="object"&&o!==null&&typeof o.main=="boolean"&&typeof o.floorprice=="number"&&typeof o.priceRuleId=="number"}):!1}};var lt=class{constructor(){this.name="YieldOptimization";this.description="Provides floors and UPR ids";this.moduleType="yield";this.yieldModuleConfig=null;this._initSteps=[];this._prepareRequestAdsSteps=[];this.yieldOptimizationInit=e=>q("yield-optimization-init",t=>{let o=t.config.slots.filter(r=>t.labelConfigService.filterSlot(r)).map(r=>r.adUnitPath).filter(j);return e.init(t.labelConfigService.getDeviceLabel(),t.adUnitPathVariables,o,t.window.fetch,t.logger)});this.yieldOptimizationPrepareRequestAds=e=>N("yield-optimization",Le,(t,o)=>{t.logger.debug("YieldOptimizationService",t.requestId,"applying price rules");let r=t.config.adServer||"gam",n=o.map(s=>e.setTargeting(s.adSlot,r,t.logger).then(a=>s.priceRule=a));return Promise.all(n).then(()=>e.getBrowser()).then(s=>{t.env==="production"&&r==="gam"&&t.window.googletag.pubads().setTargeting("upr_browser",s)})})}config(){return this.yieldModuleConfig}configure(e){var t;if((t=e==null?void 0:e.yieldOptimization)!=null&&t.enabled){this.yieldModuleConfig=e.yieldOptimization;let o=new dt(e.yieldOptimization);this._initSteps.push(this.yieldOptimizationInit(o)),this._prepareRequestAdsSteps.push(this.yieldOptimizationPrepareRequestAds(o))}}initSteps(){return this._initSteps}configureSteps(){return[]}prepareRequestAdsSteps(){return this._prepareRequestAdsSteps}};window.moli.registerModule(new lt);var ut=class{constructor(){this.name="zeotap";this.description="Provides Zeotap functionality (data collection and identity plus) to Moli.";this.moduleType="identity";this.gvlid=301;this.loadScriptCount=0;this.zeotapConfig=null;this.hasConsent=e=>e.gdprApplies?e.vendor.consents[this.gvlid]&&e.purpose.consents[A.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&e.purpose.consents[A.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE]&&e.purpose.consents[A.responses.TCPurpose.SELECT_PERSONALISED_ADS]&&e.purpose.consents[A.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE]&&e.purpose.consents[A.responses.TCPurpose.SELECT_PERSONALISED_CONTENT]&&e.purpose.consents[A.responses.TCPurpose.MEASURE_AD_PERFORMANCE]&&e.purpose.consents[A.responses.TCPurpose.APPLY_MARKET_RESEARCH]&&e.purpose.consents[A.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS]:!0;this.loadScript=(e,t,o)=>{var f;let{mode:r,dataKeyValues:n,exclusionKeyValues:s,assetUrl:a,hashedEmailAddress:l,countryCode:d}=o;if(!t)return Promise.reject("Zeotap module :: no asset loader found, module not initialized yet?");if(r==="default"&&this.loadScriptCount>0)return Promise.reject("Zeotap module :: can't reload script in default mode.");let u=this.makeKeyValuesMap((f=e.targeting)==null?void 0:f.keyValues);if(s.some(h=>this.isExclusionKeyValueSet(h,u)))return Promise.reject("Zeotap module :: targeting exclusions prevented loading the script.");let c=n.map(h=>this.parameterFromKeyValue(h,u)).join("&"),m=!!o.hashedEmailAddress&&this.loadScriptCount===0,p=a+`&idp=${m?1:0}`+(c.length>0?`&${c}`:"")+(d?`&ctry=${d}`:"")+(l?`&z_e_sha2_l=${l}`:"");return this.loadScriptCount++,t.loadScript({name:this.name,loadMethod:1,assetUrl:p})};this.parameterFromKeyValue=(e,t)=>{let o=t.get(e.keyValueKey);return Array.isArray(o)?`${e.parameterKey}=${encodeURIComponent(o.join(","))}`:`${e.parameterKey}=${encodeURIComponent(o||"")}`};this.isExclusionKeyValueSet=(e,t)=>{let o=t.get(e.keyValueKey);return Array.isArray(o)?o.indexOf(e.disableOnValue)>-1:o===e.disableOnValue};this.makeKeyValuesMap=e=>e?new Map(Object.keys(e).map(t=>[t,e[t]]).filter(([,t])=>!!t)):new Map}config(){return this.zeotapConfig}configure(e){e!=null&&e.zeotap&&e.zeotap.enabled&&(this.zeotapConfig=e.zeotap)}initSteps(){let e=this.zeotapConfig;return e&&e.mode==="default"?[q(this.name,t=>(this.hasConsent(t.tcData)&&this.loadScript(t.config,t.assetLoaderService,e).catch(o=>t.logger.error(this.name,o)),Promise.resolve()))]:[]}configureSteps(){let e=this.zeotapConfig;return e&&e.mode==="spa"?[ie(this.name,t=>(this.loadScript(t.config,t.assetLoaderService,e).catch(o=>t.logger.error(this.name,o)),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new ut);var $i,we=($i=window.document.currentScript)!=null?$i:document.getElementById("moli-ad-tag"),Fi,vt=(Fi=Ce(window,Re.moliPubCode,Z.moliPubCode)[0])==null?void 0:Fi.value,Wi,It=(Wi=Ce(window,Re.moliVersion,Z.moliVersion)[0])==null?void 0:Wi.value,Ki,Hi,Yi;if(we){let i=vt!=null?vt:we.getAttribute("data-publisher-code"),e=(Ki=It!=null?It:we.getAttribute("data-version"))!=null?Ki:"prod",t=(Hi=we.getAttribute("data-endpoint"))!=null?Hi:"cdn.h5v.eu/publishers",o=(Yi=we.getAttribute("data-endpoint-fallback"))!=null?Yi:"cdn-fallback.h5v.eu/publishers";if(i){let r=`//${t}/${i}/${e}.json`;fetch(r).then(n=>n.json()).catch(n=>(console.error(`Failed to load configuration from ${r}. Using fallback`,n),fetch(`//${o}/${i}/${e}.json`))).then(n=>window.moli.configure(n)).catch(n=>console.error(`Failed to load configuration from ${r}:`,n))}else console.error('No publisher code provided for ad tag configuration! Add the `data-pub-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
