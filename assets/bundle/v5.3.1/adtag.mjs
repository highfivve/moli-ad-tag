/* ad tag library 5.3.1 by highfivve.com */
"use strict";(()=>{var Cr=Object.defineProperty,Rr=Object.defineProperties;var wr=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Vt=Object.prototype.hasOwnProperty,Nt=Object.prototype.propertyIsEnumerable;var zt=i=>{throw TypeError(i)};var _t=(i,e,t)=>e in i?Cr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,y=(i,e)=>{for(var t in e||(e={}))Vt.call(e,t)&&_t(i,t,e[t]);if(Le)for(var t of Le(e))Nt.call(e,t)&&_t(i,t,e[t]);return i},w=(i,e)=>Rr(i,wr(e));var jt=(i,e)=>{var t={};for(var r in i)Vt.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&Le)for(var r of Le(i))e.indexOf(r)<0&&Nt.call(i,r)&&(t[r]=i[r]);return t};var Ft=(i,e,t)=>e.has(i)||zt("Cannot "+t);var oe=(i,e,t)=>(Ft(i,e,"read from private field"),t?t.call(i):e.get(i)),ve=(i,e,t)=>e.has(i)?zt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);var Rt=(i,e,t)=>(Ft(i,e,"access private method"),t);var $t=(i,e,t)=>new Promise((r,n)=>{var o=d=>{try{a(t.next(d))}catch(u){n(u)}},s=d=>{try{a(t.throw(d))}catch(u){n(u)}},a=d=>d.done?r(d.value):Promise.resolve(d.value).then(o,s);a((t=t.apply(i,e)).next())});var Mr=i=>{let e=i.indexOf("=");if(e>=0){let t=decodeURIComponent(i.slice(0,e)),r=decodeURIComponent(i.slice(e+1));return[t,r]}else return[decodeURIComponent(i),""]},Se=i=>{try{let e=i.startsWith("?")?i.slice(1):i;return e.length>0?new Map(e.split("&").filter(t=>t.length>0).map(Mr)):new Map}catch(e){return console.error(e),new Map}};var Ue=(i,e)=>{let t=[],r,n=typeof i.document=="object"&&i.document,o=n&&n.documentElement.doScroll,s="DOMContentLoaded",a=n&&(o?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);!a&&n&&n.addEventListener(s,r=()=>{if(n)for(n.removeEventListener(s,r),a=!0;r=t.shift();)r()}),a?setTimeout(e,0):t.push(e)};var wt=class{constructor(e){this.window=e}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,t);case 1:return this.loadAssetViaTag(e,t)}})}loadJson(e,t){return this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(r=>r.ok?r.json():r.text().then(n=>Promise.reject(`${r.statusText}: ${n}`))).catch(r=>Promise.reject(r))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then(r=>r.ok?Promise.resolve(r):Promise.reject(r)).then(r=>r.text()).then(r=>this.scriptTagWithBody(r)).then(r=>t.appendChild(r))}scriptTagWithBody(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){let r=this.scriptTag(e);return new Promise((n,o)=>{r.onload=n,r.onerror=o,t.appendChild(r)})}scriptTag(e){let t=this.window.document.createElement("script");return e.type==="module"?t.type="module":e.type==="nomodule"?(t.type="text/javascript",t.setAttribute("nomodule","")):e.assetUrl.endsWith("mjs")?t.type="module":t.type="text/javascript",t.async=!0,t.src=e.assetUrl,t}awaitDomReady(){return new Promise(e=>{Ue(this.window,e)})}},_e=i=>new wt(i);function Er(i){try{let e="moliDebug";return!!Se(i.location.search).get(e)||!!i.sessionStorage.getItem(e)||!!i.localStorage.getItem(e)}catch(e){return!1}}function Tr(){let i=()=>{};return{debug:i,info:i,warn:i,error:console.error}}function Y(i){return`background:${i}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function Ve(i){switch(i){case"debug":return Y("#49A0CC");case"info":return Y("#61A172");case"warn":return Y("#FFC300");case"error":return Y("#C70039")}}function Ne(i){switch(i){case"AdPipeline":return Y("#74ABC6");case"GAM":return Y("#BA0E5F");case"MoliGlobal":return Y("#403073");case"Prebid":return Y("#4357AD");case"AdVisibilityService":return Y("#d5ba3c");case"UserActivityService":return Y("#19ad0e");case"Adex DMP":return Y("#003E74");default:return Y("#052E53")}}function ne(){return{debug(i,e,...t){console.debug(`%c[DEBUG]%c${i}%c${e}`,Ve("debug"),Ne(i),"",...t)},info(i,e,...t){console.info(`%c[INFO]%c${i}%c${e}`,Ve("info"),Ne(i),"",...t)},warn(i,e,...t){console.warn(`%c[WARN]%c${i}%c${e}`,Ve("warn"),Ne(i),"",...t)},error(i,e,...t){console.error(`%c[ERROR]%c${i}%c${e}`,Ve("error"),Ne(i),"",...t)}}}function k(i,e){return Er(e)?ne():i&&i.logger?i.logger:Tr()}var ze=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}};var je=(i,e,t,r)=>{let n=i.slots.find(o=>o.domId===e);if(n){let o=w(y({},n),{domId:t});return w(y({},i),{slots:[...i.slots,o]})}else return r.error("MoliGlobal","no infinite ad slot configured!",i),i};function ce(i){return i.reduce((e,t)=>e.concat(t),[])}function j(i,e,t){return t.indexOf(i)===e}function U(i){return i!=null}var me=class{constructor(e,t,r){this.labelSizeConfig=e;this.extraLabels=t;this.window=r;this.possibleDevices=["mobile","desktop","android","ios"];let n=t.some(a=>this.possibleDevices.indexOf(a)>-1),o=e.filter(a=>r.matchMedia(a.mediaQuery).matches);this.isValid=e.length===0||!(e.length>0&&o.length===0);let s=ce(o.map(a=>a.labelsSupported));this.supportedLabels=[...n?[]:s,...t].filter(j)}filterSlot(e){var r,n;let t=!0;return this.supportedLabels.length&&((r=e.labelAll)!=null&&r.length)&&(t=e.labelAll.every(o=>this.supportedLabels.indexOf(o)>-1)),this.supportedLabels.length&&e.labelAny&&!((n=e.labelAll)!=null&&n.length)&&(t=e.labelAny.some(o=>this.supportedLabels.indexOf(o)>-1)),t}getSupportedLabels(){return this.supportedLabels}getDeviceLabel(){return this.getSupportedLabels().find(e=>this.possibleDevices.indexOf(e)>-1)||"mobile"}},Mt=(i,e,t,r)=>new me(t!=null?t:[],[...(r==null?void 0:r.labels)||[],...e.labels],i).getDeviceLabel();var I;(t=>{let i;(o=>{let r;(h=>(h[h.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",h[h.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",h[h.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",h[h.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",h[h.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",h[h.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",h[h.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",h[h.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",h[h.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",h[h.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",h[h.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(r=o.TCPurpose||(o.TCPurpose={}));let n;(u=>(u[u.NOT_ALLOWED=0]="NOT_ALLOWED",u[u.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",u[u.REQUIRE_LI=2]="REQUIRE_LI"))(n=o.RestrictionType||(o.RestrictionType={}))})(i=t.responses||(t.responses={}));let e;(s=>{let r;(l=>(l.VISIBLE="visible",l.HIDDEN="hidden",l.DISABLED="disabled"))(r=s.DisplayStatus||(s.DisplayStatus={}));let n;(p=>(p.STUB="stub",p.LOADING="loading",p.LOADED="loaded",p.ERROR="error"))(n=s.CmpStatus||(s.CmpStatus={}));let o;(l=>(l.TC_LOADED="tcloaded",l.CMP_UI_SHOWN="cmpuishown",l.USER_ACTION_COMPLETE="useractioncomplete"))(o=s.EventStatus||(s.EventStatus={}))})(e=t.status||(t.status={}))})(I||(I={}));var kr=I.status.EventStatus,xr=I.status.CmpStatus,Or=[I.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,I.responses.TCPurpose.SELECT_BASIC_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,I.responses.TCPurpose.MEASURE_AD_PERFORMANCE,I.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,I.responses.TCPurpose.APPLY_MARKET_RESEARCH,I.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],Dr=i=>!!i.gdprApplies&&Or.some(e=>!i.purpose.consents[e]&&i.purpose.legitimateInterests[e]),Gt=(i,e,t,r)=>(r==="test"&&t.info("gdprApplies is set to false in test mode!"),r==="test"||i.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:kr.TC_LOADED,cmpStatus:xr.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((n,o)=>{if(e.__tcfapi){let s=a=>{a.cmpStatus==="error"?o(a):(a.eventStatus==="useractioncomplete"||a.eventStatus==="tcloaded")&&(t.debug("Consent","consent ready",a),i.disableLegitimateInterest&&Dr(a)?o("user consent is missing for some purposes"):n(a),a.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},a.listenerId))};e.__tcfapi("addEventListener",2,s)}else o("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var Ee=i=>{if(i){let[e,t,r]=i.split(".").reverse();switch(`${t}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${r}.${t}.${e}`;default:return t?`${t}.${e}`:e}}else return};var Fe=i=>{let[e,t,...r]=i.split("/"),[n,...o]=t.split(",");return o.length===0?i:["",n,...r].join("/")},F=(i,e)=>{let t=/[^{]+(?=})/g,r=/([A-Za-z0-9\_]+)/g,n=i.match(t);return!e||!n?i:(n.forEach(o=>{if(!o.match(r))throw new SyntaxError(`invalid variable "${o}" in path`);if(!e[o])throw new ReferenceError(`path variable "${o}" is not defined`)}),i.replace(new RegExp(Object.keys(e).map(o=>`{${o}}`).join("|"),"g"),o=>e[o.substr(1,o.length-2)]))},Wt=(i,e)=>i.split("/").slice(0,e+1).join("/"),Kt=(i,e,t,r)=>y({device:e,domain:r||Ee(i)||"unknown"},t);var Yt=i=>{var e;return typeof((e=i.crypto)==null?void 0:e.randomUUID)=="function"?i.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})};var Br=I.responses.TCPurpose,$e=100,K=10,D=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),_=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),J=(i,e)=>{Object.defineProperty(e,"name",{value:i});let t=0;return _(i,(r,n)=>t!==r.requestAdsCalls?(t=r.requestAdsCalls,e(r,n)):Promise.resolve())},Jt=(i,e)=>(Object.defineProperty(e,"name",{value:i}),_(i,(t,r)=>t.requestAdsCalls===1&&t.requestId===1?e(t,r):Promise.resolve())),N=(i,e,t)=>{let r=Object.assign(t,{priority:e});return Object.defineProperty(t,"name",{value:i}),r},Ge=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),Ie=class{constructor(e,t,r,n){this.config=e;this.logger=t;this.window=r;this.auction=n;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,t)=>{let r=new Map;return this.config.prepareRequestAds.forEach(n=>{let o=r.get(n.priority);o?o.push(n):r.set(n.priority,[n])}),Array.from(r.entries()).sort(([n],[o])=>n>o?-1:1).reduce((n,[o,s])=>n.then(()=>(e.logger.debug("AdPipeline",e.requestId,`run prepareRequestAds with priority ${o}`),Promise.all(s.map(a=>a(e,t))))),Promise.resolve(void 0))}}run(e,t,r,n,o){if(e.length===0)return Promise.resolve();this.requestId=this.requestId+1;let s=this.requestId,a=Yt(this.window);this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${n}. call. AuctionId ${a}`,e);let d=t.consent||{};return this.tcData=this.tcData?this.tcData:Gt(d,this.window,this.logger,r.environment),this.tcData.then(u=>{var f,h,E;let l=[...((f=t.targeting)==null?void 0:f.labels)||[],...r.labels];u.gdprApplies&&u.purpose.consents[Br.STORE_INFORMATION_ON_DEVICE]?l.push("purpose-1"):u.gdprApplies||l.push("purpose-1");let p=new me(t.labelSizeConfig||[],l,this.window),c=o&&((h=t.buckets)!=null&&h.bucket)&&t.buckets.bucket[o]?t.buckets.bucket[o]:null,g=Kt(this.window.location.hostname,p.getDeviceLabel(),(E=t.targeting)==null?void 0:E.adUnitPathVariables,t.domain),b={auctionId:a,requestId:s,requestAdsCalls:n,logger:this.logger,env:r.environment||"production",config:t,runtimeConfig:r,labelConfigService:p,window:this.window,tcData:u,bucket:c,adUnitPathVariables:g,auction:this.auction,assetLoaderService:_e(this.window)};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(C=>C(b))));let S="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(C=>C(b,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(b,e))).then(C=>C.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(b,C)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(B=>B(b,C)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(b,C)):Promise.reject(S)).catch(C=>{switch(C){case S:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",C),Promise.reject(C)}})})}getAuction(){return this.auction}logStage(e,t){return new Promise(r=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),r()})}};var We=(i,e)=>i[0]===e[0]&&i[1]===e[1];var H=class{constructor(e,t,r){this.sizeConfig=e;this.supportedLabels=t;this.window=r;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:e.filter(t=>this.supportedSizes.some(r=>r==="fluid"?t==="fluid":t==="fluid"?!1:We(t,r))):[];this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every(r=>t.some(n=>n===r)))&&(!e.labelNone||!e.labelNone.some(r=>t.some(n=>n===r)));let n=e.length!==0?e.filter(o=>r.matchMedia(o.mediaQuery).matches&&this.areLabelsMatching(o,t)):[];this.isValid=e.length===0||!(e.length>0&&n.length===0),this.supportedSizes=ce(n.map(o=>o.sizesSupported)).map(o=>JSON.stringify(o)).filter(j).map(o=>JSON.parse(o))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var Z={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:i=>`moli-test-slot-size-${i}`,debugDelay:"moli-debug-delay"};var fe=(i,e=localStorage)=>{try{return e.getItem(i)}catch(t){return ne().debug(`Could not read value with key ${i} from browser storage`,e),null}},Te=(i,e,t=localStorage)=>{try{t.setItem(i,e)}catch(r){ne().debug(`Could not set key ${i} with value ${e} to browser storage`,t)}};var qr=i=>i==="hidden"||Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number",Qt=i=>`${i}__container`,Ke=(i,e)=>{let t=Ur(i,e);return t.forEach(({slot:r,container:n})=>{n.innerHTML="",n.appendChild(Vr(r))}),t};var Lr=(i,e)=>{let t=document.getElementById(i);t&&(t.innerHTML=e)},Ur=(i,e)=>(e.forEach(t=>{let{moliSlot:r}=t,n=Qt(r.domId),o=document.createElement("div");o.id=n;let s=document.getElementById(r.domId);s&&s.setAttribute("data-google-query-id","test"),Lr(r.domId,o.outerHTML),i.logger.debug("GAM",`Set content for slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath}`)}),_r(e)),_r=i=>i.map(e=>{let t=document.getElementById(Qt(e.moliSlot.domId));return t?{slot:e,container:t}:void 0}).filter(U),Vr=i=>{let e=Nr(i),t=zr(i.moliSlot,e);if(t==="hidden")return document.createElement("div");{let r=document.createElement("div"),[n,o]=t;r.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${n}px; height: ${o}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${i.moliSlot.domId}</strong>`,r.appendChild(s);let a=document.createElement("span");a.style.color="#656565";let d=([f,h])=>a.innerText=`(${f}x${h})`;d([n,o]),s.appendChild(a);let u=document.createElement("div");u.style.cssText="position: absolute; top: 5px; left: 5px",r.appendChild(u);let l=(f,h)=>{if(f==="hidden")r.style.display="none";else{let[E,C]=f;r.style.width=`${E}px`,r.style.height=`${C}px`,d(f),S(h)}jr(i.moliSlot,f)},p="1px dotted white",c="1px solid black",g=document.createElement("button");g.innerText="hide",g.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",g.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${p};`,g.addEventListener("click",()=>l("hidden",g));let b=[...e.map(f=>{let[h,E]=f,C=Zt(t,f),B=document.createElement("button");return B.innerText=`${h}x${E}`,B.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${C?c:p};`,B.addEventListener("click",()=>l(f,B)),B}),g];b.forEach(f=>u.appendChild(f));let S=f=>{b.forEach(h=>h.style.border=p),f.style.border=c};return r}},Nr=i=>i.filterSupportedSizes(i.moliSlot.sizes).filter(H.isFixedSize).filter(([e,t])=>e>1&&t>1),zr=(i,e)=>{let t=Fr(i);if(t&&(t==="hidden"||$r(e,t)))return t;{let r=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[r]}},jr=(i,e)=>Te(Z.testSlotSize(i.domId),JSON.stringify(e)),Fr=i=>{let e=fe(Z.testSlotSize(i.domId));if(e)try{let t=JSON.parse(e);return qr(t)?t:void 0}catch(t){return}},Zt=(i,e)=>{let[t,r]=i,[n,o]=e;return t===n&&r===o},$r=(i,e)=>i.some(t=>Zt(t,e));var Gr=(i,e)=>({setCollapseEmptyDiv(){},addService(t){},getSlotElementId(){return i},getAdUnitPath(){return e},setTargeting(t,r){return this},getTargeting(t){return[]},getTargetingKeys(){return[]},clearTargeting(t){},getResponseInformation(){return null}}),ei=(i,e,t)=>{var o;let r=t?t.keyValues:{},n=(o=t==null?void 0:t.adManagerExcludes)!=null?o:[];[r,e].forEach(s=>{Object.keys(s).filter(a=>!n.includes(a)).forEach(a=>{let d=s[a];d&&i.googletag.pubads().setTargeting(a,d)})})},ti=(i,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!i.gdprApplies||i.vendor.consents[755]&&i.purpose.consents[I.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[I.responses.TCPurpose.SELECT_BASIC_ADS,I.responses.TCPurpose.MEASURE_AD_PERFORMANCE,I.responses.TCPurpose.APPLY_MARKET_RESEARCH,I.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(t=>i.purpose.consents[t]||i.purpose.legitimateInterests[t]),ii=()=>{let i;return D("gpt-init",e=>e.env==="test"?Promise.resolve():(i||(i=new Promise(t=>{e.logger.debug("GAM","init googletag stub"),e.window.googletag=e.window.googletag||{},e.window.googletag.cmd=e.window.googletag.cmd||[],e.window.googletag.cmd.push(t),e.assetLoaderService.loadScript({name:"gpt",loadMethod:1,assetUrl:ti(e.tcData,e.config.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(r=>e.logger.error("failed to load gpt.js",r))})),i))},ri=()=>{let i=0;return _("gpt-destroy-ad-slots",(e,t)=>{var r;if(e.env==="test")return Promise.resolve();if(((r=e.config.spa)==null?void 0:r.destroyAllAdSlots)===!1){let n=e.window.googletag.pubads().getSlots(),o=t.map(s=>n.find(a=>a.getSlotElementId()===s.domId)).filter(U);o.length===0?e.logger.debug("GAM","no ad slots to destroy"):(e.logger.debug("GAM",`destroy ${o.length} ad slots`,o),e.window.googletag.destroySlots(o))}else i!==e.requestAdsCalls&&(i=e.requestAdsCalls,e.logger.debug("GAM","destroy all ad slots"),e.window.googletag.destroySlots());return Promise.resolve()})},oi=()=>J("gpt-reset-targeting",i=>new Promise(e=>{i.env==="production"&&(i.logger.debug("GAM","reset top level targeting"),i.window.googletag.pubads().clearTargeting(),ei(i.window,i.runtimeConfig.keyValues,i.config.targeting)),e()})),ni=()=>{let i;return _("gpt-configure",(e,t)=>(i||(i=new Promise(r=>{var o;let n=e.runtimeConfig.environment||"production";switch(e.logger.debug("GAM","configure googletag"),n){case"production":ei(e.window,e.runtimeConfig.keyValues,e.config.targeting),e.window.googletag.pubads().enableAsyncRendering(),e.window.googletag.pubads().disableInitialLoad(),e.window.googletag.pubads().enableSingleRequest(),(o=e.config.gpt)!=null&&o.pageSettingsConfig&&e.window.googletag.setConfig(e.config.gpt.pageSettingsConfig);let s=!ti(e.tcData,e.config.consent);e.logger.debug("GAM","use limited ads",s),e.window.googletag.pubads().setPrivacySettings({limitedAds:s}),e.window.googletag.enableServices(),r();return;case"test":r();return}})),i))},si=()=>N("gpt-device-label-keyValue",K,i=>i.env==="test"?Promise.resolve():new Promise(e=>{let t=i.labelConfigService.getDeviceLabel();i.logger.debug("GAM",'adding "device_label" key-value with values',t),i.window.googletag.pubads().setTargeting("device_label",t),e()})),ai=()=>N("gpt-consent-keyValue",K,i=>i.env==="test"?Promise.resolve():new Promise(e=>{let t=i.tcData,r=!t.gdprApplies||[I.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,I.responses.TCPurpose.SELECT_BASIC_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,I.responses.TCPurpose.MEASURE_AD_PERFORMANCE,I.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,I.responses.TCPurpose.APPLY_MARKET_RESEARCH,I.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(n=>t.purpose.consents[n]);i.window.googletag.pubads().setTargeting("consent",r?"full":"none"),e()})),di=()=>(i,e)=>{let t=e.map(r=>{var b;let n=new H(r.sizeConfig,i.labelConfigService.getSupportedLabels(),i.window),o=n.filterSupportedSizes;if(!(n.filterSlot(r)&&i.labelConfigService.filterSlot(r)))return Promise.resolve(null);let s=o(r.sizes),a=F(r.adUnitPath,i.adUnitPathVariables),d=S=>{if(!i.window.document.getElementById(S)){let f=i.window.document.createElement("div");f.id=S,f.setAttribute("data-h5v-position",r.position),f.style.setProperty("display","none"),i.window.document.body.appendChild(f)}},u=()=>{switch(r.position){case"in-page":return i.window.googletag.defineSlot(a,s,r.domId);case"interstitial":return d(r.domId),i.window.googletag.defineSlot(a,s,r.domId);case"out-of-page":return d(r.domId),i.window.googletag.defineOutOfPageSlot(a,r.domId);case"out-of-page-interstitial":return i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);case"out-of-page-bottom-anchor":return i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);case"out-of-page-top-anchor":return i.window.googletag.defineOutOfPageSlot(a,i.window.googletag.enums.OutOfPageFormat.TOP_ANCHOR)}},l=()=>{if(i.env==="test")return null;let S=u();return S&&i.window.googletag.display(S),S},c=(i.env==="test"?[]:i.window.googletag.pubads().getSlots()).find(S=>S.getSlotElementId()===r.domId),g=c||l();switch(i.env){case"production":if(g)return g.setCollapseEmptyDiv(((b=r.gpt)==null?void 0:b.collapseEmptyDiv)!==!1),g.addService(i.window.googletag.pubads()),i.logger.debug("GAM",`Register slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath}`),Promise.resolve({moliSlot:r,adSlot:g,filterSupportedSizes:o});if(r.position==="out-of-page-interstitial"||r.position==="out-of-page-top-anchor"||r.position==="out-of-page-bottom-anchor")return i.logger.warn("GAM",`${r.position} is not supported`),Promise.resolve(null);{let S=`Slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath} is already defined. You may have called requestAds() multiple times`;return i.logger.error("GAM",S),Promise.reject(new Error(S))}case"test":return Promise.resolve({moliSlot:r,adSlot:Gr(r.domId,r.adUnitPath),filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${i.runtimeConfig.environment}`)}});return Promise.all(t).then(r=>r.filter(U))},Wr=(i,e)=>{let t=i.find(({moliSlot:r})=>r.position==="interstitial");if(t&&t.adSlot.getTargeting("hb_pb").length===0){e.window.googletag.destroySlots([t.adSlot]);let n=e.window.googletag.defineOutOfPageSlot(F(t.moliSlot.adUnitPath,e.adUnitPathVariables),e.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);if(n)return console.log("GAM","Display out-of-page-interstitial slot"),n.addService(e.window.googletag.pubads()),e.window.googletag.display(n),[...i.filter(({moliSlot:o})=>o.position!=="interstitial"),w(y({},t),{adSlot:n})];e.logger.error("GAM","Failed to define out-of-page-interstitial slot")}return i},li=()=>(i,e)=>new Promise(t=>{switch(i.logger.debug("GAM","requestAds"),i.env){case"test":Ke(i,e);break;case"production":let r=e.filter(({moliSlot:s,adSlot:a})=>!i.auction.isSlotThrottled(s.domId,a.getAdUnitPath()));if(r.length===0)break;let n=Wr(r,i);i.window.googletag.pubads().refresh(n.map(({adSlot:s})=>s));let o=n.map(({moliSlot:s})=>`[DomID] ${s.domId} [AdUnitPath] ${s.adUnitPath}`).join(`
`);i.logger.debug("GAM",`Refresh ${e.length} slot(s):
${o}`);break}t()});var ue;(v=>{let i;(te=>{let W;(ie=>(ie[ie.Unknown=0]="Unknown",ie[ie.ProfessionallyProduced=1]="ProfessionallyProduced",ie[ie.Prosumer=2]="Prosumer",ie[ie.UGC=3]="UGC"))(W=te.ContentQuality||(te.ContentQuality={}))})(i=v.firstpartydata||(v.firstpartydata={}));let e;(z=>{let W;(le=>(le[le.NO=0]="NO",le[le.YES=1]="YES"))(W=z.Skip||(z.Skip={}));let te;(L=>(L[L.VAST_1=1]="VAST_1",L[L.VAST_2=2]="VAST_2",L[L.VAST_3=3]="VAST_3",L[L.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",L[L.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",L[L.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",L[L.VAST_4=7]="VAST_4",L[L.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",L[L.DAAST_1=9]="DAAST_1",L[L.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(te=z.Protocol||(z.Protocol={}));let ge;(q=>(q[q.AutoPlaySoundOff=1]="AutoPlaySoundOff",q[q.AutoPlaySoundOn=2]="AutoPlaySoundOn",q[q.ClickToPlay=3]="ClickToPlay",q[q.MousOver=4]="MousOver",q[q.InViewportSoundsOn=5]="InViewportSoundsOn",q[q.InViewportSoundsOff=6]="InViewportSoundsOff"))(ge=z.PlaybackMethod||(z.PlaybackMethod={}));let Ct;(q=>(q[q.VPAID_1=1]="VPAID_1",q[q.VPAID_2=2]="VPAID_2",q[q.MRAID_1=3]="MRAID_1",q[q.ORMMA=4]="ORMMA",q[q.MRAID_2=5]="MRAID_2",q[q.MRAID_3=6]="MRAID_3"))(Ct=z.Api||(z.Api={}));let Ir;(re=>(re[re.InStream=1]="InStream",re[re.InBanner=2]="InBanner",re[re.InArticle=3]="InArticle",re[re.InFeed=4]="InFeed",re[re.Interstitial=5]="Interstitial"))(Ir=z.Placement||(z.Placement={}));let Ar;(pe=>(pe[pe.Instream=1]="Instream",pe[pe.AccompanyingContent=2]="AccompanyingContent",pe[pe.Interstitial=3]="Interstitial",pe[pe.NoContentStandalone=4]="NoContentStandalone"))(Ar=z.Plcmt||(z.Plcmt={}));let ie;(M=>(M[M.AudioAdAutoPlay=1]="AudioAdAutoPlay",M[M.AudioAdUserInitiated=2]="AudioAdUserInitiated",M[M.ExpandableAutomatic=3]="ExpandableAutomatic",M[M.ExpandableOnClick=4]="ExpandableOnClick",M[M.ExpandableOnRollover=5]="ExpandableOnRollover",M[M.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",M[M.InBannerVideoAdClick=7]="InBannerVideoAdClick",M[M.Pop=8]="Pop",M[M.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",M[M.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",M[M.Surveys=11]="Surveys",M[M.TextOnly=12]="TextOnly",M[M.UserInteractive=13]="UserInteractive",M[M.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",M[M.HasAudioOnOffButton=15]="HasAudioOnOffButton",M[M.HasSkipButton=16]="HasSkipButton",M[M.AdobeFlash=16]="AdobeFlash"))(ie=z.CreativeAttributes||(z.CreativeAttributes={}));let Pr;(le=>(le[le.LinerInStream=1]="LinerInStream",le[le.NonLinearOverlay=2]="NonLinearOverlay"))(Pr=z.Linearity||(z.Linearity={}))})(e=v.video||(v.video={})),v.Adagio="adagio",v.AdaptMx="amx",v.Adform="adf",v.AdUp="aduptech",v.Criteo="criteo",v.ConnectAd="connectad",v.AppNexusAst="appnexusAst",v.AppNexus="appnexus",v.GumGum="gumgum",v.ImproveDigital="improvedigital",v.IndexExchange="ix",v.Invibes="invibes",v.NanoInteractive="nanointeractive",v.PubMatic="pubmatic",v.Ogury="ogury",v.OneTag="onetag",v.OpenX="openx",v.SmartAdServer="smartadserver",v.Smartx="smartx",v.Unruly="unruly",v.Teads="teads",v.TheTradeDesk="ttd",v.Triplelift="triplelift",v.Yieldlab="yieldlab",v.Seedtag="seedtag",v.Spotx="spotx",v.ShowHeroes="showheroesBs",v.StroeerCore="stroeerCore",v.StailaMedia="stailamedia",v.Xaxis="xhb",v.DSPX="dspx",v.RichAudience="ra",v.Rubicon="rubicon",v.Recognified="rads",v.Visx="visx",v.Vlyby="vlyby",v.Orbidder="orbidder"})(ue||(ue={}));var ui=(i,e)=>{var t;return w(y({},i),{ext:w(y({},i.ext),{prebid:w(y({},(t=i.ext)==null?void 0:t.prebid),{storedrequest:e})})})};var ke={version:"5.3.1"};var pi=(i,e,t={})=>({url:e,render:r=>Kr(r,i,t),backupOnly:!0}),Kr=(i,e,t={})=>{if(!i.renderer){ne().error("Can not initialize prebid outstream player, because bid.renderer is not defined");return}i.renderer.push(()=>{var r;return(r=window.outstreamPlayer)==null?void 0:r.call(window,i,e,t)})};var Hr=i=>new Promise((e,t)=>{i.window.setTimeout(()=>t("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),Yr=i=>new Promise(e=>i.pbjs.que.push(e)),ci=i=>!!i.moliSlot.prebid,Jr=(i,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(t=>i.code===t.code):!1,gi=(i,e,t)=>t.filter(ci).map(({moliSlot:n,priceRule:o,filterSupportedSizes:s})=>{let a=o?{floors:{currency:e.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":o.floorprice}}}:null;return i.logger.debug("Prebid",i.requestId,"Price Rule",o,n.domId,a),Xr(n.prebid).map(d=>{var Q,de,Me,he;let u=d.adUnit.mediaTypes.banner,l=d.adUnit.mediaTypes.video,p=d.adUnit.mediaTypes.native,c=u?s(u.sizes).filter(H.isFixedSize):[],g=l?Qr(l.playerSize,s):[],b=d.adUnit.bids.filter(G=>i.labelConfigService.filterSlot(G)).filter(G=>G.bidder&&i.auction.biddersDisabling?!i.auction.biddersDisabling.isBidderDisabled(n.domId,G.bidder):!0).filter(G=>G.bidder&&i.auction.frequencyCapping?!i.auction.isBidderFrequencyCappedOnSlot(n.domId,G.bidder):!0).map(G=>{let m=G,{labelAny:Lt,labelAll:ee}=m;return jt(m,["labelAny","labelAll"])}),S=g.length>0&&!(l!=null&&l.w)&&!(l!=null&&l.h)?{w:g[0][0],h:g[0][1]}:{},f=e.backupVideoRenderer,h=l?{video:y(y(w(y({},l),{playerSize:g.length===0?void 0:g}),S),f?{renderer:pi(n.domId,f.url)}:{})}:void 0,E=u&&c.length>0?{banner:w(y({},u),{sizes:c})}:void 0,C=p?{native:y({},p)}:void 0,B=w(y({},d.adUnit.pubstack),{adUnitPath:F(((Q=d.adUnit.pubstack)==null?void 0:Q.adUnitPath)||n.adUnitPath,i.adUnitPathVariables)}),$=(he=(Me=(de=d.adUnit.ortb2Imp)==null?void 0:de.ext)==null?void 0:Me.prebid)==null?void 0:he.storedrequest,X=$&&$.id?w(y({},$),{id:F($.id,i.adUnitPathVariables)}):null;return y(w(y(w(y(y({},d.adUnit),$&&X&&{ortb2Imp:ui(d.adUnit.ortb2Imp,X)}),{code:d.adUnit.code||n.domId}),d.adUnit.pubstack?{pubstack:B}:{}),{mediaTypes:y(y(y({},h),E),C),bids:b}),a)}).filter(d=>d.bids.length>0&&d.mediaTypes&&(d.mediaTypes.banner||d.mediaTypes.video||d.mediaTypes.native)&&!Jr(d,i.window))}).reduce((n,o)=>[...n,...o],[]),mi=i=>D("prebid-init",e=>{var r,n;e.window.pbjs=e.window.pbjs||{que:[]};let t=(r=e.config.prebid)==null?void 0:r.analyticAdapters;return t&&t.length>0&&e.window.pbjs.que.push(()=>{e.window.pbjs.enableAnalytics(t)}),e.window.pbjs.libLoaded?Promise.resolve():(n=e.config.prebid)!=null&&n.distributionUrl?(i.loadScript({name:"prebid",assetUrl:e.config.prebid.distributionUrl,loadMethod:1}),Promise.resolve()):Promise.race([Yr(e.window),Hr(e)])}),fi=i=>_("prebid-remove-adunits",e=>new Promise(t=>{if(i.ephemeralAdUnits!==!0){e.window.pbjs=e.window.pbjs||{que:[]};let r=e.window.pbjs.adUnits;r&&e.window.pbjs.que.push(()=>{e.logger.debug("Prebid","Destroying prebid adUnits",r),r.forEach(n=>e.window.pbjs.removeAdUnit(n.code))})}t()})),yi=(i,e)=>{let t,r=n=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:n}});return _("prebid-configure",(n,o)=>(t||(t=new Promise(s=>{i.bidderSettings&&(n.window.pbjs.bidderSettings=i.bidderSettings),n.window.pbjs.que.push(()=>{i.config.s2sConfig&&(Array.isArray(i.config.s2sConfig)?i.config.s2sConfig:[i.config.s2sConfig]).forEach(u=>{var p,c;let l=(c=(p=u.extPrebid)==null?void 0:p.analytics)==null?void 0:c.h5v;l&&(l.configLabel=n.window.moli.configLabel,l.moliVersion=ke.version)}),n.window.pbjs.setConfig(w(y({},i.config),{schain:r([e.supplyChainStartNode]),floors:i.config.floors||{}})),i.schain.nodes.forEach(({bidder:d,node:u,appendNode:l})=>{let p=[e.supplyChainStartNode];l&&p.push(u),n.window.pbjs.setBidderConfig({bidders:[d],config:{schain:r(p)}},!0)}),n.window.pbjs.registerSignalSources&&n.window.pbjs.registerSignalSources()}),s()})),t))},Xr=i=>Array.isArray(i)?i:[i],bi=i=>N("prebid-prepare-adunits",K,(e,t)=>new Promise(r=>{i.ephemeralAdUnits||e.window.pbjs.que.push(()=>{let n=gi(e,i,t);n.forEach(o=>{e.logger.debug("Prebid",e.requestId,`Prebid add ad unit: [Code] ${o.code}`,o)}),e.window.pbjs.addAdUnits(n)}),r()})),hi=(i,e)=>Ge("prebid-request-bids",(t,r)=>{var a,d;let n=Math.max(((a=i.config.bidderTimeout)!=null?a:2e3)+3e3,(d=i.failsafeTimeout)!=null?d:0),o=new Promise(u=>t.window.setTimeout(u,n)),s=new Promise(u=>{var S;let l=r.filter(f=>!t.auction.isSlotThrottled(f.moliSlot.domId,f.adSlot.getAdUnitPath())),p=i.ephemeralAdUnits?{adUnits:gi(t,i,l)}:{adUnitCodes:l.filter(ci).map(f=>f.moliSlot.domId)},c=p.adUnitCodes||((S=p.adUnits)==null?void 0:S.map(f=>f.code).filter(U).filter(j))||[];if(c.length===0)return t.logger.debug("Prebid","skip request bids. All slots were filtered.",l.map(f=>f.moliSlot)),u();let g=!1;t.logger.debug("Prebid",`Prebid request bids: 
			${c.join(`
			`)}`);let b=(f,h,E)=>{t.logger.info("Prebid",E,f,r.map(C=>C.moliSlot.domId));try{if(g){t.logger.warn("Prebid",`ad server request already sent [${t.requestId}]. AuctionId ${E}`);return}if(!f)return t.logger.warn("Prebid",`Undefined bid response map for ad unit codes: ${c.join(", ")}`),u();g=!0,e==="gam"&&(t.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.forEach(C=>C(t,f,r)),t.window.pbjs.setTargetingForGPTAsync(c)),u()}catch(C){t.logger.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(C)),u()}};t.window.pbjs.que.push(()=>{var f;t.window.pbjs.requestBids(w(y({},p),{auctionId:t.auctionId,timeout:(f=t.bucket)==null?void 0:f.timeout,bidsBackHandler:b}))})});return Promise.race([o,s])}),vi=()=>(i,e)=>{let t=e.map(r=>{let n=new H(r.sizeConfig,i.labelConfigService.getSupportedLabels(),i.window),o=n.filterSupportedSizes;if(!(n.filterSlot(r)&&i.labelConfigService.filterSlot(r)))return Promise.resolve(null);let s={getAdUnitPath:()=>r.adUnitPath};switch(i.env){case"production":return Promise.resolve({moliSlot:r,adSlot:s,filterSupportedSizes:o});case"test":return Promise.resolve({moliSlot:r,adSlot:s,filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${i.runtimeConfig.environment}`)}});return Promise.all(t).then(r=>r.filter(U))},Si=()=>(i,e)=>new Promise((t,r)=>{i.logger.debug("Prebid","start rendering");try{switch(i.env){case"test":i.logger.debug("Prebid","Rendering test slots"),Ke(i,e);break;case"production":i.window.pbjs.getHighestCpmBids().filter(n=>n&&n.adId).forEach(n=>{var s;let o=i.window.document.getElementById(n.adUnitCode);if(o){let a=document.createElement("div");a.style.setProperty("border","0pt none");let d=document.createElement("iframe");d.scrolling="no",d.frameBorder="0",d.marginHeight="0",d.marginHeight="0",d.name=`prebid_ads_iframe_${n.adUnitCode}`,d.title="3rd party ad content",d.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),d.setAttribute("aria-label","Advertisment"),d.style.setProperty("border","0"),d.style.setProperty("margin","0"),d.style.setProperty("overflow","hidden"),a.appendChild(d),o.appendChild(a);let u=(s=d.contentWindow)==null?void 0:s.document;if(u){i.window.pbjs.renderAd(u,n.adId);let l="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",p=u.createElement("style");p.appendChild(u.createTextNode(l)),u.head.appendChild(p)}else i.logger.error("Prebid",`No access to iframe contentWindow for ad unit${n.adUnitCode}`)}else i.logger.error("Prebid",`Could not locate ad slot with id ${n.adUnitCode}`)});break}t()}catch(n){r(n)}}),Qr=(i,e)=>{let t=r=>!!r&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number";return i?e(t(i)?[i]:i).filter(H.isFixedSize):[]};var ye=I.responses.TCPurpose,Zr=i=>!!i.moliSlot.a9,Ii=i=>!i.gdprApplies||i.vendor.consents[793]&&[ye.STORE_INFORMATION_ON_DEVICE,ye.SELECT_BASIC_ADS,ye.CREATE_PERSONALISED_ADS_PROFILE,ye.SELECT_PERSONALISED_ADS,ye.MEASURE_AD_PERFORMANCE,ye.APPLY_MARKET_RESEARCH,ye.DEVELOP_IMPROVE_PRODUCTS].every(e=>i.purpose.consents[e]),Ai=(i,e)=>D("a9-init",t=>new Promise(r=>{t.window.apstag=t.window.apstag||{_Q:[],init:function(){t.window.apstag._Q.push(["i",arguments])},fetchBids:function(){t.window.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){t.window.apstag._Q.push(["di",arguments])},rpa:function(){t.window.apstag._Q.push(["ri",arguments])},upa:function(){t.window.apstag._Q.push(["ui",arguments])}},t.env!=="test"&&Ii(t.tcData)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:i.scriptUrl?i.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(n=>t.logger.error("failed to load apstag.js",n)),r()})),Pi=(i,e)=>_("a9-configure",(t,r)=>new Promise(n=>{let o=[e.supplyChainStartNode];i.schainNode&&o.push(i.schainNode),t.window.apstag.init({pubID:i.pubID,adServer:"googletag",bidTimeout:i.timeout,gdpr:{cmpTimeout:i.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:o}}),n()})),Ci=i=>Jt("a9-publisher-audiences",(e,t)=>new Promise(r=>{let n=i.publisherAudience;if(n&&n.enabled){let o={hashedRecords:[{type:"email",record:n.sha256Email}]};if(e.logger.debug("A9","Enable publisher audiences"),e.window.apstag.rpa(o),e.window.__tcfapi){let s=!0;e.window.__tcfapi("addEventListener",2,a=>{if(s){s=!1;return}a.eventStatus===I.status.EventStatus.USER_ACTION_COMPLETE&&(e.logger.debug("A9","Update publisher audience token"),e.window.apstag.upa(o))})}}r()})),Ri=()=>N("a9-clear-targeting",K,(i,e)=>i.requestId===0?(i.logger.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(t=>{i.logger.debug("A9","clear a9 targetings"),e.forEach(({adSlot:r})=>{r.getTargetingKeys().filter(n=>n==="amznp"||n==="amznsz"||n==="amznbid").forEach(n=>r.clearTargeting(n))}),t()})),eo=(i,e,t)=>{let r=Fe(i),n=e?Wt(r,e):r;return F(n,t)},wi=i=>Ge("a9-fetch-bids",(e,t)=>new Promise(r=>{var o;if(!Ii(e.tcData)){e.logger.debug("A9","Skip any due to missing consent"),r();return}let n=t.filter(Zr).filter(s=>!e.auction.isSlotThrottled(s.moliSlot.domId,s.adSlot.getAdUnitPath())).filter(s=>{let a=s.moliSlot.a9.mediaType==="video",d=e.labelConfigService.filterSlot(s.moliSlot.a9),u=s.filterSupportedSizes(s.moliSlot.sizes).filter(H.isFixedSize).length>0;return d&&(a||u)}).map(({moliSlot:s,priceRule:a,filterSupportedSizes:d})=>{var u,l;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let p=i.supportedSizes?s.sizes.filter(g=>{var b;return(b=i.supportedSizes)==null?void 0:b.some(S=>We(S,g))}):s.sizes,c=eo(s.adUnitPath,(u=s.a9.slotNamePathDepth)!=null?u:i.slotNamePathDepth,e.adUnitPathVariables);return y({slotID:s.domId,slotName:c,sizes:d(p).filter(H.isFixedSize)},i.enableFloorPrices&&a?{floor:{value:Math.ceil((l=e.window.pbjs)!=null&&l.convertCurrency?e.window.pbjs.convertCurrency(a.floorprice,"EUR",i.floorPriceCurrency||"USD")*100:a.floorprice*100*1.19),currency:i.floorPriceCurrency||"USD"}}:{})}});e.logger.debug("A9",`Fetch '${n.length}' A9 slots: ${n.map(s=>`[slotID] ${s.slotID}`)}`),n.length===0?r():e.window.apstag.fetchBids(y({slots:n},((o=e.bucket)==null?void 0:o.timeout)&&{bidTimeout:e.bucket.timeout}),s=>{e.window.apstag.setDisplayBids(),r()})}));var Mi=(i,e)=>e?new Promise(t=>i.setTimeout(t,e)):Promise.resolve(),Ei=i=>Number(fe(Z.debugDelay,i.localStorage))||void 0;var He=class{constructor(e,t){this.config=e;this.window=t;this.participationInfo=new Map;var r;(r=this.logger)==null||r.info(`Bidders disabling feature is ${e.enabled?"enabled":"disabled"}`)}isBidderDisabled(e,t){var r,n,o;return(o=(n=(r=this.participationInfo.get(e))==null?void 0:r.get(t))==null?void 0:n.disabled)!=null?o:!1}onAuctionEnd(e){var t,r;(t=e.bidderRequests)==null||t.forEach(n=>{var o;(o=n==null?void 0:n.bids)==null||o.forEach(s=>{var p,c,g;let a=s.bidder,d=s.adUnitCode;this.participationInfo.get(d)||this.participationInfo.set(d,new Map);let l=(p=this.participationInfo.get(d))==null?void 0:p.get(a);if(l){let b=l.bidRequestCount+1;(c=this.participationInfo.get(d))==null||c.set(a,w(y({},l),{bidRequestCount:b}))}else(g=this.participationInfo.get(d))==null||g.set(a,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),(r=e.bidsReceived)==null||r.forEach(n=>{var d,u,l;let o=n.bidderCode,s=n.adUnitCode,a=(d=this.participationInfo.get(s))==null?void 0:d.get(o);a?(u=this.participationInfo.get(s))==null||u.set(o,w(y({},a),{bidReceivedCount:a.bidReceivedCount+1})):(l=this.participationInfo.get(s))==null||l.set(o,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),this.deactivateBidderForTTL()}deactivateBidderForTTL(){this.participationInfo.forEach((e,t)=>{e.forEach((r,n)=>{this.shouldDisableBidder(r)&&(this.disableBidder(t,n),this.window.setTimeout(()=>{this.enableBidder(t,n)},this.config.reactivationPeriod))})})}shouldDisableBidder(e){return e.bidRequestCount>this.config.minBidRequests&&e.bidReceivedCount/e.bidRequestCount<this.config.minRate&&!e.disabled}disableBidder(e,t){var n,o;let r=(n=this.participationInfo.get(e))==null?void 0:n.get(t);r&&(r.disabled=!0,(o=this.logger)==null||o.info(`Bidder ${t} for position ${e} is now disabled.`))}enableBidder(e,t){var n,o;let r=(n=this.participationInfo.get(e))==null?void 0:n.get(t);r&&(r.disabled=!1,(o=this.logger)==null||o.info(`Bidder ${t} for position ${e} is now enabled.`))}};var Ye=class{constructor(e,t){this.config=e;this._window=t;this.slotsRequested=new Set}onSlotRequested(e){let t=e.slot.getSlotElementId();(!this.config.includedDomIds||this.config.includedDomIds.length===0||this.config.includedDomIds.includes(t))&&(this.slotsRequested.add(t),this._window.setTimeout(()=>{this.slotsRequested.delete(t)},this.config.throttle*1e3))}isThrottled(e){return this.slotsRequested.has(e)}};var Et=(i,e)=>Math.max(i.wait-(e-i.ts),0);var Ti="h5v-fc",Ae,xe,Tt,be,Je=class{constructor(e,t,r,n){this.config=e;this._window=t;this.now=r;this.logger=n;ve(this,xe);this.frequencyCaps=new Map;this.positionImpSchedules=new Map;this.numAdRequests=0;ve(this,Ae,(e,t,r)=>{if(t.bidder===r.bidder&&t.domId===r.adUnitCode){let n=`${r.adUnitCode}:${r.bidder}`;this.logger.debug("fc",`adding ${n}`),this.frequencyCaps.set(n,{ts:e,wait:t.blockedForMs,bid:{bidder:r.bidder,adUnitCode:r.adUnitCode}}),this._window.setTimeout(()=>{this.logger.debug("fc",`removing ${n}`),this.frequencyCaps.delete(n)},t.blockedForMs)}});ve(this,be,()=>{if(this.config.persistent===!0){let e={caps:Array.from(this.frequencyCaps.values()),pCaps:Array.from(this.positionImpSchedules.entries()).reduce((t,[r,n])=>w(y({},t),{[r]:n}),{}),requestAds:this.numAdRequests};this._window.sessionStorage.setItem(Ti,JSON.stringify(e))}});if(this.bidWonConfigs=this.config.configs.filter(o=>{var s;return!o.events||((s=o.events)==null?void 0:s.includes("bidWon"))}),this.bidRequestedConfigs=this.config.configs.filter(o=>{var s;return(s=o.events)==null?void 0:s.includes("bidRequested")}),this.resolvedAdUnitPathPositionConfigs=this.config.positions||[],e.persistent===!0){let o=this._window.sessionStorage.getItem(Ti);if(o)try{let s=JSON.parse(o);this.numAdRequests=s.requestAds,s.caps.forEach(a=>{let d=Et(a,this.now());oe(this,Ae).call(this,a.ts,{bidder:a.bid.bidder,domId:a.bid.adUnitCode,blockedForMs:d},a.bid)}),Object.entries(s.pCaps).forEach(([a,d])=>{d==null||d.forEach(u=>{let l=Et(u,this.now());Rt(this,xe,Tt).call(this,u.ts,a,{intervalInMs:l})})})}catch(s){this.logger.error("fc","failed to parse fc state",s)}}}onAuctionEnd(e){this.bidRequestedConfigs.forEach(t=>{var r;(r=e.bidderRequests)==null||r.forEach(n=>{var o;(o=n==null?void 0:n.bids)==null||o.forEach(s=>{oe(this,Ae).call(this,this.now(),t,s)})})}),oe(this,be).call(this)}onBidWon(e){this.bidWonConfigs.forEach(t=>oe(this,Ae).call(this,this.now(),t,e)),oe(this,be).call(this)}onSlotRenderEnded(e){var t;if(!e.isEmpty){let r=e.slot.getAdUnitPath(),n=(t=this.resolvedAdUnitPathPositionConfigs.find(o=>o.adUnitPath===r))==null?void 0:t.conditions.pacingInterval;n&&Rt(this,xe,Tt).call(this,this.now(),r,n)}}afterRequestAds(){this.numAdRequests++,oe(this,be).call(this)}updateAdUnitPaths(e){var t;this.resolvedAdUnitPathPositionConfigs=((t=this.config.positions)!=null?t:[]).map(r=>w(y({},r),{adUnitPath:F(r.adUnitPath,e)}))}isAdUnitCapped(e){return this.resolvedAdUnitPathPositionConfigs.some(t=>{var r;return t.adUnitPath===e&&t.conditions.delay&&this.numAdRequests<t.conditions.delay.minRequestAds||t.conditions.pacingRequestAds&&this.numAdRequests%t.conditions.pacingRequestAds.requestAds!==0||t.conditions.pacingInterval&&((r=this.positionImpSchedules.get(e))!=null?r:[]).length>=t.conditions.pacingInterval.maxImpressions})}isFrequencyCapped(e,t){return this.frequencyCaps.has(`${e}:${t}`)}};Ae=new WeakMap,xe=new WeakSet,Tt=function(e,t,r){var o;let n=(o=this.positionImpSchedules.get(t))!=null?o:[];n.push({ts:e,wait:r.intervalInMs}),this.positionImpSchedules.set(t,n),this._window.setTimeout(()=>{let s=this.positionImpSchedules.get(t);s&&this.positionImpSchedules.set(t,s.filter(a=>a.ts!==e))},r.intervalInMs),oe(this,be).call(this)},be=new WeakMap;var Xe=class{constructor(){this.lastBidCpms=new Map}groupReceivedBidsByAdUnitCode(e){return e.reduce((t,r)=>{let{adUnitCode:n,cpm:o}=r;return t[n]||(t[n]=[]),t[n].push(o),t},{})}onAuctionEnd(e){let t=this.groupReceivedBidsByAdUnitCode(e);this.lastBidCpms.forEach((r,n)=>{t[n]||this.lastBidCpms.delete(n)}),Object.entries(t).forEach(([r,n])=>{var s;let o=(s=this.getLastBidCpms(r))!=null?s:[];this.lastBidCpms.set(r,Array.from(new Set([...n,...o])))})}getLastBidCpms(e){var t;return(t=this.lastBidCpms.get(e))!=null?t:null}};var Qe,Pe=class{constructor(e,t,r,n={}){this.window=e;this.logger=t;this.eventService=r;this.config=n;ve(this,Qe,_("GlobalAuctionContext",e=>{var t;return(t=this.frequencyCapping)==null||t.updateAdUnitPaths(e.adUnitPathVariables),Promise.resolve()}));var o,s,a,d,u,l,p,c;(o=n.biddersDisabling)!=null&&o.enabled&&(this.biddersDisabling=new He(n.biddersDisabling,this.window)),(s=n.adRequestThrottling)!=null&&s.enabled&&(this.adRequestThrottling=new Ye(n.adRequestThrottling,this.window)),(a=n.frequencyCap)!=null&&a.enabled&&(this.frequencyCapping=new Je(n.frequencyCap,this.window,this.window.Date.now,this.logger)),(d=n.previousBidCpms)!=null&&d.enabled&&(this.previousBidCpms=new Xe),this.window.pbjs=this.window.pbjs||{que:[]},this.window.googletag=this.window.googletag||{cmd:[]},((u=this.config.biddersDisabling)!=null&&u.enabled||(l=this.config.previousBidCpms)!=null&&l.enabled)&&this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("auctionEnd",g=>{var b,S,f,h;(b=this.config.biddersDisabling)!=null&&b.enabled&&((S=this.biddersDisabling)==null||S.onAuctionEnd(g)),(f=this.config.previousBidCpms)!=null&&f.enabled&&g.bidsReceived&&((h=this.previousBidCpms)==null||h.onAuctionEnd(g.bidsReceived))})}),(p=this.config.adRequestThrottling)!=null&&p.enabled&&this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotRequested",g=>{var b;(b=this.adRequestThrottling)==null||b.onSlotRequested(g)})}),(c=this.config.frequencyCap)!=null&&c.enabled&&(this.window.pbjs.que.push(()=>{this.window.pbjs.onEvent("bidWon",g=>{var b;this.config.frequencyCap&&((b=this.frequencyCapping)==null||b.onBidWon(g))})}),this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotRenderEnded",g=>{var b;(b=this.frequencyCapping)==null||b.onSlotRenderEnded(g)})}),this.eventService.addEventListener("afterRequestAds",()=>{var g;(g=this.frequencyCapping)==null||g.afterRequestAds()}))}isSlotThrottled(e,t){var r,n;return!!((r=this.adRequestThrottling)!=null&&r.isThrottled(e)||(n=this.frequencyCapping)!=null&&n.isAdUnitCapped(t))}isBidderFrequencyCappedOnSlot(e,t){var r,n;return(n=(r=this.frequencyCapping)==null?void 0:r.isFrequencyCapped(e,t))!=null?n:!1}getLastBidCpmsOfAdUnit(e){var t,r;return(r=(t=this.previousBidCpms)==null?void 0:t.getLastBidCpms(e))!=null?r:[]}configureStep(){return oe(this,Qe)}};Qe=new WeakMap;var Oe=i=>i!==null&&typeof i=="object"&&!Array.isArray(i);function Ze(i,...e){if(!e.length)return i;let t=e.shift();if(Oe(i)&&Oe(t))for(let r in t)Oe(t[r])?(i[r]||Object.assign(i,{[r]:{}}),Ze(i[r],t[r])):Array.isArray(t[r])?i[r]?Array.isArray(i[r])&&(i[r]=i[r].concat(t[r])):Object.assign(i,{[r]:t[r]}):Object.assign(i,{[r]:t[r]});return Ze(i,...e)}var ki=(i,e)=>e.pubads().getSlots().find(t=>t.getSlotElementId()===i.domId||t.getAdUnitPath()===i.adUnitPath),to=i=>{try{let e=typeof i=="string"?JSON.parse(i):Oe(i)?i:null;switch(e==null?void 0:e.event){case"h5.adunit.passback":return e.passbackOrigin&&(e.domId||e.adUnitPath)?e:null;case"h5.adunit.refresh":return e;default:return null}}catch(e){return null}},io=(i,e)=>{let t=e.config.slots.find(n=>n.domId===i.domId&&n.behaviour.loaded==="backfill"),r=ki(i,e.window.googletag);t&&r&&(e.logger.debug("bridge",`Refresh ad slot ${i.domId}`),e.window.googletag.destroySlots([r]),e.window.moli.refreshAdSlot(i.domId,{loaded:"backfill"}).catch(n=>e.logger.error("bridge",`failed to refresh ${i.domId}`,n)))},ro=(i,e)=>{let t=ki(i,e.window.googletag),r="passback";t&&t.getTargeting(r).length===0&&(e.logger.debug("passback",`Process passback for ad slot ${t.getAdUnitPath()}`),t.setTargeting(r,"true"),t.setTargeting("passbackOrigin",i.passbackOrigin),e.window.googletag.pubads().refresh([t]))},xi=()=>D("bridge",i=>{var e;return(e=i.config.bridge)!=null&&e.enabled&&(i.logger.debug("bridge","add message listener"),i.window.addEventListener("message",t=>{let r=to(t.data);if(r)switch(r.event){case"h5.adunit.passback":ro(r,i);break;case"h5.adunit.refresh":io(r,i);break}})),Promise.resolve()});var et=class i{constructor(e,t,r,n){this.assetService=e;this.eventService=t;this.window=r;this.adPipelineConfig=n;this.requestAdsCalls=0;this.adPipeline=new Ie({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},ne(),this.window,new Pe(this.window,ne(),this.eventService));this.initialize=(e,t)=>{var c;let r=i.getEnvironment(t),n=e.adServer||"gam",o=n==="gam",s=((c=e.spa)==null?void 0:c.enabled)===!0;this.logger.setLogger(k(t,this.window)),this.logger.debug("AdService",`Initializing with environment ${r} and ad server ${n}`);let a=o?[ii(),xi()]:[],d=o?[ni()]:[];o&&s&&d.push(ri(),oi());let u=[];o&&u.push(si(),ai());let l=[];e.prebid&&r==="production"&&(a.push(mi(this.assetService)),d.push(yi(e.prebid,e.schain)),s&&d.push(fi(e.prebid)),u.push(bi(e.prebid)),l.push(hi(e.prebid,n))),e.a9&&r==="production"&&o&&(a.push(Ai(e.a9,this.assetService)),d.push(Pi(e.a9,e.schain)),d.push(Ci(e.a9)),u.push(Ri()),l.push(wi(e.a9)));let p=new Pe(this.window,this.logger,this.eventService,e.globalAuctionContext);if(d.push(p.configureStep()),a.push(...t.adPipelineConfig.initSteps),d.push(...t.adPipelineConfig.configureSteps),u.push(...t.adPipelineConfig.prepareRequestAdsSteps),l.push(...t.adPipelineConfig.requestBidsSteps),r==="test"){let g=Ei(this.window);g&&d.push(()=>Mi(this.window,g))}return this.adPipeline=new Ie({init:a,configure:d,defineSlots:o?di():vi(),prepareRequestAds:u,requestBids:l,requestAds:o?li():Si()},this.logger,this.window,p),new Promise(g=>{Ue(this.window,()=>{this.logger.debug("DOM","dom ready"),g(e)})})};this.requestAds=(e,t)=>$t(this,null,function*(){var o;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:r,refreshInfiniteSlots:n}=t;this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,r),this.eventService.emit("beforeRequestAds",{runtimeConfig:t});try{let s=e.slots.map(a=>this.isManualSlot(a)?r.some(d=>d===a.domId)?a:null:this.isInfiniteSlot(a)?n.some(d=>d.artificialDomId===a.domId)?a:null:this.isBackfillSlot(a)?null:a).filter(U).filter(this.isSlotAvailable);if((o=e.buckets)!=null&&o.enabled){let a=Mt(this.window,t,e.labelSizeConfig,e.targeting),d=new Map;s.forEach(l=>{let p=this.getBucketName(l.behaviour.bucket,a),c=d.get(p);c?c.push(l):d.set(p,[l])});let u=yield Promise.all(Array.from(d.entries()).map(([l,p])=>(this.logger.debug("AdPipeline",`running bucket ${l}, slots:`,p),this.adPipeline.run(p,e,t,this.requestAdsCalls).then(()=>p))));return this.eventService.emit("afterRequestAds",{state:"finished"}),ce(u)}else return yield this.adPipeline.run(s,e,t,this.requestAdsCalls),this.eventService.emit("afterRequestAds",{state:"finished"}),s}catch(s){return this.logger.error("AdPipeline","slot filtering failed",s),this.eventService.emit("afterRequestAds",{state:"error"}),Promise.reject(s)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.isManualSlot=e=>e.behaviour.loaded==="manual";this.isInfiniteSlot=e=>e.behaviour.loaded==="infinite";this.isBackfillSlot=e=>e.behaviour.loaded==="backfill";this.isSlotAvailable=e=>!!this.window.document.getElementById(e.domId)||e.position==="interstitial"||e.position==="out-of-page"||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor";this.getBucketName=(e,t)=>e?typeof e=="string"?e:e[t]||"default":"default";this.logger=new ze(ne()),n&&(this.adPipeline=new Ie(n,this.logger,r,new Pe(r,this.logger,this.eventService)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,t,r,n){if(e.length===0)return Promise.resolve();let{loaded:o}=y({loaded:"manual"},n),s=t.slots.filter(a=>e.some(d=>d===a.domId)&&(a.behaviour.loaded===o||a.behaviour.loaded==="infinite")).filter(this.isSlotAvailable).map(a=>n!=null&&n.sizesOverride?w(y({},a),{sizes:n.sizesOverride}):a);if(e.length!==s.length){let a=s.filter(u=>e.every(l=>l!==u.domId)),d=e.filter(u=>s.every(l=>l.domId!==u));a.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",a),d.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",a)}return this.logger.debug("AdService","refresh ad slots",s),this.adPipeline.run(s,t,r,this.requestAdsCalls)}refreshBucket(e,t,r,n){var d;if(!((d=t.buckets)!=null&&d.enabled))return Promise.resolve();let o=Mt(this.window,r,t.labelSizeConfig,t.targeting),{loaded:s}=y({loaded:"manual"},n),a=t.slots.filter(this.isSlotAvailable).filter(u=>this.getBucketName(u.behaviour.bucket,o)===e&&(u.behaviour.loaded===s||u.behaviour.loaded==="infinite")).map(u=>n!=null&&n.sizesOverride?w(y({},u),{sizes:n.sizesOverride}):u);return a.length===0?(this.logger.warn("AdService","No slots found in bucket",e),Promise.resolve()):(this.logger.debug("AdService","refresh ad buckets",a,t.targeting),this.adPipeline.run(a,t,r,this.requestAdsCalls,e))}};var tt=class{constructor(){this.eventListeners=new Map;this.oneTimeListeners=new Map;this.addEventListener=(e,t,r={})=>{var o;let n=r.once?this.oneTimeListeners:this.eventListeners;n.has(e)||n.set(e,new Set),(o=n.get(e))==null||o.add(t)};this.removeEventListener=(e,t)=>{var r,n;(r=this.eventListeners.get(e))==null||r.delete(t),(n=this.oneTimeListeners.get(e))==null||n.delete(t)};this.emit=(e,t)=>{var n;(n=this.eventListeners.get(e))==null||n.forEach(o=>{try{o(t)}catch(s){console.error(`Error in event listener for ${e}:`,s)}});let r=this.oneTimeListeners.get(e);r&&(r.forEach(o=>{try{o(t)}catch(s){console.error(`Error in one-time event listener for ${e}:`,s)}finally{r.delete(o)}}),r.size===0&&this.oneTimeListeners.delete(e))}}};var De={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var Be=(i,e,t,r=n=>!0)=>[{source:"queryParam",value:Se(i.location.search).get(e)},{source:"sessionStorage",value:fe(t,i.sessionStorage)},{source:"localStorage",value:fe(t,i.localStorage)}].map(({source:n,value:o})=>o&&r(o)?{source:n,value:o}:void 0).filter(U);var oo=i=>!!["production","test"].find(t=>t===i),Oi=i=>Be(i,De.moliEnv,Z.moliEnv,oo)[0]||void 0,Di=(i,e)=>Te(Z.moliEnv,i,e);var qe=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href===e;case"path":try{let r=new URL(e);return t.pathname===r.pathname}catch(r){return!0}}},Bi=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href!==e;case"path":try{let r=new URL(e);return t.pathname!==r.pathname}catch(r){return!0}}};var qi=i=>{let e=_e(i),t=new tt,r=new et(e,t,i),n=i,o={state:"configurable",initialize:!1,runtimeConfig:ee(),modules:[]};function s(m,P){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.keyValues[m]=P;break}case"spa-finished":case"spa-requestAds":{o.nextRuntimeConfig.keyValues[m]=P;break}default:{k(o.runtimeConfig,i).error("MoliGlobal",`Setting key-value after configuration: ${m} : ${P}`);break}}}function a(m){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.labels.push(m);break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.labels.push(m);break}default:{k(o.runtimeConfig,i).error("MoliGlobal",`Adding label after configure: ${m}`);break}}}function d(m){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.adUnitPathVariables=m;break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.adUnitPathVariables=m;break}default:{k(o.runtimeConfig,i).error("MoliGlobal",`Setting unit path variables after configuration: ${m}`);break}}}function u(){let m=Ee(i.location.hostname)||"unknown";switch(o.state){case"configurable":return w(y({},o.runtimeConfig.adUnitPathVariables),{domain:m,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let P=new me(o.config.labelSizeConfig||[],[],i);return w(y({},f().adUnitPathVariables),{domain:o.config.domain||m,device:P.getDeviceLabel()})}}function l(m,P){let T=(P||{}).removeNetworkChildId||!1,x=F(m,u());return T?Fe(x):x}function p(m){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.logger=m;break}default:{m.error("Setting a custom logger is not allowed after configuration");break}}}function c(m){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.beforeRequestAds.push(m);break}default:{k(o.runtimeConfig,i).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",o.config);break}}}function g(m){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.afterRequestAds.push(m);break}default:{k(o.runtimeConfig,i).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",o.config);break}}}function b(){switch(o.state){case"configurable":return null;case"configured":return o.config;case"requestAds":return o.config;case"spa-requestAds":case"spa-finished":return o.config;case"finished":return o.config;case"error":return o.config}}function S(){return o.runtimeConfig}function f(){var m,P,R,T,x,V,A;return{keyValues:y(y({},(P=(m=o.config)==null?void 0:m.targeting)==null?void 0:P.keyValues),o.runtimeConfig.keyValues),labels:[...(x=(T=(R=o.config)==null?void 0:R.targeting)==null?void 0:T.labels)!=null?x:[],...o.runtimeConfig.labels],adUnitPathVariables:y(y({},(A=(V=o.config)==null?void 0:V.targeting)==null?void 0:A.adUnitPathVariables),o.runtimeConfig.adUnitPathVariables)}}function h(m){switch(o.state){case"configurable":case"configured":{o.modules.push(m);return}default:k(o.runtimeConfig,i).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function E(m){var P;switch(o.state){case"configurable":{let R=o.initialize,T=Oi(i),x=o.modules;T&&(o.runtimeConfig.environment=T.value),(T==null?void 0:T.source)==="queryParam"&&Di(T.value,i.sessionStorage);let V=k(o.runtimeConfig,i);return V.debug("MoliGlobal","configure modules",(P=m.modules)!=null?P:{}),x.forEach(A=>{var O;try{A.configure((O=m.modules)!=null?O:{}),V.debug("MoliGlobal",`configure ${A.moduleType} module ${A.name}`,A.config()),o.runtimeConfig.adPipelineConfig.initSteps.push(...A.initSteps()),o.runtimeConfig.adPipelineConfig.configureSteps.push(...A.configureSteps()),o.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...A.prepareRequestAdsSteps()),A.requestBidsSteps&&o.runtimeConfig.adPipelineConfig.requestBidsSteps.push(...A.requestBidsSteps()),A.prebidBidsBackHandler&&o.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.push(...A.prebidBidsBackHandler())}catch(v){V.error("MoliGlobal",`failed to configure ${A.moduleType} module ${A.name}`,v)}}),o={state:"configured",config:m,runtimeConfig:o.runtimeConfig,modules:x},R||m.requestAds===!0?C():Promise.resolve(o)}case"configured":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",o.config),Promise.resolve(o);case"requestAds":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(o);case"finished":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(o);case"error":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",o.error),Promise.resolve(o)}return Promise.resolve(null)}function C(){var m;switch(o.state){case"configurable":return o.initialize=!0,Promise.resolve(o);case"configured":{he(),G(o.config.domain);let{refreshInfiniteSlots:P}=o.runtimeConfig,R=o.config;P.length>0&&P.forEach(A=>{R=je(R,A.idOfConfiguredSlot,A.artificialDomId,k(o.runtimeConfig,i))});let T=k(o.runtimeConfig,i);o.runtimeConfig.hooks&&o.runtimeConfig.hooks.beforeRequestAds&&o.runtimeConfig.hooks.beforeRequestAds.forEach(A=>{try{A(R,o.runtimeConfig)}catch(O){T.error("MoliGlobal","beforeRequestAds hook failed",O)}});let x=o.runtimeConfig.hooks.afterRequestAds;if(((m=R.spa)==null?void 0:m.enabled)===!0){let A=o.runtimeConfig,O=r.initialize(R,A);return o={state:"spa-requestAds",config:R,initialized:O,modules:o.modules,href:i.location.href,runtimeConfig:Object.freeze(ee(o.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:ee(o.runtimeConfig)},O.then(()=>r.requestAds(R,A)).then(()=>{var W,te;let v=(te=(W=R.spa)==null?void 0:W.validateLocation)!=null?te:"href";if(o.state==="spa-requestAds"&&qe(v,o.href,i.location)){r.refreshAdSlots(o.runtimeConfig.refreshSlots,o.config,o.runtimeConfig),x.forEach(Ct=>Ct("spa-finished"));let ge=w(y({},o),{state:"spa-finished",nextRuntimeConfig:ee(o.runtimeConfig),runtimeConfig:ee(o.runtimeConfig,{keepTargeting:!0})});return o=ge,ge}else return o.state==="spa-finished"||o.state==="spa-requestAds"?(k(o.runtimeConfig,i).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),o):Promise.reject(`reached invalid state [${o.state}]`)})}else return o={state:"requestAds",config:R,modules:o.modules,runtimeConfig:Object.freeze(o.runtimeConfig)},r.initialize(R,o.runtimeConfig).then(A=>r.requestAds(A,o.runtimeConfig)).then(()=>(o={state:"finished",config:R,runtimeConfig:o.runtimeConfig,modules:o.modules},x.forEach(A=>A("finished")),Promise.resolve(o))).catch(A=>(k(o.runtimeConfig,i).error("MoliGlobal",A),o={state:"error",config:R,runtimeConfig:o.runtimeConfig,error:A,modules:o.modules},x.forEach(O=>O("error")),Promise.resolve(o)))}case"spa-requestAds":case"spa-finished":{o.state==="spa-requestAds"&&k(o.runtimeConfig,i).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),he(),G(o.config.domain);let{modules:P}=o,R=o.nextRuntimeConfig.hooks.afterRequestAds,T=o.nextRuntimeConfig.hooks.beforeRequestAds,x=o;T.forEach(v=>{try{v(x.config,o.runtimeConfig)}catch(W){k(o.runtimeConfig,i).error("MoliGlobal","beforeRequestAds hook failed",W)}});let{initialized:V,href:A,nextRuntimeConfig:O}=o;return o=w(y({},x),{state:"spa-requestAds",runtimeConfig:ee(o.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:ee(o.runtimeConfig)}),V.then(v=>{var te,ge;let W=(ge=(te=v.spa)==null?void 0:te.validateLocation)!=null?ge:"href";return Bi(W,A,i.location)?r.requestAds(v,O).then(()=>v):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${W} for validation.`)}).then(v=>(r.refreshAdSlots(o.runtimeConfig.refreshSlots,v,o.runtimeConfig),o={state:"spa-finished",config:v,initialized:V,modules:P,href:i.location.href,runtimeConfig:o.runtimeConfig,nextRuntimeConfig:ee(o.runtimeConfig)},R.forEach(W=>W("spa-finished")),o))}case"requestAds":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return k(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",o.error),Promise.reject()}}function B(m,P){var T,x;let R=typeof m=="string"?[m]:m;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshSlots.push(...R),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshSlots.push(...R),Promise.resolve("queued");case"spa-finished":let V=(x=(T=o.config.spa)==null?void 0:T.validateLocation)!=null?x:"href";return qe(V,o.href,i.location)?r.refreshAdSlots(R,o.config,o.runtimeConfig,P).then(()=>"refreshed"):(o.nextRuntimeConfig.refreshSlots.push(...R),Promise.resolve("queued"));case"finished":case"requestAds":return r.refreshAdSlots(R,o.config,o.runtimeConfig,P).then(()=>"refreshed");default:return k(o.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function $(m,P){var R,T;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:m,idOfConfiguredSlot:P}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:m,idOfConfiguredSlot:P}),Promise.resolve("queued");case"spa-finished":let x=(T=(R=o.config.spa)==null?void 0:R.validateLocation)!=null?T:"href";return qe(x,o.href,i.location)?(o=w(y({},o),{config:je(o.config,P,m,k(o.runtimeConfig,i))}),r.refreshAdSlots([m],o.config,o.runtimeConfig).then(()=>"refreshed")):(o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:m,idOfConfiguredSlot:P}),Promise.resolve("queued"));case"finished":case"requestAds":return o=w(y({},o),{config:je(o.config,P,m,k(o.runtimeConfig,i))}),r.refreshAdSlots([m],o.config,o.runtimeConfig).then(()=>"refreshed");default:return k(o.runtimeConfig,i).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function X(m,P){var T,x,V;function R(A){let O=A.slots.filter(v=>v.behaviour.bucket&&(typeof v.behaviour.bucket=="string"&&v.behaviour.bucket===m||Object.values(v.behaviour.bucket).includes(m)));return O==null?void 0:O.map(v=>v.domId)}switch(o.state){case"configurable":{let A=(T=n.moli.getConfig())==null?void 0:T.slots.filter(v=>v.behaviour.bucket===m),O=A==null?void 0:A.map(v=>v.domId);return O!=null&&O.length?(o.runtimeConfig.refreshSlots.push(...O),Promise.resolve("queued")):Promise.reject("no configurable domIds for buckets")}case"configured":{let A=R(o.config);return o.runtimeConfig.refreshSlots.push(...A),Promise.resolve("queued")}case"spa-requestAds":{let A=R(o.config);return o.runtimeConfig.refreshSlots.push(...A),Promise.resolve("queued")}case"spa-finished":{let A=(V=(x=o.config.spa)==null?void 0:x.validateLocation)!=null?V:"href";if(qe(A,o.href,i.location))return r.refreshBucket(m,o.config,o.runtimeConfig,P).then(()=>"refreshed");{let O=R(o.config);return o.runtimeConfig.refreshSlots.push(...O),Promise.resolve("queued")}}case"finished":case"requestAds":return r.refreshBucket(m,o.config,o.runtimeConfig).then(()=>"refreshed");default:return k(o.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function Q(){return o.state}function de(){return o.modules}function Me(m){switch(o.state){case"configurable":{k(o.runtimeConfig,i).error("MoliGlobal","Cannot open console before configuration");break}default:e.loadScript({assetUrl:m!=null?m:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${ke.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(P=>console.error("failed to load moli debugger",P))}}function he(){let m="ABtest",R=Se(i.location.search).get(m),T=R?Number(R):Math.floor(Math.random()*100)+1;s(m,T.toString())}function G(m){let P=m||Ee(i.location.hostname);P&&a(P)}function Lt(){return e}function ee(m,P){var R,T,x,V,A,O,v;return{environment:(R=m==null?void 0:m.environment)!=null?R:"production",hooks:{beforeRequestAds:(T=m==null?void 0:m.hooks.beforeRequestAds)!=null?T:[],afterRequestAds:(x=m==null?void 0:m.hooks.afterRequestAds)!=null?x:[]},logger:(V=m==null?void 0:m.logger)!=null?V:void 0,adUnitPathVariables:(P==null?void 0:P.keepTargeting)===!0?(A=m==null?void 0:m.adUnitPathVariables)!=null?A:{}:{},labels:(P==null?void 0:P.keepTargeting)===!0?(O=m==null?void 0:m.labels)!=null?O:[]:[],keyValues:(P==null?void 0:P.keepTargeting)===!0?(v=m==null?void 0:m.keyValues)!=null?v:{}:{},refreshSlots:[],refreshInfiniteSlots:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[],requestBidsSteps:[],prebidBidsBackHandler:[]}}}return{que:{push(m){m(n.moli)}},version:ke.version,setTargeting:s,addLabel:a,setLogger:p,setAdUnitPathVariables:d,resolveAdUnitPath:l,beforeRequestAds:c,afterRequestAds:g,getConfig:b,getRuntimeConfig:S,getPageTargeting:f,registerModule:h,configure:E,requestAds:C,refreshAdSlot:B,refreshBucket:X,refreshInfiniteAdSlot:$,getModuleMeta:de,getState:Q,openConsole:Me,getAssetLoaderService:()=>e,addEventListener:t.addEventListener,removeEventListener:t.removeEventListener}};var Li=i=>{let e=i,t=e.moli?[...e.moli.que]:[],r=qi(i);return e.moli=r,t.forEach(n=>n(r)),r};Li(window);var no=i=>i==="android"?"aaid":i==="ios"?"idfa":void 0,Ui=(i,e,t,r,n,o,s,a)=>{let d=no(typeof n=="string"?n:n[0]),u=r.reduce((c,g)=>y(y({},c),g),{}),l=r.length?`&kv=${JSON.stringify(u)}`:"",p=a?`&gdpr_consent=${a}`:"";o(`https://api.theadex.com/collector/v1/ifa/c/${i}/t/${e}/request?&ifa=${t}&ifa_type=${d}${l}${p}`).catch(c=>s.error(c))};var _i=(i,e,t)=>{let r=i[e.key],n=kt(i,e.valueType,e.valueKey);if(!r||Array.isArray(r)||n===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(n)&&e.defaultValue===void 0){t.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,r,n);return}let o=ji(n,e,t);return{[e.attribute]:{[r]:o}}},Vi=(i,e,t)=>{let r=kt(i,e.adexValueType,e.key);if(r===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(r)&&e.defaultValue===void 0||Array.isArray(r))){t.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,r);return}let n=ji(r,e,t);return{[e.attribute]:n}},Ni=(i,e,t)=>{let r=kt(i,"string",e.key);if(r===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof r=="number"){t.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,r);return}let n=ao(r,e,t);return{[e.attribute]:n}},zi=i=>Object.fromEntries(i.sort().map(e=>[e,1])),so=i=>i.sort().join(","),kt=(i,e,t)=>e==="number"?Number(i[t]):i[t],ji=(i,e,t)=>i!==void 0&&!Number.isNaN(i)?Array.isArray(i)?so(i):i:Fi(e,t),ao=(i,e,t)=>i===void 0?Fi(e,t):Array.isArray(i)?zi(i):{[i]:1},Fi=(i,e)=>(e.warn("Adex DMP","using defaultValue",i.defaultValue,"as fallback for key",i.key),i.adexValueType==="list"?i.defaultValue?zi(i.defaultValue):void 0:i.defaultValue);var ae=I.responses.TCPurpose,it=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[ae.STORE_INFORMATION_ON_DEVICE,ae.SELECT_BASIC_ADS,ae.CREATE_PERSONALISED_ADS_PROFILE,ae.SELECT_PERSONALISED_ADS,ae.CREATE_PERSONALISED_CONTENT_PROFILE,ae.SELECT_PERSONALISED_CONTENT,ae.MEASURE_AD_PERFORMANCE,ae.MEASURE_CONTENT_PERFORMANCE,ae.APPLY_MARKET_RESEARCH,ae.DEVELOP_IMPROVE_PRODUCTS].every(t=>e.purpose.consents[t]);this.getOrInitAdexQueue=e=>{let t=e;return t._adexc=t._adexc||[],t};this.getAdexKeyValues=(e,t)=>{var n;let r=y(y({},(n=e.config.targeting)==null?void 0:n.keyValues),e.runtimeConfig.keyValues);if(Object.keys(r).length>0)return t.mappingDefinitions.map(o=>{switch(o.adexValueType){case"map":return _i(r,o,e.logger);case"list":return Ni(r,o,e.logger);default:return Vi(r,o,e.logger)}}).filter(U)};this.configureAdexC=(e,t)=>{let r=this.getOrInitAdexQueue(e.window),n=this.getAdexKeyValues(e,t);n?r._adexc.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"ut","_kv",[n.reduce((o,s)=>y(y({},o),s),{}),t.spaMode?1:0]]):e.logger.warn("Adex DMP","targeting key/values are empty")}}config(){return this.adexConfig}configure(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}initSteps(){let e=this.adexConfig;return e?[D("DMP module setup",t=>this.track(t,e))]:[]}configureSteps(){let e=this.adexConfig;return e!=null&&e.spaMode?[_("DMP module setup",t=>(this.configureAdexC(t,e),Promise.resolve()))]:[]}track(e,t){var d,u;let{adexCustomerId:r,adexTagId:n,appConfig:o}=t;this.configureAdexC(e,t);let s=this.getAdexKeyValues(e,t),a=y(y({},(d=e.config.targeting)==null?void 0:d.keyValues),e.runtimeConfig.keyValues);if(this.hasRequiredConsent(e.tcData)&&!this.isLoaded&&Object.keys(a).length>0){this.isLoaded=!0;let l=U(o)&&U(a[o.advertiserIdKey])&&(a[o.clientTypeKey]==="android"||a[o.clientTypeKey]==="ios");if(o!=null&&o.advertiserIdKey&&l){let p=e.tcData.gdprApplies?e.tcData.tcString:void 0,c=a[o.advertiserIdKey];typeof c=="string"&&s&&Ui(r,o.adexMobileTagId?o.adexMobileTagId:n,c,s,(u=a[o.clientTypeKey])!=null?u:"",e.window.fetch,e.logger,p)}else e.assetLoaderService.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${r}/${n}/s/adex.js`,loadMethod:1}).catch(p=>e.logger.error("failed to load adex",p))}return Promise.resolve()}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new it);var Ce=class Ce{constructor(e,t,r,n,o,s,a,d){this.userActivityService=e;this.refreshInterval=t;this.refreshIntervalOverrides=r;this.useIntersectionObserver=n;this.disableAdVisibilityChecks=o;this.viewabilityOverrides=s;this.window=a;this.logger=d;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var r;(r=this.logger)==null||r.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId());let t=this.observedDomElementForSlot(e);this.intersectionObserver&&t&&this.intersectionObserver.unobserve(t.target)};this.handleGoogletagAdVisibilityChanged=e=>{var n;let t=e.slot,r=this.visibilityRecordForGoogletagEvent(e);r&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${t.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(r,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,t)=>{var r,n,o;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(r=this.logger)==null||r.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}t>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(o=this.logger)==null||o.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var l;this.minimalAdVisibilityRatio=o?0:.5,this.visibilityRecords=new Map,(n||Object.values(s).some(p=>(p==null?void 0:p.variant)==="css"))&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new this.window.IntersectionObserver(p=>this.handleObservedAdVisibilityChanged(p),{threshold:this.minimalAdVisibilityRatio})),n||this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged),this.userActivityService.addUserActivityChangedListener(p=>this.handleUserActivityChanged(p)),this.setUpdateTimer(!0),(l=this.logger)==null||l.debug("AdVisibilityService","initialized")}trackSlot(e,t,r){var s;let n=e.getSlotElementId(),o=this.observedDomElementForSlot(e);if(o){(s=this.logger)==null||s.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(n)&&this.removeSlotTracking(e);let a=o.viewabilityOverride;this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks||(a==null?void 0:a.variant)==="disabled"&&(a.disableAllAdVisibilityChecks||!(a.disabledAdVisibilityCheckAdvertiserIds&&a.disabledAdVisibilityCheckAdvertiserIds.length>0&&r)||a.disabledAdVisibilityCheckAdvertiserIds.includes(r))?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:t}),this.intersectionObserver&&(o.targetOverride||this.useIntersectionObserver)&&this.intersectionObserver.observe(o.target)}}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),Ce.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var t;if(e.latestStartVisible){let r=this.window.performance.now(),n=Math.round(r-e.latestStartVisible);e.durationVisibleSum+=n,e.latestStartVisible=r,(t=this.logger)==null||t.debug("AdVisibilityService",`added ${n}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let t=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>t}).forEach(e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-Ce.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(t=>{var n;let r=this.visibilityRecordForEntry(t);r&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${r.slot.getSlotElementId()} changed. Visible area: ${t.intersectionRatio*100}%`),this.updateVisibilityRecord(r,t.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(t=>{t.latestStartVisible&&(t.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}observedDomElementForSlot(e){let t=e.getSlotElementId(),r=this.viewabilityOverrides[t],n=this.window.document.getElementById(t),o=r&&r.variant==="css"?this.window.document.querySelector(r.cssSelector):null;return o?{target:o,targetOverride:!0,viewabilityOverride:r}:n?{target:n,targetOverride:!1,viewabilityOverride:r}:null}};Ce.updateVisibilityInterval=1e3,Ce.consecutiveDurationToRefresh=1500;var rt=Ce;var lo=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Re=class Re{constructor(e,t={level:"strict"},r){this.window=e;this.userActivityLevelControl=t;this.logger=r;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var n;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(n=this.logger)==null||n.debug("UserActivityService","initialized"),t.level){case"custom":this.userActivityDuration=t.userActivityDuration,this.userBecomingInactiveDuration=t.userBecomingInactiveDuration;break;default:let{userActivityDuration:o,userBecomingInactiveDuration:s}=lo.get(t.level);this.userActivityDuration=o,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Re.observedEvents.forEach(t=>this.window.removeEventListener(t,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Re.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Re.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Re.observedEvents=["mousemove","touchstart","scroll","keypress"];var ot=Re;var nt=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,t,r,n)=>{if(e.env==="test"){e.logger.info("AdReload","disabled in environment test");return}this.initialized||(e.logger.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(t,e.window,e.logger),this.setupSlotRenderListener(t,r,n,e.window,e.logger),this.initialized=!0)};this.setupAdVisibilityService=(e,t,r)=>{var n,o;this.adVisibilityService=new rt(new ot(t,e.userActivityLevelControl,r),this.refreshIntervalMs,(n=e.refreshIntervalMsOverrides)!=null?n:{},!1,!!e.disableAdVisibilityChecks,(o=e.viewabilityOverrides)!=null?o:{},t,r)};this.setupSlotRenderListener=(e,t,r,n,o)=>n.googletag.pubads().addEventListener("slotRenderEnded",s=>{var B;let{slot:a,campaignId:d,advertiserId:u,yieldGroupIds:l,isEmpty:p}=s,c=a.getSlotElementId(),g=t.indexOf(c)>-1,b=!d||e.excludeOrderIds.indexOf(d)===-1,S=!!d&&e.includeOrderIds.indexOf(d)>-1,f=!!u&&e.includeAdvertiserIds.indexOf(u)>-1,h=!!l&&e.includeYieldGroupIds.some($=>l.indexOf($)>-1),E=!p&&g&&b&&(S||f||h);E||this.logTrackingDisallowedReason(c,{slotIsEmpty:p,slotIsMonitored:g,orderIdNotExcluded:b,orderIdIncluded:S,advertiserIdIncluded:f,yieldGroupIdIncluded:h},o,l,d,u);let C=!!((B=this.adVisibilityService)!=null&&B.isSlotTracked(c));E?this.adVisibilityService.trackSlot(a,r,u):C&&this.adVisibilityService.removeSlotTracking(a)});this.reloadAdSlot=(e,t)=>r=>{let n=r.getSlotElementId(),o=t.config.slots.find(s=>s.domId===n);if(o&&o.behaviour.loaded!=="infinite"){t.logger.debug("AdReload","fired slot reload",o.domId);let s=this.maybeOptimizeSlotForCls(e,o,r,t.logger,t.window);r.setTargeting(this.reloadKeyValue,"true");let d=(()=>{var l,p;if(((p=(l=e.viewabilityOverrides)==null?void 0:l[n])==null?void 0:p.refreshBucket)===!0){let c=o.behaviour.bucket;return typeof c=="string"?c:c==null?void 0:c[t.labelConfigService.getDeviceLabel()]}})();d?t.window.moli.refreshBucket(d).then(u=>t.logger.debug("AdReload",`refreshBucket '${d}' result`,u)).catch(u=>t.logger.error("AdReload",`refreshBucket '${d}' failed`,u)):t.window.moli.refreshAdSlot(n,y({loaded:o.behaviour.loaded},s&&{sizesOverride:s})).catch(u=>t.logger.error("AdReload",`refreshing ${n} failed`,u))}};this.maybeOptimizeSlotForCls=(e,t,r,n,o)=>{let s=t.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let a=o.document.getElementById(s);if(a&&a.style){let d=a.scrollHeight;a.style.setProperty("height",`${d}px`);let u=t.sizes.filter(l=>l!=="fluid"&&l[1]<=d);return n.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${d}px`,"new sizes:",u),u.length<t.sizes.filter(l=>l!=="fluid").length&&o.googletag.destroySlots([r]),u}n.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return t.sizes};this.logTrackingDisallowedReason=(e,t,r,n,o,s)=>{let{slotIsEmpty:a,slotIsMonitored:d,orderIdNotExcluded:u,orderIdIncluded:l,advertiserIdIncluded:p,yieldGroupIdIncluded:c}=t;a&&r.debug("AdReload",e,"slot not tracked: reported empty"),d||r.debug("AdReload",e,"slot not tracked: excluded by DOM id"),u||r.debug("AdReload",e,"slot not tracked: excluded by order id",o),l||p||c||r.debug("AdReload",e,"slot not tracked: neither order id",o,"nor advertiser id",s,"nor yieldGroup id",n,"included")}}config(){return this.moduleConfig}isInitialized(){return this.initialized}configure(e){var t;(t=e==null?void 0:e.adReload)!=null&&t.enabled&&(this.moduleConfig=e.adReload)}initSteps(){return[]}configureSteps(){let e=this.moduleConfig;return e?[_(this.name,t=>{let r=t.config.slots.filter(o=>e.excludeAdSlotDomIds.indexOf(o.domId)===-1).map(o=>o.domId).filter(U),n=this.reloadAdSlot(e,t);return t.logger.debug("AdReload","monitoring slots",r),this.initialize(t,e,r,n),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new nt);var st=class{constructor(){this.name="Blocklist URLs";this.description="Blocks ad requests entirely or adds key-values for blocklistd urls";this.moduleType="policy";this.blocklistConfig=null;this.isBlocklisted=(e,t,r)=>e.urls.some(({pattern:n,matchType:o})=>{switch(o){case"exact":return t===n;case"contains":return t.indexOf(n)>-1;case"regex":try{let s=RegExp(n).test(t);return s&&r.debug(this.name,`Url '${t}' matched pattern '${n}'`),s}catch(s){return r.error(this.name,`Invalid pattern ${n}`,s),!1}}});this.blocklistCache=null}config(){return this.blocklistConfig}configure(e){e!=null&&e.blocklist&&e.blocklist.enabled&&(this.blocklistConfig=e.blocklist)}initSteps(){return this.blocklistConfig?[D("blocklist-urls-init",t=>{var r;switch((r=this.blocklistConfig)==null?void 0:r.mode){case"key-value":let n=this.blocklistConfig.key,o=this.blocklistConfig.isBlocklistedValue||"true";return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{this.isBlocklisted(s,t.window.location.href,t.logger)&&t.window.googletag.pubads().setTargeting(n,o)});case"block":return this.getBlocklist(this.blocklistConfig.blocklist,t.assetLoaderService,t.logger)().then(s=>{if(t.logger.debug(this.name,"using blocklist",s),this.isBlocklisted(s,t.window.location.href,t.logger))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[]}getBlocklist(e,t,r){switch(e.provider){case"static":return()=>Promise.resolve(e.blocklist);case"dynamic":let n;return()=>(n||(n=this.loadConfigWithRetry(t,e.endpoint,3).catch(o=>(r.error(this.name,"Fetching blocklisted urls failed",o),{urls:[]}))),n)}}loadConfigWithRetry(e,t,r,n=null){return r<=0?Promise.reject(n):(this.blocklistCache||(this.blocklistCache=e.loadJson("blocklist-urls.json",t).catch(o=>new Promise(a=>setTimeout(a,100/r)).then(()=>this.loadConfigWithRetry(e,t,r-1,o)))),this.blocklistCache)}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new st);var at=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(e,t)=>{t.forEach(r=>{"cssSelectors"in r.deleteMethod?r.deleteMethod.cssSelectors.forEach(n=>{let o=e.window.document.querySelectorAll(n);e.logger.debug("Cleanup Module",`Remove elements with selector ${n} from dom`,o),o.forEach(s=>{try{s.remove()}catch(a){e.logger.error("Cleanup Module",`Error removing element with selector ${n}`,a)}})}):r.deleteMethod.jsAsString.forEach(n=>{try{e.logger.debug("Cleanup Module",`Try to execute string as JS: '${n}'`),new Function(n)()}catch(o){e.logger.error("Cleanup Module",`Error executing JS string: '${n}'`,o)}})})};this.hasBidderWonLastAuction=(e,t)=>{var o;return((o=e.window.pbjs.getAllWinningBids().find(s=>s.adUnitCode===t.domId))==null?void 0:o.bidder)===t.bidder}}configure(e){e!=null&&e.cleanup&&e.cleanup.enabled&&(this.cleanupConfig=e.cleanup)}config(){return this.cleanupConfig}initSteps(){return[]}configureSteps(){let e=this.cleanupConfig;return e?[J("destroy-out-of-page-ad-format",t=>(t.runtimeConfig.environment==="test"||t.window.pbjs.que.push(()=>{let r=e.configs.filter(n=>this.hasBidderWonLastAuction(t,n));this.cleanUp(t,r)}),Promise.resolve()))]:[]}prepareRequestAdsSteps(){let e=this.cleanupConfig;return e?[N("cleanup-before-ad-reload",$e,(t,r)=>(t.runtimeConfig.environment==="test"||t.window.pbjs.que.push(()=>{let n=e.configs.filter(o=>r.map(s=>s.moliSlot.domId).includes(o.domId)).filter(o=>this.hasBidderWonLastAuction(t,o));this.cleanUp(t,n)}),Promise.resolve()))]:[]}};window.moli.registerModule(new at);var dt=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}config(){return this.confiantConfig}configure(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}initSteps(){let e=this.confiantConfig;return e?[D("confiant-init",t=>this.loadConfiant(t,e))]:[]}loadConfiant(e,t){var r;return e.env==="test"||e.tcData.gdprApplies&&(!e.tcData.purpose.consents[1]||!(!((r=this.confiantConfig)!=null&&r.checkGVLID)||e.tcData.vendor.consents[this.gvlid]))||e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:t.assetUrl}).catch(n=>e.logger.error("failed to load confiant",n)),Promise.resolve()}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new dt);var uo=(i,e)=>{var r;let t=(r=i.config.targeting)==null?void 0:r.keyValues[e];return t?`&device_id=${typeof t=="string"?t:t[0]}`:""},$i=(i,e,t,r,n)=>{let o=uo(i,e.advertiserIdKey),s=i.tcData.gdprApplies?`gdpr=1&gdpr_consent=${i.tcData.tcString}`:"gdpr=0",a=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",d=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",u="",l=y(y({},e.additionalIdentifier),t);Object.entries(l).forEach(([b,S])=>{u+=`&${b}=${encodeURIComponent(S)}`});let p="",c=y(y({},e.customKeywords),r);Object.entries(c).forEach(([b,S])=>{p+=`&${b}=${encodeURIComponent(S)}`});let g=n.createElement("img");g.src=`https://aps.xplosion.de/data?sid=${e.sid}${o}&os=${e.os}&app_id=${e.appId}${d}${a}${u}${p}&${s}`,g.width=1,g.height=1,n.body.append(g)};var po=(i,e)=>{var r;if(e.os==="web")return;let t=(r=i.config.targeting)==null?void 0:r.keyValues[e.advertiserIdKey];if(t)return typeof t=="string"?t:t[0]},Gi=(i,e,t)=>{try{let n="moli_emetriq",o=i.getItem(n),s=o?Number.parseInt(o,10):0,a=e-864e5>s;return a&&(i.setItem(n,e.toString()),t.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),a}catch(r){return t.error("emetriq","could not access session storage",r),!1}},Wi=(i,e,t,r)=>{if(!e.login){r.warn("emetriq","login configuration missing!");return}let n=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);n.searchParams.append("guid",e.login.guid),i.tcData.gdprApplies?(n.searchParams.append("gdpr","1"),n.searchParams.append("gdpr_consent",i.tcData.tcString)):n.searchParams.append("gdpr","0");let o=po(i,e);if(o)switch(e.os){case"android":n.searchParams.append("adid",o);break;case"ios":n.searchParams.append("idfa",o);break}let s=t.createElement("img");s.src=n.href,s.width=1,s.height=1,t.body.append(s)};var lt=class i{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}config(){return this.emetriqConfig}configure(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}initSteps(){let e=this.emetriqConfig;return e?[D("load-emetriq",t=>{var n;let r=i.staticCustomParams(y(y({},(n=t.config.targeting)==null?void 0:n.keyValues),t.runtimeConfig.keyValues),e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||i.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"web":this.loadEmetriqScript(t,e,o,r);break}}),Promise.resolve()})]:[]}configureSteps(){let e=this.emetriqConfig;return e?[J("track-emetriq",t=>{var n;let r=i.staticCustomParams(y(y({},(n=t.config.targeting)==null?void 0:n.keyValues),t.runtimeConfig.keyValues),e.customMappingDefinition);return t.env==="test"||this.checkIfConsentIsMissing(t)||(e.login&&Gi(t.window.sessionStorage,Date.now(),t.logger)&&Wi(t,e,t.window.document,t.logger),i.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"android":case"ios":$i(t,e,o,r,t.window.document);break}})),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}checkIfConsentIsMissing(e){return e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid]?(e.logger.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,t,r,n){let o=e.window;return o._enqAdpParam=y(y(y({},t._enqAdpParam),r),n),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${t._enqAdpParam.sid}/default.js`}).catch(s=>e.logger.error("failed to load emetriq",s))}static syncDelay(e,t){return t?typeof t=="number"?new Promise(r=>e.window.setTimeout(()=>r({}),t)):e.window.pbjs?new Promise(r=>{e.window.pbjs.que.push(()=>{let n=()=>{r(i.prebidIdentifiers(e)),e.window.pbjs.offEvent("auctionEnd",n)};e.window.pbjs.onEvent("auctionEnd",n)})}):(e.logger.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,t){let r={};return(t!=null?t:[]).forEach(({param:n,key:o})=>{let s=e[o];s&&(r[n]=typeof s=="string"?s:s.join(","))}),r}static prebidIdentifiers(e){let t={},r=e.window.pbjs.getUserIds();return r.amxId&&(t.id_amxid=r.amxId),r.idl_env&&(t.id_liveramp=r.idl_env),r.IDP&&(t.id_zeotap=r.IDP),r.pubcid&&(t.id_sharedid=r.pubcid),r.id5id&&(t.id_id5=r.id5id.uid),t}};window.moli.registerModule(new lt);var ut=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}config(){return this.identityLinkConfig}configure(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}initSteps(){let e=this.identityLinkConfig;return e?[D(this.name,t=>(this.loadAts(t,e),Promise.resolve()))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}loadAts(e,t){if(e.env==="test"||e.tcData.gdprApplies&&!e.tcData.vendor.consents[this.gvlid])return Promise.resolve();let r=e.window;return r.addEventListener("envelopeModuleReady",()=>{r.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:t.hashedEmailAddresses})}),e.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${t.launchPadId}/launchpad-liveramp.js`}).catch(n=>e.logger.error("failed to load emetriq",n))}};window.moli.registerModule(new ut);var Ki=i=>{let e=i.filter(r=>r.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:r=>{let n=r.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:n?e.find(s=>s.domId===n):e[0],configSlotDomId:n}}}};var pt=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,t)=>{var u;if(this.initialized)return;this.initialized=!0,(u=e.logger)==null||u.debug(this.name,"initialize moli lazy load module");let r=t.slots,n=t.buckets,o=t.infiniteSlots,s=e.window;r.forEach(l=>{let p=new s.IntersectionObserver(c=>{var g;(g=e.logger)==null||g.debug(this.name,"lazy-load slots called with",c),c.forEach(b=>{var S;b.isIntersecting&&((S=e.logger)==null||S.debug(this.name,`Trigger ad slot with DOM ID ${b.target.id}`),s.moli.refreshAdSlot(b.target.id),p.unobserve(b.target))})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});this.observers.push(p),l.domIds.forEach(c=>{var b,S;let g=e.config.slots.find(f=>f.domId===c);if(!g)(b=e.logger)==null||b.warn(this.name,`Lazy-load non-existing slot with domID ${c}`);else if(g.behaviour.loaded!=="manual")(S=e.logger)==null||S.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${c}`);else if(g.behaviour.loaded==="manual"){let f=s.document.getElementById(c);f&&p.observe(f)}})}),n.forEach(l=>{var c,g,b,S;let p=new s.IntersectionObserver(f=>{f.forEach(h=>{var E,C,B;if(h.isIntersecting&&h.target.id===l.observedDomId)if(((E=e.config.slots.find(X=>X.domId===l.observedDomId))==null?void 0:E.behaviour.bucket)!==l.bucket)(C=e.logger)==null||C.warn(this.name,`${l.observedDomId} doesn't belong to ${l.bucket}`);else{let X=e.config.slots.filter(Q=>Q.behaviour.bucket===l.bucket).map(Q=>Q.domId);(B=e.logger)==null||B.debug(`Refresh ${l.bucket}`,`Trigger ad slots with DOM IDs [${X.join(", ")}]`),s.moli.refreshBucket(l.bucket),p.unobserve(h.target)}})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});if(this.observers.push(p),(c=e.config.buckets)!=null&&c.enabled||(g=e.logger)==null||g.warn(this.name,"GlobalBucket config isn't enabled"),!((b=e.config.buckets)!=null&&b.bucket&&e.config.buckets.bucket[l.bucket]))(S=e.logger)==null||S.error(this.name,`Lazy-load non-existing bucket with name ${l.bucket}`);else{let f=s.document.getElementById(l.observedDomId);f&&p.observe(f)}});let{configuredInfiniteSlots:a,findSlot:d}=Ki(e.config.slots);(o||[]).forEach(l=>{var c;let p="data-h5-serial-number";if(a.length>0){let g=new s.IntersectionObserver(S=>{S.forEach(f=>{var h,E,C,B;if(f.isIntersecting){let{configuredInfiniteSlot:$,configSlotDomId:X}=d(f.target);if($){let Q=(E=(h=f.target.attributes)==null?void 0:h.getNamedItem(p))==null?void 0:E.value,de=`${$.domId}-${Q}`;f.target.setAttribute("id",de),(C=e.logger)==null||C.debug(this.name,`Trigger ad slot with newly created DOM ID ${de}`),s.moli.refreshInfiniteAdSlot(de,$.domId),g.unobserve(f.target)}else(B=e.logger)==null||B.error(this.name,`No infinite-scrolling slot configured for ${X}`),g.unobserve(f.target)}})},{root:l.options.rootId?s.document.getElementById(l.options.rootId):null,threshold:l.options.threshold,rootMargin:l.options.rootMargin});this.observers.push(g),s.document.querySelectorAll(l.selector).forEach((S,f)=>{S.setAttribute(p,`${f+1}`),S&&g.observe(S)})}else(c=e.logger)==null||c.warn(this.name,"No infinite-scrolling slots configured!")})}}config(){return this.lazyloadConfig}configure(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}initSteps(){return[]}configureSteps(){let e=this.lazyloadConfig;return e?[J("lazy-module-configuration",t=>(this.initialized=!1,this.observers.forEach(r=>r.disconnect()),this.observers.length=0,this.registerIntersectionObservers(t,e),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new pt);var ct=class i{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}config(){return this.moduleConfig}configure(e){var t;if((t=e==null?void 0:e.prebidFirstPartyData)!=null&&t.enabled){let r=e.prebidFirstPartyData;this._configureSteps=[_("prebid-fpd-module-configure",n=>i.setPrebidFpdConfig(n,r,n.logger))]}}initSteps(){return[]}configureSteps(){return this._configureSteps}prepareRequestAdsSteps(){return[]}static setPrebidFpdConfig(e,t,r){var n;if(e.config.prebid){let o=((n=e.config.targeting)==null?void 0:n.keyValues)||{},s=t.gptTargetingMappings;e.window.pbjs.que.push(()=>{var u,l,p,c,g,b,S,f;let a=e.window.pbjs.readConfig().ortb2||{},d=Ze({},t.staticPrebidFirstPartyData,a);if(s){let h=y({cat:[],sectioncat:[],pagecat:[]},d.site);if(s.cat){let E=i.extractKeyValueArray(s.cat,o);(u=h.cat)==null||u.push(...E),(l=h.pagecat)==null||l.push(...E),(p=h.sectioncat)==null||p.push(...E)}if(s.sectionCat&&(h.sectioncat=i.extractKeyValueArray(s.sectionCat,o)),s.pageCat&&(h.pagecat=i.extractKeyValueArray(s.pageCat,o)),h.cat&&(h.cat=h.cat.filter(j)),h.sectioncat&&(h.sectioncat=h.sectioncat.filter(j)),h.pagecat&&(h.pagecat=h.pagecat.filter(j)),!t.iabDataProviderName&&(s.iabV2||s.iabV3)&&r.error("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Data Segments will not be set."),h.content=w(y({},h.content),{data:(b=(g=(c=h.content)==null?void 0:c.data)==null?void 0:g.filter(E=>E.name!==t.iabDataProviderName))!=null?b:[]}),s.iabV2&&t.iabDataProviderName){let E=i.extractKeyValueArray(s.iabV2,o),C={name:t.iabDataProviderName,ext:{segtax:6},segment:E.map(B=>({id:B})).filter(j)};(S=h.content.data)==null||S.push(C)}if(s.iabV3&&t.iabDataProviderName){let E=i.extractKeyValueArray(s.iabV3,o),C={name:t.iabDataProviderName,ext:{segtax:7},segment:E.map(B=>({id:B})).filter(j)};(f=h.content.data)==null||f.push(C)}d.site=h}e.window.pbjs.setConfig({ortb2:d})})}return Promise.resolve()}static extractKeyValueArray(e,t){let r=t[e];return r?typeof r=="string"?[r]:r:[]}};window.moli.registerModule(new ct);var gt=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}config(){return this.pubstackConfig}configure(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}initSteps(){let e=this.pubstackConfig;return e?[D("pubstack-init",t=>(t.env==="test"||t.assetLoaderService.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(r=>t.logger.error("failed to load pubstack",r)),Promise.resolve()))]:[]}configureSteps(){return this.pubstackConfig?[_("pubstack-configure",t=>{if(t.env==="test")return Promise.resolve();let r=["0","1","2","3"],n=t.window.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return n&&n.content&&r.includes(n.content)&&t.window.googletag.pubads().setTargeting("pbstck_ab_test",n.content),Promise.resolve()})]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new gt);var Yi="footer-ad-close-button",co="[data-ref=h5-footer-ad-container]",go=`[data-ref=${Yi}]`,mt={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},Hi=(i,e,t,r)=>n=>{let o=n.slot,s=i.document.body.querySelector(co),a=i.document.getElementById(e),d=()=>{var l;o.getSlotElementId()===e&&s&&((l=i.googletag)==null||l.destroySlots([o]),s.remove())};if(!s||!a||o.getSlotElementId()!==e||n.isEmpty||n.advertiserId&&t.includes(n.advertiserId)||i.matchMedia("(max-width: 767px)").matches){r.debug("[footer-ad]","remove footer ad container");return}if(i.document.body.querySelector(go))return;let u=document.createElement("button");u.classList.add(mt.footerAdClose),u.setAttribute("aria-label","Anzeige entfernen"),u.setAttribute("data-ref",Yi),a.classList.add(mt.adSlot),Array.isArray(n.size)&&n.size[1]>200&&i.matchMedia("(max-height: 800px)").matches&&a.classList.add(mt.isShiftedBottom),s.classList.add(mt.container),s.style.setProperty("display","block"),s.appendChild(u),u.addEventListener("click",()=>d())},Ji=(i,e,t,r,n)=>{e==="production"?i.googletag.pubads().addEventListener("slotRenderEnded",Hi(i,r,n,t)):Hi(i,r,n,t)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>r}})};var Xi="[data-ref=sticky-ad]",Qi="[data-ref=sticky-ad-close]",ir="h5-sticky-ad--visible",xt=i=>{i.style.setProperty("display","none"),i.classList.remove(ir)},Zi=i=>{i.style.setProperty("display","block"),i.classList.add(ir)},er=(i,e,t,r)=>new Promise(n=>{let o=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(i&&xt(i),n("empty")):s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):n("standard"),r.googletag.pubads().removeEventListener("slotRenderEnded",o))};r.googletag.pubads().addEventListener("slotRenderEnded",o)}),tr=(i,e)=>new Promise(t=>{let r=n=>{n.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",r))};e.googletag.pubads().addEventListener("slotOnload",r)}),rr=(i,e,t,r,n,o)=>{let s=i.document.querySelector(Xi),a=i.document.querySelector(Qi);if(s&&a){if(t.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),o||Zi(s),a.addEventListener("click",()=>{xt(s);let d=i.googletag.pubads().getSlots().find(u=>u.getSlotElementId()===r);d&&i.googletag.destroySlots([d])},{once:!0,passive:!0}),e==="production"){let d=([u])=>(t.debug("mobile-sticky-ad",`result ${u}`),u==="disallowed"?(t.debug("mobile-sticky-ad","hide mobile sticky container"),s&&xt(s),Promise.resolve()):u==="standard"?(o&&Zi(s),Promise.all([er(s,r,n,i),tr(r,i)]).then(d)):Promise.resolve());Promise.all([er(s,r,n,i),tr(r,i)]).then(d)}}else t.warn("[mobile-sticky]",`Could not find adSticky container ${Xi} or closeButton ${Qi}`,s,a)};var ft=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){var t;(t=e==null?void 0:e.stickyFooterAd)!=null&&t.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[N(this.name,K,(t,r)=>{var n;return e.mobileStickyDomId&&r.some(o=>{var s;return o.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&rr(t.window,t.env,t.logger,e.mobileStickyDomId,e.disallowedAdvertiserIds,(n=e.initiallyHidden)!=null?n:!1),e.desktopFloorAdDomId&&r.some(o=>o.moliSlot.domId===e.desktopFloorAdDomId)&&Ji(t.window,t.env,t.logger,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new ft);var Ot="[data-ref=h5v-sticky-ad]",Dt="[data-ref=h5v-sticky-ad-close]",or=".h5v-closeButtonContent",dr="h5v-footerAd--hidden",nr=(i,e,t)=>new Promise(r=>{let n=o=>{o.slot.getSlotElementId()===i&&(o.isEmpty?r("empty"):o.advertiserId&&e.includes(o.advertiserId)?r("disallowed"):r("standard"),t.googletag.pubads().removeEventListener("slotRenderEnded",n))};t.googletag.pubads().addEventListener("slotRenderEnded",n)}),sr=(i,e)=>new Promise(t=>{let r=n=>{n.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",r))};e.googletag.pubads().addEventListener("slotOnload",r)}),ar=i=>{i.classList.add(dr)},mo=i=>{i.classList.remove(dr)},lr=(i,e,t,r,n,o)=>{let s="sticky-ad",a=i.document.querySelector(Ot),d=i.document.querySelector(Dt),u=i.document.querySelector(or);if(a&&d){if(t.debug(s,"Running initAdSticky with defined sticky container and close button"),!u){if(o)d.textContent=o;else if(!d.querySelector("svg")){let p=i.document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("width","24"),p.setAttribute("height","24");let c=i.document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add(or),c.setAttribute("d","M7 10l5 5 5-5z"),p.appendChild(c),d.appendChild(p)}}d.addEventListener("click",()=>{a.addEventListener("transitionend",function(){var c;a.remove();let p=(c=i.googletag)==null?void 0:c.pubads().getSlots().find(g=>g.getSlotElementId()===r);p&&i.googletag.destroySlots([p])},{once:!0}),ar(a)});let l=p=>{if(t.debug(s,`result ${p}`),p==="disallowed"||p==="empty")return t.debug(s,"stickyFooter container"),ar(a),Promise.resolve();if(p==="standard"){mo(a);let c=sr(r,i);return nr(r,n,i).then(g=>g==="empty"||g==="disallowed"?Promise.resolve(g):c.then(()=>g)).then(l)}return Promise.resolve()};if(e==="production")if(r){let p=sr(r,i);nr(r,n,i).then(c=>c==="empty"||c==="disallowed"?Promise.resolve(c):p.then(()=>c)).then(l)}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${Ot} or closeButton ${Dt}`,a,d);else l("standard")}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${Ot} or closeButton ${Dt}`,a,d)};var yt=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}config(){return this.stickyFooterAdConfig}configure(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}prepareRequestAdsSteps(){let e=this.stickyFooterAdConfig;return e?[N(this.name,K,(t,r)=>{let n=r.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.desktop),o=r.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.mobile),s=o||n;return o&&n&&t.logger.warn(this.name,"mobile and desktop sticky footer are called!"),s&&lr(t.window,t.env,t.logger,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}configureSteps(){return[]}initSteps(){return[]}};window.moli.registerModule(new yt);var ur=(i,e,t,r,n,o)=>s=>{s.forEach(a=>{e&&a.target===e?t.then(d=>{a.isIntersecting||!a.isIntersecting&&a.boundingClientRect.y<0||d==="empty"||d==="disallowed"?i.classList.add(o):a.boundingClientRect.y>=0&&d==="standard"&&i.classList.remove(o)}):a.target===r&&n&&(a.isIntersecting?i.classList.remove(n):i.classList.add(n))})};var pr=(i,e,t,r)=>new Promise(n=>{if(i.env==="test"){n("standard");return}let o=s=>{s.slot.getSlotElementId()===e.domId&&(s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):s.isEmpty?n("empty"):r>0?i.window.setTimeout(()=>n("standard"),r):n("standard"),i.window.googletag.pubads().removeEventListener("slotRenderEnded",o))};i.window.googletag.pubads().addEventListener("slotRenderEnded",o)});var bt=class{constructor(){this.name="sticky-header-ads";this.description="sticky header ad creatives";this.moduleType="creatives";this.containerSelector='[data-ref="header-ad"]';this.buttonSelector='[data-ref="header-ad-close-button"]';this.navbarHiddenClassName="h5v-header-ad--navbarHidden";this.observer=null;this.stickyHeaderAdConfig=null}configure(e){var t;(t=e==null?void 0:e.stickyHeaderAd)!=null&&t.enabled&&(this.stickyHeaderAdConfig=e.stickyHeaderAd)}config(){return this.stickyHeaderAdConfig}initSteps(){return[]}configureSteps(){return this.stickyHeaderAdConfig?[J("sticky-header-ads:cleanup",()=>(this.observer&&(this.observer.disconnect(),this.observer=null),Promise.resolve()))]:[]}prepareRequestAdsSteps(){let e=this.stickyHeaderAdConfig;return e?[N(this.name,K,(t,r)=>{var d,u,l;if(this.observer)return Promise.resolve();let n=r.find(p=>p.moliSlot.domId===e.headerAdDomId);if(!n)return Promise.resolve();let o=t.window.document.querySelector(this.containerSelector);if(!o)return t.logger.warn(this.name,`Could not find sticky header container with selector '${this.containerSelector}'`),Promise.resolve();let s=(d=e.minVisibleDurationMs)!=null?d:0;if(e.fadeOutTrigger!==!1){let p=(u=e.fadeOutTrigger.options)!=null?u:{rootMargin:"0px"},c=t.window.document.querySelectorAll(e.fadeOutTrigger.selector),g=c.length>0?c.item(0):null,b=e.navbarConfig,S=(l=b==null?void 0:b.navbarHiddenClassName)!=null?l:this.navbarHiddenClassName,f=b?t.window.document.querySelector(b.selector):null;if(g){let h=pr(t,n.moliSlot,e.disallowedAdvertiserIds,s);this.observer=new IntersectionObserver(ur(o,g,h,f,S,e.fadeOutClassName),p),this.observer.observe(g),f&&this.observer.observe(f)}else t.logger.error(this.name,`No DOM element found for selector ${e.fadeOutTrigger.selector}. Sticky header may never fade out`)}let a=t.window.document.querySelector(this.buttonSelector);return a&&a.addEventListener("click",()=>{o.classList.add(e.fadeOutClassName),this.observer&&this.observer.disconnect(),t.env==="production"&&t.window.googletag.destroySlots([n.adSlot]),e.destroySlot&&o&&o.remove()}),Promise.resolve()})]:[]}};window.moli.registerModule(new bt);var fo=(i,e)=>{let t=Object.keys(i);return ce(t.map(r=>y({adSlotId:r},i[r])).filter(r=>e.indexOf(r.adSlotId)>-1).filter(r=>U(r.bids)).map(r=>r.bids.sort((n,o)=>o.cpm-n.cpm).slice(0,1)))},ht=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.bidsBackHandler=[];this.getConfigEffect=(e,t,r,n)=>{let o=t[e.skinAdSlotDomId],s=p=>{let c=e.formatFilter.some(g=>{switch(g.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return p.bidder===ue.AppNexusAst||p.bidder===ue.AppNexus;case"improvedigital":return p.bidder===ue.ImproveDigital;case"gumgum":return p.bidder===ue.GumGum&&(g.auid===void 0||typeof p.ad!="string"&&p.ad.auid===g.auid);case"dspx":return p.bidder===ue.DSPX;case"visx":return p.bidder===ue.Visx;case"yieldlab":return p.bidder===ue.Yieldlab;default:return!1}});return p.cpm>0&&c},a=fo(t,e.blockedAdSlotDomIds),d=a.reduce((p,c)=>p+c.cpm,0),u=o?o.bids.filter(s).sort((p,c)=>c.cpm-p.cpm):[],l=u.length>0?u[0].cpm>d?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return n.debug(this.name,"nonSkinBids",a),n.debug(this.name,"skinBids",u),r&&l==="BlockSkinSlot"&&(r({skin:u[0].cpm,combinedNonSkinSlots:d},e,u[0]),n.debug(this.name,"trackSkinCpmLow",a)),e.enableCpmComparison?l:u.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,t,r)=>e.configs.map(n=>({skinConfig:n,configEffect:this.getConfigEffect(n,t,e.trackSkinCpmLow,r)})).find(({configEffect:n})=>n!=="NoBlocking");this.destroyAdSlot=(e,t)=>r=>{let n=e.map(o=>o.adSlot).filter(o=>o.getSlotElementId()===r);t.googletag.destroySlots(n)};this.runSkinConfigs=e=>(t,r,n)=>{var a,d,u;let o=null,s=this.selectConfig(e,r,t.logger);if(s){let{skinConfig:l,configEffect:p}=s;if(p==="BlockOtherSlots"){t.logger.debug("SkinModule","Skin configuration applied",l),l.blockedAdSlotDomIds.forEach(this.destroyAdSlot(n,t.window)),l.hideBlockedSlots&&l.blockedAdSlotDomIds.forEach(this.hideAdSlot(t.window,t.logger)),l.hideSkinAdSlot&&this.hideAdSlot(t.window,t.logger)(l.skinAdSlotDomId),l.hideBlockedSlotsSelector&&t.window.document.querySelectorAll(l.hideBlockedSlotsSelector).forEach(b=>{t.logger.debug("SkinModule",`Set display:none for container with selector ${l.hideBlockedSlotsSelector}`),b.style.setProperty("display","none")});let c=(a=r[l.skinAdSlotDomId])==null?void 0:a.bids.sort((b,S)=>S.cpm-b.cpm)[0],g=b=>t.window.googletag.pubads().getSlots().find(f=>f.getSlotElementId()===b);if((d=l.adReload)!=null&&d.intervalMs&&(c!=null&&c.bidder)&&l.adReload.allowed.includes(c.bidder)){let b=n.filter(f=>f.moliSlot.domId===l.skinAdSlotDomId||l.blockedAdSlotDomIds.includes(f.moliSlot.domId)).map(f=>f.moliSlot.behaviour.loaded);b.every(f=>f===b[0])&&b[0]!=="infinite"?(o&&clearTimeout(o),o=t.window.setTimeout(()=>{var f;t.window.moli.refreshAdSlot([...l.blockedAdSlotDomIds,l.skinAdSlotDomId],{loaded:b[0]}),(f=g(l.skinAdSlotDomId))==null||f.setTargeting("native-ad-reload","true"),t.logger.info("SkinModule","Ad reload for skin and blocked slots triggered",l.skinAdSlotDomId,l.blockedAdSlotDomIds)},(u=l.adReload)==null?void 0:u.intervalMs)):t.logger.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",b)}}else l.enableCpmComparison&&(t.logger.debug("SkinModule","Skin configuration ignored because cpm was low",l),this.destroyAdSlot(n,t.window)(l.skinAdSlotDomId))}else e.configs.filter(l=>l.destroySkinSlot).map(l=>l.skinAdSlotDomId).filter(j).forEach(this.destroyAdSlot(n,t.window))};this.hideAdSlot=(e,t)=>r=>{let n=e.document.getElementById(r);try{n&&(t.debug("SkinModule",`Set display:none for ${r}`),n.style.setProperty("display","none"))}catch(o){t.error("SkinModule",`Couldn't set the the wallpaper div ${r} to display:none;`,o)}}}config(){return this.skinModuleConfig}configure(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin,this.bidsBackHandler.push(this.runSkinConfigs(e.skin)))}initSteps(){return[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}prebidBidsBackHandler(){return this.bidsBackHandler}};window.moli.registerModule(new ht);var vt=class{constructor(){this.name="utiq";this.description="user module";this.moduleType="identity";this.requiredPurposeIds=[I.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,I.responses.TCPurpose.SELECT_BASIC_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_ADS,I.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,I.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,I.responses.TCPurpose.MEASURE_AD_PERFORMANCE,I.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,I.responses.TCPurpose.APPLY_MARKET_RESEARCH,I.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS,I.responses.TCPurpose.USE_LIMITED_DATA_TO_SElECT_CONTENT];this.utiqConfig=null}config(){return this.utiqConfig}configure(e){e!=null&&e.utiq&&e.utiq.enabled&&(this.utiqConfig=e.utiq)}initSteps(){let e=this.utiqConfig;return e!=null&&e.enabled?[D(this.name,t=>this.loadUtiq(e,t))]:[]}configureSteps(){return[]}prepareRequestAdsSteps(){return[]}loadUtiq(e,t){if(t.env==="test")return Promise.resolve();let r=t.window;return r.Utiq=r.Utiq?w(y({},r.Utiq),{config:y(y({},r.Utiq.config),e.options)}):{config:e.options},t.tcData.gdprApplies&&this.requiredPurposeIds.some(n=>t.tcData.gdprApplies&&!t.tcData.purpose.consents[n])?Promise.resolve():t.assetLoaderService.loadScript({name:this.name,loadMethod:1,assetUrl:e.assetUrl}).catch(n=>t.logger.error("failed to load utiq",n))}};window.moli.registerModule(new vt);var cr=i=>{var e;return i?((e=i.dynamicFloorPrices)==null?void 0:e.strategy)!==void 0:!1};var yo=i=>{if(i.length===0)return null;{let e=Math.max(...i);return Math.round(e*100)}},bo=i=>{if(i.length===0)return null;{let e=Math.min(...i);return Math.round(e*100)}},ho=i=>{if(!i||i.length===0)return null;if(i.length===1)return Math.round(i[0]*100);{let e=i.sort()[i.length-2];return Math.round(e*100)}},vo=(i,e)=>{switch(i){case"max":return yo(e);case"min":return bo(e);case"second-highest":return ho(e);default:return null}},St=i=>Math.floor(i),So=i=>{let e=St(i.priceInCents),t=St(i.roundingStepsInCents),r=i.maxPriceRuleInCents!==void 0?St(i.maxPriceRuleInCents):void 0,n=i.minPriceRuleInCents!==void 0?St(i.minPriceRuleInCents):void 0,o=Math.floor(e/t)*t;return r!==void 0&&o>r?r:n!==void 0&&o<n?n:o},gr=({strategy:i,previousCpms:e,standardRule:t,roundingStepsInCents:r=5,maxPriceRuleInCents:n=500,minPriceRuleInCents:o=5})=>{let s=Array.isArray(e)?e==null?void 0:e.filter(u=>u>0&&!isNaN(u)):[];if(!s||s.length===0||!i)return t;let a=vo(i,s);if(a===null)return t;let d=So({priceInCents:a,roundingStepsInCents:r,maxPriceRuleInCents:n,minPriceRuleInCents:o});return w(y({},t),{floorprice:d/100,priceRuleId:d})};var It=class{constructor(e){this.yieldConfig=e;this.emptyAdUnitPriceRulesResponse={rules:{},browser:"None"};this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);this.isEnabled=!1;this.device="mobile";this.adUnitPathVariables={}}init(e,t,r,n,o){switch(this.device=e,this.adUnitPathVariables=t,this.yieldConfig.provider){case"none":o.warn("YieldOptimizationService","Yield optimization is disabled!"),this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.resolve(this.emptyAdUnitPriceRulesResponse);break;case"static":o.warn("YieldOptimizationService","Yield optimization is static!"),this.isEnabled=!0,this.adUnitPricingRuleResponse=Promise.resolve({rules:this.yieldConfig.config.rules,browser:"None"});break;case"dynamic":this.isEnabled=!0;let s=this.yieldConfig.excludedAdUnitPaths,d=r.filter(u=>s.indexOf(u)<0).map(u=>F(u,this.adUnitPathVariables));this.adUnitPricingRuleResponse=this.loadConfigWithRetry(this.yieldConfig.configEndpoint,3,d,n).then(u=>(o.info("YieldOptimizationService",`loaded pricing rules for device ${this.device}`,u),u)).catch(u=>(o.error("YieldOptimizationService","failed to initialize service",u),this.emptyAdUnitPriceRulesResponse));break;default:this.isEnabled=!1,this.adUnitPricingRuleResponse=Promise.reject("Unknown config provider")}return Promise.resolve()}getPriceRule(e){return this.adUnitPricingRuleResponse.then(t=>t.rules[F(e,this.adUnitPathVariables)])}getBrowser(){return this.adUnitPricingRuleResponse.then(e=>e.browser||"None")}setTargeting(e,t,r,n,o){let s=F(e.getAdUnitPath(),this.adUnitPathVariables);return this.adUnitPricingRuleResponse.then(a=>{let d=a.rules[s];if(t==="gam")if(d)if(e.setTargeting("upr_model",d.model||"static"),d.main){e.setTargeting("upr_main","true");let u=o==null?void 0:o.getLastBidCpmsOfAdUnit(e.getSlotElementId());if(u&&(u==null?void 0:u.length)>0&&cr(n)&&n.dynamicFloorPrices){let{strategy:l,roundingStepsInCents:p,maxPriceRuleInCents:c,minPriceRuleInCents:g}=n.dynamicFloorPrices,b=gr({strategy:l,previousCpms:u,standardRule:d,roundingStepsInCents:p,maxPriceRuleInCents:c,minPriceRuleInCents:g});return r.debug("YieldOptimizationService",`set dynamic price rule id ${b.priceRuleId} for ${s} based on previous bid cpms on same position. Stategy is '${l}'. Main traffic share ${d.main}. Cpm is ${b.floorprice}.`),e.setTargeting("upr_id",b.priceRuleId.toFixed(0)),b}else e.setTargeting("upr_id",d.priceRuleId.toFixed(0))}else r.debug("YieldOptimizationService",`set price rule id ${d.priceRuleId} for ${s}. Main traffic share ${d.main}. cpm is ${d.floorprice}`),e.setTargeting("upr_id",d.priceRuleId.toFixed(0));else this.isEnabled&&r.warn("YieldOptimizationService",`No price rule found for ${s}`);return d})}loadConfigWithRetry(e,t,r,n,o=null){return t<=0?Promise.reject(o):n(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:this.device,key:"adUnitPath",adUnitPaths:r})}).then(s=>s.ok?s.json():s.text().then(a=>Promise.reject(`${s.statusText}: ${a}`))).then(s=>typeof s!="object"?Promise.reject("response is not an object"):s===null?Promise.reject("response is null"):this.isAdunitPricesRulesResponse(s)?this.validateRules(s.rules)?s:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(s=>new Promise(d=>setTimeout(d,100/t)).then(()=>this.loadConfigWithRetry(e,t-1,r,n,s)))}isAdunitPricesRulesResponse(e){return e.hasOwnProperty("rules")}isPriceRules(e){return typeof e=="object"&&e!==null}validateRules(e){return this.isPriceRules(e)?Object.keys(e).every(t=>{let r=e[t];return typeof r=="object"&&r!==null&&typeof r.main=="boolean"&&typeof r.floorprice=="number"&&typeof r.priceRuleId=="number"}):!1}};var At=class{constructor(){this.name="YieldOptimization";this.description="Provides floors and UPR ids";this.moduleType="yield";this.yieldModuleConfig=null;this._initSteps=[];this._prepareRequestAdsSteps=[];this.yieldOptimizationInit=e=>D("yield-optimization-init",t=>{let r=t.config.slots.filter(n=>t.labelConfigService.filterSlot(n)).map(n=>n.adUnitPath).filter(j);return e.init(t.labelConfigService.getDeviceLabel(),t.adUnitPathVariables,r,t.window.fetch,t.logger)});this.yieldOptimizationPrepareRequestAds=e=>N("yield-optimization",$e,(t,r)=>{t.logger.debug("YieldOptimizationService",t.requestId,"applying price rules");let n=t.config.adServer||"gam",o=r.map(s=>e.setTargeting(s.adSlot,n,t.logger,this.yieldModuleConfig,t.auction).then(a=>s.priceRule=a));return Promise.all(o).then(()=>e.getBrowser()).then(s=>{t.env==="production"&&n==="gam"&&t.window.googletag.pubads().setTargeting("upr_browser",s)})})}config(){return this.yieldModuleConfig}configure(e){var t;if((t=e==null?void 0:e.yieldOptimization)!=null&&t.enabled){this.yieldModuleConfig=e.yieldOptimization;let r=new It(e.yieldOptimization);this._initSteps.push(this.yieldOptimizationInit(r)),this._prepareRequestAdsSteps.push(this.yieldOptimizationPrepareRequestAds(r))}}initSteps(){return this._initSteps}configureSteps(){return[]}prepareRequestAdsSteps(){return this._prepareRequestAdsSteps}};window.moli.registerModule(new At);var Pt=class{constructor(){this.name="zeotap";this.description="Provides Zeotap functionality (data collection and identity plus) to Moli.";this.moduleType="identity";this.gvlid=301;this.loadScriptCount=0;this.zeotapConfig=null;this.hasConsent=e=>e.gdprApplies?e.vendor.consents[this.gvlid]&&e.purpose.consents[I.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&e.purpose.consents[I.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE]&&e.purpose.consents[I.responses.TCPurpose.SELECT_PERSONALISED_ADS]&&e.purpose.consents[I.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE]&&e.purpose.consents[I.responses.TCPurpose.SELECT_PERSONALISED_CONTENT]&&e.purpose.consents[I.responses.TCPurpose.MEASURE_AD_PERFORMANCE]&&e.purpose.consents[I.responses.TCPurpose.APPLY_MARKET_RESEARCH]&&e.purpose.consents[I.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS]:!0;this.loadScript=(e,t,r)=>{var b;let{mode:n,dataKeyValues:o,exclusionKeyValues:s,assetUrl:a,hashedEmailAddress:d,countryCode:u}=r;if(!t)return Promise.reject("Zeotap module :: no asset loader found, module not initialized yet?");if(n==="default"&&this.loadScriptCount>0)return Promise.reject("Zeotap module :: can't reload script in default mode.");let l=this.makeKeyValuesMap((b=e.targeting)==null?void 0:b.keyValues);if(s.some(S=>this.isExclusionKeyValueSet(S,l)))return Promise.reject("Zeotap module :: targeting exclusions prevented loading the script.");let p=o.map(S=>this.parameterFromKeyValue(S,l)).join("&"),c=!!r.hashedEmailAddress&&this.loadScriptCount===0,g=a+`&idp=${c?1:0}`+(p.length>0?`&${p}`:"")+(u?`&ctry=${u}`:"")+(d?`&z_e_sha2_l=${d}`:"");return this.loadScriptCount++,t.loadScript({name:this.name,loadMethod:1,assetUrl:g})};this.parameterFromKeyValue=(e,t)=>{let r=t.get(e.keyValueKey);return Array.isArray(r)?`${e.parameterKey}=${encodeURIComponent(r.join(","))}`:`${e.parameterKey}=${encodeURIComponent(r||"")}`};this.isExclusionKeyValueSet=(e,t)=>{let r=t.get(e.keyValueKey);return Array.isArray(r)?r.indexOf(e.disableOnValue)>-1:r===e.disableOnValue};this.makeKeyValuesMap=e=>e?new Map(Object.keys(e).map(t=>[t,e[t]]).filter(([,t])=>!!t)):new Map}config(){return this.zeotapConfig}configure(e){e!=null&&e.zeotap&&e.zeotap.enabled&&(this.zeotapConfig=e.zeotap)}initSteps(){let e=this.zeotapConfig;return e&&e.mode==="default"?[D(this.name,t=>(this.hasConsent(t.tcData)&&this.loadScript(t.config,t.assetLoaderService,e).catch(r=>t.logger.error(this.name,r)),Promise.resolve()))]:[]}configureSteps(){let e=this.zeotapConfig;return e&&e.mode==="spa"?[J(this.name,t=>(this.loadScript(t.config,t.assetLoaderService,e).catch(r=>t.logger.error(this.name,r)),Promise.resolve()))]:[]}prepareRequestAdsSteps(){return[]}};window.moli.registerModule(new Pt);var mr,we=(mr=window.document.currentScript)!=null?mr:document.getElementById("moli-ad-tag"),fr,Bt=(fr=Be(window,De.moliPubCode,Z.moliPubCode)[0])==null?void 0:fr.value,yr,qt=(yr=Be(window,De.moliVersion,Z.moliVersion)[0])==null?void 0:yr.value,br,hr,vr,Sr;if(we){let i=Bt!=null?Bt:we.getAttribute("data-publisher-code"),e=(br=qt!=null?qt:we.getAttribute("data-version"))!=null?br:"production",t=((hr=we.getAttribute("data-labels"))!=null?hr:"").split(",").map(o=>o.trim()).filter(o=>o.length>0);t.length>0&&window.moli.que.push(o=>{o.beforeRequestAds(()=>t.forEach(s=>o.addLabel(s)))}),window.moli.configLabel=e;let r=(vr=we.getAttribute("data-endpoint"))!=null?vr:"api.h5v.eu/publishers",n=(Sr=we.getAttribute("data-endpoint-fallback"))!=null?Sr:"cdn.h5v.eu/publishers";if(i){let o=`/${i}/configs/${e}/config.json`,s=`//${r}${o}`;fetch(s,{mode:"cors"}).then(a=>a.json()).catch(a=>(console.error(`Failed to load configuration from ${s}. Using fallback`,a),fetch(`//${n}${o}`,{mode:"cors"}))).then(a=>window.moli.configure(a)).catch(a=>console.error(`Failed to load configuration from ${s}:`,a))}else console.error('No publisher code provided for ad tag configuration! Add the `data-publisher-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");})();
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
