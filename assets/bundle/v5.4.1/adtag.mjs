/* ad tag library 5.4.1 by highfivve.com */
"use strict";(()=>{var Ir=Object.defineProperty,Sr=Object.defineProperties;var Ar=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Et=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var Rt=(i,e,t)=>e in i?Ir(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,h=(i,e)=>{for(var t in e||(e={}))Et.call(e,t)&&Rt(i,t,e[t]);if(Le)for(var t of Le(e))Mt.call(e,t)&&Rt(i,t,e[t]);return i},x=(i,e)=>Sr(i,Ar(e));var Tt=(i,e)=>{var t={};for(var r in i)Et.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&Le)for(var r of Le(i))e.indexOf(r)<0&&Mt.call(i,r)&&(t[r]=i[r]);return t};var xt=(i,e,t)=>new Promise((r,n)=>{var o=l=>{try{a(t.next(l))}catch(p){n(p)}},s=l=>{try{a(t.throw(l))}catch(p){n(p)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(i,e)).next())});var Pr=i=>{let e=i.indexOf("=");if(e>=0){let t=decodeURIComponent(i.slice(0,e)),r=decodeURIComponent(i.slice(e+1));return[t,r]}else return[decodeURIComponent(i),""]},he=i=>{try{let e=i.startsWith("?")?i.slice(1):i;return e.length>0?new Map(e.split("&").filter(t=>t.length>0).map(Pr)):new Map}catch(e){return console.error(e),new Map}};var Ue=(i,e)=>{let t=[],r,n=typeof i.document=="object"&&i.document,o=n&&n.documentElement.doScroll,s="DOMContentLoaded",a=n&&(o?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);!a&&n&&n.addEventListener(s,r=()=>{if(n)for(n.removeEventListener(s,r),a=!0;r=t.shift();)r()}),a?setTimeout(e,0):t.push(e)};var ft=class{constructor(e){this.window=e}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then(()=>{switch(e.loadMethod){case 0:return this.loadAssetViaFetch(e,t);case 1:return this.loadAssetViaTag(e,t)}})}loadJson(e,t){return this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(r=>r.ok?r.json():r.text().then(n=>Promise.reject(`${r.statusText}: ${n}`))).catch(r=>Promise.reject(r))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then(r=>r.ok?Promise.resolve(r):Promise.reject(r)).then(r=>r.text()).then(r=>this.scriptTagWithBody(r)).then(r=>t.appendChild(r))}scriptTagWithBody(e){let t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){let r=this.scriptTag(e);return new Promise((n,o)=>{r.onload=n,r.onerror=o,t.appendChild(r)})}scriptTag(e){let t=this.window.document.createElement("script");return e.type==="module"?t.type="module":e.type==="nomodule"?(t.type="text/javascript",t.setAttribute("nomodule","")):e.assetUrl.endsWith("mjs")?t.type="module":t.type="text/javascript",t.async=!0,t.src=e.assetUrl,t}awaitDomReady(){return new Promise(e=>{Ue(this.window,e)})}},_e=i=>new ft(i);function Cr(i){try{let e="moliDebug";return!!he(i.location.search).get(e)||!!i.sessionStorage.getItem(e)||!!i.localStorage.getItem(e)}catch(e){return!1}}function Rr(){let i=()=>{};return{debug:i,info:i,warn:i,error:console.error}}function ie(i){return`background:${i}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function Ve(i){switch(i){case"debug":return ie("#49A0CC");case"info":return ie("#61A172");case"warn":return ie("#FFC300");case"error":return ie("#C70039")}}function Ne(i){switch(i){case"AdPipeline":return ie("#74ABC6");case"GAM":return ie("#BA0E5F");case"MoliGlobal":return ie("#403073");case"Prebid":return ie("#4357AD");case"AdVisibilityService":return ie("#d5ba3c");case"UserActivityService":return ie("#19ad0e");case"Adex DMP":return ie("#003E74");default:return ie("#052E53")}}function de(){return{debug(i,e,...t){console.debug(`%c[DEBUG]%c${i}%c${e}`,Ve("debug"),Ne(i),"",...t)},info(i,e,...t){console.info(`%c[INFO]%c${i}%c${e}`,Ve("info"),Ne(i),"",...t)},warn(i,e,...t){console.warn(`%c[WARN]%c${i}%c${e}`,Ve("warn"),Ne(i),"",...t)},error(i,e,...t){console.error(`%c[ERROR]%c${i}%c${e}`,Ve("error"),Ne(i),"",...t)}}}function q(i,e){return Cr(e)?de():i&&i.logger?i.logger:Rr()}var Fe=class{constructor(e){this.logger=e;this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}};var ze=(i,e,t,r)=>{let n=i.slots.find(o=>o.domId===e);if(n){let o=x(h({},n),{domId:t});return x(h({},i),{slots:[...i.slots,o]})}else return r.error("MoliGlobal","no infinite ad slot configured!",i),i};function ge(i){return i.reduce((e,t)=>e.concat(t),[])}function Y(i,e,t){return t.indexOf(i)===e}function z(i){return i!=null}var Ee=(i,e,t)=>{let r=["mobile","desktop","android","ios"],n=e.some(d=>r.indexOf(d)>-1),o=i.filter(d=>t.matchMedia(d.mediaQuery).matches),s=[...n?[]:ge(o.map(d=>d.labelsSupported)),...e].filter(Y);return{filterSlot:d=>{var c,g;let u=!0;return s.length&&((c=d.labelAll)!=null&&c.length)&&(u=d.labelAll.every(f=>s.indexOf(f)>-1)),s.length&&d.labelAny&&!((g=d.labelAll)!=null&&g.length)&&(u=d.labelAny.some(f=>s.indexOf(f)>-1)),u},getSupportedLabels:()=>s,getDeviceLabel:()=>s.find(d=>r.indexOf(d)>-1)||"mobile"}},yt=(i,e,t,r)=>Ee(t!=null?t:[],[...(r==null?void 0:r.labels)||[],...e.labels],i).getDeviceLabel();var M;(t=>{let i;(o=>{let r;(A=>(A[A.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",A[A.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",A[A.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",A[A.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",A[A.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",A[A.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",A[A.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",A[A.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",A[A.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",A[A.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS",A[A.USE_LIMITED_DATA_TO_SElECT_CONTENT=11]="USE_LIMITED_DATA_TO_SElECT_CONTENT"))(r=o.TCPurpose||(o.TCPurpose={}));let n;(p=>(p[p.NOT_ALLOWED=0]="NOT_ALLOWED",p[p.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",p[p.REQUIRE_LI=2]="REQUIRE_LI"))(n=o.RestrictionType||(o.RestrictionType={}))})(i=t.responses||(t.responses={}));let e;(s=>{let r;(d=>(d.VISIBLE="visible",d.HIDDEN="hidden",d.DISABLED="disabled"))(r=s.DisplayStatus||(s.DisplayStatus={}));let n;(u=>(u.STUB="stub",u.LOADING="loading",u.LOADED="loaded",u.ERROR="error"))(n=s.CmpStatus||(s.CmpStatus={}));let o;(d=>(d.TC_LOADED="tcloaded",d.CMP_UI_SHOWN="cmpuishown",d.USER_ACTION_COMPLETE="useractioncomplete"))(o=s.EventStatus||(s.EventStatus={}))})(e=t.status||(t.status={}))})(M||(M={}));var Er=M.status.EventStatus,Mr=M.status.CmpStatus,Tr=[M.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,M.responses.TCPurpose.SELECT_BASIC_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,M.responses.TCPurpose.MEASURE_AD_PERFORMANCE,M.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,M.responses.TCPurpose.APPLY_MARKET_RESEARCH,M.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS],xr=i=>!!i.gdprApplies&&Tr.some(e=>!i.purpose.consents[e]),kt=(i,e,t,r)=>(r==="test"&&t.info("gdprApplies is set to false in test mode!"),r==="test"||i.enabled===!1?Promise.resolve({gdprApplies:!1,eventStatus:Er.TC_LOADED,cmpStatus:Mr.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise((n,o)=>{if(e.__tcfapi){let s=a=>{a.cmpStatus==="error"?o(a):(a.eventStatus==="useractioncomplete"||a.eventStatus==="tcloaded")&&(t.debug("Consent","consent ready",a),i.disableLegitimateInterest&&xr(a)?o("user consent is missing for some purposes"):n(a),a.listenerId&&e.__tcfapi("removeEventListener",2,()=>{},a.listenerId))};e.__tcfapi("addEventListener",2,s)}else o("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")}));var fe=i=>{if(i){let[e,t,r]=i.split(".").reverse();switch(`${t}.${e}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${r}.${t}.${e}`;default:return t?`${t}.${e}`:e}}else return};var je=i=>{let[e,t,...r]=i.split("/"),[n,...o]=t.split(",");return o.length===0?i:["",n,...r].join("/")},J=(i,e)=>{let t=/[^{]+(?=})/g,r=/([A-Za-z0-9\_]+)/g,n=i.match(t);return!e||!n?i:(n.forEach(o=>{if(!o.match(r))throw new SyntaxError(`invalid variable "${o}" in path`);if(!e[o])throw new ReferenceError(`path variable "${o}" is not defined`)}),i.replace(new RegExp(Object.keys(e).map(o=>`{${o}}`).join("|"),"g"),o=>e[o.substr(1,o.length-2)]))},Ot=(i,e)=>i.split("/").slice(0,e+1).join("/"),wt=(i,e,t,r)=>h({device:e,domain:r||fe(i)||"unknown"},t);var qt=i=>{var e;return typeof((e=i.crypto)==null?void 0:e.randomUUID)=="function"?i.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})};var kr=M.responses.TCPurpose,$e=100,Q=10,_=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),j=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),re=(i,e)=>{Object.defineProperty(e,"name",{value:i});let t=0;return j(i,(r,n)=>t!==r.f?(t=r.f,e(r,n)):Promise.resolve())},Dt=(i,e)=>(Object.defineProperty(e,"name",{value:i}),j(i,(t,r)=>t.f===1&&t.c===1?e(t,r):Promise.resolve())),G=(i,e,t)=>{let r=Object.assign(t,{priority:e});return Object.defineProperty(t,"name",{value:i}),r},Ge=(i,e)=>(Object.defineProperty(e,"name",{value:i}),e),Ie=class{constructor(e,t,r,n){this.config=e;this.logger=t;this.window=r;this.auction=n;this.init=null;this.tcData=null;this.requestId=0;this.runPrepareRequestAds=(e,t)=>{let r=new Map;return this.config.prepareRequestAds.forEach(n=>{let o=r.get(n.priority);o?o.push(n):r.set(n.priority,[n])}),Array.from(r.entries()).sort(([n],[o])=>n>o?-1:1).reduce((n,[o,s])=>n.then(()=>(e.t.debug("AdPipeline",e.c,`run prepareRequestAds with priority ${o}`),Promise.all(s.map(a=>a(e,t))))),Promise.resolve(void 0))}}run(e,t,r,n,o){if(e.length===0)return Promise.resolve();this.requestId=this.requestId+1;let s=this.requestId,a=qt(this.window);this.logger.debug("AdPipeline",`starting run with requestId ${s} on ${n}. call. AuctionId ${a}`,e);let l=t.consent||{};return this.tcData=this.tcData?this.tcData:kt(l,this.window,this.logger,r.environment),this.tcData.then(p=>{var S,P,v;let d=[...((S=t.targeting)==null?void 0:S.labels)||[],...r.labels];p.gdprApplies&&p.purpose.consents[kr.STORE_INFORMATION_ON_DEVICE]?d.push("purpose-1"):p.gdprApplies||d.push("purpose-1");let u=Ee(t.labelSizeConfig||[],d,this.window),c=o==null?void 0:o.bucketName,g=c&&((P=t.buckets)!=null&&P.bucket)&&t.buckets.bucket[c]?t.buckets.bucket[c]:null,f=wt(this.window.location.hostname,u.getDeviceLabel(),(v=t.targeting)==null?void 0:v.adUnitPathVariables,t.domain),b=h(h({},f),r.adUnitPathVariables),m={I:a,c:s,f:n,t:this.logger,r:r.environment||"production",i:t,l:r,u,e:this.window,o:p,b:g,m:b,g:this.auction,p:_e(this.window),S:o};this.init=this.init?this.init:this.logStage("init",s).then(()=>Promise.all(this.config.init.map(y=>y(m))));let A="rejected-no-slots-after-filtering";return this.init.then(()=>this.logStage("configure",s).then(()=>Promise.all(this.config.configure.map(y=>y(m,e))))).then(()=>this.logStage("defineSlots",s).then(()=>this.config.defineSlots(m,e))).then(y=>y.length?this.logStage("prepareRequestAds",s).then(()=>this.runPrepareRequestAds(m,y)).then(()=>this.logStage("requestBids",s)).then(()=>Promise.all(this.config.requestBids.map(C=>C(m,y)))).then(()=>this.logStage("requestAds",s)).then(()=>this.config.requestAds(m,y)):Promise.reject(A)).catch(y=>{switch(y){case A:return Promise.resolve();default:return this.logger.error("AdPipeline","running ad pipeline failed with error",y),Promise.reject(y)}})})}getAuction(){return this.auction}logStage(e,t){return new Promise(r=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),r()})}};var We=(i,e)=>i[0]===e[0]&&i[1]===e[1];var te=class{constructor(e,t,r){this.sizeConfig=e;this.supportedLabels=t;this.window=r;this.filterSupportedSizes=e=>this.isValid?this.supportedSizes.length===0?e:e.filter(t=>this.supportedSizes.some(r=>r==="fluid"?t==="fluid":t==="fluid"?!1:We(t,r))):[];this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every(r=>t.some(n=>n===r)))&&(!e.labelNone||!e.labelNone.some(r=>t.some(n=>n===r)));let n=e.length!==0?e.filter(o=>r.matchMedia(o.mediaQuery).matches&&this.areLabelsMatching(o,t)):[];this.isValid=e.length===0||!(e.length>0&&n.length===0),this.supportedSizes=ge(n.map(o=>o.sizesSupported)).map(o=>JSON.stringify(o)).filter(Y).map(o=>JSON.parse(o))}static isFixedSize(e){return e!=="fluid"}filterSlot(e){return!e.sizes||e.sizes.length===0||this.filterSupportedSizes(e.sizes).length>0}};var oe={moliEnv:"moli-env",moliPubCode:"moli-pub-code",moliVersion:"moli-version",testSlotSize:i=>`moli-test-slot-size-${i}`,debugDelay:"moli-debug-delay"};var ye=(i,e=localStorage)=>{try{return e.getItem(i)}catch(t){return de().debug(`Could not read value with key ${i} from browser storage`,e),null}},Me=(i,e,t=localStorage)=>{try{t.setItem(i,e)}catch(r){de().debug(`Could not set key ${i} with value ${e} to browser storage`,t)}};var Or=i=>i==="hidden"||Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number",Ut=i=>`${i}__container`,He=(i,e)=>{let t=Br(i,e);return t.forEach(({slot:r,container:n})=>{n.innerHTML="",n.appendChild(Dr(r))}),t};var wr=(i,e)=>{let t=document.getElementById(i);t&&(t.innerHTML=e)},Br=(i,e)=>(e.forEach(t=>{let{moliSlot:r}=t,n=Ut(r.domId),o=document.createElement("div");o.id=n;let s=document.getElementById(r.domId);s&&s.setAttribute("data-google-query-id","test"),wr(r.domId,o.outerHTML),i.t.debug("GAM",`Set content for slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath}`)}),qr(e)),qr=i=>i.map(e=>{let t=document.getElementById(Ut(e.moliSlot.domId));return t?{slot:e,container:t}:void 0}).filter(z),Dr=i=>{let e=Lr(i),t=Ur(i.moliSlot,e);if(t==="hidden")return document.createElement("div");{let r=document.createElement("div"),[n,o]=t;r.style.cssText=`
      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
      width: ${n}px; height: ${o}px; padding: 6px; border: 2px dotted gray; background-color: #fff;
      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
      background-size: 100% 1.2em; box-sizing: border-box;
    `;let s=document.createElement("h4");s.innerHTML=`<strong>${i.moliSlot.domId}</strong>`,r.appendChild(s);let a=document.createElement("span");a.style.color="#656565";let l=([m,A])=>a.innerText=`(${m}x${A})`;l([n,o]),s.appendChild(a);let p=document.createElement("div");p.style.cssText="position: absolute; top: 5px; left: 5px",r.appendChild(p);let d=(m,A)=>{if(m==="hidden")r.style.display="none";else{let[S,P]=m;r.style.width=`${S}px`,r.style.height=`${P}px`,l(m),b(A)}_r(i.moliSlot,m)},u="1px dotted white",c="1px solid black",g=document.createElement("button");g.innerText="hide",g.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",g.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${u};`,g.addEventListener("click",()=>d("hidden",g));let f=[...e.map(m=>{let[A,S]=m,P=_t(t,m),v=document.createElement("button");return v.innerText=`${A}x${S}`,v.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${P?c:u};`,v.addEventListener("click",()=>d(m,v)),v}),g];f.forEach(m=>p.appendChild(m));let b=m=>{f.forEach(A=>A.style.border=u),m.style.border=c};return r}},Lr=i=>i.filterSupportedSizes(i.moliSlot.sizes).filter(te.isFixedSize).filter(([e,t])=>e>1&&t>1),Ur=(i,e)=>{let t=Vr(i);if(t&&(t==="hidden"||Nr(e,t)))return t;{let r=Math.floor(Math.random()*e.length);return e.length===0?[300,250]:e[r]}},_r=(i,e)=>Me(oe.testSlotSize(i.domId),JSON.stringify(e)),Vr=i=>{let e=ye(oe.testSlotSize(i.domId));if(e)try{let t=JSON.parse(e);return Or(t)?t:void 0}catch(t){return}},_t=(i,e)=>{let[t,r]=i,[n,o]=e;return t===n&&r===o},Nr=(i,e)=>i.some(t=>_t(t,e));var Se="f";var Fr=(i,e)=>({setCollapseEmptyDiv(){},addService(t){},getSlotElementId(){return i},getAdUnitPath(){return e},setTargeting(t,r){return this},getTargeting(t){return[]},getTargetingKeys(){return[]},clearTargeting(t){},getResponseInformation(){return null}}),Vt=(i,e,t)=>{var o;let r=t?t.keyValues:{},n=(o=t==null?void 0:t.adManagerExcludes)!=null?o:[];[r,e].forEach(s=>{Object.keys(s).filter(a=>!n.includes(a)).forEach(a=>{let l=s[a];l&&i.googletag.pubads().setTargeting(a,l)})})},Nt=(i,e)=>(e==null?void 0:e.useLimitedAds)===!1?!0:!i.gdprApplies||i.vendor.consents[755]&&i.purpose.consents[M.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE]&&[M.responses.TCPurpose.SELECT_BASIC_ADS,M.responses.TCPurpose.MEASURE_AD_PERFORMANCE,M.responses.TCPurpose.APPLY_MARKET_RESEARCH,M.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(t=>i.purpose.consents[t]||i.purpose.legitimateInterests[t]),Ft=()=>{let i;return _("gpt-init",e=>e.r==="test"?Promise.resolve():(i||(i=new Promise(t=>{e.t.debug("GAM","init googletag stub"),e.e.googletag=e.e.googletag||{},e.e.googletag.cmd=e.e.googletag.cmd||[],e.e.googletag.cmd.push(t),e.p.loadScript({name:"gpt",loadMethod:1,assetUrl:Nt(e.o,e.i.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch(r=>e.t.error("failed to load gpt.js",r))})),i))},zt=()=>{let i=0;return j("gpt-destroy-ad-slots",(e,t)=>{var s,a;if(e.r==="test")return Promise.resolve();let r=(a=(s=e.i.spa)==null?void 0:s.cleanup)!=null?a:{slots:"all"},n=l=>l.length===0?(e.t.debug("GAM","no ad slots to destroy"),Promise.resolve()):(e.t.debug("GAM",`destroy ${l.length} ad slots`,l),e.e.googletag.destroySlots(l),Promise.resolve()),o=i!==e.f;switch(i=e.f,e.t.debug("GAM",`destroy ${r.slots} ad slots`),r.slots){case"all":return o&&e.e.googletag.destroySlots(),Promise.resolve();case"requested":let l=e.e.googletag.pubads().getSlots(),p=t.map(d=>l.find(u=>u.getSlotElementId()===d.domId)).filter(z);return n(p);case"excluded":if(o){let d=e.e.googletag.pubads().getSlots().filter(u=>!r.slotIds.includes(u.getSlotElementId()));return n(d)}return Promise.resolve();default:return Promise.resolve()}})},jt=()=>re("gpt-reset-targeting",i=>new Promise(e=>{i.r==="production"&&(i.t.debug("GAM","reset top level targeting"),i.e.googletag.pubads().clearTargeting(),Vt(i.e,i.l.keyValues,i.i.targeting)),e()})),$t=()=>{let i;return j("gpt-configure",(e,t)=>(i||(i=new Promise(r=>{var o;let n=e.l.environment||"production";switch(e.t.debug("GAM","configure googletag"),n){case"production":Vt(e.e,e.l.keyValues,e.i.targeting),e.e.googletag.pubads().enableAsyncRendering(),e.e.googletag.pubads().disableInitialLoad(),e.e.googletag.pubads().enableSingleRequest(),(o=e.i.gpt)!=null&&o.pageSettingsConfig&&e.e.googletag.setConfig(e.i.gpt.pageSettingsConfig);let s=!Nt(e.o,e.i.consent);e.t.debug("GAM","use limited ads",s),e.e.googletag.pubads().setPrivacySettings({limitedAds:s}),e.e.googletag.enableServices(),r();return;case"test":r();return}})),i))},Gt=()=>G("gpt-device-label-keyValue",Q,i=>i.r==="test"?Promise.resolve():new Promise(e=>{let t=i.u.getDeviceLabel();i.t.debug("GAM",'adding "device_label" key-value with values',t),i.e.googletag.pubads().setTargeting("device_label",t),e()})),Wt=()=>G("gpt-consent-keyValue",Q,i=>i.r==="test"?Promise.resolve():new Promise(e=>{let t=i.o,r=!t.gdprApplies||[M.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,M.responses.TCPurpose.SELECT_BASIC_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,M.responses.TCPurpose.MEASURE_AD_PERFORMANCE,M.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,M.responses.TCPurpose.APPLY_MARKET_RESEARCH,M.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS].every(n=>t.purpose.consents[n]);i.e.googletag.pubads().setTargeting("consent",r?"full":"none"),e()})),Ht=()=>(i,e)=>{let t=e.map(r=>{var f;let n=new te(r.sizeConfig,i.u.getSupportedLabels(),i.e),o=n.filterSupportedSizes;if(!(n.filterSlot(r)&&i.u.filterSlot(r)))return Promise.resolve(null);let s=o(r.sizes),a=J(r.adUnitPath,i.m),l=b=>{if(!i.e.document.getElementById(b)){let m=i.e.document.createElement("div");m.id=b,m.setAttribute("data-h5v-position",r.position),m.style.setProperty("display","none"),i.e.document.body.appendChild(m)}},p=()=>{switch(r.position){case"in-page":return[i.e.googletag.defineSlot(a,s,r.domId),null];case"interstitial":return l(r.domId),[i.e.googletag.defineSlot(a,s,r.domId),null];case"out-of-page":return l(r.domId),[i.e.googletag.defineOutOfPageSlot(a,r.domId),null];case"out-of-page-interstitial":return[i.e.googletag.defineOutOfPageSlot(a,i.e.googletag.enums.OutOfPageFormat.INTERSTITIAL),i.e.googletag.enums.OutOfPageFormat.INTERSTITIAL];case"out-of-page-bottom-anchor":return[i.e.googletag.defineOutOfPageSlot(a,i.e.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR),i.e.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR];case"out-of-page-top-anchor":return[i.e.googletag.defineOutOfPageSlot(a,i.e.googletag.enums.OutOfPageFormat.TOP_ANCHOR),i.e.googletag.enums.OutOfPageFormat.TOP_ANCHOR]}},d=()=>{if(i.r==="test")return null;let[b,m]=p();return b&&(m?b.setTargeting(Se,m.toString()):b.clearTargeting(Se),i.e.googletag.display(b)),b},c=(i.r==="test"?[]:i.e.googletag.pubads().getSlots()).find(b=>b.getSlotElementId()===r.domId),g=c||d();switch(i.r){case"production":if(g)return g.setCollapseEmptyDiv(((f=r.gpt)==null?void 0:f.collapseEmptyDiv)!==!1),g.addService(i.e.googletag.pubads()),i.t.debug("GAM",`Register slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath}`),Promise.resolve({moliSlot:r,adSlot:g,filterSupportedSizes:o});if(r.position==="out-of-page-interstitial"||r.position==="out-of-page-top-anchor"||r.position==="out-of-page-bottom-anchor")return i.t.warn("GAM",`${r.position} is not supported`),Promise.resolve(null);{let b=`Slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath} is already defined. You may have called requestAds() multiple times`;return i.t.error("GAM",b),Promise.reject(new Error(b))}case"test":return Promise.resolve({moliSlot:r,adSlot:Fr(r.domId,r.adUnitPath),filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${i.l.environment}`)}});return Promise.all(t).then(r=>r.filter(z))},zr=(i,e)=>{let t=i.find(({moliSlot:r})=>r.position==="interstitial");if(t&&t.adSlot.getTargeting("hb_pb").length===0){e.e.googletag.destroySlots([t.adSlot]);let n=e.e.googletag.defineOutOfPageSlot(J(t.moliSlot.adUnitPath,e.m),e.e.googletag.enums.OutOfPageFormat.INTERSTITIAL);if(n)return e.t.debug("GAM","Display out-of-page-interstitial slot"),n.addService(e.e.googletag.pubads()),e.e.googletag.display(n),[...i.filter(({moliSlot:o})=>o.position!=="interstitial"),x(h({},t),{adSlot:n})];e.t.error("GAM","Failed to define out-of-page-interstitial slot")}return i},Kt=()=>(i,e)=>new Promise(t=>{switch(i.t.debug("GAM","requestAds"),i.r){case"test":He(i,e);break;case"production":let r=e.filter(({moliSlot:s,adSlot:a})=>!i.g.isSlotThrottled(s.domId,a.getAdUnitPath()));if(r.length===0)break;let n=zr(r,i);i.e.googletag.pubads().refresh(n.map(({adSlot:s})=>s));let o=n.map(({moliSlot:s})=>`[DomID] ${s.domId} [AdUnitPath] ${s.adUnitPath}`).join(`
`);i.t.debug("GAM",`Refresh ${e.length} slot(s):
${o}`);break}t()});var ce;(E=>{let i;(ne=>{let Z;(se=>(se[se.Unknown=0]="Unknown",se[se.ProfessionallyProduced=1]="ProfessionallyProduced",se[se.Prosumer=2]="Prosumer",se[se.UGC=3]="UGC"))(Z=ne.ContentQuality||(ne.ContentQuality={}))})(i=E.firstpartydata||(E.firstpartydata={}));let e;(K=>{let Z;(ue=>(ue[ue.NO=0]="NO",ue[ue.YES=1]="YES"))(Z=K.Skip||(K.Skip={}));let ne;(F=>(F[F.VAST_1=1]="VAST_1",F[F.VAST_2=2]="VAST_2",F[F.VAST_3=3]="VAST_3",F[F.VAST_1_WRAPPER=4]="VAST_1_WRAPPER",F[F.VAST_2_WRAPPER=5]="VAST_2_WRAPPER",F[F.VAST_3_WRAPPER=6]="VAST_3_WRAPPER",F[F.VAST_4=7]="VAST_4",F[F.VAST_4_WRAPPER=8]="VAST_4_WRAPPER",F[F.DAAST_1=9]="DAAST_1",F[F.DAAST_1_WRAPPER=10]="DAAST_1_WRAPPER"))(ne=K.Protocol||(K.Protocol={}));let Re;(U=>(U[U.AutoPlaySoundOff=1]="AutoPlaySoundOff",U[U.AutoPlaySoundOn=2]="AutoPlaySoundOn",U[U.ClickToPlay=3]="ClickToPlay",U[U.MousOver=4]="MousOver",U[U.InViewportSoundsOn=5]="InViewportSoundsOn",U[U.InViewportSoundsOff=6]="InViewportSoundsOff"))(Re=K.PlaybackMethod||(K.PlaybackMethod={}));let De;(U=>(U[U.VPAID_1=1]="VPAID_1",U[U.VPAID_2=2]="VPAID_2",U[U.MRAID_1=3]="MRAID_1",U[U.ORMMA=4]="ORMMA",U[U.MRAID_2=5]="MRAID_2",U[U.MRAID_3=6]="MRAID_3"))(De=K.Api||(K.Api={}));let ve;(ae=>(ae[ae.InStream=1]="InStream",ae[ae.InBanner=2]="InBanner",ae[ae.InArticle=3]="InArticle",ae[ae.InFeed=4]="InFeed",ae[ae.Interstitial=5]="Interstitial"))(ve=K.Placement||(K.Placement={}));let vr;(me=>(me[me.Instream=1]="Instream",me[me.AccompanyingContent=2]="AccompanyingContent",me[me.Interstitial=3]="Interstitial",me[me.NoContentStandalone=4]="NoContentStandalone"))(vr=K.Plcmt||(K.Plcmt={}));let se;(w=>(w[w.AudioAdAutoPlay=1]="AudioAdAutoPlay",w[w.AudioAdUserInitiated=2]="AudioAdUserInitiated",w[w.ExpandableAutomatic=3]="ExpandableAutomatic",w[w.ExpandableOnClick=4]="ExpandableOnClick",w[w.ExpandableOnRollover=5]="ExpandableOnRollover",w[w.InBannerVideoAdAutoPlay=6]="InBannerVideoAdAutoPlay",w[w.InBannerVideoAdClick=7]="InBannerVideoAdClick",w[w.Pop=8]="Pop",w[w.ProvocativeOrSuggestiveImagery=9]="ProvocativeOrSuggestiveImagery",w[w.ShakyFlashingFlickering=10]="ShakyFlashingFlickering",w[w.Surveys=11]="Surveys",w[w.TextOnly=12]="TextOnly",w[w.UserInteractive=13]="UserInteractive",w[w.WindowsDialogOrAlertStyle=14]="WindowsDialogOrAlertStyle",w[w.HasAudioOnOffButton=15]="HasAudioOnOffButton",w[w.HasSkipButton=16]="HasSkipButton",w[w.AdobeFlash=16]="AdobeFlash"))(se=K.CreativeAttributes||(K.CreativeAttributes={}));let hr;(ue=>(ue[ue.LinerInStream=1]="LinerInStream",ue[ue.NonLinearOverlay=2]="NonLinearOverlay"))(hr=K.Linearity||(K.Linearity={}))})(e=E.video||(E.video={})),E.Adagio="adagio",E.AdaptMx="amx",E.Adform="adf",E.AdUp="aduptech",E.Criteo="criteo",E.ConnectAd="connectad",E.AppNexusAst="appnexusAst",E.AppNexus="appnexus",E.GumGum="gumgum",E.ImproveDigital="improvedigital",E.IndexExchange="ix",E.Invibes="invibes",E.NanoInteractive="nanointeractive",E.PubMatic="pubmatic",E.Ogury="ogury",E.OneTag="onetag",E.OpenX="openx",E.SmartAdServer="smartadserver",E.Smartx="smartx",E.Unruly="unruly",E.Teads="teads",E.TheTradeDesk="ttd",E.Triplelift="triplelift",E.Yieldlab="yieldlab",E.Seedtag="seedtag",E.Spotx="spotx",E.ShowHeroes="showheroesBs",E.StroeerCore="stroeerCore",E.StailaMedia="stailamedia",E.Xaxis="xhb",E.DSPX="dspx",E.RichAudience="ra",E.Rubicon="rubicon",E.Recognified="rads",E.Visx="visx",E.Vlyby="vlyby",E.Orbidder="orbidder"})(ce||(ce={}));var Yt=(i,e)=>{var t;return x(h({},i),{ext:x(h({},i.ext),{prebid:x(h({},(t=i.ext)==null?void 0:t.prebid),{storedrequest:e})})})};var Te={version:"5.4.1"};var Jt=(i,e,t={})=>({url:e,render:r=>jr(r,i,t),backupOnly:!0}),jr=(i,e,t={})=>{if(!i.renderer){de().error("Can not initialize prebid outstream player, because bid.renderer is not defined");return}i.renderer.push(()=>{var r;return(r=window.outstreamPlayer)==null?void 0:r.call(window,i,e,t)})};var $r=i=>new Promise((e,t)=>{i.e.setTimeout(()=>t("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag"),5e3)}),Gr=i=>new Promise(e=>i.pbjs.que.push(e)),Xt=i=>!!i.moliSlot.prebid,Wr=(i,e)=>e.pbjs.adUnits?e.pbjs.adUnits.some(t=>i.code===t.code):!1,Qt=(i,e,t)=>t.filter(Xt).map(({moliSlot:n,priceRule:o,filterSupportedSizes:s})=>{let a=o?{floors:{currency:e.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":o.floorprice}}}:null;return i.t.debug("Prebid",i.c,"Price Rule",o,n.domId,a),Hr(n.prebid).map(l=>{var T,D,N,$;let p=l.adUnit.mediaTypes.banner,d=l.adUnit.mediaTypes.video,u=l.adUnit.mediaTypes.native,c=p?s(p.sizes).filter(te.isFixedSize):[],g=d?Kr(d.playerSize,s):[],f=l.adUnit.bids.filter(V=>i.u.filterSlot(V)).filter(V=>!V.bidder||V.bidder&&!i.g.isBidderDisabled(n.domId,V.bidder)&&!i.g.isBidderFrequencyCappedOnSlot(n.domId,V.bidder)).map(V=>{let R=V,{labelAny:ee,labelAll:qe}=R;return Tt(R,["labelAny","labelAll"])}),b=g.length>0&&!(d!=null&&d.w)&&!(d!=null&&d.h)?{w:g[0][0],h:g[0][1]}:{},m=e.backupVideoRenderer,A=d?{video:h(h(x(h({},d),{playerSize:g.length===0?void 0:g}),b),m?{renderer:Jt(n.domId,m.url)}:{})}:void 0,S=p&&c.length>0?{banner:x(h({},p),{sizes:c})}:void 0,P=u?{native:h({},u)}:void 0,v=x(h({},l.adUnit.pubstack),{adUnitPath:J(((T=l.adUnit.pubstack)==null?void 0:T.adUnitPath)||n.adUnitPath,i.m)}),y=($=(N=(D=l.adUnit.ortb2Imp)==null?void 0:D.ext)==null?void 0:N.prebid)==null?void 0:$.storedrequest,C=y&&y.id?x(h({},y),{id:J(y.id,i.m)}):null;return h(x(h(x(h(h({},l.adUnit),y&&C&&{ortb2Imp:Yt(l.adUnit.ortb2Imp,C)}),{code:l.adUnit.code||n.domId}),l.adUnit.pubstack?{pubstack:v}:{}),{mediaTypes:h(h(h({},A),S),P),bids:f}),a)}).filter(l=>l.bids.length>0&&l.mediaTypes&&(l.mediaTypes.banner||l.mediaTypes.video||l.mediaTypes.native)&&!Wr(l,i.e))}).reduce((n,o)=>[...n,...o],[]),Zt=i=>_("prebid-init",e=>{var r,n;e.e.pbjs=e.e.pbjs||{que:[]};let t=(r=e.i.prebid)==null?void 0:r.analyticAdapters;return t&&t.length>0&&e.e.pbjs.que.push(()=>{e.e.pbjs.enableAnalytics(t)}),e.e.pbjs.libLoaded?Promise.resolve():(n=e.i.prebid)!=null&&n.distributionUrl?(i.loadScript({name:"prebid",assetUrl:e.i.prebid.distributionUrl,loadMethod:1}),Promise.resolve()):Promise.race([Gr(e.e),$r(e)])}),ei=i=>j("prebid-remove-adunits",e=>new Promise(t=>{if(i.ephemeralAdUnits!==!0){e.e.pbjs=e.e.pbjs||{que:[]};let r=e.e.pbjs.adUnits;r&&e.e.pbjs.que.push(()=>{e.t.debug("Prebid","Destroying prebid adUnits",r),r.forEach(n=>e.e.pbjs.removeAdUnit(n.code))})}t()})),ti=()=>re("prebid-clear-auction",i=>new Promise(e=>{i.e.pbjs=i.e.pbjs||{que:[]},i.e.pbjs.que.push(()=>{i.t.debug("Prebid","Clearing prebid auctions"),i.e.pbjs.clearAllAuctions()}),e()})),ii=(i,e)=>{let t,r=n=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:n}});return j("prebid-configure",(n,o)=>(t||(t=new Promise(s=>{i.bidderSettings&&(n.e.pbjs.bidderSettings=i.bidderSettings),n.e.pbjs.que.push(()=>{i.config.s2sConfig&&(Array.isArray(i.config.s2sConfig)?i.config.s2sConfig:[i.config.s2sConfig]).forEach(p=>{var u,c;let d=(c=(u=p.extPrebid)==null?void 0:u.analytics)==null?void 0:c.h5v;d&&(d.configLabel=n.e.moli.configLabel,d.moliVersion=Te.version)}),n.e.pbjs.setConfig(x(h({},i.config),{schain:r([e.supplyChainStartNode]),floors:i.config.floors||{}})),i.schain.nodes.forEach(({bidder:l,node:p,appendNode:d})=>{let u=[e.supplyChainStartNode];d&&u.push(p),n.e.pbjs.setBidderConfig({bidders:[l],config:{schain:r(u)}},!0)}),n.e.pbjs.registerSignalSources&&n.e.pbjs.registerSignalSources()}),s()})),t))},Hr=i=>Array.isArray(i)?i:[i],ri=i=>G("prebid-prepare-adunits",Q,(e,t)=>new Promise(r=>{i.ephemeralAdUnits||e.e.pbjs.que.push(()=>{let n=Qt(e,i,t);n.forEach(o=>{e.t.debug("Prebid",e.c,`Prebid add ad unit: [Code] ${o.code}`,o)}),e.e.pbjs.addAdUnits(n)}),r()})),oi=(i,e)=>Ge("prebid-request-bids",(t,r)=>{var a,l;let n=Math.max(((a=i.config.bidderTimeout)!=null?a:2e3)+3e3,(l=i.failsafeTimeout)!=null?l:0),o=new Promise(p=>t.e.setTimeout(p,n)),s=new Promise(p=>{var b;let d=r.filter(m=>!t.g.isSlotThrottled(m.moliSlot.domId,m.adSlot.getAdUnitPath())),u=i.ephemeralAdUnits?{adUnits:Qt(t,i,d)}:{adUnitCodes:d.filter(Xt).map(m=>m.moliSlot.domId)},c=u.adUnitCodes||((b=u.adUnits)==null?void 0:b.map(m=>m.code).filter(z).filter(Y))||[];if(c.length===0)return t.t.debug("Prebid","skip request bids. All slots were filtered.",d.map(m=>m.moliSlot)),p();let g=!1;t.t.debug("Prebid",`Prebid request bids: 
			${c.join(`
			`)}`);let f=(m,A,S)=>{t.t.info("Prebid",S,m,r.map(P=>P.moliSlot.domId));try{if(g){t.t.warn("Prebid",`ad server request already sent [${t.c}]. AuctionId ${S}`);return}if(!m)return t.t.warn("Prebid",`Undefined bid response map for ad unit codes: ${c.join(", ")}`),p();g=!0,e==="gam"&&(t.l.adPipelineConfig.prebidBidsBackHandler.forEach(P=>P(t,m,r)),t.e.pbjs.setTargetingForGPTAsync(c)),p()}catch(P){t.t.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(P)),p()}};t.e.pbjs.que.push(()=>{var m;t.e.pbjs.requestBids(x(h({},u),{auctionId:t.I,timeout:(m=t.b)==null?void 0:m.timeout,bidsBackHandler:f}))})});return Promise.race([o,s])}),ni=()=>(i,e)=>{let t=e.map(r=>{let n=new te(r.sizeConfig,i.u.getSupportedLabels(),i.e),o=n.filterSupportedSizes;if(!(n.filterSlot(r)&&i.u.filterSlot(r)))return Promise.resolve(null);let s={getAdUnitPath:()=>r.adUnitPath};switch(i.r){case"production":return Promise.resolve({moliSlot:r,adSlot:s,filterSupportedSizes:o});case"test":return Promise.resolve({moliSlot:r,adSlot:s,filterSupportedSizes:o});default:return Promise.reject(`invalid environment: ${i.l.environment}`)}});return Promise.all(t).then(r=>r.filter(z))},si=()=>(i,e)=>new Promise((t,r)=>{i.t.debug("Prebid","start rendering");try{switch(i.r){case"test":i.t.debug("Prebid","Rendering test slots"),He(i,e);break;case"production":i.e.pbjs.getHighestCpmBids().filter(n=>n&&n.adId).forEach(n=>{var s;let o=i.e.document.getElementById(n.adUnitCode);if(o){let a=document.createElement("div");a.style.setProperty("border","0pt none");let l=document.createElement("iframe");l.scrolling="no",l.frameBorder="0",l.marginHeight="0",l.marginHeight="0",l.name=`prebid_ads_iframe_${n.adUnitCode}`,l.title="3rd party ad content",l.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),l.setAttribute("aria-label","Advertisment"),l.style.setProperty("border","0"),l.style.setProperty("margin","0"),l.style.setProperty("overflow","hidden"),a.appendChild(l),o.appendChild(a);let p=(s=l.contentWindow)==null?void 0:s.document;if(p){i.e.pbjs.renderAd(p,n.adId);let d="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",u=p.createElement("style");u.appendChild(p.createTextNode(d)),p.head.appendChild(u)}else i.t.error("Prebid",`No access to iframe contentWindow for ad unit${n.adUnitCode}`)}else i.t.error("Prebid",`Could not locate ad slot with id ${n.adUnitCode}`)});break}t()}catch(n){r(n)}}),Kr=(i,e)=>{let t=r=>!!r&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number";return i?e(t(i)?[i]:i).filter(te.isFixedSize):[]};var be=M.responses.TCPurpose,Yr=i=>!!i.moliSlot.a9,ai=i=>!i.gdprApplies||i.vendor.consents[793]&&[be.STORE_INFORMATION_ON_DEVICE,be.SELECT_BASIC_ADS,be.CREATE_PERSONALISED_ADS_PROFILE,be.SELECT_PERSONALISED_ADS,be.MEASURE_AD_PERFORMANCE,be.APPLY_MARKET_RESEARCH,be.DEVELOP_IMPROVE_PRODUCTS].every(e=>i.purpose.consents[e]),di=(i,e)=>_("a9-init",t=>new Promise(r=>{t.e.apstag=t.e.apstag||{_Q:[],init:function(){t.e.apstag._Q.push(["i",arguments])},fetchBids:function(){t.e.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){t.e.apstag._Q.push(["di",arguments])},rpa:function(){t.e.apstag._Q.push(["ri",arguments])},upa:function(){t.e.apstag._Q.push(["ui",arguments])}},t.r!=="test"&&ai(t.o)&&e.loadScript({name:"A9",loadMethod:1,assetUrl:i.scriptUrl?i.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch(n=>t.t.error("failed to load apstag.js",n)),r()})),li=(i,e)=>j("a9-configure",(t,r)=>new Promise(n=>{let o=[e.supplyChainStartNode];i.schainNode&&o.push(i.schainNode),t.e.apstag.init({pubID:i.pubID,adServer:"googletag",bidTimeout:i.timeout,gdpr:{cmpTimeout:i.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:o}}),n()})),ui=i=>Dt("a9-publisher-audiences",(e,t)=>new Promise(r=>{let n=i.publisherAudience;if(n&&n.enabled){let o={hashedRecords:[{type:"email",record:n.sha256Email}]};if(e.t.debug("A9","Enable publisher audiences"),e.e.apstag.rpa(o),e.e.__tcfapi){let s=!0;e.e.__tcfapi("addEventListener",2,a=>{if(s){s=!1;return}a.eventStatus===M.status.EventStatus.USER_ACTION_COMPLETE&&(e.t.debug("A9","Update publisher audience token"),e.e.apstag.upa(o))})}}r()})),pi=()=>G("a9-clear-targeting",Q,(i,e)=>i.c===0?(i.t.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise(t=>{i.t.debug("A9","clear a9 targetings"),e.forEach(({adSlot:r})=>{r.getTargetingKeys().filter(n=>n==="amznp"||n==="amznsz"||n==="amznbid").forEach(n=>r.clearTargeting(n))}),t()})),Jr=(i,e,t)=>{let r=je(i),n=e?Ot(r,e):r;return J(n,t)},ci=i=>Ge("a9-fetch-bids",(e,t)=>new Promise(r=>{var o;if(!ai(e.o)){e.t.debug("A9","Skip any due to missing consent"),r();return}let n=t.filter(Yr).filter(s=>!e.g.isSlotThrottled(s.moliSlot.domId,s.adSlot.getAdUnitPath())).filter(s=>{let a=s.moliSlot.a9.mediaType==="video",l=e.u.filterSlot(s.moliSlot.a9),p=s.filterSupportedSizes(s.moliSlot.sizes).filter(te.isFixedSize).length>0;return l&&(a||p)}).map(({moliSlot:s,priceRule:a,filterSupportedSizes:l})=>{var p,d;if(s.a9.mediaType==="video")return{slotID:s.domId,mediaType:"video"};{let u=i.supportedSizes?s.sizes.filter(g=>{var f;return(f=i.supportedSizes)==null?void 0:f.some(b=>We(b,g))}):s.sizes,c=Jr(s.adUnitPath,(p=s.a9.slotNamePathDepth)!=null?p:i.slotNamePathDepth,e.m);return h({slotID:s.domId,slotName:c,sizes:l(u).filter(te.isFixedSize)},i.enableFloorPrices&&a?{floor:{value:Math.ceil((d=e.e.pbjs)!=null&&d.convertCurrency?e.e.pbjs.convertCurrency(a.floorprice,"EUR",i.floorPriceCurrency||"USD")*100:a.floorprice*100*1.19),currency:i.floorPriceCurrency||"USD"}}:{})}});e.t.debug("A9",`Fetch '${n.length}' A9 slots: ${n.map(s=>`[slotID] ${s.slotID}`)}`),n.length===0?r():e.e.apstag.fetchBids(h({slots:n},((o=e.b)==null?void 0:o.timeout)&&{bidTimeout:e.b.timeout}),s=>{e.e.apstag.setDisplayBids(),r()})}));var mi=(i,e)=>e?new Promise(t=>i.setTimeout(t,e)):Promise.resolve(),gi=i=>Number(ye(oe.debugDelay,i.localStorage))||void 0;var fi=(i,e,t)=>{let r=new Map;t==null||t.info(`Bidders disabling feature is ${i.enabled?"enabled":"disabled"}`);let n=(d,u)=>{var c,g,f;return(f=(g=(c=r.get(d))==null?void 0:c.get(u))==null?void 0:g.disabled)!=null?f:!1},o=d=>{var u,c;(u=d.bidderRequests)==null||u.forEach(g=>{var f;(f=g==null?void 0:g.bids)==null||f.forEach(b=>{var P,v,y;let m=b.bidder,A=b.adUnitCode;r.get(A)||r.set(A,new Map);let S=(P=r.get(A))==null?void 0:P.get(m);if(S){let C=S.bidRequestCount+1;(v=r.get(A))==null||v.set(m,x(h({},S),{bidRequestCount:C}))}else(y=r.get(A))==null||y.set(m,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})})}),(c=d.bidsReceived)==null||c.forEach(g=>{var A,S,P;let f=g.bidderCode,b=g.adUnitCode,m=(A=r.get(b))==null?void 0:A.get(f);m?(S=r.get(b))==null||S.set(f,x(h({},m),{bidReceivedCount:m.bidReceivedCount+1})):(P=r.get(b))==null||P.set(f,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})}),s()},s=()=>{r.forEach((d,u)=>{d.forEach((c,g)=>{a(c)&&(l(u,g),e.setTimeout(()=>{p(u,g)},i.reactivationPeriod))})})},a=d=>d.bidRequestCount>i.minBidRequests&&d.bidReceivedCount/d.bidRequestCount<i.minRate&&!d.disabled,l=(d,u)=>{var g;let c=(g=r.get(d))==null?void 0:g.get(u);c&&(c.disabled=!0,t==null||t.info(`Bidder ${u} for position ${d} is now disabled.`))},p=(d,u)=>{var g;let c=(g=r.get(d))==null?void 0:g.get(u);c&&(c.disabled=!1,t==null||t.info(`Bidder ${u} for position ${d} is now enabled.`))};return{isBidderDisabled:n,onAuctionEnd:o}};var yi=(i,e)=>{let t=new Set;function r(o){let s=o.slot.getSlotElementId();(!i.includedDomIds||i.includedDomIds.length===0||i.includedDomIds.includes(s))&&(t.add(s),e.setTimeout(()=>{t.delete(s)},i.throttle*1e3))}function n(o){return t.has(o)}return{onSlotRequested:r,isThrottled:n}};var bt=(i,e)=>Math.max(i.wait-(e-i.ts),0);var xe;(e=>{let i;(r=>{let t;(l=>(l[l.TOP_ANCHOR=2]="TOP_ANCHOR",l[l.BOTTOM_ANCHOR=3]="BOTTOM_ANCHOR",l[l.REWARDED=4]="REWARDED",l[l.INTERSTITIAL=5]="INTERSTITIAL"))(t=r.OutOfPageFormat||(r.OutOfPageFormat={}))})(i=e.enums||(e.enums={}))})(xe||(xe={}));var bi="h5v-fc",Xr=i=>!!i.conditions&&!!i.conditions.pacingInterval,vi=(i,e,t,r)=>{var m,A,S,P;let n=new Map,o=new Map,s=new Map,a=0,l=(A=(m=i.bidders)==null?void 0:m.filter(Xr))!=null?A:[],p=(S=l.filter(v=>{var y,C,T;return!((y=v.conditions.pacingInterval)!=null&&y.events)||((T=(C=v.conditions.pacingInterval)==null?void 0:C.events)==null?void 0:T.includes("bidWon"))}))!=null?S:[],d=(P=l.filter(v=>{var y,C;return(C=(y=v.conditions.pacingInterval)==null?void 0:y.events)==null?void 0:C.includes("bidRequested")}))!=null?P:[],u=i.positions||[],c=()=>{if(i.persistent===!0){let v={bCaps:Array.from(s.entries()).reduce((y,[C,T])=>x(h({},y),{[C]:T}),{}),pCaps:Array.from(n.entries()).reduce((y,[C,T])=>x(h({},y),{[C]:T}),{}),pLastImpAdRequests:Array.from(o.entries()).reduce((y,[C,T])=>x(h({},y),{[C]:T}),{}),requestAds:a};e.sessionStorage.setItem(bi,JSON.stringify(v))}},g=(v,y,C,T)=>{var N;let D=y.bidders;if((!D||D.includes(T.bidder))&&y.domId===T.adUnitCode){let $=`${T.adUnitCode}:${T.bidder}`,V=(N=s.get($))!=null?N:[];V.push({ts:v,wait:C}),s.set($,V),e.setTimeout(()=>{r.debug("fc",`removing ${$} at ${v}`);let ee=s.get($);ee&&s.set($,ee.filter(qe=>qe.ts!==v))},C),c()}},f=(v,y,C)=>{var D;let T=(D=n.get(y))!=null?D:[];T.push({ts:v,wait:C.intervalInMs}),n.set(y,T),e.setTimeout(()=>{let N=n.get(y);N&&n.set(y,N.filter($=>$.ts!==v))},C.intervalInMs),c()},b=v=>{u.filter(y=>y.adUnitPath===v).forEach(y=>{y.conditions.pacingInterval&&f(t(),v,y.conditions.pacingInterval),y.conditions.pacingRequestAds&&(o.set(v,a),c())})};if(i.persistent===!0){let v=e.sessionStorage.getItem(bi);if(v)try{let y=JSON.parse(v);a=y.requestAds,Object.entries(y.bCaps).forEach(([C,T])=>{T==null||T.forEach(D=>{let[N,$]=C.split(":"),V=bt(D,t());g(t(),{domId:N,bidders:[$]},V,{bidder:$,adUnitCode:N})})}),Object.entries(y.pCaps).forEach(([C,T])=>{T==null||T.forEach(D=>{let N=bt(D,t());f(D.ts,C,{intervalInMs:N})})})}catch(y){r.error("fc","failed to parse fc state",y)}}return{onAuctionEnd(v){d.forEach(y=>{var C;(C=v.bidderRequests)==null||C.forEach(T=>{var D;(D=T==null?void 0:T.bids)==null||D.forEach(N=>{g(t(),y,y.conditions.pacingInterval.intervalInMs,N)})})}),c()},onBidWon(v){p.forEach(y=>g(t(),y,y.conditions.pacingInterval.intervalInMs,v)),c()},onSlotRenderEnded(v){let[y]=v.slot.getTargeting(Se);!v.isEmpty&&y!==xe.enums.OutOfPageFormat.INTERSTITIAL.toString()&&b(v.slot.getAdUnitPath())},onImpressionViewable(v){let[y]=v.slot.getTargeting(Se);y===xe.enums.OutOfPageFormat.INTERSTITIAL.toString()&&b(v.slot.getAdUnitPath())},afterRequestAds(){a++,c()},updateAdUnitPaths(v){var y;u=((y=i.positions)!=null?y:[]).map(C=>x(h({},C),{adUnitPath:J(C.adUnitPath,v)}))},isAdUnitCapped(v){return u.filter(y=>y.adUnitPath===v).some(y=>{var C,T;return y.adUnitPath===v&&y.conditions.delay&&a<y.conditions.delay.minRequestAds||y.conditions.pacingRequestAds&&o.has(v)&&a-((C=o.get(v))!=null?C:0)<y.conditions.pacingRequestAds.requestAds||y.conditions.pacingInterval&&((T=n.get(v))!=null?T:[]).length>=y.conditions.pacingInterval.maxImpressions})},isFrequencyCapped(v,y){return i.bidders?i.bidders.filter(C=>C.domId===v&&(!C.bidders||C.bidders.includes(y))).some(({conditions:{pacingInterval:C,delay:T}})=>{var D;return C&&((D=s.get(`${v}:${y}`))!=null?D:[]).length>=C.maxImpressions||T&&a<T.minRequestAds}):!1}}};var hi=()=>{let i=new Map,e=n=>n.reduce((o,s)=>{let{adUnitCode:a,cpm:l}=s;return o[a]||(o[a]=[]),o[a].push(l),o},{}),t=n=>{let o=e(n);i.forEach((s,a)=>{o[a]||i.delete(a)}),Object.entries(o).forEach(([s,a])=>{var p;let l=(p=r(s))!=null?p:[];i.set(s,Array.from(new Set([...a,...l])))})},r=n=>{var o;return(o=i.get(n))!=null?o:null};return{groupReceivedBidsByAdUnitCode:e,onAuctionEnd:t,getLastBidCpms:r}};var Ke=(i,e,t,r={})=>{var p,d,u,c,g,f,b,m,A;let n=(p=r.biddersDisabling)!=null&&p.enabled?fi(r.biddersDisabling,i):void 0,o=(d=r.adRequestThrottling)!=null&&d.enabled?yi(r.adRequestThrottling,i):void 0,s=(u=r.frequencyCap)!=null&&u.enabled?vi(r.frequencyCap,i,i.Date.now,e):void 0,a=(c=r.previousBidCpms)!=null&&c.enabled?hi():void 0;i.pbjs=i.pbjs||{que:[]},i.googletag=i.googletag||{},i.googletag.cmd=i.googletag.cmd||[],((g=r.biddersDisabling)!=null&&g.enabled||(f=r.previousBidCpms)!=null&&f.enabled||(b=r.frequencyCap)!=null&&b.enabled)&&i.pbjs.que.push(()=>{i.pbjs.onEvent("auctionEnd",S=>{var P,v,y;(P=r.biddersDisabling)!=null&&P.enabled&&(n==null||n.onAuctionEnd(S)),(v=r.previousBidCpms)!=null&&v.enabled&&S.bidsReceived&&(a==null||a.onAuctionEnd(S.bidsReceived)),(y=r.frequencyCap)!=null&&y.enabled&&(s==null||s.onAuctionEnd(S))})}),(m=r.adRequestThrottling)!=null&&m.enabled&&i.googletag.cmd.push(()=>{i.googletag.pubads().addEventListener("slotRequested",S=>{o==null||o.onSlotRequested(S)})}),(A=r.frequencyCap)!=null&&A.enabled&&(i.pbjs.que.push(()=>{i.pbjs.onEvent("bidWon",S=>{r.frequencyCap&&(s==null||s.onBidWon(S))})}),i.googletag.cmd.push(()=>{i.googletag.pubads().addEventListener("slotRenderEnded",S=>{s==null||s.onSlotRenderEnded(S)}),i.googletag.pubads().addEventListener("impressionViewable",S=>{s==null||s.onImpressionViewable(S)})}),t.addEventListener("afterRequestAds",()=>{s==null||s.afterRequestAds()}));let l=j("GlobalAuctionContext",S=>(s==null||s.updateAdUnitPaths(S.m),Promise.resolve()));return{isSlotThrottled(S,P){return!!(o!=null&&o.isThrottled(S)||s!=null&&s.isAdUnitCapped(P))},isBidderFrequencyCappedOnSlot(S,P){var v;return(v=s==null?void 0:s.isFrequencyCapped(S,P))!=null?v:!1},getLastBidCpmsOfAdUnit(S){var P;return(P=a==null?void 0:a.getLastBidCpms(S))!=null?P:[]},isBidderDisabled(S,P){var v;return(v=n==null?void 0:n.isBidderDisabled(S,P))!=null?v:!1},configureStep(){return l}}};var ke=i=>i!==null&&typeof i=="object"&&!Array.isArray(i);function Ye(i,...e){if(!e.length)return i;let t=e.shift();if(ke(i)&&ke(t))for(let r in t)ke(t[r])?(i[r]||Object.assign(i,{[r]:{}}),Ye(i[r],t[r])):Array.isArray(t[r])?i[r]?Array.isArray(i[r])&&(i[r]=i[r].concat(t[r])):Object.assign(i,{[r]:t[r]}):Object.assign(i,{[r]:t[r]});return Ye(i,...e)}var Ii=(i,e)=>e.pubads().getSlots().find(t=>t.getSlotElementId()===i.domId||t.getAdUnitPath()===i.adUnitPath),Qr=i=>{try{let e=typeof i=="string"?JSON.parse(i):ke(i)?i:null;switch(e==null?void 0:e.event){case"h5.adunit.passback":return e.passbackOrigin&&(e.domId||e.adUnitPath)?e:null;case"h5.adunit.refresh":return e;default:return null}}catch(e){return null}},Zr=(i,e)=>{let t=e.i.slots.find(n=>n.domId===i.domId&&n.behaviour.loaded==="backfill"),r=Ii(i,e.e.googletag);t&&r&&(e.t.debug("bridge",`Refresh ad slot ${i.domId}`),e.e.googletag.destroySlots([r]),e.e.moli.refreshAdSlot(i.domId,{loaded:"backfill"}).catch(n=>e.t.error("bridge",`failed to refresh ${i.domId}`,n)))},eo=(i,e)=>{let t=Ii(i,e.e.googletag),r="passback";t&&t.getTargeting(r).length===0&&(e.t.debug("passback",`Process passback for ad slot ${t.getAdUnitPath()}`),t.setTargeting(r,"true"),t.setTargeting("passbackOrigin",i.passbackOrigin),e.e.googletag.pubads().refresh([t]))},Si=()=>_("bridge",i=>{var e;return(e=i.i.bridge)!=null&&e.enabled&&(i.t.debug("bridge","add message listener"),i.e.addEventListener("message",t=>{let r=Qr(t.data);if(r)switch(r.event){case"h5.adunit.passback":eo(r,i);break;case"h5.adunit.refresh":Zr(r,i);break}})),Promise.resolve()});var to=i=>i.behaviour.loaded==="manual",io=i=>i.behaviour.loaded==="infinite",ro=i=>i.behaviour.loaded==="backfill",vt=i=>e=>!!i.document.getElementById(e.domId)||e.position==="interstitial"||e.position==="out-of-page"||e.position==="out-of-page-interstitial"||e.position==="out-of-page-top-anchor"||e.position==="out-of-page-bottom-anchor",Pi=(i,e)=>i?typeof i=="string"?i:i[e]||"default":"default",Ai=(i,e,t,r,n)=>{let{loaded:o}=h({loaded:"manual"},n);return e.slots.filter(vt(i)).filter(s=>Pi(s.behaviour.bucket,t)===r&&(s.behaviour.loaded===o||s.behaviour.loaded==="infinite")).map(s=>n!=null&&n.sizesOverride?x(h({},s),{sizes:n.sizesOverride}):s)},Je=class i{constructor(e,t,r,n){this.assetService=e;this.eventService=t;this.window=r;this.adPipelineConfig=n;this.requestAdsCalls=0;this.adPipeline=new Ie({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},de(),this.window,Ke(this.window,de(),this.eventService));this.initialize=(e,t)=>{var c;let r=i.getEnvironment(t),n=e.adServer||"gam",o=n==="gam",s=((c=e.spa)==null?void 0:c.enabled)===!0;this.logger.setLogger(q(t,this.window)),this.logger.debug("AdService",`Initializing with environment ${r} and ad server ${n}`);let a=o?[Ft(),Si()]:[],l=o?[$t()]:[];o&&s&&l.push(zt(),jt());let p=[];o&&p.push(Gt(),Wt());let d=[];e.prebid&&r==="production"&&(a.push(Zt(this.assetService)),l.push(ii(e.prebid,e.schain)),s&&(l.push(ei(e.prebid)),e.prebid.clearAllAuctions&&l.push(ti())),p.push(ri(e.prebid)),d.push(oi(e.prebid,n))),e.a9&&r==="production"&&o&&(a.push(di(e.a9,this.assetService)),l.push(li(e.a9,e.schain)),l.push(ui(e.a9)),p.push(pi()),d.push(ci(e.a9)));let u=Ke(this.window,this.logger,this.eventService,e.globalAuctionContext);if(l.push(u.configureStep()),a.push(...t.adPipelineConfig.initSteps),l.push(...t.adPipelineConfig.configureSteps),p.push(...t.adPipelineConfig.prepareRequestAdsSteps),d.push(...t.adPipelineConfig.requestBidsSteps),r==="test"){let g=gi(this.window);g&&l.push(()=>mi(this.window,g))}return this.adPipeline=new Ie({init:a,configure:l,defineSlots:o?Ht():ni(),prepareRequestAds:p,requestBids:d,requestAds:o?Kt():si()},this.logger,this.window,u),new Promise(g=>{Ue(this.window,()=>{this.logger.debug("DOM","dom ready"),g(e)})})};this.requestAds=(e,t)=>xt(this,null,function*(){var l;this.requestAdsCalls=this.requestAdsCalls+1;let{refreshSlots:r,refreshInfiniteSlots:n,refreshBuckets:o}=t,s=yt(this.window,t,e.labelSizeConfig,e.targeting),a=o.flatMap(p=>Ai(this.window,e,s,p.bucket,p.options).map(d=>d.domId));this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,r,o),this.eventService.emit("beforeRequestAds",{runtimeConfig:t});try{let p=e.slots.map(d=>to(d)?r.includes(d.domId)||a.includes(d.domId)?d:null:io(d)?n.some(u=>u.artificialDomId===d.domId)?d:null:ro(d)?null:d).filter(z).filter(vt(this.window));if((l=e.buckets)!=null&&l.enabled){let d=new Map;p.forEach(c=>{let g=Pi(c.behaviour.bucket,s),f=d.get(g);f?f.push(c):d.set(g,[c])});let u=yield Promise.all(Array.from(d.entries()).map(([c,g])=>(this.logger.debug("AdPipeline",`running bucket ${c}, slots:`,g),this.adPipeline.run(g,e,t,this.requestAdsCalls).then(()=>g))));return this.eventService.emit("afterRequestAds",{state:"finished"}),ge(u)}else return yield this.adPipeline.run(p,e,t,this.requestAdsCalls),this.eventService.emit("afterRequestAds",{state:"finished"}),p}catch(p){return this.logger.error("AdPipeline","slot filtering failed",p),this.eventService.emit("afterRequestAds",{state:"error"}),Promise.reject(p)}});this.getAdPipeline=()=>this.adPipeline;this.setLogger=e=>{this.logger.setLogger(e)};this.logger=new Fe(de()),n&&(this.adPipeline=new Ie(n,this.logger,r,Ke(r,this.logger,this.eventService)))}static getEnvironment(e){return e.environment||"production"}refreshAdSlots(e,t,r,n){if(e.length===0)return Promise.resolve();let{loaded:o}=h({loaded:"manual"},n),s=new Set(["infinite"]);o==="eager"?(s.add("manual"),s.add("eager")):s.add(o);let a=t.slots.filter(l=>e.some(p=>p===l.domId)&&s.has(l.behaviour.loaded)).filter(vt(this.window)).map(l=>n!=null&&n.sizesOverride?x(h({},l),{sizes:n.sizesOverride}):l);if(e.length!==a.length){let l=a.filter(d=>e.every(u=>u!==d.domId)),p=e.filter(d=>a.every(u=>u.domId!==d));l.length&&this.logger.warn("AdService","The following slots do not exist on the page DOM.",l),p.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",l)}return this.logger.debug("AdService","refresh ad slots",a),this.adPipeline.run(a,t,r,this.requestAdsCalls,{options:n})}refreshBucket(e,t,r,n){var a;if(!((a=t.buckets)!=null&&a.enabled))return Promise.resolve();let o=yt(this.window,r,t.labelSizeConfig,t.targeting),s=Ai(this.window,t,o,e,n);return s.length===0?(this.logger.warn("AdService","No slots found in bucket",e),Promise.resolve()):(this.logger.debug("AdService","refresh ad buckets",s,t.targeting),this.adPipeline.run(s,t,r,this.requestAdsCalls,{bucketName:e,options:n}))}};var Ci=()=>{let i=new Map,e=new Map;return{addEventListener(t,r,n={}){var s;let o=n.once?e:i;o.has(t)||o.set(t,new Set),(s=o.get(t))==null||s.add(r)},removeEventListener(t,r){var n,o;(n=i.get(t))==null||n.delete(r),(o=e.get(t))==null||o.delete(r)},emit(t,r){var o;(o=i.get(t))==null||o.forEach(s=>{try{s(r)}catch(a){console.error(`Error in event listener for ${String(t)}:`,a)}});let n=e.get(t);n&&(n.forEach(s=>{try{s(r)}catch(a){console.error(`Error in one-time event listener for ${String(t)}:`,a)}finally{n.delete(s)}}),n.size===0&&e.delete(t))}}};var Oe={moliEnv:"moliEnv",moliPubCode:"moliPubCode",moliVersion:"moliVersion"};var we=(i,e,t,r=n=>!0)=>[{source:"queryParam",value:he(i.location.search).get(e)},{source:"sessionStorage",value:ye(t,i.sessionStorage)},{source:"localStorage",value:ye(t,i.localStorage)}].map(({source:n,value:o})=>o&&r(o)?{source:n,value:o}:void 0).filter(z);var oo=i=>!!["production","test"].find(t=>t===i),Ri=i=>we(i,Oe.moliEnv,oe.moliEnv,oo)[0]||void 0,Ei=(i,e)=>Me(oe.moliEnv,i,e);var Be=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href===e;case"path":try{let r=new URL(e);return t.pathname===r.pathname}catch(r){return!0}}},Mi=(i,e,t)=>{switch(i){case"none":return!0;case"href":return t.href!==e;case"path":try{let r=new URL(e);return t.pathname!==r.pathname}catch(r){return!0}}};var Ti=i=>{let e=_e(i),t=Ci(),r=new Je(e,t,i),n=i,o={state:"configurable",initialize:!1,runtimeConfig:ee(),modules:[]};function s(I,R){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.keyValues[I]=R;break}case"spa-finished":case"spa-requestAds":{o.nextRuntimeConfig.keyValues[I]=R;break}default:{q(o.runtimeConfig,i).error("MoliGlobal",`Setting key-value after configuration: ${I} : ${R}`);break}}}function a(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.labels.push(I);break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.labels.push(I);break}default:{q(o.runtimeConfig,i).error("MoliGlobal",`Adding label after configure: ${I}`);break}}}function l(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.adUnitPathVariables=I;break}case"spa-requestAds":case"spa-finished":{o.nextRuntimeConfig.adUnitPathVariables=I;break}default:{q(o.runtimeConfig,i).error("MoliGlobal",`Setting unit path variables after configuration: ${I}`);break}}}function p(){let I=fe(i.location.hostname)||"unknown";switch(o.state){case"configurable":return x(h({},o.runtimeConfig.adUnitPathVariables),{domain:I,device:"unknown"});case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":let R=Ee(o.config.labelSizeConfig||[],[],i);return x(h({},m().adUnitPathVariables),{domain:o.config.domain||I,device:R.getDeviceLabel()})}}function d(I,R){let B=(R||{}).removeNetworkChildId||!1,L=J(I,p());return B?je(L):L}function u(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.logger=I;break}default:{I.error("Setting a custom logger is not allowed after configuration");break}}}function c(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.beforeRequestAds.push(I);break}default:{q(o.runtimeConfig,i).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",o.config);break}}}function g(I){switch(o.state){case"configurable":case"configured":{o.runtimeConfig.hooks.afterRequestAds.push(I);break}default:{q(o.runtimeConfig,i).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",o.config);break}}}function f(){switch(o.state){case"configurable":return null;case"configured":return o.config;case"requestAds":return o.config;case"spa-requestAds":case"spa-finished":return o.config;case"finished":return o.config;case"error":return o.config}}function b(){return o.runtimeConfig}function m(){var I,R,k,B,L,H,O;return{keyValues:h(h({},(R=(I=o.config)==null?void 0:I.targeting)==null?void 0:R.keyValues),o.runtimeConfig.keyValues),labels:[...(L=(B=(k=o.config)==null?void 0:k.targeting)==null?void 0:B.labels)!=null?L:[],...o.runtimeConfig.labels],adUnitPathVariables:h(h({},(O=(H=o.config)==null?void 0:H.targeting)==null?void 0:O.adUnitPathVariables),o.runtimeConfig.adUnitPathVariables)}}function A(I){switch(o.state){case"configurable":case"configured":{o.modules.push(I);return}default:q(o.runtimeConfig,i).error("Registering a module is only allowed within the ad tag before the ad tag is configured")}}function S(I){var R;switch(o.state){case"configurable":{let k=o.initialize,B=Ri(i),L=o.modules;B&&(o.runtimeConfig.environment=B.value),(B==null?void 0:B.source)==="queryParam"&&Ei(B.value,i.sessionStorage);let H=q(o.runtimeConfig,i);return H.debug("MoliGlobal","configure modules",(R=I.modules)!=null?R:{}),L.forEach(O=>{var X;try{O.n((X=I.modules)!=null?X:{}),H.debug("MoliGlobal",`configure ${O.moduleType} module ${O.name}`,O.i()),o.runtimeConfig.adPipelineConfig.initSteps.push(...O.s()),o.runtimeConfig.adPipelineConfig.configureSteps.push(...O.a()),o.runtimeConfig.adPipelineConfig.prepareRequestAdsSteps.push(...O.d()),O.A&&o.runtimeConfig.adPipelineConfig.requestBidsSteps.push(...O.A()),O.v&&o.runtimeConfig.adPipelineConfig.prebidBidsBackHandler.push(...O.v())}catch(W){H.error("MoliGlobal",`failed to configure ${O.moduleType} module ${O.name}`,W)}}),o={state:"configured",config:I,runtimeConfig:o.runtimeConfig,modules:L},k||I.requestAds===!0?P():Promise.resolve(o)}case"configured":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",o.config),Promise.resolve(o);case"requestAds":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads."),Promise.resolve(o);case"finished":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished."),Promise.resolve(o);case"error":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",o.error),Promise.resolve(o)}return Promise.resolve(null)}function P(){var I;switch(o.state){case"configurable":return o.initialize=!0,Promise.resolve(o);case"configured":{$(),V(o.config.domain);let{refreshInfiniteSlots:R}=o.runtimeConfig,k=o.config;R.length>0&&R.forEach(O=>{k=ze(k,O.idOfConfiguredSlot,O.artificialDomId,q(o.runtimeConfig,i))});let B=q(o.runtimeConfig,i);o.runtimeConfig.hooks&&o.runtimeConfig.hooks.beforeRequestAds&&o.runtimeConfig.hooks.beforeRequestAds.forEach(O=>{try{O(k,o.runtimeConfig)}catch(X){B.error("MoliGlobal","beforeRequestAds hook failed",X)}});let L=o.runtimeConfig.hooks.afterRequestAds;if(((I=k.spa)==null?void 0:I.enabled)===!0){let O=o.runtimeConfig,X=r.initialize(k,O);return o={state:"spa-requestAds",config:k,initialized:X,modules:o.modules,href:i.location.href,runtimeConfig:Object.freeze(ee(o.runtimeConfig,{keepTargeting:!0})),nextRuntimeConfig:ee(o.runtimeConfig)},X.then(()=>r.requestAds(k,O)).then(()=>{var E,Z;let W=(Z=(E=k.spa)==null?void 0:E.validateLocation)!=null?Z:"href";if(o.state==="spa-requestAds"&&Be(W,o.href,i.location)){let{config:ne,runtimeConfig:Re}=o;o.runtimeConfig.refreshSlots.length>0&&r.refreshAdSlots(Re.refreshSlots,ne,Re),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(ve=>{r.refreshBucket(ve.bucket,ne,Re,ve.options)}),L.forEach(ve=>ve("spa-finished"));let De=x(h({},o),{state:"spa-finished",nextRuntimeConfig:ee(o.runtimeConfig),runtimeConfig:ee(o.runtimeConfig,{keepTargeting:!0})});return o=De,De}else return o.state==="spa-finished"||o.state==="spa-requestAds"?(q(o.runtimeConfig,i).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),o):Promise.reject(`reached invalid state [${o.state}]`)})}else return o={state:"requestAds",config:k,modules:o.modules,runtimeConfig:Object.freeze(o.runtimeConfig)},r.initialize(k,o.runtimeConfig).then(O=>r.requestAds(O,o.runtimeConfig)).then(()=>(o={state:"finished",config:k,runtimeConfig:o.runtimeConfig,modules:o.modules},L.forEach(O=>O("finished")),Promise.resolve(o))).catch(O=>(q(o.runtimeConfig,i).error("MoliGlobal",O),o={state:"error",config:k,runtimeConfig:o.runtimeConfig,error:O,modules:o.modules},L.forEach(X=>X("error")),Promise.resolve(o)))}case"spa-requestAds":case"spa-finished":{o.state==="spa-requestAds"&&q(o.runtimeConfig,i).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),$(),V(o.config.domain);let{modules:R}=o,k=o.nextRuntimeConfig.hooks.afterRequestAds,B=o.nextRuntimeConfig.hooks.beforeRequestAds,L=o;B.forEach(W=>{try{W(L.config,o.runtimeConfig)}catch(E){q(o.runtimeConfig,i).error("MoliGlobal","beforeRequestAds hook failed",E)}});let{initialized:H,href:O,nextRuntimeConfig:X}=o;return o=x(h({},L),{state:"spa-requestAds",runtimeConfig:ee(o.nextRuntimeConfig,{keepTargeting:!0}),nextRuntimeConfig:ee(o.runtimeConfig)}),H.then(W=>{var Z,ne;let E=(ne=(Z=W.spa)==null?void 0:Z.validateLocation)!=null?ne:"href";return Mi(E,O,i.location)?r.requestAds(W,X).then(()=>W):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${E} for validation.`)}).then(W=>{let E=o.runtimeConfig;return o.runtimeConfig.refreshSlots.length>0&&r.refreshAdSlots(o.runtimeConfig.refreshSlots,W,o.runtimeConfig),o.runtimeConfig.refreshBuckets.length>0&&o.runtimeConfig.refreshBuckets.forEach(Z=>{r.refreshBucket(Z.bucket,W,E,Z.options)}),o={state:"spa-finished",config:W,initialized:H,modules:R,href:i.location.href,runtimeConfig:o.runtimeConfig,nextRuntimeConfig:ee(o.runtimeConfig)},k.forEach(Z=>Z("spa-finished")),o})}case"requestAds":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return q(o.runtimeConfig,i).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",o.error),Promise.reject()}}function v(I,R){var B,L;let k=typeof I=="string"?[I]:I;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshSlots.push(...k),Promise.resolve("queued");case"spa-finished":let H=(L=(B=o.config.spa)==null?void 0:B.validateLocation)!=null?L:"href";return Be(H,o.href,i.location)?r.refreshAdSlots(k,o.config,o.runtimeConfig,R).then(()=>"refreshed"):(o.nextRuntimeConfig.refreshSlots.push(...k),Promise.resolve("queued"));case"finished":case"requestAds":return r.refreshAdSlots(k,o.config,o.runtimeConfig,R).then(()=>"refreshed");default:return q(o.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function y(I,R){var k,B;switch(o.state){case"configurable":case"configured":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:R}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:R}),Promise.resolve("queued");case"spa-finished":let L=(B=(k=o.config.spa)==null?void 0:k.validateLocation)!=null?B:"href";return Be(L,o.href,i.location)?(o=x(h({},o),{config:ze(o.config,R,I,q(o.runtimeConfig,i))}),r.refreshAdSlots([I],o.config,o.runtimeConfig).then(()=>"refreshed")):(o.runtimeConfig.refreshInfiniteSlots.push({artificialDomId:I,idOfConfiguredSlot:R}),Promise.resolve("queued"));case"finished":case"requestAds":return o=x(h({},o),{config:ze(o.config,R,I,q(o.runtimeConfig,i))}),r.refreshAdSlots([I],o.config,o.runtimeConfig).then(()=>"refreshed");default:return q(o.runtimeConfig,i).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function C(I,R){var k,B;switch(o.state){case"configurable":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:R}),Promise.resolve("queued");case"configured":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:R}),Promise.resolve("queued");case"spa-requestAds":return o.runtimeConfig.refreshBuckets.push({bucket:I,options:R}),Promise.resolve("queued");case"spa-finished":{let L=(B=(k=o.config.spa)==null?void 0:k.validateLocation)!=null?B:"href";return Be(L,o.href,i.location)?r.refreshBucket(I,o.config,o.runtimeConfig,R).then(()=>"refreshed"):(o.runtimeConfig.refreshBuckets.push({bucket:I,options:R}),Promise.resolve("queued"))}case"finished":case"requestAds":return r.refreshBucket(I,o.config,o.runtimeConfig,R).then(()=>"refreshed");default:return q(o.runtimeConfig,i).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}}function T(){i.dispatchEvent(new CustomEvent("h5v.trigger-delay"))}function D(){return o.state}function N(I){switch(o.state){case"configurable":{q(o.runtimeConfig,i).error("MoliGlobal","Cannot open console before configuration");break}default:e.loadScript({assetUrl:I!=null?I:`https://highfivve.github.io/moli-ad-tag/assets/bundle/v${Te.version}/console.js`,loadMethod:1,name:"moli-debugger"}).catch(R=>console.error("failed to load moli debugger",R))}}function $(){let I="ABtest",k=he(i.location.search).get(I),B=k?Number(k):Math.floor(Math.random()*100)+1;s(I,B.toString())}function V(I){let R=I||fe(i.location.hostname);R&&a(R)}function ee(I,R){var k,B,L,H,O,X,W,E;return{environment:(k=I==null?void 0:I.environment)!=null?k:"production",hooks:{beforeRequestAds:(B=I==null?void 0:I.hooks.beforeRequestAds)!=null?B:[],afterRequestAds:(L=I==null?void 0:I.hooks.afterRequestAds)!=null?L:[]},logger:(H=I==null?void 0:I.logger)!=null?H:void 0,adUnitPathVariables:(R==null?void 0:R.keepTargeting)===!0?(O=I==null?void 0:I.adUnitPathVariables)!=null?O:{}:{},labels:(R==null?void 0:R.keepTargeting)===!0?(X=I==null?void 0:I.labels)!=null?X:[]:[],keyValues:(R==null?void 0:R.keepTargeting)===!0?(W=I==null?void 0:I.keyValues)!=null?W:{}:{},refreshSlots:[],refreshInfiniteSlots:[],refreshBuckets:[],adPipelineConfig:{initSteps:[],configureSteps:[],prepareRequestAdsSteps:[],requestBidsSteps:[],prebidBidsBackHandler:(E=I==null?void 0:I.adPipelineConfig.prebidBidsBackHandler)!=null?E:[]}}}return{que:{push(I){I(n.moli)}},version:Te.version,setTargeting:s,addLabel:a,setLogger:u,setAdUnitPathVariables:l,resolveAdUnitPath:d,beforeRequestAds:c,afterRequestAds:g,getConfig:f,getRuntimeConfig:b,getPageTargeting:m,registerModule:A,configure:S,requestAds:P,refreshAdSlot:v,refreshBucket:C,refreshInfiniteAdSlot:y,triggerDelay:T,getState:D,openConsole:N,addEventListener:t.addEventListener,removeEventListener:t.removeEventListener}};var xi=i=>{let e=i,t=e.moli?[...e.moli.que]:[],r=Ti(i);return e.moli=r,t.forEach(n=>n(r)),r};xi(window);var no=i=>i==="android"?"aaid":i==="ios"?"idfa":void 0,ki=(i,e,t,r,n,o,s,a)=>{let l=no(typeof n=="string"?n:n[0]),p=r.reduce((c,g)=>h(h({},c),g),{}),d=r.length?`&kv=${JSON.stringify(p)}`:"",u=a?`&gdpr_consent=${a}`:"";o(`https://api.theadex.com/collector/v1/ifa/c/${i}/t/${e}/request?&ifa=${t}&ifa_type=${l}${d}${u}`).catch(c=>s.error(c))};var Oi=(i,e,t)=>{let r=i[e.key],n=ht(i,e.valueType,e.valueKey);if(!r||Array.isArray(r)||n===void 0&&e.defaultValue===void 0||e.valueType==="number"&&Number.isNaN(n)&&e.defaultValue===void 0){t.warn("Adex DMP",`values for key ${e.key}/valueKey ${e.valueKey} were empty or key was an array. Key/Value:`,r,n);return}let o=Di(n,e,t);return{[e.attribute]:{[r]:o}}},wi=(i,e,t)=>{let r=ht(i,e.adexValueType,e.key);if(r===void 0&&e.defaultValue===void 0||e.adexValueType==="number"&&(Number.isNaN(r)&&e.defaultValue===void 0||Array.isArray(r))){t.warn("Adex DMP",`value for key ${e.key} was empty or key was an array. Value:`,r);return}let n=Di(r,e,t);return{[e.attribute]:n}},Bi=(i,e,t)=>{let r=ht(i,"string",e.key);if(r===void 0&&(e.defaultValue===void 0||e.defaultValue.length===0)||typeof r=="number"){t.warn("Adex DMP",`value for key "${e.key}" was empty or number. Value:`,r);return}let n=ao(r,e,t);return{[e.attribute]:n}},qi=i=>Object.fromEntries(i.sort().map(e=>[e,1])),so=i=>i.sort().join(","),ht=(i,e,t)=>e==="number"?Number(i[t]):i[t],Di=(i,e,t)=>i!==void 0&&!Number.isNaN(i)?Array.isArray(i)?so(i):i:Li(e,t),ao=(i,e,t)=>i===void 0?Li(e,t):Array.isArray(i)?qi(i):{[i]:1},Li=(i,e)=>(e.warn("Adex DMP","using defaultValue",i.defaultValue,"as fallback for key",i.key),i.adexValueType==="list"?i.defaultValue?qi(i.defaultValue):void 0:i.defaultValue);var Ui=(i,e)=>{var t;e.Utiq||(e.Utiq={queue:[]}),(t=e.Utiq).queue||(t.queue=[]),e.Utiq.queue.push(()=>{var r,n;(n=(r=e.Utiq)==null?void 0:r.API)==null||n.addEventListener("onIdsAvailable",({mtid:o})=>{e._adexc.push([`/${i.adexCustomerId}/${i.adexTagId}/`,"cm","_cm",[308,o]])})})};var le=M.responses.TCPurpose,Xe=class{constructor(){this.name="the-adex-dmp";this.description="Moli DMP module for The Adex.";this.moduleType="dmp";this.adexConfig=null;this.isLoaded=!1;this.hasRequiredConsent=e=>!e.gdprApplies||e.vendor.consents[44]&&[le.STORE_INFORMATION_ON_DEVICE,le.SELECT_BASIC_ADS,le.CREATE_PERSONALISED_ADS_PROFILE,le.SELECT_PERSONALISED_ADS,le.CREATE_PERSONALISED_CONTENT_PROFILE,le.SELECT_PERSONALISED_CONTENT,le.MEASURE_AD_PERFORMANCE,le.MEASURE_CONTENT_PERFORMANCE,le.APPLY_MARKET_RESEARCH,le.DEVELOP_IMPROVE_PRODUCTS].every(t=>e.purpose.consents[t]);this.getOrInitAdexQueue=e=>{let t=e;return t._adexc=t._adexc||[],t};this.getAdexKeyValues=(e,t)=>{var n;let r=h(h({},(n=e.i.targeting)==null?void 0:n.keyValues),e.l.keyValues);if(Object.keys(r).length>0)return t.mappingDefinitions.map(o=>{switch(o.adexValueType){case"map":return Oi(r,o,e.t);case"list":return Bi(r,o,e.t);default:return wi(r,o,e.t)}}).filter(z)};this.configureAdexC=(e,t)=>{var o;let r=this.getOrInitAdexQueue(e.e),n=this.getAdexKeyValues(e,t);n?r._adexc.push([`/${t.adexCustomerId}/${t.adexTagId}/`,"ut","_kv",[n.reduce((s,a)=>h(h({},s),a),{}),t.spaMode?1:0]]):e.t.warn("Adex DMP","targeting key/values are empty"),(o=t.enabledPartners)!=null&&o.includes("utiq")&&Ui(t,e.e)}}i(){return this.adexConfig}n(e){e!=null&&e.adex&&e.adex.enabled&&(this.adexConfig=e.adex)}s(){let e=this.adexConfig;return e?[_("DMP module setup",t=>this.track(t,e))]:[]}a(){let e=this.adexConfig;return e!=null&&e.spaMode?[j("DMP module setup",t=>(this.configureAdexC(t,e),Promise.resolve()))]:[]}track(e,t){var l,p;let{adexCustomerId:r,adexTagId:n,appConfig:o}=t;this.configureAdexC(e,t);let s=this.getAdexKeyValues(e,t),a=h(h({},(l=e.i.targeting)==null?void 0:l.keyValues),e.l.keyValues);if(this.hasRequiredConsent(e.o)&&!this.isLoaded&&Object.keys(a).length>0){this.isLoaded=!0;let d=z(o)&&z(a[o.advertiserIdKey])&&(a[o.clientTypeKey]==="android"||a[o.clientTypeKey]==="ios");if(o!=null&&o.advertiserIdKey&&d){let u=e.o.gdprApplies?e.o.tcString:void 0,c=a[o.advertiserIdKey];typeof c=="string"&&s&&ki(r,o.adexMobileTagId?o.adexMobileTagId:n,c,s,(p=a[o.clientTypeKey])!=null?p:"",e.e.fetch,e.t,u)}else e.p.loadScript({name:this.name,assetUrl:`https://dmp.theadex.com/d/${r}/${n}/s/adex.js`,loadMethod:1}).catch(u=>e.t.error("failed to load adex",u))}return Promise.resolve()}d(){return[]}};window.moli.registerModule(new Xe);var Ae=class Ae{constructor(e,t,r,n,o,s,a,l){this.userActivityService=e;this.refreshInterval=t;this.refreshIntervalOverrides=r;this.useIntersectionObserver=n;this.disableAdVisibilityChecks=o;this.viewabilityOverrides=s;this.window=a;this.logger=l;this.isSlotTracked=e=>this.visibilityRecords.has(e);this.removeSlotTracking=e=>{var r;(r=this.logger)==null||r.debug("AdVisibilityService",`removing slot visibility tracking for ${e.getSlotElementId()}`,e),this.visibilityRecords.delete(e.getSlotElementId());let t=this.observedDomElementForSlot(e);this.intersectionObserver&&t&&this.intersectionObserver.unobserve(t.target)};this.handleGoogletagAdVisibilityChanged=e=>{var n;let t=e.slot,r=this.visibilityRecordForGoogletagEvent(e);r&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${t.getSlotElementId()} changed. Visible area: ${e.inViewPercentage}%`),this.updateVisibilityRecord(r,e.inViewPercentage/100))};this.updateVisibilityRecord=(e,t)=>{var r,n,o;if(e.latestStartVisible){let s=this.window.performance.now()-e.latestStartVisible;(r=this.logger)==null||r.debug("AdVisibilityService",`added ${Math.round(s)}ms visibility to ${e.slot.getSlotElementId()}`),e.durationVisibleSum+=s}t>=this.minimalAdVisibilityRatio?(e.latestStartVisible=this.window.performance.now(),(n=this.logger)==null||n.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} visible`)):(e.latestStartVisible=void 0,(o=this.logger)==null||o.debug("AdVisibilityService",`ad ${e.slot.getSlotElementId()} not visible`))};this.visibilityRecordForGoogletagEvent=e=>this.visibilityRecords.get(e.slot.getSlotElementId());var d;this.minimalAdVisibilityRatio=o?0:.5,this.visibilityRecords=new Map,(n||Object.values(s).some(u=>(u==null?void 0:u.variant)==="css"))&&"IntersectionObserver"in this.window&&(this.intersectionObserver=new this.window.IntersectionObserver(u=>this.handleObservedAdVisibilityChanged(u),{threshold:this.minimalAdVisibilityRatio})),n||this.window.googletag.cmd.push(()=>{this.window.googletag.pubads().addEventListener("slotVisibilityChanged",this.handleGoogletagAdVisibilityChanged)}),this.userActivityService.addUserActivityChangedListener(u=>this.handleUserActivityChanged(u)),this.setUpdateTimer(!0),(d=this.logger)==null||d.debug("AdVisibilityService","initialized")}trackSlot(e,t,r){var s;let n=e.getSlotElementId(),o=this.observedDomElementForSlot(e);if(o){(s=this.logger)==null||s.debug("AdVisibilityService",`tracking slot ${e.getSlotElementId()}`,e),this.isSlotTracked(n)&&this.removeSlotTracking(e);let a=o.viewabilityOverride;this.visibilityRecords.set(e.getSlotElementId(),{slot:e,latestStartVisible:this.disableAdVisibilityChecks||(a==null?void 0:a.variant)==="disabled"&&(a.disableAllAdVisibilityChecks||!(a.disabledAdVisibilityCheckAdvertiserIds&&a.disabledAdVisibilityCheckAdvertiserIds.length>0&&r)||a.disabledAdVisibilityCheckAdvertiserIds.includes(r))?this.window.performance.now():void 0,durationVisibleSum:0,refreshCallback:t}),this.intersectionObserver&&(o.targetOverride||this.useIntersectionObserver)&&this.intersectionObserver.observe(o.target)}}setUpdateTimer(e){e?this.visibilityUpdateTimer=this.window.setInterval(()=>this.updateAdVisibilityDuration(),Ae.updateVisibilityInterval):(this.window.clearInterval(this.visibilityUpdateTimer),this.visibilityUpdateTimer=void 0)}updateAdVisibilityDuration(){this.visibilityRecords.forEach(e=>{var t;if(e.latestStartVisible){let r=this.window.performance.now(),n=Math.round(r-e.latestStartVisible);e.durationVisibleSum+=n,e.latestStartVisible=r,(t=this.logger)==null||t.debug("AdVisibilityService",`added ${n}ms visibility to ${e.slot.getSlotElementId()}, now totalling at ${e.durationVisibleSum}ms`)}}),Array.from(this.visibilityRecords.values()).filter(e=>{let t=this.refreshIntervalOverrides[e.slot.getSlotElementId()]||this.refreshInterval;return e.durationVisibleSum>t}).forEach(e=>{var t;(t=this.logger)==null||t.debug("AdVisibilityService",`refreshing ad ${e.slot.getSlotElementId()} after ${e.durationVisibleSum}ms visibility`),e.latestStartVisible=this.window.performance.now(),e.durationVisibleSum=-Ae.consecutiveDurationToRefresh,e.refreshCallback(e.slot)})}handleObservedAdVisibilityChanged(e){e.forEach(t=>{var n;let r=this.visibilityRecordForEntry(t);r&&((n=this.logger)==null||n.debug("AdVisibilityService",`Visibility of slot ${r.slot.getSlotElementId()} changed. Visible area: ${t.intersectionRatio*100}%`),this.updateVisibilityRecord(r,t.intersectionRatio))})}handleUserActivityChanged(e){this.visibilityRecords.forEach(t=>{t.latestStartVisible&&(t.latestStartVisible=this.window.performance.now())}),this.setUpdateTimer(e)}visibilityRecordForEntry(e){return this.visibilityRecords.get(e.target.id)}observedDomElementForSlot(e){let t=e.getSlotElementId(),r=this.viewabilityOverrides[t],n=this.window.document.getElementById(t),o=r&&r.variant==="css"?this.window.document.querySelector(r.cssSelector):null;return o?{target:o,targetOverride:!0,viewabilityOverride:r}:n?{target:n,targetOverride:!1,viewabilityOverride:r}:null}};Ae.updateVisibilityInterval=1e3,Ae.consecutiveDurationToRefresh=1500;var Qe=Ae;var lo=new Map([["strict",{userActivityDuration:10*1e3,userBecomingInactiveDuration:5*1e3}],["moderate",{userActivityDuration:12*1e3,userBecomingInactiveDuration:8*1e3}],["lax",{userActivityDuration:15*1e3,userBecomingInactiveDuration:12*1e3}]]),Pe=class Pe{constructor(e,t={level:"strict"},r){this.window=e;this.userActivityLevelControl=t;this.logger=r;this.isActive=!0;this.handleUserInteraction=()=>this.userActive();this.handleUserIdle=()=>this.userInactive();this.handleUserBecomingIdle=()=>this.userBecomingInactive();this.handlePageVisibilityChanged=()=>{this.window.document.hidden?this.userInactive():this.userActive()};var n;switch(this.listener=[],this.window.document.addEventListener("visibilitychange",this.handlePageVisibilityChanged),(n=this.logger)==null||n.debug("UserActivityService","initialized"),t.level){case"custom":this.userActivityDuration=t.userActivityDuration,this.userBecomingInactiveDuration=t.userBecomingInactiveDuration;break;default:let{userActivityDuration:o,userBecomingInactiveDuration:s}=lo.get(t.level);this.userActivityDuration=o,this.userBecomingInactiveDuration=s}this.userActive()}addUserActivityChangedListener(e){this.listener.push(e)}userActive(){var e;this.isActive||(this.isActive=!0,this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become active")),Pe.observedEvents.forEach(t=>this.window.removeEventListener(t,this.handleUserInteraction)),this.userInactiveTimer&&this.window.clearTimeout(this.userInactiveTimer),this.userBecomingIdleTimer&&this.window.clearTimeout(this.userBecomingIdleTimer),this.userInactiveTimer=this.window.setTimeout(this.handleUserIdle,this.userActivityDuration),this.userBecomingIdleTimer=this.window.setTimeout(this.handleUserBecomingIdle,this.userBecomingInactiveDuration)}userInactive(){var e;this.isActive=!1,Pe.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),this.listener.forEach(t=>t(this.isActive)),(e=this.logger)==null||e.debug("UserActivityService","user has become inactive")}userBecomingInactive(){var e;Pe.observedEvents.forEach(t=>this.window.addEventListener(t,this.handleUserInteraction)),(e=this.logger)==null||e.debug("UserActivityService","user will shortly become inactive")}};Pe.observedEvents=["mousemove","touchstart","scroll","keypress"];var Ze=Pe;var et=class{constructor(){this.name="moli-ad-reload";this.description="Moli implementation of an ad reload module.";this.moduleType="ad-reload";this.moduleConfig=null;this.refreshIntervalMs=2e4;this.reloadKeyValue="native-ad-reload";this.initialized=!1;this.initialize=(e,t,r,n)=>{if(e.r==="test"){e.t.info("AdReload","disabled in environment test");return}this.initialized||(e.t.debug("AdReload","initialize moli ad reload module"),this.setupAdVisibilityService(t,e.e,e.t),this.setupSlotRenderListener(t,r,n,e.e,e.t),this.initialized=!0)};this.setupAdVisibilityService=(e,t,r)=>{var n,o;this.adVisibilityService=new Qe(new Ze(t,e.userActivityLevelControl,r),this.refreshIntervalMs,(n=e.refreshIntervalMsOverrides)!=null?n:{},!1,!!e.disableAdVisibilityChecks,(o=e.viewabilityOverrides)!=null?o:{},t,r)};this.setupSlotRenderListener=(e,t,r,n,o)=>n.googletag.pubads().addEventListener("slotRenderEnded",s=>{var v;let{slot:a,campaignId:l,advertiserId:p,yieldGroupIds:d,isEmpty:u}=s,c=a.getSlotElementId(),g=t.indexOf(c)>-1,f=!l||e.excludeOrderIds.indexOf(l)===-1,b=!!l&&e.includeOrderIds.indexOf(l)>-1,m=!!p&&e.includeAdvertiserIds.indexOf(p)>-1,A=!!d&&e.includeYieldGroupIds.some(y=>d.indexOf(y)>-1),S=!u&&g&&f&&(b||m||A);S||this.logTrackingDisallowedReason(c,{slotIsEmpty:u,slotIsMonitored:g,orderIdNotExcluded:f,orderIdIncluded:b,advertiserIdIncluded:m,yieldGroupIdIncluded:A},o,d,l,p);let P=!!((v=this.adVisibilityService)!=null&&v.isSlotTracked(c));S?this.adVisibilityService.trackSlot(a,r,p):P&&this.adVisibilityService.removeSlotTracking(a)});this.reloadAdSlot=(e,t)=>r=>{let n=r.getSlotElementId(),o=t.i.slots.find(s=>s.domId===n);if(o&&o.behaviour.loaded!=="infinite"){t.t.debug("AdReload","fired slot reload",o.domId);let s=this.maybeOptimizeSlotForCls(e,o,r,t.t,t.e);r.setTargeting(this.reloadKeyValue,"true");let l=(()=>{var d,u;if(((u=(d=e.viewabilityOverrides)==null?void 0:d[n])==null?void 0:u.refreshBucket)===!0){let c=o.behaviour.loaded,g=o.behaviour.bucket,f=typeof g=="string"?g:g==null?void 0:g[t.u.getDeviceLabel()];return f&&c!=="infinite"?{name:f,loaded:c}:void 0}})();l?t.e.moli.refreshBucket(l.name,{loaded:l.loaded}).then(p=>t.t.debug("AdReload",`refreshBucket '${l.name}' result`,p)).catch(p=>t.t.error("AdReload",`refreshBucket '${l.name}' failed`,p)):t.e.moli.refreshAdSlot(n,h({loaded:o.behaviour.loaded},s&&{sizesOverride:s})).catch(p=>t.t.error("AdReload",`refreshing ${n} failed`,p))}};this.maybeOptimizeSlotForCls=(e,t,r,n,o)=>{let s=t.domId;if(e.optimizeClsScoreDomIds.indexOf(s)>-1){let a=o.document.getElementById(s);if(a&&a.style){let l=a.scrollHeight;a.style.setProperty("height",`${l}px`);let p=t.sizes.filter(d=>d!=="fluid"&&d[1]<=l);return n.debug("AdReload",`CLS optimization: slot ${s} received fixed height ${l}px`,"new sizes:",p),p.length<t.sizes.filter(d=>d!=="fluid").length&&o.googletag.destroySlots([r]),p}n.warn("AdReload",`CLS optimization: slot ${s} to be optimized but not found in DOM.`)}return t.sizes};this.logTrackingDisallowedReason=(e,t,r,n,o,s)=>{let{slotIsEmpty:a,slotIsMonitored:l,orderIdNotExcluded:p,orderIdIncluded:d,advertiserIdIncluded:u,yieldGroupIdIncluded:c}=t;a&&r.debug("AdReload",e,"slot not tracked: reported empty"),l||r.debug("AdReload",e,"slot not tracked: excluded by DOM id"),p||r.debug("AdReload",e,"slot not tracked: excluded by order id",o),d||u||c||r.debug("AdReload",e,"slot not tracked: neither order id",o,"nor advertiser id",s,"nor yieldGroup id",n,"included")}}i(){return this.moduleConfig}isInitialized(){return this.initialized}n(e){var t;(t=e==null?void 0:e.adReload)!=null&&t.enabled&&(this.moduleConfig=e.adReload)}s(){return[]}a(){let e=this.moduleConfig;return e?[j(this.name,t=>{let r=t.i.slots.filter(o=>e.excludeAdSlotDomIds.indexOf(o.domId)===-1).map(o=>o.domId).filter(z),n=this.reloadAdSlot(e,t);return t.t.debug("AdReload","monitoring slots",r),this.initialize(t,e,r,n),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new et);var tt=class{constructor(){this.name="Blocklist URLs";this.description="Blocks ad requests entirely or adds key-values for blocklistd urls";this.moduleType="policy";this.blocklistConfig=null;this.isBlocklisted=(e,t,r)=>e.urls.some(({pattern:n,matchType:o})=>{switch(o){case"exact":return t===n;case"contains":return t.indexOf(n)>-1;case"regex":try{let s=RegExp(n).test(t);return s&&r.debug(this.name,`Url '${t}' matched pattern '${n}'`),s}catch(s){return r.error(this.name,`Invalid pattern ${n}`,s),!1}}});this.blocklistCache=null}i(){return this.blocklistConfig}n(e){e!=null&&e.blocklist&&e.blocklist.enabled&&(this.blocklistConfig=e.blocklist)}s(){return this.blocklistConfig?[_("blocklist-urls-init",t=>{var r;switch((r=this.blocklistConfig)==null?void 0:r.mode){case"key-value":let n=this.blocklistConfig.key,o=this.blocklistConfig.isBlocklistedValue||"true";return this.getBlocklist(this.blocklistConfig.blocklist,t.p,t.t)().then(s=>{this.isBlocklisted(s,t.e.location.href,t.t)&&t.e.googletag.pubads().setTargeting(n,o)});case"block":return this.getBlocklist(this.blocklistConfig.blocklist,t.p,t.t)().then(s=>{if(t.t.debug(this.name,"using blocklist",s),this.isBlocklisted(s,t.e.location.href,t.t))return Promise.reject("blocklisted url found. Abort ad pipeline run")});default:return Promise.resolve()}})]:[]}getBlocklist(e,t,r){switch(e.provider){case"static":return()=>Promise.resolve(e.blocklist);case"dynamic":let n;return()=>(n||(n=this.loadConfigWithRetry(t,e.endpoint,3).catch(o=>(r.error(this.name,"Fetching blocklisted urls failed",o),{urls:[]}))),n)}}loadConfigWithRetry(e,t,r,n=null){return r<=0?Promise.reject(n):(this.blocklistCache||(this.blocklistCache=e.loadJson("blocklist-urls.json",t).catch(o=>new Promise(a=>setTimeout(a,100/r)).then(()=>this.loadConfigWithRetry(e,t,r-1,o)))),this.blocklistCache)}a(){return[]}d(){return[]}};window.moli.registerModule(new tt);var it=class{constructor(){this.name="cleanup";this.description="cleanup out-of-page formats on navigation or ad-reload";this.moduleType="creatives";this.cleanupConfig=null;this.cleanUp=(e,t)=>{t.forEach(r=>{"cssSelectors"in r.deleteMethod?r.deleteMethod.cssSelectors.forEach(n=>{let o=e.e.document.querySelectorAll(n);e.t.debug("Cleanup Module",`Remove elements with selector ${n} from dom`,o),o.forEach(s=>{try{s.remove()}catch(a){e.t.error("Cleanup Module",`Error removing element with selector ${n}`,a)}})}):r.deleteMethod.jsAsString.forEach(n=>{try{e.t.debug("Cleanup Module",`Try to execute string as JS: '${n}'`),new Function(n)()}catch(o){e.t.error("Cleanup Module",`Error executing JS string: '${n}'`,o)}})})};this.hasBidderWonLastAuction=(e,t)=>{var o;return((o=e.e.pbjs.getAllWinningBids().filter(s=>s.adUnitCode===t.domId).at(-1))==null?void 0:o.bidder)===t.bidder}}n(e){e!=null&&e.cleanup&&e.cleanup.enabled&&(this.cleanupConfig=e.cleanup)}i(){return this.cleanupConfig}s(){return[]}a(){let e=this.cleanupConfig;return e?[re("destroy-out-of-page-ad-format",t=>(t.l.environment==="test"||t.e.pbjs.que.push(()=>{let r=e.configs.filter(n=>this.hasBidderWonLastAuction(t,n));this.cleanUp(t,r)}),Promise.resolve()))]:[]}d(){let e=this.cleanupConfig;return e?[G("cleanup-before-ad-reload",$e,(t,r)=>(t.l.environment==="test"||t.e.pbjs.que.push(()=>{let n=e.configs.filter(o=>r.map(s=>s.moliSlot.domId).includes(o.domId)).filter(o=>this.hasBidderWonLastAuction(t,o));this.cleanUp(t,n)}),Promise.resolve()))]:[]}};window.moli.registerModule(new it);var rt=class{constructor(){this.name="confiant";this.description="ad fraud detection and protection module";this.moduleType="ad-fraud";this.gvlid="56";this.confiantConfig=null}i(){return this.confiantConfig}n(e){e!=null&&e.confiant&&e.confiant.enabled&&(this.confiantConfig=e.confiant)}s(){let e=this.confiantConfig;return e?[_("confiant-init",t=>this.loadConfiant(t,e))]:[]}loadConfiant(e,t){var r;return e.r==="test"||e.o.gdprApplies&&(!e.o.purpose.consents[1]||!(!((r=this.confiantConfig)!=null&&r.checkGVLID)||e.o.vendor.consents[this.gvlid]))||e.p.loadScript({name:this.name,loadMethod:1,assetUrl:t.assetUrl}).catch(n=>e.t.error("failed to load confiant",n)),Promise.resolve()}a(){return[]}d(){return[]}};window.moli.registerModule(new rt);var uo=(i,e)=>{var r;let t=(r=i.i.targeting)==null?void 0:r.keyValues[e];return t?`&device_id=${typeof t=="string"?t:t[0]}`:""},_i=(i,e,t,r,n)=>{let o=uo(i,e.advertiserIdKey),s=i.o.gdprApplies?`gdpr=1&gdpr_consent=${i.o.tcString}`:"gdpr=0",a=e.linkOrKeyword.link?`&link=${encodeURIComponent(e.linkOrKeyword.link)}`:"",l=e.linkOrKeyword.keywords?`&keywords=${encodeURIComponent(e.linkOrKeyword.keywords)}`:"",p="",d=h(h({},e.additionalIdentifier),t);Object.entries(d).forEach(([f,b])=>{p+=`&${f}=${encodeURIComponent(b)}`});let u="",c=h(h({},e.customKeywords),r);Object.entries(c).forEach(([f,b])=>{u+=`&${f}=${encodeURIComponent(b)}`});let g=n.createElement("img");g.src=`https://aps.xplosion.de/data?sid=${e.sid}${o}&os=${e.os}&app_id=${e.appId}${l}${a}${p}${u}&${s}`,g.width=1,g.height=1,n.body.append(g)};var po=(i,e)=>{var r;if(e.os==="web")return;let t=(r=i.i.targeting)==null?void 0:r.keyValues[e.advertiserIdKey];if(t)return typeof t=="string"?t:t[0]},Vi=(i,e,t)=>{try{let n="moli_emetriq",o=i.getItem(n),s=o?Number.parseInt(o,10):0,a=e-864e5>s;return a&&(i.setItem(n,e.toString()),t.debug("emetriq",`eligible for login event tracking. Last tracked at ${new Date(s)}`)),a}catch(r){return t.error("emetriq","could not access session storage",r),!1}},Ni=(i,e,t,r)=>{if(!e.login){r.warn("emetriq","login configuration missing!");return}let n=new URL(`https://xdn-ttp.de/lns/import-event-${e.login.partner}`);n.searchParams.append("guid",e.login.guid),i.o.gdprApplies?(n.searchParams.append("gdpr","1"),n.searchParams.append("gdpr_consent",i.o.tcString)):n.searchParams.append("gdpr","0");let o=po(i,e);if(o)switch(e.os){case"android":n.searchParams.append("adid",o);break;case"ios":n.searchParams.append("idfa",o);break}let s=t.createElement("img");s.src=n.href,s.width=1,s.height=1,t.body.append(s)};var ot=class i{constructor(){this.name="emetriq";this.description="Provides Emetriq data collection functionality to Moli.";this.moduleType="dmp";this.gvlid="213";this.emetriqConfig=null}i(){return this.emetriqConfig}n(e){e!=null&&e.emetriq&&e.emetriq.enabled&&(this.emetriqConfig=e.emetriq)}s(){let e=this.emetriqConfig;return e?[_("load-emetriq",t=>{var n;let r=i.staticCustomParams(h(h({},(n=t.i.targeting)==null?void 0:n.keyValues),t.l.keyValues),e.customMappingDefinition);return t.r==="test"||this.checkIfConsentIsMissing(t)||i.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"web":this.loadEmetriqScript(t,e,o,r);break}}),Promise.resolve()})]:[]}a(){let e=this.emetriqConfig;return e?[re("track-emetriq",t=>{var n;let r=i.staticCustomParams(h(h({},(n=t.i.targeting)==null?void 0:n.keyValues),t.l.keyValues),e.customMappingDefinition);return t.r==="test"||this.checkIfConsentIsMissing(t)||(e.login&&Vi(t.e.sessionStorage,Date.now(),t.t)&&Ni(t,e,t.e.document,t.t),i.syncDelay(t,e.syncDelay).then(o=>{switch(e.os){case"android":case"ios":_i(t,e,o,r,t.e.document);break}})),Promise.resolve()})]:[]}d(){return[]}checkIfConsentIsMissing(e){return e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid]?(e.t.warn(this.name,"missing consent"),!0):!1}loadEmetriqScript(e,t,r,n){let o=e.e;return o._enqAdpParam=h(h(h({},t._enqAdpParam),r),n),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://ups.xplosion.de/loader/${t._enqAdpParam.sid}/default.js`}).catch(s=>e.t.error("failed to load emetriq",s))}static syncDelay(e,t){return t?typeof t=="number"?new Promise(r=>e.e.setTimeout(()=>r({}),t)):e.e.pbjs?new Promise(r=>{e.e.pbjs.que.push(()=>{let n=()=>{r(i.prebidIdentifiers(e)),e.e.pbjs.offEvent("auctionEnd",n)};e.e.pbjs.onEvent("auctionEnd",n)})}):(e.t.error("emetriq","No sync delay, because window.pbjs is not defined!"),Promise.resolve({})):Promise.resolve({})}static staticCustomParams(e,t){let r={};return(t!=null?t:[]).forEach(({param:n,key:o})=>{let s=e[o];s&&(r[n]=typeof s=="string"?s:s.join(","))}),r}static prebidIdentifiers(e){let t={},r=e.e.pbjs.getUserIds();return r.amxId&&(t.id_amxid=r.amxId),r.idl_env&&(t.id_liveramp=r.idl_env),r.IDP&&(t.id_zeotap=r.IDP),r.pubcid&&(t.id_sharedid=r.pubcid),r.id5id&&(t.id_id5=r.id5id.uid),t}};window.moli.registerModule(new ot);var nt=class{constructor(){this.name="identitylink";this.description="Provides LiveRamp's ATS (authenticated traffic solution) functionality to Moli.";this.moduleType="identity";this.gvlid="97";this.identityLinkConfig=null}i(){return this.identityLinkConfig}n(e){e!=null&&e.identitylink&&e.identitylink.enabled&&(this.identityLinkConfig=e.identitylink)}s(){let e=this.identityLinkConfig;return e?[_(this.name,t=>(this.loadAts(t,e),Promise.resolve()))]:[]}a(){return[]}d(){return[]}loadAts(e,t){if(e.r==="test"||e.o.gdprApplies&&!e.o.vendor.consents[this.gvlid])return Promise.resolve();let r=e.e;return r.addEventListener("envelopeModuleReady",()=>{r.atsenvelopemodule.setAdditionalData({type:"emailHashes",id:t.hashedEmailAddresses})}),e.p.loadScript({name:this.name,loadMethod:1,assetUrl:`https://launchpad-wrapper.privacymanager.io/${t.launchPadId}/launchpad-liveramp.js`}).catch(n=>e.t.error("failed to load emetriq",n))}};window.moli.registerModule(new nt);var Fi=i=>{let e=i.filter(r=>r.behaviour.loaded==="infinite");return{configuredInfiniteSlots:e,findSlot:r=>{let n=r.getAttribute("data-h5-slot-dom-id");return{configuredInfiniteSlot:n?e.find(s=>s.domId===n):e[0],configSlotDomId:n}}}};var st=class{constructor(){this.name="moli-lazy-load";this.description="Moli implementation of an ad lazy load module.";this.moduleType="lazy-load";this.initialized=!1;this.observers=[];this.lazyloadConfig=null;this.registerIntersectionObservers=(e,t)=>{var p;if(this.initialized)return;this.initialized=!0,(p=e.t)==null||p.debug(this.name,"initialize moli lazy load module");let r=t.slots,n=t.buckets,o=t.infiniteSlots,s=e.e;r.forEach(d=>{let u=new s.IntersectionObserver(c=>{var g;(g=e.t)==null||g.debug(this.name,"lazy-load slots called with",c),c.forEach(f=>{var b;f.isIntersecting&&((b=e.t)==null||b.debug(this.name,`Trigger ad slot with DOM ID ${f.target.id}`),s.moli.refreshAdSlot(f.target.id),u.unobserve(f.target))})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});this.observers.push(u),d.domIds.forEach(c=>{var f,b;let g=e.i.slots.find(m=>m.domId===c);if(!g)(f=e.t)==null||f.warn(this.name,`Lazy-load non-existing slot with domID ${c}`);else if(g.behaviour.loaded!=="manual")(b=e.t)==null||b.warn(this.name,`Lazy-load configured for slot without manual loading behaviour. ${c}`);else if(g.behaviour.loaded==="manual"){let m=s.document.getElementById(c);m&&u.observe(m)}})}),n.forEach(d=>{var c,g,f,b;let u=new s.IntersectionObserver(m=>{m.forEach(A=>{var S,P,v;if(A.isIntersecting&&A.target.id===d.observedDomId)if(((S=e.i.slots.find(C=>C.domId===d.observedDomId))==null?void 0:S.behaviour.bucket)!==d.bucket)(P=e.t)==null||P.warn(this.name,`${d.observedDomId} doesn't belong to ${d.bucket}`);else{let C=e.i.slots.filter(T=>T.behaviour.bucket===d.bucket).map(T=>T.domId);(v=e.t)==null||v.debug(`Refresh ${d.bucket}`,`Trigger ad slots with DOM IDs [${C.join(", ")}]`),s.moli.refreshBucket(d.bucket),u.unobserve(A.target)}})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});if(this.observers.push(u),(c=e.i.buckets)!=null&&c.enabled||(g=e.t)==null||g.warn(this.name,"GlobalBucket config isn't enabled"),!((f=e.i.buckets)!=null&&f.bucket&&e.i.buckets.bucket[d.bucket]))(b=e.t)==null||b.error(this.name,`Lazy-load non-existing bucket with name ${d.bucket}`);else{let m=s.document.getElementById(d.observedDomId);m&&u.observe(m)}});let{configuredInfiniteSlots:a,findSlot:l}=Fi(e.i.slots);(o||[]).forEach(d=>{var c;let u="data-h5-serial-number";if(a.length>0){let g=new s.IntersectionObserver(b=>{b.forEach(m=>{var A,S,P,v;if(m.isIntersecting){let{configuredInfiniteSlot:y,configSlotDomId:C}=l(m.target);if(y){let T=(S=(A=m.target.attributes)==null?void 0:A.getNamedItem(u))==null?void 0:S.value,D=`${y.domId}-${T}`;m.target.setAttribute("id",D),(P=e.t)==null||P.debug(this.name,`Trigger ad slot with newly created DOM ID ${D}`),s.moli.refreshInfiniteAdSlot(D,y.domId),g.unobserve(m.target)}else(v=e.t)==null||v.error(this.name,`No infinite-scrolling slot configured for ${C}`),g.unobserve(m.target)}})},{root:d.options.rootId?s.document.getElementById(d.options.rootId):null,threshold:d.options.threshold,rootMargin:d.options.rootMargin});this.observers.push(g),s.document.querySelectorAll(d.selector).forEach((b,m)=>{b.setAttribute(u,`${m+1}`),b&&g.observe(b)})}else(c=e.t)==null||c.warn(this.name,"No infinite-scrolling slots configured!")})}}i(){return this.lazyloadConfig}n(e){e!=null&&e.lazyload&&e.lazyload.enabled&&(this.lazyloadConfig=e.lazyload)}s(){return[]}a(){let e=this.lazyloadConfig;return e?[re("lazy-module-configuration",t=>(this.initialized=!1,this.observers.forEach(r=>r.disconnect()),this.observers.length=0,this.registerIntersectionObservers(t,e),Promise.resolve()))]:[]}d(){return[G("lazy-module-delay",Q,(e,t)=>new Promise((r,n)=>{var s,a,l;let o=(a=(s=e.S)==null?void 0:s.options)==null?void 0:a.delay;if(o){(l=e.t)==null||l.debug(this.name,"delaying slots",t);let p=new Promise(u=>{e.e.addEventListener("h5v.trigger-delay",()=>u(!0),{once:!0})}),d=new Promise(u=>{var c;e.e.setTimeout(()=>u(!1),(c=o.timeoutMs)!=null?c:3e4)});return Promise.race([p,d]).then(u=>u?r():n(new Error("Delay timeout exceeded")))}else r()}))]}};window.moli.registerModule(new st);var at=class i{constructor(){this.description="Module for passing first party data to prebid auctions";this.moduleType="prebid";this.name="prebid-first-party-data";this.moduleConfig=null;this._configureSteps=[]}i(){return this.moduleConfig}n(e){var t;if((t=e==null?void 0:e.prebidFirstPartyData)!=null&&t.enabled){let r=e.prebidFirstPartyData;this._configureSteps=[j("prebid-fpd-module-configure",n=>i.setPrebidFpdConfig(n,r,n.t))]}}s(){return[]}a(){return this._configureSteps}d(){return[]}static setPrebidFpdConfig(e,t,r){var n;if(e.i.prebid){let o=((n=e.i.targeting)==null?void 0:n.keyValues)||{},s=t.gptTargetingMappings;e.e.pbjs.que.push(()=>{var p,d,u,c,g,f,b,m,A;let a=e.e.pbjs.readConfig().ortb2||{},l=Ye({},t.staticPrebidFirstPartyData,a);if(s){let S=h({cat:[],sectioncat:[],pagecat:[]},l.site);if(s.cat){let v=i.extractKeyValueArray(s.cat,o);(p=S.cat)==null||p.push(...v),(d=S.pagecat)==null||d.push(...v),(u=S.sectioncat)==null||u.push(...v)}s.sectionCat&&(S.sectioncat=i.extractKeyValueArray(s.sectionCat,o)),s.pageCat&&(S.pagecat=i.extractKeyValueArray(s.pageCat,o)),S.cat&&(S.cat=S.cat.filter(Y)),S.sectioncat&&(S.sectioncat=S.sectioncat.filter(Y)),S.pagecat&&(S.pagecat=S.pagecat.filter(Y));let P=(c=t.iabDataProviderName)!=null?c:fe(e.e.location.hostname);if(!t.iabDataProviderName&&(s.iabV2||s.iabV3)&&r.debug("PrebidFirstPartyDataModule","Targeting for iabV2 or iabV3 was defined, but iabDataProviderName was not configured. Use tld as fallback",P),S.content=x(h({},S.content),{data:(b=(f=(g=S.content)==null?void 0:g.data)==null?void 0:f.filter(v=>v.name!==P))!=null?b:[]}),s.iabV2&&P){let v=i.extractKeyValueArray(s.iabV2,o),y={name:P,ext:{segtax:6},segment:v.map(C=>({id:C})).filter(Y)};(m=S.content.data)==null||m.push(y)}if(s.iabV3&&P){let v=i.extractKeyValueArray(s.iabV3,o),y={name:P,ext:{segtax:7},segment:v.map(C=>({id:C})).filter(Y)};(A=S.content.data)==null||A.push(y)}l.site=S}e.e.pbjs.setConfig({ortb2:l})})}return Promise.resolve()}static extractKeyValueArray(e,t){let r=t[e];return r?typeof r=="string"?[r]:r:[]}};window.moli.registerModule(new at);var dt=class{constructor(){this.name="pubstack";this.description="prebid analytics integration";this.moduleType="reporting";this.pubstackConfig=null}i(){return this.pubstackConfig}n(e){e!=null&&e.pubstack&&e.pubstack.enabled&&(this.pubstackConfig=e.pubstack)}s(){let e=this.pubstackConfig;return e?[_("pubstack-init",t=>(t.r==="test"||t.p.loadScript({name:"pubstack",loadMethod:1,assetUrl:`https://boot.pbstck.com/v1/tag/${e.tagId}`}).catch(r=>t.t.error("failed to load pubstack",r)),Promise.resolve()))]:[]}a(){return this.pubstackConfig?[j("pubstack-configure",t=>{if(t.r==="test")return Promise.resolve();let r=["0","1","2","3"],n=t.e.document.head.querySelector('meta[name="pbstck_context:pbstck_ab_test"]');return n&&n.content&&r.includes(n.content)&&t.e.googletag.pubads().setTargeting("pbstck_ab_test",n.content),Promise.resolve()})]:[]}d(){return[]}};window.moli.registerModule(new dt);var ji="footer-ad-close-button",co="[data-ref=h5-footer-ad-container]",mo=`[data-ref=${ji}]`,lt={adSlot:"h5-footer-ad",container:"h5-footer-ad-container",footerAdClose:"h5-footer-ad-close",isShiftedBottom:"is-shifted-bottom"},zi=(i,e,t,r)=>n=>{let o=n.slot,s=i.document.body.querySelector(co),a=i.document.getElementById(e),l=()=>{var d;o.getSlotElementId()===e&&s&&((d=i.googletag)==null||d.destroySlots([o]),s.remove())};if(!s||!a||o.getSlotElementId()!==e||n.isEmpty||n.advertiserId&&t.includes(n.advertiserId)||i.matchMedia("(max-width: 767px)").matches){r.debug("[footer-ad]","remove footer ad container");return}if(i.document.body.querySelector(mo))return;let p=document.createElement("button");p.classList.add(lt.footerAdClose),p.setAttribute("aria-label","Anzeige entfernen"),p.setAttribute("data-ref",ji),a.classList.add(lt.adSlot),Array.isArray(n.size)&&n.size[1]>200&&i.matchMedia("(max-height: 800px)").matches&&a.classList.add(lt.isShiftedBottom),s.classList.add(lt.container),s.style.setProperty("display","block"),s.appendChild(p),p.addEventListener("click",()=>l())},$i=(i,e,t,r,n)=>{e==="production"?i.googletag.pubads().addEventListener("slotRenderEnded",zi(i,r,n,t)):zi(i,r,n,t)({advertiserId:1,size:[728,90],isEmpty:!1,slot:{getSlotElementId:()=>r}})};var Gi="[data-ref=sticky-ad]",Wi="[data-ref=sticky-ad-close]",Ji="h5-sticky-ad--visible",It=i=>{i.style.setProperty("display","none"),i.classList.remove(Ji)},Hi=i=>{i.style.setProperty("display","block"),i.classList.add(Ji)},Ki=(i,e,t,r)=>new Promise(n=>{let o=s=>{s.slot.getSlotElementId()===e&&(s.isEmpty?(i&&It(i),n("empty")):s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):n("standard"),r.googletag.pubads().removeEventListener("slotRenderEnded",o))};r.googletag.cmd.push(()=>{r.googletag.pubads().addEventListener("slotRenderEnded",o)})}),Yi=(i,e)=>new Promise(t=>{let r=n=>{n.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",r))};e.googletag.pubads().addEventListener("slotOnload",r)}),Xi=(i,e,t,r,n,o)=>{let s=i.document.querySelector(Gi),a=i.document.querySelector(Wi);if(s&&a){if(t.debug("mobile-sticky-ad","Running initAdSticky with defined sticky container and close button"),o||Hi(s),a.addEventListener("click",()=>{It(s);let l=i.googletag.pubads().getSlots().find(p=>p.getSlotElementId()===r);l&&i.googletag.destroySlots([l])},{once:!0,passive:!0}),e==="production"){let l=([p])=>(t.debug("mobile-sticky-ad",`result ${p}`),p==="disallowed"?(t.debug("mobile-sticky-ad","hide mobile sticky container"),s&&It(s),Promise.resolve()):p==="standard"?(o&&Hi(s),Promise.all([Ki(s,r,n,i),Yi(r,i)]).then(l)):Promise.resolve());Promise.all([Ki(s,r,n,i),Yi(r,i)]).then(l)}}else t.warn("[mobile-sticky]",`Could not find adSticky container ${Gi} or closeButton ${Wi}`,s,a)};var ut=class{constructor(){this.name="sticky-footer-ads";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}i(){return this.stickyFooterAdConfig}n(e){var t;(t=e==null?void 0:e.stickyFooterAd)!=null&&t.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAd)}d(){let e=this.stickyFooterAdConfig;return e?[G(this.name,Q,(t,r)=>{var n;return e.mobileStickyDomId&&r.some(o=>{var s;return o.moliSlot.domId===((s=this.stickyFooterAdConfig)==null?void 0:s.mobileStickyDomId)})&&Xi(t.e,t.r,t.t,e.mobileStickyDomId,e.disallowedAdvertiserIds,(n=e.initiallyHidden)!=null?n:!1),e.desktopFloorAdDomId&&r.some(o=>o.moliSlot.domId===e.desktopFloorAdDomId)&&$i(t.e,t.r,t.t,e.desktopFloorAdDomId,e.disallowedAdvertiserIds),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new ut);var St="[data-ref=h5v-sticky-ad]",At="[data-ref=h5v-sticky-ad-close]",Qi=".h5v-closeButtonContent",ir="h5v-footerAd--hidden",go="h5v-footerAd--hidden-d",fo="h5v-footerAd--hidden-m",Zi=(i,e,t)=>new Promise(r=>{let n=o=>{o.slot.getSlotElementId()===i&&(o.isEmpty?r("empty"):o.advertiserId&&e.includes(o.advertiserId)?r("disallowed"):r("standard"),t.googletag.pubads().removeEventListener("slotRenderEnded",n))};t.googletag.cmd.push(()=>{t.googletag.pubads().addEventListener("slotRenderEnded",n)})}),er=(i,e)=>new Promise(t=>{let r=n=>{n.slot.getSlotElementId()===i&&(t(),e.googletag.pubads().removeEventListener("slotOnload",r))};e.googletag.pubads().addEventListener("slotOnload",r)}),tr=i=>{i.classList.add(ir)},yo=i=>{i.classList.remove(ir,go,fo)},rr=(i,e,t,r,n,o)=>{let s="sticky-ad",a=i.document.querySelector(St),l=i.document.querySelector(At),p=i.document.querySelector(Qi);if(a&&l){if(t.debug(s,"Running initAdSticky with defined sticky container and close button"),!p){if(o)l.textContent=o;else if(!l.querySelector("svg")){let u=i.document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width","24"),u.setAttribute("height","24");let c=i.document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add(Qi),c.setAttribute("d","M7 10l5 5 5-5z"),u.appendChild(c),l.appendChild(u)}}l.addEventListener("click",()=>{a.addEventListener("transitionend",function(){var c;a.remove();let u=(c=i.googletag)==null?void 0:c.pubads().getSlots().find(g=>g.getSlotElementId()===r);u&&i.googletag.destroySlots([u])},{once:!0}),tr(a)});let d=u=>{if(t.debug(s,`result ${u}`),u==="disallowed"||u==="empty")return t.debug(s,"stickyFooter container"),tr(a),Promise.resolve();if(u==="standard"){yo(a);let c=er(r,i);return Zi(r,n,i).then(g=>g==="empty"||g==="disallowed"?Promise.resolve(g):c.then(()=>g)).then(d)}return Promise.resolve()};if(e==="production")if(r){let u=er(r,i);Zi(r,n,i).then(c=>c==="empty"||c==="disallowed"?Promise.resolve(c):u.then(()=>c)).then(d)}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${St} or closeButton ${At}`,a,l);else d("standard")}else t.warn("[sticky-footer-ad]",`Could not find adSticky container ${St} or closeButton ${At}`,a,l)};var pt=class{constructor(){this.name="sticky-footer-ads-v2";this.description="sticky footer ad creatives";this.moduleType="creatives";this.stickyFooterAdConfig=null}i(){return this.stickyFooterAdConfig}n(e){e!=null&&e.stickyFooterAdV2&&e.stickyFooterAdV2.enabled&&(this.stickyFooterAdConfig=e.stickyFooterAdV2)}d(){let e=this.stickyFooterAdConfig;return e?[G(this.name,Q,(t,r)=>{let n=r.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.desktop),o=r.find(a=>a.moliSlot.domId===e.stickyFooterDomIds.mobile),s=o||n;return o&&n&&t.t.warn(this.name,"mobile and desktop sticky footer are called!"),s&&rr(t.e,t.r,t.t,s.moliSlot.domId,e.disallowedAdvertiserIds,e.closingButtonText),Promise.resolve()})]:[]}a(){return[]}s(){return[]}};window.moli.registerModule(new pt);var or=(i,e,t,r,n,o)=>s=>{s.forEach(a=>{e&&a.target===e?t.then(l=>{a.isIntersecting||!a.isIntersecting&&a.boundingClientRect.y<0||l==="empty"||l==="disallowed"?i.classList.add(o):a.boundingClientRect.y>=0&&l==="standard"&&i.classList.remove(o)}):a.target===r&&n&&(a.isIntersecting?i.classList.remove(n):i.classList.add(n))})};var nr=(i,e,t,r)=>new Promise(n=>{if(i.r==="test"){n("standard");return}let o=s=>{s.slot.getSlotElementId()===e.domId&&(s.advertiserId&&t.includes(s.advertiserId)?n("disallowed"):s.isEmpty?n("empty"):r>0?i.e.setTimeout(()=>n("standard"),r):n("standard"),i.e.googletag.pubads().removeEventListener("slotRenderEnded",o))};i.e.googletag.pubads().addEventListener("slotRenderEnded",o)});var ct=class{constructor(){this.name="sticky-header-ads";this.description="sticky header ad creatives";this.moduleType="creatives";this.containerSelector='[data-ref="header-ad"]';this.buttonSelector='[data-ref="header-ad-close-button"]';this.navbarHiddenClassName="h5v-header-ad--navbarHidden";this.observer=null;this.stickyHeaderAdConfig=null}n(e){var t;(t=e==null?void 0:e.stickyHeaderAd)!=null&&t.enabled&&(this.stickyHeaderAdConfig=e.stickyHeaderAd)}i(){return this.stickyHeaderAdConfig}s(){return[]}a(){return this.stickyHeaderAdConfig?[re("sticky-header-ads:cleanup",()=>(this.observer&&(this.observer.disconnect(),this.observer=null),Promise.resolve()))]:[]}d(){let e=this.stickyHeaderAdConfig;return e?[G(this.name,Q,(t,r)=>{var l,p,d;if(this.observer)return Promise.resolve();let n=r.find(u=>u.moliSlot.domId===e.headerAdDomId);if(!n)return Promise.resolve();let o=t.e.document.querySelector(this.containerSelector);if(!o)return t.t.warn(this.name,`Could not find sticky header container with selector '${this.containerSelector}'`),Promise.resolve();let s=(l=e.minVisibleDurationMs)!=null?l:0;if(e.fadeOutTrigger!==!1){let u=(p=e.fadeOutTrigger.options)!=null?p:{rootMargin:"0px"},c=t.e.document.querySelectorAll(e.fadeOutTrigger.selector),g=c.length>0?c.item(0):null,f=e.navbarConfig,b=(d=f==null?void 0:f.navbarHiddenClassName)!=null?d:this.navbarHiddenClassName,m=f?t.e.document.querySelector(f.selector):null;if(g){let A=nr(t,n.moliSlot,e.disallowedAdvertiserIds,s);this.observer=new IntersectionObserver(or(o,g,A,m,b,e.fadeOutClassName),u),this.observer.observe(g),m&&this.observer.observe(m)}else t.t.error(this.name,`No DOM element found for selector ${e.fadeOutTrigger.selector}. Sticky header may never fade out`)}let a=t.e.document.querySelector(this.buttonSelector);return a&&a.addEventListener("click",()=>{o.classList.add(e.fadeOutClassName),this.observer&&this.observer.disconnect(),t.r==="production"&&t.e.googletag.destroySlots([n.adSlot]),e.destroySlot&&o&&o.remove()}),Promise.resolve()})]:[]}};window.moli.registerModule(new ct);var bo=(i,e)=>{let t=Object.keys(i);return ge(t.map(r=>h({adSlotId:r},i[r])).filter(r=>e.indexOf(r.adSlotId)>-1).filter(r=>z(r.bids)).map(r=>r.bids.sort((n,o)=>o.cpm-n.cpm).slice(0,1)))},mt=class{constructor(){this.name="skin";this.description="Block other ad slots if a wallpaper has won the auction";this.moduleType="prebid";this.skinModuleConfig=null;this.bidsBackHandler=[];this.getConfigEffect=(e,t,r,n)=>{let o=t[e.skinAdSlotDomId],s=u=>{let c=e.formatFilter.some(g=>{switch(g.bidder){case"*":return!0;case"appnexus":case"appnexusAst":return u.bidder===ce.AppNexusAst||u.bidder===ce.AppNexus;case"improvedigital":return u.bidder===ce.ImproveDigital;case"gumgum":return u.bidder===ce.GumGum&&(g.auid===void 0||typeof u.ad!="string"&&u.ad.auid===g.auid);case"dspx":return u.bidder===ce.DSPX;case"visx":return u.bidder===ce.Visx;case"yieldlab":return u.bidder===ce.Yieldlab;default:return!1}});return u.cpm>0&&c},a=bo(t,e.blockedAdSlotDomIds),l=a.reduce((u,c)=>u+c.cpm,0),p=o?o.bids.filter(s).sort((u,c)=>c.cpm-u.cpm):[],d=p.length>0?p[0].cpm>l?"BlockOtherSlots":"BlockSkinSlot":"NoBlocking";return n.debug(this.name,"nonSkinBids",a),n.debug(this.name,"skinBids",p),r&&d==="BlockSkinSlot"&&(r({skin:p[0].cpm,combinedNonSkinSlots:l},e,p[0]),n.debug(this.name,"trackSkinCpmLow",a)),e.enableCpmComparison?d:p.length>0?"BlockOtherSlots":"NoBlocking"};this.selectConfig=(e,t,r)=>e.configs.map(n=>({skinConfig:n,configEffect:this.getConfigEffect(n,t,e.trackSkinCpmLow,r)})).find(({configEffect:n})=>n!=="NoBlocking");this.destroyAdSlot=(e,t)=>r=>{let n=e.map(o=>o.adSlot).filter(o=>o.getSlotElementId()===r);t.googletag.destroySlots(n)};this.runSkinConfigs=e=>(t,r,n)=>{var a,l,p;let o=null,s=this.selectConfig(e,r,t.t);if(s){let{skinConfig:d,configEffect:u}=s;if(u==="BlockOtherSlots"){t.t.debug("SkinModule","Skin configuration applied",d),d.blockedAdSlotDomIds.forEach(this.destroyAdSlot(n,t.e)),d.hideBlockedSlots&&d.blockedAdSlotDomIds.forEach(this.hideAdSlot(t.e,t.t)),d.hideSkinAdSlot&&this.hideAdSlot(t.e,t.t)(d.skinAdSlotDomId),d.hideBlockedSlotsSelector&&t.e.document.querySelectorAll(d.hideBlockedSlotsSelector).forEach(f=>{t.t.debug("SkinModule",`Set display:none for container with selector ${d.hideBlockedSlotsSelector}`),f.style.setProperty("display","none")});let c=(a=r[d.skinAdSlotDomId])==null?void 0:a.bids.sort((f,b)=>b.cpm-f.cpm)[0],g=f=>t.e.googletag.pubads().getSlots().find(m=>m.getSlotElementId()===f);if((l=d.adReload)!=null&&l.intervalMs&&(c!=null&&c.bidder)&&d.adReload.allowed.includes(c.bidder)){let f=n.filter(m=>m.moliSlot.domId===d.skinAdSlotDomId||d.blockedAdSlotDomIds.includes(m.moliSlot.domId)).map(m=>m.moliSlot.behaviour.loaded);f.every(m=>m===f[0])&&f[0]!=="infinite"?(o&&clearTimeout(o),o=t.e.setTimeout(()=>{var m;t.e.moli.refreshAdSlot([...d.blockedAdSlotDomIds,d.skinAdSlotDomId],{loaded:f[0]}),(m=g(d.skinAdSlotDomId))==null||m.setTargeting("native-ad-reload","true"),t.t.info("SkinModule","Ad reload for skin and blocked slots triggered",d.skinAdSlotDomId,d.blockedAdSlotDomIds)},(p=d.adReload)==null?void 0:p.intervalMs)):t.t.error("SkinModule","Ad reload not possible because of different loading behaviors of the slots that should be refreshed:",f)}}else d.enableCpmComparison&&(t.t.debug("SkinModule","Skin configuration ignored because cpm was low",d),this.destroyAdSlot(n,t.e)(d.skinAdSlotDomId))}else e.configs.filter(d=>d.destroySkinSlot).map(d=>d.skinAdSlotDomId).filter(Y).forEach(this.destroyAdSlot(n,t.e))};this.hideAdSlot=(e,t)=>r=>{let n=e.document.getElementById(r);try{n&&(t.debug("SkinModule",`Set display:none for ${r}`),n.style.setProperty("display","none"))}catch(o){t.error("SkinModule",`Couldn't set the the wallpaper div ${r} to display:none;`,o)}}}i(){return this.skinModuleConfig}n(e){e!=null&&e.skin&&e.skin.enabled&&(this.skinModuleConfig=e.skin,this.bidsBackHandler.push(this.runSkinConfigs(e.skin)))}s(){return[]}a(){return[]}d(){return[]}v(){return this.bidsBackHandler}};window.moli.registerModule(new mt);var vo=[M.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,M.responses.TCPurpose.SELECT_BASIC_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_ADS,M.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,M.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,M.responses.TCPurpose.MEASURE_AD_PERFORMANCE,M.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,M.responses.TCPurpose.APPLY_MARKET_RESEARCH,M.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS,M.responses.TCPurpose.USE_LIMITED_DATA_TO_SElECT_CONTENT],sr=()=>{let i=null,e=(t,r)=>{if(r.r==="test")return Promise.resolve();let n=r.e;return n.Utiq=n.Utiq?x(h({},n.Utiq),{config:h(h({},n.Utiq.config),t.options)}):{queue:[],config:t.options},n.Utiq.queue=n.Utiq.queue||[],r.o.gdprApplies&&vo.some(o=>r.o.gdprApplies&&!r.o.purpose.consents[o])?Promise.resolve():r.p.loadScript({name:"utiq",loadMethod:1,assetUrl:t.assetUrl}).catch(o=>r.t.error("failed to load utiq",o))};return{name:"utiq",description:"user module",moduleType:"identity",i(){return i},n(t){t!=null&&t.utiq&&t.utiq.enabled&&(i=t.utiq)},s(){return i!=null&&i.enabled?[_("utiq",t=>e(i,t))]:[]},a(){return[]},d(){return[]}}};window.moli.registerModule(sr());var ar=i=>{var e;return i?((e=i.dynamicFloorPrices)==null?void 0:e.strategy)!==void 0:!1};var ho=i=>{if(i.length===0)return null;{let e=Math.max(...i);return Math.round(e*100)}},Io=i=>{if(i.length===0)return null;{let e=Math.min(...i);return Math.round(e*100)}},So=i=>{if(!i||i.length===0)return null;if(i.length===1)return Math.round(i[0]*100);{let e=i.sort()[i.length-2];return Math.round(e*100)}},Ao=(i,e)=>{switch(i){case"max":return ho(e);case"min":return Io(e);case"second-highest":return So(e);default:return null}},gt=i=>Math.floor(i),Po=i=>{let e=gt(i.priceInCents),t=gt(i.roundingStepsInCents),r=i.maxPriceRuleInCents!==void 0?gt(i.maxPriceRuleInCents):void 0,n=i.minPriceRuleInCents!==void 0?gt(i.minPriceRuleInCents):void 0,o=Math.floor(e/t)*t;return r!==void 0&&o>r?r:n!==void 0&&o<n?n:o},dr=({strategy:i,previousCpms:e,standardRule:t,roundingStepsInCents:r=5,maxPriceRuleInCents:n=500,minPriceRuleInCents:o=5})=>{let s=Array.isArray(e)?e==null?void 0:e.filter(p=>p>0&&!isNaN(p)):[];if(!s||s.length===0||!i)return t;let a=Ao(i,s);if(a===null)return t;let l=Po({priceInCents:a,roundingStepsInCents:r,maxPriceRuleInCents:n,minPriceRuleInCents:o});return x(h({},t),{floorprice:l/100,priceRuleId:l})};var lr=i=>{let e={rules:{},browser:"None"},t=Promise.resolve(e),r=!1,n="mobile",o={},s=(f,b,m,A,S)=>{switch(n=f,o=b,i.provider){case"none":S.warn("YieldOptimizationService","Yield optimization is disabled!"),r=!1,t=Promise.resolve(e);break;case"static":S.warn("YieldOptimizationService","Yield optimization is static!"),r=!0,t=Promise.resolve({rules:i.config.rules,browser:"None"});break;case"dynamic":r=!0;let P=i.excludedAdUnitPaths,y=m.filter(C=>P.indexOf(C)<0).map(C=>J(C,o));t=d(i.configEndpoint,3,y,A).then(C=>(S.info("YieldOptimizationService",`loaded pricing rules for device ${n}`,C),C)).catch(C=>(S.error("YieldOptimizationService","failed to initialize service",C),e));break;default:r=!1,t=Promise.reject("Unknown config provider")}return Promise.resolve()},a=f=>t.then(b=>b.rules[J(f,o)]),l=()=>t.then(f=>f.browser||"None"),p=(f,b,m,A,S)=>{let P=J(f.getAdUnitPath(),o);return t.then(v=>{let y=v.rules[P];if(b==="gam")if(y)if(f.setTargeting("upr_model",y.model||"static"),y.main){f.setTargeting("upr_main","true");let C=S==null?void 0:S.getLastBidCpmsOfAdUnit(f.getSlotElementId());if(C&&(C==null?void 0:C.length)>0&&ar(A)&&A.dynamicFloorPrices){let{strategy:T,roundingStepsInCents:D,maxPriceRuleInCents:N,minPriceRuleInCents:$}=A.dynamicFloorPrices,V=dr({strategy:T,previousCpms:C,standardRule:y,roundingStepsInCents:D,maxPriceRuleInCents:N,minPriceRuleInCents:$});return m.debug("YieldOptimizationService",`set dynamic price rule id ${V.priceRuleId} for ${P} based on previous bid cpms on same position. Stategy is '${T}'. Main traffic share ${y.main}. Cpm is ${V.floorprice}.`),f.setTargeting("upr_id",V.priceRuleId.toFixed(0)),V}else f.setTargeting("upr_id",y.priceRuleId.toFixed(0))}else m.debug("YieldOptimizationService",`set price rule id ${y.priceRuleId} for ${P}. Main traffic share ${y.main}. cpm is ${y.floorprice}`),f.setTargeting("upr_id",y.priceRuleId.toFixed(0));else r&&m.warn("YieldOptimizationService",`No price rule found for ${P}`);return y})},d=(f,b,m,A,S=null)=>b<=0?Promise.reject(S):A(f,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device:n,key:"adUnitPath",adUnitPaths:m})}).then(P=>P.ok?P.json():P.text().then(v=>Promise.reject(`${P.statusText}: ${v}`))).then(P=>typeof P!="object"||P===null?Promise.reject("Invalid response"):u(P)?g(P.rules)?P:Promise.reject("At least one rule object was not valid"):Promise.reject("response is missing rules property")).catch(P=>new Promise(y=>setTimeout(y,100/b)).then(()=>d(f,b-1,m,A,P))),u=f=>f.hasOwnProperty("rules"),c=f=>typeof f=="object"&&f!==null,g=f=>c(f)?Object.keys(f).every(b=>{let m=f[b];return typeof m=="object"&&m!==null&&typeof m.main=="boolean"&&typeof m.floorprice=="number"&&typeof m.priceRuleId=="number"}):!1;return{init:s,getPriceRule:a,getBrowser:l,setTargeting:p}};var ur=i=>{let e="YieldOptimization",t="Provides floors and UPR ids",r="yield",n=null,o=[],s=[],a=()=>n,l=f=>{var b;if((b=f==null?void 0:f.yieldOptimization)!=null&&b.enabled){n=f.yieldOptimization;let m=i!=null?i:lr(f.yieldOptimization);o.push(c(m)),s.push(g(m))}},p=()=>o,d=()=>[],u=()=>s,c=f=>_("yield-optimization-init",b=>{let m=b.i.slots.filter(A=>b.u.filterSlot(A)).map(A=>A.adUnitPath).filter(Y);return f.init(b.u.getDeviceLabel(),b.m,m,b.e.fetch,b.t)}),g=f=>G("yield-optimization",$e,(b,m)=>{b.t.debug("YieldOptimizationService",b.c,"applying price rules");let A=b.i.adServer||"gam",S=m.map(P=>f.setTargeting(P.adSlot,A,b.t,n,b.g).then(v=>P.priceRule=v));return Promise.all(S).then(()=>f.getBrowser()).then(P=>{b.r==="production"&&A==="gam"&&b.e.googletag.pubads().setTargeting("upr_browser",P)})});return{name:e,description:t,moduleType:r,i:a,n:l,s:p,a:d,d:u}};window.moli.registerModule(ur());var pr,Ce=(pr=window.document.currentScript)!=null?pr:document.getElementById("moli-ad-tag"),cr,Pt=(cr=we(window,Oe.moliPubCode,oe.moliPubCode)[0])==null?void 0:cr.value,mr,Ct=(mr=we(window,Oe.moliVersion,oe.moliVersion)[0])==null?void 0:mr.value,gr,fr,yr,br;if(Ce){let i=Pt!=null?Pt:Ce.getAttribute("data-publisher-code"),e=(gr=Ct!=null?Ct:Ce.getAttribute("data-version"))!=null?gr:"production",t=((fr=Ce.getAttribute("data-labels"))!=null?fr:"").split(",").map(o=>o.trim()).filter(o=>o.length>0);t.length>0&&window.moli.que.push(o=>{o.beforeRequestAds(()=>t.forEach(s=>o.addLabel(s)))}),window.moli.configLabel=e;let r=(yr=Ce.getAttribute("data-endpoint"))!=null?yr:"api.h5v.eu/publishers",n=(br=Ce.getAttribute("data-endpoint-fallback"))!=null?br:"cdn.h5v.eu/publishers";if(i){let o=`/${i}/configs/${e}/config.json`,s=`//${r}${o}`;fetch(s,{mode:"cors"}).then(a=>a.json()).catch(a=>(console.error(`Failed to load configuration from ${s}. Using fallback`,a),fetch(`//${n}${o}`,{mode:"cors"}))).then(a=>window.moli.configure(a)).catch(a=>console.error(`Failed to load configuration from ${s}:`,a))}else console.error('No publisher code provided for ad tag configuration! Add the `data-publisher-code="yourCode"` attribute to the script tag.')}else console.error("Failed to find the current script tag for the ad tag bundle!");})();
/*!
 * domready (c) Dustin Diaz 2014 - License MIT
 * @see {@link https://github.com/ded/domready}
 */
