"use strict";(self.webpackChunkthe_publisher_ad_tag=self.webpackChunkthe_publisher_ad_tag||[]).push([[3211],{8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(6540);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}},8834:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"features/consent","title":"Consent (TCF2)","description":"Moli integrates with the IAB Transparency and Consent Framework 2.0 (TCF2) to ensure compliance with privacy regulations like GDPR. The ad tag automatically handles consent state and only loads ads when appropriate consent is available.","source":"@site/docs/features/consent.md","sourceDirName":"features","slug":"/features/consent","permalink":"/moli-ad-tag/docs/features/consent","draft":false,"unlisted":false,"editUrl":"https://github.com/highfivve/moli-ad-tag/docs/features/consent.md","tags":[],"version":"current","frontMatter":{"title":"Consent (TCF2)"},"sidebar":"docs","previous":{"title":"Amazon TAM","permalink":"/moli-ad-tag/docs/features/tam"},"next":{"title":"Targeting","permalink":"/moli-ad-tag/docs/features/targeting"}}');var s=t(4848),o=t(8453);const a={title:"Consent (TCF2)"},r=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"1. Consent Collection",id:"1-consent-collection",level:3},{value:"2. Consent Detection",id:"2-consent-detection",level:3},{value:"3. Ad Loading",id:"3-ad-loading",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Consent States",id:"consent-states",level:2},{value:"Consent Ready",id:"consent-ready",level:3},{value:"Consent Pending",id:"consent-pending",level:3},{value:"Consent Denied",id:"consent-denied",level:3},{value:"Integration with CMPs",id:"integration-with-cmps",level:2},{value:"Popular CMPs",id:"popular-cmps",level:3},{value:"CMP Implementation Example",id:"cmp-implementation-example",level:3},{value:"Consent with Prebid",id:"consent-with-prebid",level:2},{value:"Testing Consent",id:"testing-consent",level:2},{value:"Test Mode",id:"test-mode",level:3},{value:"Debugging Consent",id:"debugging-consent",level:3},{value:"Privacy Compliance",id:"privacy-compliance",level:2},{value:"GDPR Compliance",id:"gdpr-compliance",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"Consent Configuration",id:"consent-configuration",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Moli integrates with the ",(0,s.jsx)(n.a,{href:"https://github.com/InteractiveAdvertisingBureau/GDPR-Transparency-and-Consent-Framework/blob/master/TCFv2/IAB%20Tech%20Lab%20-%20CMP%20API%20v2.md",children:"IAB Transparency and Consent Framework 2.0 (TCF2)"})," to ensure compliance with privacy regulations like GDPR. The ad tag automatically handles consent state and only loads ads when appropriate consent is available."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"TCF2 is a standardized framework that allows publishers to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Collect user consent for data processing"}),"\n",(0,s.jsx)(n.li,{children:"Communicate consent choices to advertising partners"}),"\n",(0,s.jsx)(n.li,{children:"Ensure compliance with privacy regulations"}),"\n",(0,s.jsx)(n.li,{children:"Provide transparency about data usage"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.h3,{id:"1-consent-collection",children:"1. Consent Collection"}),"\n",(0,s.jsxs)(n.p,{children:["Your Consent Management Platform (CMP) collects user consent and provides it in the ",(0,s.jsx)(n.code,{children:"__tcfapi"})," global API."]}),"\n",(0,s.jsx)(n.h3,{id:"2-consent-detection",children:"2. Consent Detection"}),"\n",(0,s.jsx)(n.p,{children:"Moli automatically detects the TCF2 consent state and waits for consent to be ready before loading ads."}),"\n",(0,s.jsx)(n.h3,{id:"3-ad-loading",children:"3. Ad Loading"}),"\n",(0,s.jsx)(n.p,{children:"Ads are only loaded when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Consent is available and valid"}),"\n",(0,s.jsx)(n.li,{children:"The user has given appropriate permissions"}),"\n",(0,s.jsx)(n.li,{children:"The CMP has signaled that consent is ready"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,s.jsx)(n.p,{children:"Moli automatically integrates with TCF2 without additional configuration."}),"\n",(0,s.jsx)(n.h2,{id:"consent-states",children:"Consent States"}),"\n",(0,s.jsx)(n.h3,{id:"consent-ready",children:"Consent Ready"}),"\n",(0,s.jsx)(n.p,{children:"The user has made consent choices and ads can be loaded:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Consent is available\nwindow.moli.requestAds(); // \u2705 Ads will load\n"})}),"\n",(0,s.jsx)(n.h3,{id:"consent-pending",children:"Consent Pending"}),"\n",(0,s.jsx)(n.p,{children:"The user hasn't made consent choices yet:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Consent not yet available\nwindow.moli.requestAds(); // \u23f3 Will wait for consent\n"})}),"\n",(0,s.jsx)(n.h3,{id:"consent-denied",children:"Consent Denied"}),"\n",(0,s.jsx)(n.p,{children:"The user has denied consent for advertising:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// User denied consent\nwindow.moli.requestAds(); // \u274c Ads won't load\n"})}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-cmps",children:"Integration with CMPs"}),"\n",(0,s.jsx)(n.h3,{id:"popular-cmps",children:"Popular CMPs"}),"\n",(0,s.jsx)(n.p,{children:"Moli works with any TCF2-compliant CMP, including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://consentmanager.net",children:"Consentmanager"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.onetrust.com/",children:"OneTrust"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.quantcast.com/choice/",children:"Quantcast Choice"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.sourcepoint.com/",children:"Sourcepoint"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.cookiebot.com/",children:"Cookiebot"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.trustarc.com/",children:"TrustArc"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cmp-implementation-example",children:"CMP Implementation Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html>\n<head>\n  \x3c!-- CMP Script --\x3e\n  <script src="https://cdn.cookielaw.org/consent/your-cmp-id/otSDKStub.js"><\/script>\n  \n  \x3c!-- Moli Ad Tag --\x3e\n  <script type="module" async src="https://cdn.h5v.eu/adtag/v5.0.3/all.mjs"><\/script>\n</head>\n<body>\n  \x3c!-- Your content --\x3e\n  \n  <script>\n    window.moli = window.moli || { que: [] };\n    window.moli.que.push(function(adTag) {\n      adTag.configure({\n        slots: [ /* ... */ ],\n        consent: {\n          waitForConsent: true\n        }\n      });\n    });\n  <\/script>\n</body>\n</html>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"consent-with-prebid",children:"Consent with Prebid"}),"\n",(0,s.jsx)(n.p,{children:"When using Prebid.js, consent is automatically passed to bidders:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const moliConfig: Moli.MoliConfig = {\n  slots: [ /* ... */ ],\n  prebid: {\n    config: {\n      // highlight-start\n      consentManagement: {\n        // TCF2 is automatically configured\n        timeout: 500,\n      }\n      // highlight-end\n    }\n  }\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-consent",children:"Testing Consent"}),"\n",(0,s.jsx)(n.h3,{id:"test-mode",children:"Test Mode"}),"\n",(0,s.jsx)(n.p,{children:"For development and testing, you can bypass consent requirements:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const moliConfig: Moli.MoliConfig = {\n  environment: 'test', // Enables test mode\n  slots: [ /* ... */ ],\n  consent: {\n    waitForConsent: false // Disable consent for testing\n  }\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"debugging-consent",children:"Debugging Consent"}),"\n",(0,s.jsxs)(n.p,{children:["You can always call the ",(0,s.jsx)(n.code,{children:"__tcfapi"})," directly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'window.__tcfapi("addEventListener", 2, console.log);\n'})}),"\n",(0,s.jsx)(n.p,{children:"Here's a small script to check if consent is given for a single vendor and purposes."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'/**\n *\n * @param vendorId the IAB assigned vendor id\n * @param requiredPurposes the IAB purpose IDs 1 to 10\n * @param onConsentCallback invoked when consent is available and granted\n *\n * @see https://github.com/InteractiveAdvertisingBureau/GDPR-Transparency-and-Consent-Framework/blob/master/TCFv2/IAB%20Tech%20Lab%20-%20CMP%20API%20v2.md#gettcdata\n */\nfunction loadWithConsent(vendorId, requiredPurposes, onConsentCallback) {\n  if (window.__tcfapi) {\n    var listener = (tcData) => {\n      if (\n        tcData.cmpStatus !== "error" && (\n          tcData.eventStatus === "useractioncomplete" ||\n          tcData.eventStatus === "tcloaded"\n        )\n      ) {\n        // check if consent is required and if the user has given it\n        if (\n          // gdpr does not apply, so we can always invoke 3rd party code\n          !tcData.gdprApplies ||\n          // check the specific vendor for consent\n          (!!tcData.vendor.consents[vendorId] &&\n            // check all required purposes for the vendor\n            requiredPurposes.every(function(purposeId) {\n              return !!tcData.purpose.consents[purposeId];\n            })\n          )\n        ) {\n          onConsentCallback();\n        }\n\n        // remove listener if consent is available\n        if (tcData.listenerId) {\n          window.__tcfapi("removeEventListener", 2, function() {\n          }, tcData.listenerId);\n        }\n      }\n    };\n    window.__tcfapi("addEventListener", 2, listener);\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"privacy-compliance",children:"Privacy Compliance"}),"\n",(0,s.jsx)(n.h3,{id:"gdpr-compliance",children:"GDPR Compliance"}),"\n",(0,s.jsx)(n.p,{children:"Moli's TCF2 integration helps ensure GDPR compliance by:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only loading ads with proper consent"}),"\n",(0,s.jsx)(n.li,{children:"Respecting user privacy choices"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,s.jsx)(n.p,{children:"Consent management in Moli is handled through TCF2 integration and Prebid.js configuration. There are no direct consent methods in the MoliTag interface."}),"\n",(0,s.jsxs)(n.p,{children:["For detailed API documentation, see the ",(0,s.jsx)(n.a,{href:"/api/types/moliRuntime/namespaces/MoliRuntime/interfaces/MoliTag",children:"MoliTag API reference"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"consent-configuration",children:"Consent Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Consent is configured through the ",(0,s.jsx)(n.code,{children:"consent"})," property in ",(0,s.jsx)(n.code,{children:"MoliConfig"})," and ",(0,s.jsx)(n.code,{children:"consentManagement"})," in Prebid configuration."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);