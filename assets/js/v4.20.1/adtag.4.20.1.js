(()=>{"use strict";var e={2:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.a9RequestBids=t.a9ClearTargetingStep=t.a9PublisherAudiences=t.a9Configure=t.a9Init=void 0;const n=r(157),a=r(569),d=r(255),l=r(793),c=r(879);var g=c.tcfapi.responses.TCPurpose;const u=s(r(643)),p=e=>!!e.moliSlot.a9,f=e=>!e.gdprApplies||e.vendor.consents[793]&&[g.STORE_INFORMATION_ON_DEVICE,g.SELECT_BASIC_ADS,g.CREATE_PERSONALISED_ADS_PROFILE,g.SELECT_PERSONALISED_ADS,g.MEASURE_AD_PERFORMANCE,g.APPLY_MARKET_RESEARCH,g.DEVELOP_IMPROVE_PRODUCTS].every((t=>e.purpose.consents[t]));t.a9Init=(e,t)=>(0,n.mkInitStep)("a9-init",(r=>new Promise((i=>{r.window.apstag=r.window.apstag||{_Q:[],init:function(){r.window.apstag._Q.push(["i",arguments])},fetchBids:function(){r.window.apstag._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){},dpa:function(){r.window.apstag._Q.push(["di",arguments])},rpa:function(){r.window.apstag._Q.push(["ri",arguments])},upa:function(){r.window.apstag._Q.push(["ui",arguments])}},"test"!==r.env&&f(r.tcData)&&t.loadScript({name:"A9",loadMethod:a.AssetLoadMethod.TAG,assetUrl:e.scriptUrl?e.scriptUrl:"//c.amazon-adsystem.com/aax2/apstag.js"}).catch((e=>r.logger.error("failed to load apstag.js",e))),i()})))),t.a9Configure=(e,t)=>(0,n.mkConfigureStep)("a9-configure",((r,i)=>new Promise((i=>{r.window.apstag.init({pubID:e.pubID,adServer:"googletag",bidTimeout:e.timeout,gdpr:{cmpTimeout:e.cmpTimeout},schain:{complete:1,ver:"1.0",nodes:[t.supplyChainStartNode,e.schainNode]}}),i()})))),t.a9PublisherAudiences=e=>(0,n.mkConfigureStepOnce)("a9-publisher-audiences",((t,r)=>new Promise((r=>{const i=e.publisherAudience;if(i&&i.enabled){const e={hashedRecords:[{type:"email",record:i.sha256Email}]};if(t.logger.debug("A9","Enable publisher audiences"),t.window.apstag.rpa(e),t.window.__tcfapi){let r=!0;t.window.__tcfapi("addEventListener",2,(i=>{r?r=!1:i.eventStatus===c.tcfapi.status.EventStatus.USER_ACTION_COMPLETE&&(t.logger.debug("A9","Update publisher audience token"),t.window.apstag.upa(e))}))}}r()})))),t.a9ClearTargetingStep=()=>(0,n.mkPrepareRequestAdsStep)("a9-clear-targeting",n.LOW_PRIORITY,((e,t)=>0===e.requestId?(e.logger.debug("A9","skip ad slot clearing for first pipeline run"),Promise.resolve()):new Promise((r=>{e.logger.debug("A9","clear a9 targetings"),t.forEach((({adSlot:e})=>{e.getTargetingKeys().filter((e=>"amznp"===e||"amznsz"===e||"amznbid"===e)).forEach((t=>e.clearTargeting(t)))})),r()}))));const h=(e,t,r)=>{const i=u.removeChildId(e),o=t?u.withDepth(i,t):i;return u.resolveAdUnitPath(o,r)};t.a9RequestBids=e=>(0,n.mkRequestBidsStep)("a9-fetch-bids",((t,r)=>new Promise((i=>{if(!f(t.tcData))return t.logger.debug("A9","Skip any due to missing consent"),void i();const o=r.filter(p).filter((e=>{const r="video"===e.moliSlot.a9.mediaType,i=t.labelConfigService.filterSlot(e.moliSlot.a9),o=e.filterSupportedSizes(e.moliSlot.sizes).filter(l.SizeConfigService.isFixedSize).length>0;return i&&(r||o)})).map((({moliSlot:r,priceRule:i,filterSupportedSizes:o})=>{if("video"===r.a9.mediaType)return{slotID:r.domId,mediaType:"video"};{const s=e.supportedSizes?r.sizes.filter((t=>e.supportedSizes?.some((e=>(0,d.isSizeEqual)(e,t))))):r.sizes,n=h(r.adUnitPath,r.a9.slotNamePathDepth??e.slotNamePathDepth,t.adUnitPathVariables);return{slotID:r.domId,slotName:n,sizes:o(s).filter(l.SizeConfigService.isFixedSize),...e.enableFloorPrices&&i?{floor:{value:Math.ceil(t.window.pbjs?.convertCurrency?100*t.window.pbjs.convertCurrency(i.floorprice,"EUR",e.floorPriceCurrency||"USD"):100*i.floorprice*1.19),currency:e.floorPriceCurrency||"USD"}}:{}}}}));t.logger.debug("A9",`Fetch '${o.length}' A9 slots: ${o.map((e=>`[slotID] ${e.slotID}`))}`),0===o.length?i():(t.reportingService.markA9fetchBids(t.requestId),t.window.apstag.fetchBids({slots:o,...t.bucket?.timeout&&{bidTimeout:t.bucket.timeout}},(e=>{t.reportingService.measureAndReportA9BidsBack(t.requestId),t.window.apstag.setDisplayBids(),i()})))}))))},157:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdPipeline=t.mkRequestBidsStep=t.mkPrepareRequestAdsStep=t.mkConfigureStepOnce=t.mkConfigureStepOncePerRequestAdsCycle=t.mkConfigureStep=t.mkInitStep=t.LOW_PRIORITY=t.HIGH_PRIORITY=void 0;const i=r(495),o=r(879),s=r(380);var n=o.tcfapi.responses.TCPurpose;const a=r(643);t.HIGH_PRIORITY=100,t.LOW_PRIORITY=10,t.mkInitStep=(e,t)=>(Object.defineProperty(t,"name",{value:e}),t),t.mkConfigureStep=(e,t)=>(Object.defineProperty(t,"name",{value:e}),t),t.mkConfigureStepOncePerRequestAdsCycle=(e,r)=>{Object.defineProperty(r,"name",{value:e});let i=0;return(0,t.mkConfigureStep)(e,((e,t)=>i!==e.requestAdsCalls?(i=e.requestAdsCalls,r(e,t)):Promise.resolve()))},t.mkConfigureStepOnce=(e,r)=>(Object.defineProperty(r,"name",{value:e}),(0,t.mkConfigureStep)(e,((e,t)=>1===e.requestAdsCalls&&1===e.requestId?r(e,t):Promise.resolve()))),t.mkPrepareRequestAdsStep=(e,t,r)=>{const i=Object.assign(r,{priority:t});return Object.defineProperty(r,"name",{value:e}),i},t.mkRequestBidsStep=(e,t)=>(Object.defineProperty(t,"name",{value:e}),t),t.AdPipeline=class{constructor(e,t,r,i,o){this.config=e,this.logger=t,this.window=r,this.reportingService=i,this.auction=o,this.init=null,this.tcData=null,this.requestId=0,this.runPrepareRequestAds=(e,t)=>{const r=new Map;return this.config.prepareRequestAds.forEach((e=>{const t=r.get(e.priority);t?t.push(e):r.set(e.priority,[e])})),Array.from(r.entries()).sort((([e],[t])=>e>t?-1:1)).reduce(((r,[i,o])=>r.then((()=>(e.logger.debug("AdPipeline",e.requestId,`run prepareRequestAds with priority ${i}`),Promise.all(o.map((r=>r(e,t)))))))),Promise.resolve(void 0))}}run(e,t,r,o){if(0===e.length)return Promise.resolve();this.requestId=this.requestId+1;const d=this.requestId;this.logger.debug("AdPipeline",`starting run with requestId ${d} on ${r}. call`,e);const l=t.consent||{};return this.tcData=this.tcData?this.tcData:(0,s.consentReady)(l,this.window,this.logger,t.environment),this.tcData.then((s=>{const l=[...t.targeting?.labels||[]];s.gdprApplies&&s.purpose.consents[n.STORE_INFORMATION_ON_DEVICE]?l.push("purpose-1"):s.gdprApplies||l.push("purpose-1");const c=new i.LabelConfigService(t.labelSizeConfig||[],l,this.window),g=o&&t.buckets?.bucket&&t.buckets.bucket[o]?t.buckets.bucket[o]:null,u=(0,a.generateAdUnitPathVariables)(this.window.location.hostname,c.getDeviceLabel(),t.targeting?.adUnitPathVariables,t.domain),p={requestId:d,requestAdsCalls:r,logger:this.logger,env:t.environment||"production",config:t,labelConfigService:c,reportingService:this.reportingService,window:this.window,tcData:s,bucket:g,adUnitPathVariables:u,auction:this.auction};this.init=this.init?this.init:this.logStage("init",d).then((()=>Promise.all(this.config.init.map((e=>e(p))))));const f="rejected-no-slots-after-filtering";return this.init.then((()=>this.logStage("configure",d).then((()=>Promise.all(this.config.configure.map((t=>t(p,e)))))))).then((()=>this.logStage("defineSlots",d).then((()=>this.config.defineSlots(p,e))))).then((e=>e.length?this.logStage("prepareRequestAds",d).then((()=>this.runPrepareRequestAds(p,e))).then((()=>this.logStage("requestBids",d))).then((()=>Promise.all(this.config.requestBids.map((t=>t(p,e)))))).then((()=>this.logStage("requestAds",d))).then((()=>this.config.requestAds(p,e))):Promise.reject(f))).catch((e=>e===f?Promise.resolve():(this.logger.error("AdPipeline","running ad pipeline failed with error",e),Promise.reject(e))))}))}getAuction(){return this.auction}logStage(e,t){return new Promise((r=>{this.logger.debug("AdPipeline",t,`stage: ${e}`),r()}))}}},917:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AdService=void 0;const o=r(611),s=r(157),n=r(192),a=r(465),d=r(777),l=i(r(297)),c=r(372),g=r(2),u=r(257),p=r(514),f=r(974),h=r(389),m=r(328);class b{static getEnvironment(e){return e.environment||"production"}constructor(e,t,r){this.assetService=e,this.window=t,this.adPipelineConfig=r,this.requestAdsCalls=0,this.adPipeline=new s.AdPipeline({init:[()=>Promise.reject("AdPipeline not initialized yet")],configure:[],defineSlots:()=>Promise.resolve([]),prepareRequestAds:[],requestBids:[],requestAds:()=>Promise.resolve()},(0,o.getDefaultLogger)(),this.window,n.noopReportingService,void 0),this.initialize=(e,t)=>{const r=b.getEnvironment(e),i=e.adServer||"gam",u="gam"===i;this.logger.setLogger((0,o.getLogger)(e,this.window)),this.logger.debug("AdService",`Initializing with environment ${r} and ad server ${i}`);const S=u&&e.reporting&&e.reporting.sampleRate>0?new n.ReportingService((0,a.createPerformanceService)(this.window),e.reporting,this.logger,r,this.window):n.noopReportingService,v=u?[(0,d.gptInit)(this.assetService)]:[],A=u?[(0,d.gptConfigure)(e)]:[];u&&t&&A.push((0,d.gptDestroyAdSlots)(),(0,d.gptResetTargeting)());const w=[];u&&w.push((0,d.gptLDeviceLabelKeyValue)(),(0,d.gptConsentKeyValue)(),(0,p.passbackPrepareRequestAds)(new f.PassbackService(this.logger,this.window))),e.reporting&&w.push((0,n.reportingPrepareRequestAds)(S));const P=[];if(e.prebid&&"production"===r&&(v.push((0,c.prebidInit)()),A.push((0,c.prebidConfigure)(e.prebid,e.schain)),t&&A.push((0,c.prebidRemoveAdUnits)(e.prebid)),w.push((0,c.prebidPrepareRequestAds)(e.prebid)),P.push((0,c.prebidRequestBids)(e.prebid,i,e.targeting))),e.a9&&"production"===r&&u&&(v.push((0,g.a9Init)(e.a9,this.assetService)),A.push((0,g.a9Configure)(e.a9,e.schain)),A.push((0,g.a9PublisherAudiences)(e.a9)),w.push((0,g.a9ClearTargetingStep)()),P.push((0,g.a9RequestBids)(e.a9))),e.pipeline&&(v.push(...e.pipeline.initSteps),A.push(...e.pipeline.configureSteps),w.push(...e.pipeline.prepareRequestAdsSteps)),"test"===r){const e=(0,h.getDebugDelayFromLocalStorage)(this.window);e&&A.push((()=>(0,h.executeDebugDelay)(this.window,e)))}return this.adPipeline=new s.AdPipeline({init:v,configure:A,defineSlots:u?(0,d.gptDefineSlots)():(0,c.prebidDefineSlots)(),prepareRequestAds:w,requestBids:P,requestAds:u?(0,d.gptRequestAds)():(0,c.prebidRenderAds)()},this.logger,this.window,S,new m.GlobalAuctionContext(this.window,e.globalAuctionContext)),new Promise((t=>{(0,l.default)(this.window,(()=>{this.logger.debug("DOM","dom ready"),t(e)}))}))},this.requestAds=async(e,t,r)=>{this.requestAdsCalls=this.requestAdsCalls+1,this.logger.info("AdService",`RequestAds[${this.requestAdsCalls}]`,t);try{const i=e.slots.map((e=>this.isManualSlot(e)?t.some((t=>t===e.domId))?e:null:this.isInfiniteSlot(e)?r.some((t=>t.artificialDomId===e.domId))?e:null:e)).filter(u.isNotNull).filter(this.isSlotAvailable);if(e.buckets?.enabled){const t=new Map;i.forEach((e=>{const r=e.behaviour.bucket||"default",i=t.get(r);i?i.push(e):t.set(r,[e])}));const r=await Promise.all(Array.from(t.entries()).map((([t,r])=>(this.logger.debug("AdPipeline",`running bucket ${t}, slots:`,r),this.adPipeline.run(r,e,this.requestAdsCalls).then((()=>r))))));return(0,u.flatten)(r)}return await this.adPipeline.run(i,e,this.requestAdsCalls),i}catch(e){return this.logger.error("AdPipeline","slot filtering failed",e),Promise.reject(e)}},this.getAdPipeline=()=>this.adPipeline,this.setLogger=e=>{this.logger.setLogger(e)},this.isManualSlot=e=>"manual"===e.behaviour.loaded,this.isInfiniteSlot=e=>"infinite"===e.behaviour.loaded,this.isSlotAvailable=e=>!!this.window.document.getElementById(e.domId)||"out-of-page-interstitial"===e.position||"out-of-page-top-anchor"===e.position||"out-of-page-bottom-anchor"===e.position,this.logger=new o.ProxyLogger((0,o.getDefaultLogger)()),r&&(this.adPipeline=new s.AdPipeline(r,this.logger,t,n.noopReportingService))}refreshAdSlots(e,t){if(0===e.length)return Promise.resolve();const r=[...t.slots.filter(this.isManualSlot).filter((t=>e.some((e=>e===t.domId)))),...t.slots.filter(this.isInfiniteSlot).filter((t=>e.some((e=>e===t.domId))))];if(e.length!==r.length){const t=r.filter((t=>e.every((e=>e!==t.domId)))),i=e.filter((e=>r.every((t=>t.domId!==e))));t.length&&this.logger.warn("AdService","The following slots does not exist on the page DOM.",t),i.length&&this.logger.warn("AdService","The following slots are not configured in the ad-tag config.",t)}return this.logger.debug("AdService","refresh ad slots",r,t.targeting),this.adPipeline.run(r,t,this.requestAdsCalls)}refreshBucket(e,t){if(!t.buckets?.enabled)return Promise.resolve();const r=t.slots.filter(this.isManualSlot).filter((t=>t.behaviour.bucket===e));return this.logger.debug("AdService","refresh ad buckets",r,t.targeting),this.adPipeline.run(r,t,this.requestAdsCalls,e)}}t.AdService=b},643:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateAdUnitPathVariables=t.withDepth=t.resolveAdUnitPath=t.removeChildId=void 0;const i=r(676);t.removeChildId=e=>{const[t,r,...i]=e.split("/"),[o,...s]=r.split(",");return 0===s.length?e:["",o,...i].join("/")},t.resolveAdUnitPath=(e,t)=>{const r=/([A-Za-z0-9\_]+)/g,i=e.match(/[^{]+(?=})/g);return t&&i?(i.forEach((e=>{if(!e.match(r))throw new SyntaxError(`invalid variable "${e}" in path`);if(!t[e])throw new ReferenceError(`path variable "${e}" is not defined`)})),e.replace(new RegExp(Object.keys(t).map((e=>`{${e}}`)).join("|"),"g"),(e=>t[e.substr(1,e.length-2)]))):e},t.withDepth=(e,t)=>e.split("/").slice(0,t+1).join("/"),t.generateAdUnitPathVariables=(e,t,r,o)=>({device:t,domain:o||(0,i.extractTopPrivateDomainFromHostname)(e)||"unknown",...r})},59:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdRequestThrottling=void 0,t.AdRequestThrottling=class{constructor(e,t){this.config=e,this._window=t,this.slotsRequested=new Set}onSlotRequested(e){this.slotsRequested.add(e.slot.getSlotElementId()),this._window.setTimeout((()=>{this.slotsRequested.delete(e.slot.getSlotElementId())}),1e3*this.config.throttle)}isThrottled(e){return this.slotsRequested.has(e)}}},815:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BiddersDisabling=void 0,t.BiddersDisabling=class{constructor(e,t){this.config=e,this.window=t,this.participationInfo=new Map}isBidderDisabled(e,t){return this.participationInfo.get(e)?.get(t)?.disabled??!1}onAuctionEnd(e){e.args.bidderRequests.forEach((e=>{e.bids.forEach((e=>{const t=e.bidderCode;e.bids.map((e=>e.adUnitCode)).forEach((e=>{this.participationInfo.get(e)||this.participationInfo.set(e,new Map);const r=this.participationInfo.get(e)?.get(t);if(r){const i=r.bidRequestCount+1;this.participationInfo.get(e)?.set(t,{...r,bidRequestCount:i})}else this.participationInfo.get(e)?.set(t,{disabled:!1,bidRequestCount:1,bidReceivedCount:0})}))}))})),e.args.bidsReceived.forEach((e=>{const t=e.bidderCode,r=e.adUnitCode,i=this.participationInfo.get(r)?.get(t);i?this.participationInfo.get(r)?.set(t,{...i,bidReceivedCount:i.bidReceivedCount+1}):this.participationInfo.get(r)?.set(t,{disabled:!1,bidRequestCount:1,bidReceivedCount:1})})),this.deactivateBidderForTTL()}deactivateBidderForTTL(){this.participationInfo.forEach(((e,t)=>{e.forEach(((e,r)=>{this.shouldDisableBidder(e)&&(this.disableBidder(t,r),this.window.setTimeout((()=>{this.enableBidder(t,r)}),this.config.reactivationPeriod))}))}))}shouldDisableBidder(e){return e.bidRequestCount>this.config.minBidRequests&&e.bidReceivedCount/e.bidRequestCount<this.config.minRate&&!e.disabled}disableBidder(e,t){const r=this.participationInfo.get(e)?.get(t);r&&(r.disabled=!0,this.logger?.info(`Bidder ${t} for position ${e} is now disabled.`))}enableBidder(e,t){const r=this.participationInfo.get(e)?.get(t);r&&(r.disabled=!1,this.logger?.info(`Bidder ${t} for position ${e} is now enabled.`))}}},380:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.consentReady=t.missingPurposeConsent=void 0;const i=r(879);var o=i.tcfapi.status.EventStatus,s=i.tcfapi.status.CmpStatus;const n=[i.tcfapi.responses.TCPurpose.STORE_INFORMATION_ON_DEVICE,i.tcfapi.responses.TCPurpose.SELECT_BASIC_ADS,i.tcfapi.responses.TCPurpose.CREATE_PERSONALISED_ADS_PROFILE,i.tcfapi.responses.TCPurpose.SELECT_PERSONALISED_ADS,i.tcfapi.responses.TCPurpose.CREATE_PERSONALISED_CONTENT_PROFILE,i.tcfapi.responses.TCPurpose.SELECT_PERSONALISED_CONTENT,i.tcfapi.responses.TCPurpose.MEASURE_AD_PERFORMANCE,i.tcfapi.responses.TCPurpose.MEASURE_CONTENT_PERFORMANCE,i.tcfapi.responses.TCPurpose.APPLY_MARKET_RESEARCH,i.tcfapi.responses.TCPurpose.DEVELOP_IMPROVE_PRODUCTS];t.missingPurposeConsent=e=>!!e.gdprApplies&&n.some((t=>!e.purpose.consents[t]&&e.purpose.legitimateInterests[t])),t.consentReady=(e,r,i,n)=>("test"===n&&i.info("gdprApplies is set to false in test mode!"),"test"===n||!1===e.enabled?Promise.resolve({gdprApplies:!1,eventStatus:o.TC_LOADED,cmpStatus:s.LOADED,cmpId:0,cmpVersion:0,tcfPolicyVersion:void 0,listenerId:null}):new Promise(((o,s)=>{if(r.__tcfapi){const n=n=>{"error"===n.cmpStatus?s(n):"useractioncomplete"!==n.eventStatus&&"tcloaded"!==n.eventStatus||(i.debug("Consent","consent ready",n),e.disableLegitimateInterest&&(0,t.missingPurposeConsent)(n)?s("user consent is missing for some purposes"):o(n),n.listenerId&&r.__tcfapi("removeEventListener",2,(()=>{}),n.listenerId))};r.__tcfapi("addEventListener",2,n)}else s("window.__tcfapi is not defined. Make sure that the stub code is inlined in the head tag")})))},328:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalAuctionContext=void 0;const i=r(815),o=r(59);t.GlobalAuctionContext=class{constructor(e,t={}){this.window=e,this.config=t,t.biddersDisabling?.enabled&&(this.biddersDisabling=new i.BiddersDisabling(t.biddersDisabling,this.window)),t.adRequestThrottling?.enabled&&(this.adRequestThrottling=new o.AdRequestThrottling(t.adRequestThrottling,this.window)),this.window.pbjs=this.window.pbjs||{que:[]},this.window.googletag=this.window.googletag||{cmd:[]},this.config.biddersDisabling?.enabled&&this.window.pbjs.que.push((()=>{this.window.pbjs.onEvent("auctionEnd",(e=>{e.forEach((e=>this.handleAuctionEndEvent(e)))}))})),this.config.adRequestThrottling?.enabled&&this.window.googletag.cmd.push((()=>{this.window.googletag.pubads().addEventListener("slotRequested",(e=>{this.adRequestThrottling?.onSlotRequested(e)}))}))}isSlotThrottled(e){return this.adRequestThrottling?.isThrottled(e)??!1}handleAuctionEndEvent(e){this.biddersDisabling?.onAuctionEnd(e)}}},777:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gptRequestAds=t.gptDefineSlots=t.gptConsentKeyValue=t.gptLDeviceLabelKeyValue=t.gptConfigure=t.gptResetTargeting=t.gptDestroyAdSlots=t.gptInit=void 0;const i=r(157),o=r(793),s=r(257),n=r(569),a=r(879),d=r(249);var l=a.tcfapi.responses.TCPurpose;const c=r(643),g=(e,t)=>({setCollapseEmptyDiv(){},addService(e){},getSlotElementId:()=>e,getAdUnitPath:()=>t,setTargeting(e,t){return this},getTargeting:e=>[],getTargetingKeys:()=>[],clearTargeting(e){},getResponseInformation:()=>null}),u=(e,t)=>{const r=t?t.keyValues:{},i=t?.adManagerExcludes??[];Object.keys(r).filter((e=>!i.includes(e))).forEach((t=>{const i=r[t];i&&e.googletag.pubads().setTargeting(t,i)}))},p=(e,t)=>!1===t?.useLimitedAds||!e.gdprApplies||e.vendor.consents[755]&&e.purpose.consents[l.STORE_INFORMATION_ON_DEVICE]&&[l.SELECT_BASIC_ADS,l.MEASURE_AD_PERFORMANCE,l.APPLY_MARKET_RESEARCH,l.DEVELOP_IMPROVE_PRODUCTS].every((t=>e.purpose.consents[t]||e.purpose.legitimateInterests[t]));t.gptInit=e=>{let t;return(0,i.mkInitStep)("gpt-init",(r=>"test"===r.env?Promise.resolve():(t||(t=new Promise((t=>{r.logger.debug("GAM","init googletag stub"),r.window.googletag=r.window.googletag||{},r.window.googletag.cmd=r.window.googletag.cmd||[],r.window.googletag.cmd.push(t),e.loadScript({name:"gpt",loadMethod:n.AssetLoadMethod.TAG,assetUrl:p(r.tcData,r.config.consent)?"https://securepubads.g.doubleclick.net/tag/js/gpt.js":"https://pagead2.googlesyndication.com/tag/js/gpt.js"}).catch((e=>r.logger.error("failed to load gpt.js",e)))}))),t)))},t.gptDestroyAdSlots=()=>{let e=0;return(0,i.mkConfigureStep)("gpt-destroy-ad-slots",((t,r)=>{if("test"===t.env)return Promise.resolve();if(!1===t.config.spa?.destroyAllAdSlots){const e=t.window.googletag.pubads().getSlots(),i=r.map((t=>e.find((e=>e.getSlotElementId()===t.domId)))).filter(s.isNotNull);0===i.length?t.logger.debug("GAM","no ad slots to destroy"):(t.logger.debug("GAM",`destroy ${i.length} ad slots`,i),t.window.googletag.destroySlots(i))}else e!==t.requestAdsCalls&&(e=t.requestAdsCalls,t.logger.debug("GAM","destroy all ad slots"),t.window.googletag.destroySlots());return Promise.resolve()}))},t.gptResetTargeting=()=>(0,i.mkConfigureStepOncePerRequestAdsCycle)("gpt-reset-targeting",(e=>new Promise((t=>{"production"===e.env&&(e.logger.debug("GAM","reset top level targeting"),e.window.googletag.pubads().clearTargeting(),u(e.window,e.config.targeting)),t()})))),t.gptConfigure=e=>{let t;return(0,i.mkConfigureStep)("gpt-configure",((r,i)=>(t||(t=new Promise((t=>{const i=e.environment||"production";switch(r.logger.debug("GAM","configure googletag"),i){case"production":u(r.window,e.targeting),r.window.googletag.pubads().enableAsyncRendering(),r.window.googletag.pubads().disableInitialLoad(),r.window.googletag.pubads().enableSingleRequest();const i=!p(r.tcData,r.config.consent);return r.logger.debug("GAM","use limited ads",i),r.window.googletag.pubads().setPrivacySettings({limitedAds:i}),r.window.googletag.enableServices(),void t();case"test":return void t()}}))),t)))},t.gptLDeviceLabelKeyValue=()=>(0,i.mkPrepareRequestAdsStep)("gpt-device-label-keyValue",i.LOW_PRIORITY,(e=>"test"===e.env?Promise.resolve():new Promise((t=>{const r=e.labelConfigService.getDeviceLabel();e.logger.debug("GAM",'adding "device_label" key-value with values',r),e.window.googletag.pubads().setTargeting("device_label",r),t()})))),t.gptConsentKeyValue=()=>(0,i.mkPrepareRequestAdsStep)("gpt-consent-keyValue",i.LOW_PRIORITY,(e=>"test"===e.env?Promise.resolve():new Promise((t=>{const r=e.tcData,i=!r.gdprApplies||[l.STORE_INFORMATION_ON_DEVICE,l.SELECT_BASIC_ADS,l.CREATE_PERSONALISED_ADS_PROFILE,l.SELECT_PERSONALISED_ADS,l.CREATE_PERSONALISED_CONTENT_PROFILE,l.SELECT_PERSONALISED_CONTENT,l.MEASURE_AD_PERFORMANCE,l.MEASURE_CONTENT_PERFORMANCE,l.APPLY_MARKET_RESEARCH,l.DEVELOP_IMPROVE_PRODUCTS].every((e=>r.purpose.consents[e]));e.window.googletag.pubads().setTargeting("consent",i?"full":"none"),t()})))),t.gptDefineSlots=()=>(e,t)=>{const r=t.map((t=>{const r=new o.SizeConfigService(t.sizeConfig,e.labelConfigService.getSupportedLabels(),e.window),i=r.filterSupportedSizes;if(!r.filterSlot(t)||!e.labelConfigService.filterSlot(t))return Promise.resolve(null);const s=i(t.sizes),n=(0,c.resolveAdUnitPath)(t.adUnitPath,e.adUnitPathVariables),a=("test"===e.env?[]:e.window.googletag.pubads().getSlots()).find((e=>e.getSlotElementId()===t.domId))||(()=>{if("test"===e.env)return null;const r=(()=>{switch(t.position){case"in-page":return e.window.googletag.defineSlot(n,s,t.domId);case"out-of-page":return e.window.googletag.defineOutOfPageSlot(n,t.domId);case"out-of-page-interstitial":return e.logger.debug("GAM",`defined web interstitial for ${n}`),e.window.googletag.defineOutOfPageSlot(n,e.window.googletag.enums.OutOfPageFormat.INTERSTITIAL);case"out-of-page-bottom-anchor":return e.logger.debug("GAM",`defined bottom anchor for ${n}`),e.window.googletag.defineOutOfPageSlot(n,e.window.googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);case"out-of-page-top-anchor":return e.logger.debug("GAM",`defined top anchor for ${n}`),e.window.googletag.defineOutOfPageSlot(n,e.window.googletag.enums.OutOfPageFormat.TOP_ANCHOR)}})();return r&&e.window.googletag.display(r),r})();switch(e.env){case"production":if(a)return a.setCollapseEmptyDiv(!1!==t.gpt?.collapseEmptyDiv),a.addService(e.window.googletag.pubads()),e.logger.debug("GAM",`Register slot: [DomID] ${t.domId} [AdUnitPath] ${t.adUnitPath}`),Promise.resolve({moliSlot:t,adSlot:a,filterSupportedSizes:i});if("out-of-page-interstitial"===t.position||"out-of-page-top-anchor"===t.position||"out-of-page-bottom-anchor"===t.position)return e.logger.warn("GAM",`${t.position} is not supported`),Promise.resolve(null);{const r=`Slot: [DomID] ${t.domId} [AdUnitPath] ${t.adUnitPath} is already defined. You may have called requestAds() multiple times`;return e.logger.error("GAM",r),Promise.reject(new Error(r))}case"test":return Promise.resolve({moliSlot:t,adSlot:g(t.domId,t.adUnitPath),filterSupportedSizes:i});default:return Promise.reject(`invalid environment: ${e.config.environment}`)}}));return Promise.all(r).then((e=>e.filter(s.isNotNull)))},t.gptRequestAds=()=>(e,t)=>new Promise((r=>{switch(e.logger.debug("GAM","requestAds"),e.env){case"test":(0,d.createTestSlots)(e,t);break;case"production":e.window.googletag.pubads().refresh(t.map((e=>e.adSlot))),t.forEach((({moliSlot:t})=>e.reportingService.markRefreshed(t)));const r=t.map((({moliSlot:e})=>`[DomID] ${e.domId} [AdUnitPath] ${e.adUnitPath}`)).join("\n");e.logger.debug("GAM",`Refresh ${t.length} slot(s):\n${r}`)}r()}))},495:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelConfigService=void 0;const i=r(257);t.LabelConfigService=class{constructor(e,t,r){this.labelSizeConfig=e,this.extraLabels=t,this.window=r,this.possibleDevices=["mobile","desktop","android","ios"];const o=t.some((e=>this.possibleDevices.indexOf(e)>-1)),s=e.filter((e=>r.matchMedia(e.mediaQuery).matches));this.isValid=0===e.length||!(e.length>0&&0===s.length);const n=(0,i.flatten)(s.map((e=>e.labelsSupported)));this.supportedLabels=[...o?[]:n,...t].filter(i.uniquePrimitiveFilter)}filterSlot(e){let t=!0;return this.supportedLabels.length&&e.labelAll?.length&&(t=e.labelAll.every((e=>this.supportedLabels.indexOf(e)>-1))),this.supportedLabels.length&&e.labelAny&&!e.labelAll?.length&&(t=e.labelAny.some((e=>this.supportedLabels.indexOf(e)>-1))),t}getSupportedLabels(){return this.supportedLabels}getDeviceLabel(){return this.getSupportedLabels().find((e=>this.possibleDevices.indexOf(e)>-1))||"mobile"}}},414:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createMoliTag=void 0;const n=r(30),a=r(569),d=r(611),l=r(783),c=r(76),g=r(917),u=r(141),p=r(598),f=s(r(643)),h=r(676),m=r(495),b=r(748);t.createMoliTag=e=>{const t=(0,a.createAssetLoaderService)(e),r=new g.AdService(t,e),i=e;let o={state:"configurable",initialize:!1,isSinglePageApp:!1,keyValues:{},labels:[],modules:[],moduleMeta:[],reporting:{reporters:[]},refreshSlots:[],refreshInfiniteSlots:[],hooks:{beforeRequestAds:[],afterRequestAds:[]},adUnitPathVariables:{}};function s(t,r){switch(o.state){case"configurable":o.keyValues[t]=r;break;case"configured":o.config.targeting?o.config.targeting.keyValues[t]=r:o.config={...o.config,targeting:{keyValues:{[t]:r},adManagerExcludes:[]}};break;case"spa-finished":case"spa-requestAds":o.keyValues={[t]:r,...o.keyValues};break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal",`Setting key-value after configuration: ${t} : ${r}`)}}function S(t){switch(o.state){case"configurable":case"spa-requestAds":case"spa-finished":o.labels.push(t);break;case"configured":o.config.targeting?.labels?o.config.targeting.labels.push(t):o.config={...o.config,targeting:{keyValues:o.config.targeting?o.config.targeting.keyValues:{},adManagerExcludes:o.config.targeting?o.config.targeting.adManagerExcludes:[],labels:[t]}};break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal",`Adding label after configure: ${t}`)}}function v(){switch(o.state){case"configurable":return o.initialize=!0,Promise.resolve(o);case"configured":{A(),w(o.config.domain);const{moduleMeta:i,isSinglePageApp:s,refreshSlots:n,refreshInfiniteSlots:a}=o;let c=o.config;a.length>0&&a.forEach((t=>{c=(0,l.addNewInfiniteSlotToConfig)(c,t.idOfConfiguredSlot,t.artificialDomId,e)})),o.modules.forEach((i=>{(0,d.getLogger)(c,e).debug("MoliGlobal",`initialize ${i.moduleType} module ${i.name}`,i.config()),i.init(c,t,r.getAdPipeline)})),o.hooks&&o.hooks.beforeRequestAds&&o.hooks.beforeRequestAds.forEach((t=>{try{t(c)}catch(t){(0,d.getLogger)(c,e).error("MoliGlobal","beforeRequestAds hook failed",t)}}));const g=o.hooks.afterRequestAds;if(s){const t=r.initialize(c,s).then((()=>c)),l={state:"spa-requestAds",configFromAdTag:o.configFromAdTag,config:c,initialized:t,href:e.location.href,labels:[],keyValues:{},adUnitPathVariables:{},hooks:o.hooks,refreshSlots:[],refreshInfiniteSlots:[],moduleMeta:i};return o=l,t.then((()=>r.requestAds(c,n,a))).then((()=>{if("spa-requestAds"===o.state&&o.href===e.location.href){r.refreshAdSlots(o.refreshSlots,o.config),g.forEach((e=>e("spa-finished")));const e={...o,state:"spa-finished",refreshSlots:[]};return o=e,e}return"spa-finished"===o.state||"spa-requestAds"===o.state?((0,d.getLogger)(o.config,e).debug("MoliGlobal","A previous requestAds() was slower than the following requestAds() call"),o):Promise.reject(`reached invalid state [${o.state}]`)}))}return o={state:"requestAds",config:c,moduleMeta:i},r.initialize(c,s).then((e=>r.requestAds(e,n,a))).then((()=>(o={state:"finished",config:c,moduleMeta:i},g.forEach((e=>e("finished"))),Promise.resolve(o)))).catch((t=>((0,d.getLogger)(c,e).error("MoliGlobal",t),o={state:"error",config:c,error:t,moduleMeta:i},g.forEach((e=>e("error"))),Promise.resolve(o))))}case"spa-requestAds":case"spa-finished":{"spa-requestAds"===o.state&&(0,d.getLogger)(o.config,e).debug("MoliGlobal","requestAds is being called while the previous requestAds() hasn't finished yet"),A(),w(o.config.domain);const{hooks:t,moduleMeta:i}=o,s=o.hooks.afterRequestAds,n=o.hooks.beforeRequestAds,a=o,{initialized:l,href:c,keyValues:g,labels:u,configFromAdTag:p}=o,f="spa-finished"===o.state?o.refreshSlots:[],h="spa-finished"===o.state?o.refreshInfiniteSlots:[];return o={...a,state:"spa-requestAds",refreshSlots:[]},l.then((t=>{const r=t.spa?.validateLocation??"href";return(0,b.allowRequestAds)(r,c,e.location)?Promise.resolve(t):Promise.reject(`You are trying to refresh ads on the same page, which is not allowed. Using ${r} for validation.`)})).then((e=>({...e,targeting:{keyValues:{...p.targeting&&p.targeting.keyValues?p.targeting.keyValues:{},...g},labels:[...p.targeting&&p.targeting.labels?p.targeting.labels:[],...u],adUnitPathVariables:a.adUnitPathVariables,adManagerExcludes:p.targeting?p.targeting.adManagerExcludes:[]}}))).then((t=>(n.forEach((r=>{try{r(t)}catch(r){(0,d.getLogger)(t,e).error("MoliGlobal","beforeRequestAds hook failed",r)}})),r.requestAds(t,f,h).then((()=>t))))).then((n=>("spa-requestAds"===o.state&&r.refreshAdSlots(o.refreshSlots,n),o={state:"spa-finished",configFromAdTag:p,config:n,initialized:l,href:e.location.href,hooks:t,labels:[],keyValues:{},adUnitPathVariables:{},refreshSlots:[],refreshInfiniteSlots:[],moduleMeta:i},s.forEach((e=>e("spa-finished"))),o)))}case"requestAds":return(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to requestAds twice. Already requesting ads."),Promise.reject();case"finished":return(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to requestAds twice. Already finished."),Promise.reject();case"error":return(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to requestAds twice. Already finished, but with an error.",o.error),Promise.reject()}}function A(){const t="ABtest",r=(0,n.parseQueryString)(e.location.search).get(t);s(t,(r?Number(r):Math.floor(100*Math.random())+1).toString())}function w(t){const r=t||(0,h.extractTopPrivateDomainFromHostname)(e.location.hostname);r&&S(r)}return{que:{push(e){e(i.moli)}},version:p.packageJson.version,setTargeting:s,addLabel:S,setLogger:function(e){switch(o.state){case"configurable":o.logger=e;break;case"configured":o.config={...o.config,logger:e};break;default:e.error("Setting a custom logger is not allowed after configuration")}},setSampleRate:function(t){switch(o.state){case"configurable":o.reporting.sampleRate=t;break;case"configured":o.config={...o.config,reporting:{...o.config.reporting,sampleRate:t,reporters:o.config.reporting?o.config.reporting.reporters:[]}};break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to setSampleRate. Already configured.",o.config)}},setAdUnitPathVariables:function(t){switch(o.state){case"configurable":case"spa-requestAds":case"spa-finished":o.adUnitPathVariables=t;break;case"configured":o.config={...o.config,targeting:{keyValues:o.config.targeting?o.config.targeting.keyValues:{},labels:o.config.targeting?.labels?o.config.targeting.labels:[],adUnitPathVariables:t,adManagerExcludes:o.config.targeting?o.config.targeting.adManagerExcludes:[]}};break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal",`Setting unit path variables after configuration: ${t}`)}},resolveAdUnitPath:function(t,r){const i=(r||{}).removeNetworkChildId||!1,s=f.resolveAdUnitPath(t,function(){const t=(0,h.extractTopPrivateDomainFromHostname)(e.location.hostname)||"unknown";switch(o.state){case"configurable":return{...o.adUnitPathVariables,domain:t,device:"unknown"};case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":const r=new m.LabelConfigService(o.config.labelSizeConfig||[],[],e);return{...o.config.targeting?.adUnitPathVariables,domain:o.config.domain||t,device:r.getDeviceLabel()}}}());return i?f.removeChildId(s):s},addReporter:function(t){switch(o.state){case"configurable":o.reporting.reporters.push(t);break;case"configured":o.config={...o.config,reporting:{...o.config.reporting,sampleRate:o.config.reporting?o.config.reporting.sampleRate:0,reporters:[...o.config.reporting?o.config.reporting.reporters:[],t]}};break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to setSampleRate. Already configured.",o.config)}},beforeRequestAds:function(t){switch(o.state){case"configurable":case"configured":o.hooks.beforeRequestAds.push(t);break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to add a hook beforeRequestAds. Already configured.",o.config)}},afterRequestAds:function(t){switch(o.state){case"configurable":case"configured":o.hooks.afterRequestAds.push(t);break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to add a hook afterRequestAds. Already configured.",o.config)}},getConfig:function(){switch(o.state){case"configurable":return null;case"configured":case"requestAds":case"spa-requestAds":case"spa-finished":case"finished":case"error":return o.config}},registerModule:function(t){if("configurable"===o.state)return o.modules.push(t),void o.moduleMeta.push((0,c.metaFromModule)(t));(0,d.getLogger)(o.config,e).error("Registering a module is only allowed within the ad tag before the ad tag is configured")},configure:function(t){switch(o.state){case"configurable":{const r=o.initialize,i=(0,u.getActiveEnvironmentOverride)(e),s=o.modules;"queryParam"===i?.source&&(0,u.setEnvironmentOverrideInStorage)(i.environment,e.sessionStorage),t.spa&&(o.isSinglePageApp=t.spa.enabled),o={state:"configured",configFromAdTag:t,config:{...t,...i&&{environment:i.environment},targeting:{keyValues:{...t.targeting&&t.targeting.keyValues?t.targeting.keyValues:{},...o.keyValues},labels:[...t.targeting&&t.targeting.labels?t.targeting.labels:[],...o.labels],adUnitPathVariables:o.adUnitPathVariables,adManagerExcludes:t.targeting?t.targeting.adManagerExcludes:[]},reporting:{...t.reporting,sampleRate:o.reporting.sampleRate?o.reporting.sampleRate:t.reporting&&t.reporting.sampleRate?t.reporting.sampleRate:0,reporters:[...t.reporting?t.reporting.reporters:[],...o.reporting.reporters]},logger:o.logger||t.logger},modules:s,moduleMeta:s.map(c.metaFromModule),hooks:o.hooks,isSinglePageApp:o.isSinglePageApp,refreshSlots:[...o.refreshSlots],refreshInfiniteSlots:[...o.refreshInfiniteSlots]},r&&v();break}case"configured":(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to configure moli tag twice. Already configured.",o.config);break;case"requestAds":(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to configure moli tag twice. Already requesting ads.");break;case"finished":(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to configure moli tag twice. Already finished.");break;case"error":(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying to configure moli tag twice. Already finished, but with an error.",o.error)}},enableSinglePageApp:function(){switch(o.state){case"configurable":(0,d.getLogger)(null,e).warn("MoliGlobal","enableSinglePageApp() is deprecated. Use spa config."),o.isSinglePageApp=!0;break;case"configured":(0,d.getLogger)(o.config,e).warn("MoliGlobal","enableSinglePageApp() is deprecated. Use spa config."),o.isSinglePageApp=!0;break;case"spa-requestAds":case"spa-finished":break;default:(0,d.getLogger)(o.config,e).error("MoliGlobal","Trying enable single page app. Already configured.",o.config)}},requestAds:v,refreshAdSlot:function(t){const i="string"==typeof t?[t]:t;switch(o.state){case"configurable":case"configured":case"spa-requestAds":return o.refreshSlots.push(...i),Promise.resolve("queued");case"spa-finished":const t=o.config.spa?.validateLocation??"href";return(0,b.allowRefreshAdSlot)(t,o.href,e.location)?r.refreshAdSlots(i,o.config).then((()=>"refreshed")):(o.refreshSlots.push(...i),Promise.resolve("queued"));case"finished":case"requestAds":return r.refreshAdSlots(i,o.config).then((()=>"refreshed"));default:return(0,d.getLogger)(o.config,e).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}},refreshBucket:function(t){function s(e){const r=e.slots.filter((e=>e.behaviour.bucket===t));return r?.map((e=>e.domId))}switch(o.state){case"configurable":{const e=i.moli.getConfig()?.slots.filter((e=>e.behaviour.bucket===t)),r=e?.map((e=>e.domId));return r?.length?(o.refreshSlots.push(...r),Promise.resolve("queued")):Promise.reject("no configurable domIds for buckets")}case"configured":{const e=s(o.config);return o.refreshSlots.push(...e),Promise.resolve("queued")}case"spa-requestAds":{const e=s(o.config);return o.refreshSlots.push(...e),Promise.resolve("queued")}case"spa-finished":if(o.href===e.location.href)return r.refreshBucket(t,o.config).then((()=>"refreshed"));{const e=s(o.config);return o.refreshSlots.push(...e),Promise.resolve("queued")}case"finished":case"requestAds":return r.refreshBucket(t,o.config).then((()=>"refreshed"));default:return(0,d.getLogger)(o.config,e).error("MoliGlobal",`refreshAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}return Promise.reject("no slots in buckets found")},refreshInfiniteAdSlot:function(t,i){switch(o.state){case"configurable":case"configured":case"spa-requestAds":return o.refreshInfiniteSlots.push({artificialDomId:t,idOfConfiguredSlot:i}),Promise.resolve("queued");case"spa-finished":return o.href===e.location.href?(o={...o,config:(0,l.addNewInfiniteSlotToConfig)(o.config,i,t,e)},r.refreshAdSlots([t],o.config).then((()=>"refreshed"))):(o.refreshInfiniteSlots.push({artificialDomId:t,idOfConfiguredSlot:i}),Promise.resolve("queued"));case"finished":case"requestAds":return o={...o,config:(0,l.addNewInfiniteSlotToConfig)(o.config,i,t,e)},r.refreshAdSlots([t],o.config).then((()=>"refreshed"));default:return(0,d.getLogger)(o.config,e).error("MoliGlobal",`refreshInfiniteAdSlot is not allowed in state ${o.state}`,o.config),Promise.reject(`not allowed in state ${o.state}`)}},getModuleMeta:function(){return o.moduleMeta},getState:function(){return o.state},openConsole:function(e){"configurable"===o.state||t.loadScript({assetUrl:e||"https://highfivve.github.io/moli-ad-tag/assets/js/moli-debug.min.js",loadMethod:a.AssetLoadMethod.TAG,name:"moli-debugger"}).catch((e=>console.error("failed to load moli debugger",e)))},getAssetLoaderService:function(){return t}}}},542:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initAdTag=void 0;const i=r(414);t.initAdTag=e=>{const t=e,r=t.moli&&[...t.moli.que]||[],o=(0,i.createMoliTag)(e);return t.moli=o,r.forEach((e=>e(o))),o}},514:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passbackPrepareRequestAds=void 0;const i=r(157);t.passbackPrepareRequestAds=e=>(0,i.mkPrepareRequestAdsStep)("passback-prepare-slots",i.LOW_PRIORITY,((t,r)=>new Promise((i=>{r.filter((e=>e.moliSlot.passbackSupport)).forEach((r=>{t.logger.debug("passback","add passback support for slot",r.moliSlot.domId),e.addAdSlot(r)})),i()}))))},974:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PassbackService=void 0,t.PassbackService=class{constructor(e,t){this.logger=e,this.window=t,this.isInitialized=!1,this.adSlots={},this.passbackKeyValue="passback",this.passbackOriginKeyValue="passbackOrigin",this.findAdSlot=e=>e.adUnitPath?this.adSlots[e.adUnitPath]:e.domId?this.adSlots[e.domId]:void 0}addAdSlot(e){this.isInitialized||(this.isInitialized=!0,this.initMessageListener()),this.adSlots[e.moliSlot.domId]=e,this.adSlots[e.moliSlot.adUnitPath]=e}initMessageListener(){this.logger.debug("Passback Service","Add message listener"),this.window.addEventListener("message",(e=>{const t=this.parseMessageData(e.data);if(!t)return;this.logger.debug("Passback Service","Received passback message",t);const r=this.findAdSlot(t);r&&(this.logger.debug("Passback Service","Process passback for ad slot"),r.adSlot.setTargeting(this.passbackKeyValue,"true"),r.adSlot.setTargeting(this.passbackOriginKeyValue,t.passbackOrigin),this.window.googletag.pubads().refresh([r.adSlot]),delete this.adSlots[r.moliSlot.domId],delete this.adSlots[r.moliSlot.adUnitPath])}))}parseMessageData(e){if("string"==typeof e)try{const t=JSON.parse(e);return"passback"===t.type&&t.passbackOrigin&&(t.domId||t.adUnitPath)?t:null}catch(e){return null}return null}}},198:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderPrebidOutstream=t.prebidOutstreamRenderer=void 0;const i=r(611);t.prebidOutstreamRenderer=(e,r={})=>({url:"https://assets.h5v.eu/prebid-outstream/3/bundle.js",render:i=>(0,t.renderPrebidOutstream)(i,e,r),backupOnly:!0}),t.renderPrebidOutstream=(e,t,r={})=>{e.renderer?e.renderer.push((()=>window.outstreamPlayer?.(e,t,r))):(0,i.getDefaultLogger)().error("Can not initialize prebid outstream player, because bid.renderer is not defined")}},372:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prebidRenderAds=t.prebidDefineSlots=t.prebidRequestBids=t.prebidPrepareRequestAds=t.prebidConfigure=t.prebidRemoveAdUnits=t.prebidInit=void 0;const i=r(157),o=r(793),s=r(643),n=r(257),a=r(382),d=r(249),l=e=>new Promise(((t,r)=>{e.window.setTimeout((()=>r("Prebid did not resolve in time. Maybe you forgot to import the prebid distribution in the ad tag")),5e3)})),c=e=>new Promise((t=>{e.pbjs=e.pbjs||{que:[]},e.pbjs.que.push(t)})),g=e=>!!e.moliSlot.prebid,u=(e,t,r)=>{const i=e.labelConfigService.getSupportedLabels(),n=e.labelConfigService.getDeviceLabel();return r.filter(g).map((({moliSlot:r,priceRule:d,filterSupportedSizes:l})=>{const c=e.config.targeting,g=c&&c.keyValues?c.keyValues:{},u=d?d.floorprice:void 0,h=d?{floors:{currency:t.config.currency.adServerCurrency,schema:{delimiter:"|",fields:["mediaType"]},values:{"*":d.floorprice}}}:null;return e.logger.debug("Prebid",e.requestId,"Price Rule",d,r.domId,h),p({keyValues:g,floorPrice:u,priceRule:d,labels:i,isMobile:"mobile"===n},r.prebid).map((t=>{const i=t.adUnit.mediaTypes.banner,n=t.adUnit.mediaTypes.video,d=t.adUnit.mediaTypes.native,c=i?l(i.sizes).filter(o.SizeConfigService.isFixedSize):[],g=n?f(n.playerSize,l):[],u=t.adUnit.bids.filter((t=>e.labelConfigService.filterSlot(t))).filter((t=>!t.bidder||!e.auction?.biddersDisabling||!e.auction.biddersDisabling.isBidderDisabled(r.domId,t.bidder))).map((e=>{const{labelAny:t,labelAll:r,...i}=e;return i})),p=g.length>0&&!n?.w&&!n?.h?{w:g[0][0],h:g[0][1]}:{},m=n?{video:{...n,playerSize:0===g.length?void 0:g,...p}}:void 0,b=i&&c.length>0?{banner:{...i,sizes:c}}:void 0,S=d?{native:{...d}}:void 0,v={...t.adUnit.pubstack,adUnitPath:(0,s.resolveAdUnitPath)(t.adUnit.pubstack?.adUnitPath||r.adUnitPath,e.adUnitPathVariables)},A=t.adUnit.ortb2Imp?.ext?.prebid?.storedrequest,w=A&&A.id?{...A,id:(0,s.resolveAdUnitPath)(A.id,e.adUnitPathVariables)}:null;return{...t.adUnit,...A&&w&&{ortb2Imp:(0,a.resolveStoredRequestIdInOrtb2Object)(t.adUnit.ortb2Imp,w)},code:t.adUnit.code||r.domId,...t.adUnit.pubstack?{pubstack:v}:{},mediaTypes:{...m,...b,...S},bids:u,...h}})).filter((t=>t.bids.length>0&&t.mediaTypes&&(t.mediaTypes.banner||t.mediaTypes.video||t.mediaTypes.native)&&!((e,t)=>!!t.pbjs.adUnits&&t.pbjs.adUnits.some((t=>e.code===t.code)))(t,e.window)))})).reduce(((e,t)=>[...e,...t]),[])};t.prebidInit=()=>(0,i.mkInitStep)("prebid-init",(e=>Promise.race([c(e.window),l(e)]))),t.prebidRemoveAdUnits=e=>(0,i.mkConfigureStep)("prebid-remove-adunits",(t=>new Promise((r=>{if(!0!==e.ephemeralAdUnits){t.window.pbjs=t.window.pbjs||{que:[]};const e=t.window.pbjs.adUnits;e&&(t.logger.debug("Prebid","Destroying prebid adUnits",e),e.forEach((e=>t.window.pbjs.removeAdUnit(e.code))))}r()})))),t.prebidConfigure=(e,t)=>{let r;const o=e=>({validation:"relaxed",config:{ver:"1.0",complete:1,nodes:e}});return(0,i.mkConfigureStep)("prebid-configure",((i,s)=>(r||(r=new Promise((r=>{e.bidderSettings&&(i.window.pbjs.bidderSettings=e.bidderSettings),i.window.pbjs.setConfig({...e.config,schain:o([t.supplyChainStartNode]),floors:e.config.floors||{}}),e.schain.nodes.forEach((({bidder:e,node:r,appendNode:s})=>{const n=[t.supplyChainStartNode];s&&n.push(r),i.window.pbjs.setBidderConfig({bidders:[e],config:{schain:o(n)}},!0)})),i.window.pbjs.registerSignalSources&&"function"==typeof i.window.pbjs.registerSignalSources&&i.window.pbjs.registerSignalSources(),r()}))),r)))};const p=(e,t)=>{if("function"==typeof t){const r=t(e);return Array.isArray(r)?r:[r]}return Array.isArray(t)?t:[t]};t.prebidPrepareRequestAds=e=>(0,i.mkPrepareRequestAdsStep)("prebid-prepare-adunits",i.LOW_PRIORITY,((t,r)=>new Promise((i=>{if(e.ephemeralAdUnits)i();else{const o=u(t,e,r);o.forEach((e=>{t.logger.debug("Prebid",t.requestId,`Prebid add ad unit: [Code] ${e.code}`,e)})),t.window.pbjs.addAdUnits(o),i()}})))),t.prebidRequestBids=(e,t,r)=>(0,i.mkRequestBidsStep)("prebid-request-bids",((i,o)=>{const s=Math.max((e.config.bidderTimeout??2e3)+3e3,e.failsafeTimeout??0),a=new Promise((e=>i.window.setTimeout(e,s))),d=new Promise((s=>{const a=e.ephemeralAdUnits?{adUnits:u(i,e,o)}:{adUnitCodes:o.filter(g).map((e=>e.moliSlot.domId))},d=a.adUnitCodes||a.adUnits?.map((e=>e.code)).filter(n.isNotNull).filter(n.uniquePrimitiveFilter)||[];if(0===d.length)return i.logger.debug("Prebid","skip request bids. All slots were filtered.",o.map((e=>e.moliSlot))),s();let l=!1;i.logger.debug("Prebid",`Prebid request bids: \n\t\t\t${d.join("\n\t\t\t")}`),i.window.pbjs.requestBids({...a,timeout:i.bucket?.timeout,bidsBackHandler:(n,a,c)=>{i.logger.info("Prebid",c,n,o.map((e=>e.moliSlot.domId)));try{if(l)return void i.logger.warn("Prebid",`ad server request already sent [${i.requestId}]. AuctionId ${c}`);if(!n)return i.logger.warn("Prebid",`Undefined bid response map for ad unit codes: ${d.join(", ")}`),s();if(l=!0,"gam"===t){if(e.listener){const t=r&&r.keyValues?r.keyValues:{},s="function"==typeof e.listener?e.listener({keyValues:t}):e.listener;if(s.preSetTargetingForGPTAsync)try{s.preSetTargetingForGPTAsync(n,a,o)}catch(e){i.logger.error("Prebid",`Failed to execute prebid preSetTargetingForGPTAsync listener. ${e}`)}}i.window.pbjs.setTargetingForGPTAsync(d)}s()}catch(e){i.logger.error("Prebid","DfpService:: could not resolve bidsBackHandler"+JSON.stringify(e)),s()}}})}));return Promise.race([a,d])})),t.prebidDefineSlots=()=>(e,t)=>{const r=t.map((t=>{const r=new o.SizeConfigService(t.sizeConfig,e.labelConfigService.getSupportedLabels(),e.window),i=r.filterSupportedSizes;if(!r.filterSlot(t)||!e.labelConfigService.filterSlot(t))return Promise.resolve(null);const s={getAdUnitPath:()=>t.adUnitPath};switch(e.env){case"production":case"test":return Promise.resolve({moliSlot:t,adSlot:s,filterSupportedSizes:i});default:return Promise.reject(`invalid environment: ${e.config.environment}`)}}));return Promise.all(r).then((e=>e.filter(n.isNotNull)))},t.prebidRenderAds=()=>(e,t)=>new Promise(((r,i)=>{e.logger.debug("Prebid","start rendering");try{switch(e.env){case"test":e.logger.debug("Prebid","Rendering test slots"),(0,d.createTestSlots)(e,t);break;case"production":e.window.pbjs.getHighestCpmBids().filter((e=>e&&e.adId)).forEach((t=>{const r=e.window.document.getElementById(t.adUnitCode);if(r){const i=document.createElement("div");i.style.setProperty("border","0pt none");const o=document.createElement("iframe");o.scrolling="no",o.frameBorder="0",o.marginHeight="0",o.marginHeight="0",o.name=`prebid_ads_iframe_${t.adUnitCode}`,o.title="3rd party ad content",o.sandbox.add("allow-forms","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"),o.setAttribute("aria-label","Advertisment"),o.style.setProperty("border","0"),o.style.setProperty("margin","0"),o.style.setProperty("overflow","hidden"),i.appendChild(o),r.appendChild(i);const s=o.contentWindow?.document;if(s){e.window.pbjs.renderAd(s,t.adId);const r="/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}details,main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}",i=s.createElement("style");i.appendChild(s.createTextNode(r)),s.head.appendChild(i)}else e.logger.error("Prebid",`No access to iframe contentWindow for ad unit${t.adUnitCode}`)}else e.logger.error("Prebid",`Could not locate ad slot with id ${t.adUnitCode}`)}))}r()}catch(e){i(e)}}));const f=(e,t)=>{return e?t((r=e,r&&2===r.length&&"number"==typeof r[0]&&"number"==typeof r[1]?[e]:e)).filter(o.SizeConfigService.isFixedSize):[];var r}},192:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noopReportingService=t.ReportingService=t.reportingPrepareRequestAds=void 0;const i=r(157);t.reportingPrepareRequestAds=e=>(0,i.mkPrepareRequestAdsStep)("reporting-enabled",i.HIGH_PRIORITY,((t,r)=>(1===t.requestId&&(t.logger.debug("Reporting","initialize reporting",r),e.initialize(r.map((e=>e.moliSlot)))),Promise.resolve())));class o{static getSingleMeasurementMetricMeasureName(e){switch(e){case"cmpLoad":return"cmp_load_time";case"dfpLoad":return"dfp_load_time";case"prebidLoad":return"prebid_load_time";case"a9Load":return"a9_load_time";case"ttfa":return"dfp_time_to_first_ad";case"ttfr":return"dfp_time_to_first_render"}}constructor(e,t,r,i,o){this.performanceService=e,this.config=t,this.logger=r,this.env=i,this.window=o,this.slotRenderEndedEvent={},this.adUnitRegex=t.adUnitRegex||/\/\d*\//i;try{this.pageRequestId=this.uuidv4(),this.isSample=Math.random()<=t.sampleRate,r.debug("AdPerformanceService",`isSample ${this.isSample} (${t.sampleRate}) | pageRequestId ${this.pageRequestId}`)}catch(e){this.pageRequestId="00000000-0000-0000-0000-000000000000",this.isSample=!1,r.error("[ReportingService] Initializing failed",e)}}initialize(e){this.performanceService.mark("dfp_load_start"),this.measureAndReportFirstAdRenderTime(),this.measureAndReportFirstAdLoadTime(),this.initAdSlotMetrics()}markRefreshed(e){this.performanceService.mark(`${this.minimalAdUnitName(e.adUnitPath)}_refreshed`)}markPrebidSlotsRequested(e){this.performanceService.mark(`prebid_requested_${e}`)}measureAndReportPrebidBidsBack(e){const t=o.getSingleMeasurementMetricMeasureName("prebidLoad");this.performanceService.measure(`${t}_${e}`,`prebid_requested_${e}`,`prebid_bids_back_${e}`),1===e&&this.performanceService.measure(t,`prebid_requested_${e}`,`prebid_bids_back_${e}`);const r=this.performanceService.getMeasure(`${t}_${e}`);r&&this.report({type:"prebidLoad",pageRequestId:this.pageRequestId,measurement:r})}markA9fetchBids(e){this.performanceService.mark(`a9_requested_${e}`)}measureAndReportA9BidsBack(e){const t=o.getSingleMeasurementMetricMeasureName("a9Load");this.performanceService.measure(`${t}_${e}`,`a9_requested_${e}`,`a9_bids_back_${e}`);const r=this.performanceService.getMeasure(`${t}_${e}`);1===e&&this.performanceService.measure(t,`a9_requested_${e}`,`a9_bids_back_${e}`),r&&this.report({type:"a9Load",pageRequestId:this.pageRequestId,measurement:r})}markCmpInitialization(){this.performanceService.mark("cmp_load_start")}measureCmpLoadTime(){const e=o.getSingleMeasurementMetricMeasureName("cmpLoad");this.performanceService.mark("cmp_load_end"),this.performanceService.measure(e,"cmp_load_start","cmp_load_end");const t=this.performanceService.getMeasure(e);t&&this.report({type:"cmpLoad",pageRequestId:this.pageRequestId,measurement:t})}shouldTrack(){return this.isSample}report(e){this.shouldTrack()&&this.config.reporters.forEach((t=>t(e)))}measureAndReportFirstAdRenderTime(){switch(this.env){case"production":new Promise((e=>{let t=!1;this.window.googletag.pubads().addEventListener("slotRenderEnded",(()=>{t||(e(),t=!0)}))})).then((()=>{const e=o.getSingleMeasurementMetricMeasureName("ttfr");this.performanceService.measure(e,"dfp_load_start","dfp_time_to_first_render_end");const t=this.performanceService.getMeasure(e);t&&this.report({type:"ttfr",pageRequestId:this.pageRequestId,measurement:t})}));break;case"test":this.logger.warn("ReportingService","In test environment no time-to-first-render will be reported")}}measureAndReportFirstAdLoadTime(){switch(this.env){case"production":new Promise((e=>{let t=!1;this.window.googletag.pubads().addEventListener("slotOnload",(()=>{t||(e(),t=!0)}))})).then((()=>{const e=o.getSingleMeasurementMetricMeasureName("ttfa");this.performanceService.measure(e,"dfp_load_start","dfp_time_to_first_ad_end");const t=this.performanceService.getMeasure(e);t&&this.report({type:"ttfa",pageRequestId:this.pageRequestId,measurement:t})}));break;case"test":this.logger.warn("In test environment no time-to-first-loads will be reported")}}initAdSlotMetrics(){this.window.googletag.pubads().addEventListener("slotRenderEnded",(e=>{const t=this.minimalAdUnitName(e.slot.getAdUnitPath());this.performanceService.measure(`${t}_rendered`,"dfp_load_start",`${t}_rendered`),this.slotRenderEndedEvent[e.slot.getSlotElementId()]=e})),this.window.googletag.pubads().addEventListener("slotOnload",(e=>{const t=this.minimalAdUnitName(e.slot.getAdUnitPath());this.performanceService.mark(`${t}_content_loaded`),this.performanceService.measure(`${t}_render_content_loaded`,`${t}_rendered`,`${t}_content_loaded`),this.performanceService.measure(`${t}_content_loaded_total`,"dfp_load_start",`${t}_content_loaded`);const r=this.slotRenderEndedEvent[e.slot.getSlotElementId()],i=this.performanceService.getMeasure(`${t}_rendered`),o=this.performanceService.getMeasure(`${t}_render_content_loaded`),s=this.performanceService.getMeasure(`${t}_content_loaded_total`),n=this.performanceService.getMark(`${t}_refreshed`);if(!(s&&o&&i&&n&&r))return;delete this.slotRenderEndedEvent[e.slot.getSlotElementId()];const a={type:"adSlot",pageRequestId:this.pageRequestId,adUnitName:t,advertiserId:r.advertiserId,campaignId:r.campaignId,lineItemId:r.lineItemId||r.sourceAgnosticLineItemId,refresh:n,rendered:i,rendering:o,loaded:s};this.report(a)}))}minimalAdUnitName(e){return e.replace(this.adUnitRegex,"")}reportAdSlotsMetric(e){const t={type:"adSlots",numberAdSlots:e.length,numberEmptyAdSlots:e.filter((e=>e.isEmpty)).length};return this.report(t),e}uuidv4(){return"crypto"in this.window&&"getRandomValues"in this.window.crypto?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^this.window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}t.ReportingService=o,t.noopReportingService={initialize:()=>{},markRefreshed:()=>{},markPrebidSlotsRequested:()=>{},measureAndReportPrebidBidsBack:()=>{},markA9fetchBids:()=>{},measureAndReportA9BidsBack:()=>{},markCmpInitialization:()=>{},measureCmpLoadTime:()=>{}}},793:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SizeConfigService=void 0;const i=r(257),o=r(255);t.SizeConfigService=class{static isFixedSize(e){return"fluid"!==e}constructor(e,t,r){this.sizeConfig=e,this.supportedLabels=t,this.window=r,this.filterSupportedSizes=e=>this.isValid?0===this.supportedSizes.length?e:this.supportedSizes.filter((t=>e.some((e=>"fluid"===t?"fluid"===e:"fluid"!==e&&(0,o.isSizeEqual)(e,t))))):[],this.areLabelsMatching=(e,t)=>(!e.labelAll||e.labelAll.every((e=>t.some((t=>t===e)))))&&(!e.labelNone||!e.labelNone.some((e=>t.some((t=>t===e)))));const s=0!==e.length?e.filter((e=>r.matchMedia(e.mediaQuery).matches&&this.areLabelsMatching(e,t))):[];this.isValid=0===e.length||!(e.length>0&&0===s.length),this.supportedSizes=(0,i.flatten)(s.map((e=>e.sizesSupported))).map((e=>JSON.stringify(e))).filter(i.uniquePrimitiveFilter).map((e=>JSON.parse(e)))}filterSlot(e){return!e.sizes||0===e.sizes.length||this.filterSupportedSizes(e.sizes).length>0}}},748:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.allowRequestAds=t.allowRefreshAdSlot=void 0,t.allowRefreshAdSlot=(e,t,r)=>{switch(e){case"none":return!0;case"href":return r.href===t;case"path":try{const e=new URL(t);return r.pathname===e.pathname}catch(e){return!0}}},t.allowRequestAds=(e,t,r)=>{switch(e){case"none":return!0;case"href":return r.href!==t;case"path":try{const e=new URL(t);return r.pathname!==e.pathname}catch(e){return!0}}}},598:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.packageJson=void 0,t.packageJson={version:"4.20.1"}},885:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95),t),o(r(193),t),o(r(76),t),o(r(81),t),o(r(955),t),o(r(879),t),o(r(39),t),o(r(542),t),o(r(414),t),o(r(157),t),o(r(643),t),o(r(198),t),o(r(569),t),o(r(257),t),o(r(713),t),o(r(611),t),o(r(329),t)},95:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},193:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.googletag=void 0,function(e){let t;!function(e){let t;!function(e){e[e.TOP_ANCHOR=2]="TOP_ANCHOR",e[e.BOTTOM_ANCHOR=3]="BOTTOM_ANCHOR",e[e.REWARDED=4]="REWARDED",e[e.INTERSTITIAL=5]="INTERSTITIAL"}(t=e.OutOfPageFormat||(e.OutOfPageFormat={}))}(t=e.enums||(e.enums={}))}(r||(t.googletag=r={}))},76:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metaFromModule=void 0,t.metaFromModule=e=>({moduleType:e.moduleType,name:e.name,description:e.description,config:e.config()})},81:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},955:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.prebidjs=void 0,function(e){e.Adagio="adagio",e.AdaptMx="amx",e.Adform="adf",e.AdUp="aduptech",e.Criteo="criteo",e.ConnectAd="connectad",e.AppNexusAst="appnexusAst",e.AppNexus="appnexus",e.GumGum="gumgum",e.ImproveDigital="improvedigital",e.IndexExchange="ix",e.Invibes="invibes",e.NanoInteractive="nanointeractive",e.PubMatic="pubmatic",e.Ogury="ogury",e.OneTag="onetag",e.OpenX="openx",e.SmartAdServer="smartadserver",e.Smartx="smartx",e.Unruly="unruly",e.Teads="teads",e.Triplelift="triplelift",e.Yieldlab="yieldlab",e.Seedtag="seedtag",e.Spotx="spotx",e.ShowHeroes="showheroesBs",e.StroeerCore="stroeerCore",e.Xaxis="xhb",e.DSPX="dspx",e.Rubicon="rubicon",e.Recognified="rads",e.Visx="visx",e.Vlyby="vlyby",e.Orbidder="orbidder"}(r||(t.prebidjs=r={}))},39:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},879:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.tcfapi=void 0,function(e){let t,r;!function(e){let t,r;!function(e){e[e.STORE_INFORMATION_ON_DEVICE=1]="STORE_INFORMATION_ON_DEVICE",e[e.SELECT_BASIC_ADS=2]="SELECT_BASIC_ADS",e[e.CREATE_PERSONALISED_ADS_PROFILE=3]="CREATE_PERSONALISED_ADS_PROFILE",e[e.SELECT_PERSONALISED_ADS=4]="SELECT_PERSONALISED_ADS",e[e.CREATE_PERSONALISED_CONTENT_PROFILE=5]="CREATE_PERSONALISED_CONTENT_PROFILE",e[e.SELECT_PERSONALISED_CONTENT=6]="SELECT_PERSONALISED_CONTENT",e[e.MEASURE_AD_PERFORMANCE=7]="MEASURE_AD_PERFORMANCE",e[e.MEASURE_CONTENT_PERFORMANCE=8]="MEASURE_CONTENT_PERFORMANCE",e[e.APPLY_MARKET_RESEARCH=9]="APPLY_MARKET_RESEARCH",e[e.DEVELOP_IMPROVE_PRODUCTS=10]="DEVELOP_IMPROVE_PRODUCTS"}(t=e.TCPurpose||(e.TCPurpose={})),function(e){e[e.NOT_ALLOWED=0]="NOT_ALLOWED",e[e.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",e[e.REQUIRE_LI=2]="REQUIRE_LI"}(r=e.RestrictionType||(e.RestrictionType={}))}(t=e.responses||(e.responses={})),function(e){let t,r,i;!function(e){e.VISIBLE="visible",e.HIDDEN="hidden",e.DISABLED="disabled"}(t=e.DisplayStatus||(e.DisplayStatus={})),function(e){e.STUB="stub",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(r=e.CmpStatus||(e.CmpStatus={})),function(e){e.TC_LOADED="tcloaded",e.CMP_UI_SHOWN="cmpuishown",e.USER_ACTION_COMPLETE="useractioncomplete"}(i=e.EventStatus||(e.EventStatus={}))}(r=e.status||(e.status={}))}(r||(t.tcfapi=r={}))},783:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addNewInfiniteSlotToConfig=void 0;const i=r(611);t.addNewInfiniteSlotToConfig=(e,t,r,o)=>{const s=e.slots.find((e=>e.domId===t));if(s){const t={...s,domId:r};return{...e,slots:[...e.slots,t]}}return(0,i.getLogger)(e,o).error("MoliGlobal","no infinite ad slot configured!",e),e}},257:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNotNull=t.uniquePrimitiveFilter=t.flatten=void 0,t.flatten=function(e){return e.reduce(((e,t)=>e.concat(t)),[])},t.uniquePrimitiveFilter=function(e,t,r){return r.indexOf(e)===t},t.isNotNull=function(e){return null!=e}},569:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createAssetLoaderService=t.AssetLoaderService=t.AssetLoadMethod=void 0;const o=i(r(297)),s=r(465);var n;!function(e){e[e.FETCH=0]="FETCH",e[e.TAG=1]="TAG"}(n||(t.AssetLoadMethod=n={}));class a{constructor(e,t){this.performanceService=e,this.window=t}loadScript(e,t=this.window.document.head){return this.awaitDomReady().then((()=>this.startPerformance(e.name))).then((()=>{switch(e.loadMethod){case n.FETCH:return this.loadAssetViaFetch(e,t);case n.TAG:return this.loadAssetViaTag(e,t)}})).finally((()=>this.measurePerformance(e.name)))}loadJson(e,t){return this.startPerformance(e),this.window.fetch(t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then((t=>(this.measurePerformance(e),t.ok?t.json():t.text().then((e=>Promise.reject(`${t.statusText}: ${e}`)))))).catch((t=>(this.measurePerformance(e),Promise.reject(t))))}loadAssetViaFetch(e,t){return this.window.fetch(e.assetUrl).then((e=>e.ok?Promise.resolve(e):Promise.reject(e))).then((e=>e.text())).then((e=>this.scriptTagWithBody(e))).then((e=>t.appendChild(e)))}scriptTagWithBody(e){const t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.text=e,t}loadAssetViaTag(e,t){const r=this.scriptTagWithSrc(e.assetUrl);return new Promise(((e,i)=>{r.onload=e,r.onerror=i,t.appendChild(r)}))}scriptTagWithSrc(e){const t=this.window.document.createElement("script");return t.type="text/javascript",t.async=!0,t.src=e,t}awaitDomReady(){return new Promise((e=>{(0,o.default)(this.window,e)}))}startPerformance(e){this.performanceService.mark(`${e}_load_start`)}measurePerformance(e){this.performanceService.mark(`${e}_load_stop`),this.performanceService.measure(`${e}_load_time`,`${e}_load_start`,`${e}_load_stop`)}}t.AssetLoaderService=a,t.createAssetLoaderService=e=>new a((0,s.createPerformanceService)(e),e)},818:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserStorageKeys=void 0,t.BrowserStorageKeys={moliEnv:"moli-env",testSlotSize:e=>`moli-test-slot-size-${e}`,debugDelay:"moli-debug-delay"}},389:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setDebugDelayToLocalStorage=t.getDebugDelayFromLocalStorage=t.executeDebugDelay=void 0;const i=r(818),o=r(463);t.executeDebugDelay=(e,t)=>t?new Promise((r=>e.setTimeout(r,t))):Promise.resolve(),t.getDebugDelayFromLocalStorage=e=>Number((0,o.getBrowserStorageValue)(i.BrowserStorageKeys.debugDelay,e.localStorage))||void 0,t.setDebugDelayToLocalStorage=(e,t)=>{t?(0,o.setBrowserStorageValue)(i.BrowserStorageKeys.debugDelay,t.toString(),e.localStorage):(0,o.removeBrowserStorageValue)(i.BrowserStorageKeys.debugDelay,e.localStorage)}},297:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{let r,i=[],o="object"==typeof e.document&&e.document,s=o&&o.documentElement.doScroll,n="DOMContentLoaded",a=o&&(s?/^loaded|^c/:/^loaded|^i|^c/).test(o.readyState);!a&&o&&o.addEventListener(n,r=()=>{if(o)for(o.removeEventListener(n,r),a=!0;r=i.shift();)r()}),a?setTimeout(t,0):i.push(t)}},141:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resetEnvironmentOverrides=t.setEnvironmentOverrideInStorage=t.getAllEnvironmentOverrides=t.getActiveEnvironmentOverride=void 0;const i=r(257),o=r(818),s=r(463),n=r(30),a=r(570);t.getActiveEnvironmentOverride=e=>(0,t.getAllEnvironmentOverrides)(e)[0]||void 0,t.getAllEnvironmentOverrides=e=>[{source:"queryParam",environment:(0,n.parseQueryString)(e.location.search).get(a.QueryParameters.moliEnv)},{source:"sessionStorage",environment:(0,s.getBrowserStorageValue)(o.BrowserStorageKeys.moliEnv,e.sessionStorage)},{source:"localStorage",environment:(0,s.getBrowserStorageValue)(o.BrowserStorageKeys.moliEnv,e.localStorage)}].map((({source:e,environment:t})=>t&&(e=>!!["production","test"].find((t=>t===e)))(t)?{source:e,environment:t}:void 0)).filter(i.isNotNull),t.setEnvironmentOverrideInStorage=(e,t)=>(0,s.setBrowserStorageValue)(o.BrowserStorageKeys.moliEnv,e,t),t.resetEnvironmentOverrides=e=>{(0,s.removeBrowserStorageValue)(o.BrowserStorageKeys.moliEnv,e.sessionStorage),(0,s.removeBrowserStorageValue)(o.BrowserStorageKeys.moliEnv,e.localStorage),e.location.replace((0,n.updateQueryString)(a.QueryParameters.moliEnv,void 0))}},329:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractAdTagVersion=void 0,t.extractAdTagVersion=({currentVersion:e})=>{try{switch(typeof e){case"number":return e.toFixed();case"string":const t=Number(e);return Number.isNaN(t)?void 0:t.toFixed();default:return}}catch(e){return}}},676:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractTopPrivateDomainFromHostname=void 0,t.extractTopPrivateDomainFromHostname=e=>{if(e){const[t,r,i]=e.split(".").reverse();switch(`${r}.${t}`){case"co.uk":case"com.br":case"com.mx":case"com.au":return`${i}.${r}.${t}`;default:return r?`${r}.${t}`:t}}}},463:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeBrowserStorageValue=t.setBrowserStorageValue=t.getBrowserStorageValue=void 0;const i=r(611);t.getBrowserStorageValue=(e,t=localStorage)=>{try{return t.getItem(e)}catch(r){return(0,i.getDefaultLogger)().debug(`Could not read value with key ${e} from browser storage`,t),null}},t.setBrowserStorageValue=(e,t,r=localStorage)=>{try{r.setItem(e,t)}catch(o){(0,i.getDefaultLogger)().debug(`Could not set key ${e} with value ${t} to browser storage`,r)}},t.removeBrowserStorageValue=(e,t=localStorage)=>{try{t.removeItem(e)}catch(r){(0,i.getDefaultLogger)().debug(`Could not remove key ${e} from browser storage`,t)}}},611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyLogger=t.getLogger=t.getDefaultLogger=t.getMoliDebugParameter=void 0;const i=r(30);function o(e){try{const t="moliDebug";return!!(0,i.parseQueryString)(e.location.search).get(t)||!!e.sessionStorage.getItem(t)||!!e.localStorage.getItem(t)}catch(e){return!1}}function s(e){return`background:${e}; color:#FFF; padding:3px; margin:3px; border-radius:5px; line-height: 15px;`}function n(e){switch(e){case"debug":return s("#49A0CC");case"info":return s("#61A172");case"warn":return s("#FFC300");case"error":return s("#C70039")}}function a(e){switch(e){case"AdPipeline":return s("#74ABC6");case"GAM":return s("#BA0E5F");case"Faktor CMP":return s("#9374C6");case"MoliGlobal":return s("#403073");case"Prebid":return s("#4357AD");case"AdVisibilityService":return s("#d5ba3c");case"UserActivityService":return s("#19ad0e");case"Adex DMP":return s("#003E74");default:return s("#052E53")}}function d(){return{debug(e,t,...r){console.debug(`%c[DEBUG]%c${e}%c${t}`,n("debug"),a(e),"",...r)},info(e,t,...r){console.info(`%c[INFO]%c${e}%c${t}`,n("info"),a(e),"",...r)},warn(e,t,...r){console.warn(`%c[WARN]%c${e}%c${t}`,n("warn"),a(e),"",...r)},error(e,t,...r){console.error(`%c[ERROR]%c${e}%c${t}`,n("error"),a(e),"",...r)}}}t.getMoliDebugParameter=o,t.getDefaultLogger=d,t.getLogger=function(e,t){return o(t)?d():e&&e.logger?e.logger:function(){const e=()=>{};return{debug:e,info:e,warn:e,error:console.error}}()},t.ProxyLogger=class{constructor(e){this.logger=e,this.setLogger=e=>{this.logger=e}}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}}},713:(e,t)=>{function r(e){return"[object Object]"===toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.mergeDeep=t.isPlainObject=void 0,t.isPlainObject=r,t.mergeDeep=function e(t,...i){if(!i.length)return t;const o=i.shift();if(r(t)&&r(o))for(const i in o)r(o[i])?(t[i]||Object.assign(t,{[i]:{}}),e(t[i],o[i])):Array.isArray(o[i])?t[i]?Array.isArray(t[i])&&(t[i]=t[i].concat(o[i])):Object.assign(t,{[i]:o[i]}):Object.assign(t,{[i]:o[i]});return e(t,...i)}},465:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPerformanceService=void 0;class r{mark(e){performance.mark(e)}measure(e,t,r){this.getMark(r)||performance.mark(r),performance.measure(e,t,r)}getMeasure(e){return performance.getEntriesByName(e,"measure")[0]}getMark(e){return performance.getEntriesByName(e,"mark")[0]}}class i{mark(e){}measure(e,t,r){}getMeasure(e){}getMark(e){}}t.createPerformanceService=e=>e&&"performance"in e&&"mark"in e.performance&&"measure"in e.performance&&"getEntriesByName"in e.performance?new r:new i},30:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateQueryString=t.parseQueryString=void 0;const r=e=>{const t=e.indexOf("=");return t>=0?[decodeURIComponent(e.slice(0,t)),decodeURIComponent(e.slice(t+1))]:[decodeURIComponent(e),""]};t.parseQueryString=e=>{try{const t=e.startsWith("?")?e.slice(1):e;return t.length>0?new Map(t.split("&").filter((e=>e.length>0)).map(r)):new Map}catch(e){return console.error(e),new Map}},t.updateQueryString=(e,r,i,o)=>{i=i||[location.protocol,"//",location.host,location.pathname].join(""),o=o||window.location.search;const s=Array.from((0,t.parseQueryString)(o).set(e,r||"").entries()).filter((e=>""!==e[1])).map((([e,t])=>`${e}=${t}`)).join("&");return[i,s?"?":"",s].join("")}},570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryParameters=void 0,t.QueryParameters={moliEnv:"moliEnv"}},382:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveStoredRequestIdInOrtb2Object=void 0,t.resolveStoredRequestIdInOrtb2Object=(e,t)=>({...e,ext:{...e.ext,prebid:{...e.ext?.prebid,storedrequest:t}}})},255:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSizeEqual=void 0,t.isSizeEqual=(e,t)=>e[0]===t[0]&&e[1]===t[1]},249:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeTestSlotSizeFromLocalStorage=t.createTestSlots=void 0;const i=r(793),o=r(257),s=r(818),n=r(463),a=e=>`${e}__container`;t.createTestSlots=(e,t)=>{const r=d(e,t);return r.forEach((({slot:e,container:t})=>{t.innerHTML="",t.appendChild(c(e))})),r},t.removeTestSlotSizeFromLocalStorage=e=>(0,n.removeBrowserStorageValue)(s.BrowserStorageKeys.testSlotSize(e.domId));const d=(e,t)=>(t.forEach((t=>{const{moliSlot:r}=t,i=a(r.domId),o=document.createElement("div");o.id=i;const s=document.getElementById(r.domId);s&&s.setAttribute("data-google-query-id","test"),((e,t)=>{const r=document.getElementById(e);r&&(r.innerHTML=t)})(r.domId,o.outerHTML),e.logger.debug("GAM",`Set content for slot: [DomID] ${r.domId} [AdUnitPath] ${r.adUnitPath}`)})),l(t)),l=e=>e.map((e=>{const t=document.getElementById(a(e.moliSlot.domId));return t?{slot:e,container:t}:void 0})).filter(o.isNotNull),c=e=>{const t=g(e),r=u(e.moliSlot,t);if("hidden"===r)return document.createElement("div");{const i=document.createElement("div"),[o,s]=r;i.style.cssText=`\n      position: relative; display: inline-flex; flex-direction: column; align-items: center; justify-content: center;\n      width: ${o}px; height: ${s}px; padding: 6px; border: 2px dotted gray; background-color: #fff;\n      background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);\n      background-size: 100% 1.2em; box-sizing: border-box;\n    `;const n=document.createElement("h4");n.innerHTML=`<strong>${e.moliSlot.domId}</strong>`,i.appendChild(n);const a=document.createElement("span");a.style.color="#656565";const d=([e,t])=>a.innerText=`(${e}x${t})`;d([o,s]),n.appendChild(a);const l=document.createElement("div");l.style.cssText="position: absolute; top: 5px; left: 5px",i.appendChild(l);const c=(t,r)=>{if("hidden"===t)i.style.display="none";else{const[e,o]=t;i.style.width=`${e}px`,i.style.height=`${o}px`,d(t),b(r)}p(e.moliSlot,t)},g="1px dotted white",u="1px solid black",f=document.createElement("button");f.innerText="hide",f.title="Once hidden, it can only be restored using the moli console (or by clearing local storage manually)",f.style.cssText=`font-size: 10px; background: #656565; color: white; width: auto important!; border: ${g};`,f.addEventListener("click",(()=>c("hidden",f)));const m=[...t.map((e=>{const[t,i]=e,o=h(r,e),s=document.createElement("button");return s.innerText=`${t}x${i}`,s.style.cssText=`font-size: 10px; background: #00a4a6; color: white; width: auto important!; border: ${o?u:g};`,s.addEventListener("click",(()=>c(e,s))),s})),f];m.forEach((e=>l.appendChild(e)));const b=e=>{m.forEach((e=>e.style.border=g)),e.style.border=u};return i}},g=e=>e.filterSupportedSizes(e.moliSlot.sizes).filter(i.SizeConfigService.isFixedSize).filter((([e,t])=>e>1&&t>1)),u=(e,t)=>{const r=f(e);if(r&&("hidden"===r||m(t,r)))return r;{const e=Math.floor(Math.random()*t.length);return 0===t.length?[300,250]:t[e]}},p=(e,t)=>(0,n.setBrowserStorageValue)(s.BrowserStorageKeys.testSlotSize(e.domId),JSON.stringify(t)),f=e=>{const t=(0,n.getBrowserStorageValue)(s.BrowserStorageKeys.testSlotSize(e.domId));if(t)try{const e=JSON.parse(t);return(e=>"hidden"===e||Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])(e)?e:void 0}catch{return}},h=(e,t)=>{const[r,i]=e,[o,s]=t;return r===o&&i===s},m=(e,t)=>e.some((e=>h(e,t)))}},t={};(0,function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}(885).initAdTag)(window)})();