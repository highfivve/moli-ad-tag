"use strict";(self.webpackChunkthe_publisher_ad_tag=self.webpackChunkthe_publisher_ad_tag||[]).push([[6437],{22586:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>c});var s=n(85893),t=n(11151);const d={id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},a=void 0,l={id:"api/namespaces/Moli.state",title:"Namespace: state",description:"Moli.state",source:"@site/docs/api/namespaces/Moli.state.md",sourceDirName:"api/namespaces",slug:"/api/namespaces/Moli.state",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.state",draft:!1,unlisted:!1,editUrl:null,tags:[],version:"current",frontMatter:{id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},sidebar:"API",previous:{title:"schain",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.schain"},next:{title:"yield_optimization",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.yield_optimization"}},r={},c=[{value:"State transitions",id:"state-transitions",level:2},{value:"Configurable state",id:"configurable-state",level:3},{value:"Configured state",id:"configured-state",level:3},{value:"RequestAds state",id:"requestads-state",level:3},{value:"Single Page App state",id:"single-page-app-state",level:3},{value:"Integration",id:"integration",level:4},{value:"Finished state",id:"finished-state",level:3},{value:"Error state",id:"error-state",level:3},{value:"Interfaces",id:"interfaces",level:2},{value:"Type Aliases",id:"type-aliases",level:2},{value:"AfterRequestAdsStates",id:"afterrequestadsstates",level:3},{value:"BeforeRequestAdsHook",id:"beforerequestadshook",level:3},{value:"Type declaration",id:"type-declaration",level:4},{value:"Parameters",id:"parameters",level:5},{value:"Returns",id:"returns",level:5},{value:"IRefreshInfiniteSlot",id:"irefreshinfiniteslot",level:3},{value:"Type declaration",id:"type-declaration-1",level:4},{value:"IStateMachine",id:"istatemachine",level:3},{value:"States",id:"states",level:3}];function o(e){const i={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/namespaces/Moli",children:"Moli"}),".state"]}),"\n",(0,s.jsx)(i.h2,{id:"state-transitions",children:"State transitions"}),"\n",(0,s.jsx)(i.p,{children:"The state machine is defined as:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"                                                                                  setXYZ / addXYZ\n                                                                                  requestAds()\n\n                                                                                  +----------+\n                                                                                  |          |\n                                                                                  |          |\n                                                                                  |          v\n                                                                                  |\n                                        +------------+     requestAds()     +-----+-------------------------+\n                                        |            |                      |                               |\n                                        | configured |  +----------------\x3e  | Single Page App               |\n                                        |            |                      | spa-requestAds / spa-finished |\n                                        +------------+                      +-------------------------------+\n\n                                              ^\n                                              |\n                                              |  enableSinglePageApp()\n                                              |                                        ads ok        +----------+\n                                              |                                                      |          |\n                                              |                                     +------------\x3e   | finished |\n                                              +                                     |                |          |\n                                                                                    |                +----------+\n+--------------+    configure(config)   +------------+      requestAds()     +------+-----+\n|              |                        |            |                       |            |\n| configurable |  +-------------------\x3e | configured |  +-----------------\x3e  | requestAds |\n|              |                        |            |                       |            |\n+--------------+                        +------------+                       +------+-----+\n                                                                                    |                +----------+\n  +         ^                            +         ^                                |                |          |\n  |         |                            |         |                                +-------------\x3e  | error    |\n  +  setXYZ +                            +  setXYZ +                                                 |          |\n     addXYZ                                 addXYZ                                     ads not ok    +----------+\n\n"})}),"\n",(0,s.jsx)(i.p,{children:"Each state has allowed operations and transitions"}),"\n",(0,s.jsx)(i.h3,{id:"configurable-state",children:"Configurable state"}),"\n",(0,s.jsxs)(i.p,{children:["In this state the ad tag can be customized. All ",(0,s.jsx)(i.code,{children:"getXYZ"})," and ",(0,s.jsx)(i.code,{children:"addXYZ"})," methods\ncan be called."]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"addXYZ"})," - with transition ",(0,s.jsx)(i.code,{children:"configurable -> configurable"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"setXYZ"})," - with transition ",(0,s.jsx)(i.code,{children:"configurable -> configurable"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"configure"})," - with transition ",(0,s.jsx)(i.code,{children:"configurable ->  configured"}),"\nSets the main configuration. Changes can still be made."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"requestAds"})," - with transition ",(0,s.jsx)(i.code,{children:"configurable -> configurable"}),"\nAfter ",(0,s.jsx)(i.code,{children:"moli.configure"})," has been called, ads will be requested immediately."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"configured-state",children:"Configured state"}),"\n",(0,s.jsxs)(i.p,{children:["The main ad configuration has been set. ",(0,s.jsx)(i.code,{children:"moli.getConfig"})," now returns the current\nconfiguration."]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"addXYZ"})," - with transition ",(0,s.jsx)(i.code,{children:"configured -> configured"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"setXYZ"})," - with transition ",(0,s.jsx)(i.code,{children:"configured -> configured"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"requestAds"})," - with transition ",(0,s.jsx)(i.code,{children:"configured -> requestAds"}),".\nNo changes are allowed anymore"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"requestads-state",children:"RequestAds state"}),"\n",(0,s.jsxs)(i.p,{children:["No changes are allowed anymore. The configuration is frozen. All ",(0,s.jsx)(i.code,{children:"addXYZ"})," and ",(0,s.jsx)(i.code,{children:"setXYZ"}),"\ncalls will fail."]}),"\n",(0,s.jsx)(i.p,{children:"Two state transitions will happen:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["After all ads have been loaded successfully: ",(0,s.jsx)(i.code,{children:"requestAds -> finished"})]}),"\n",(0,s.jsxs)(i.li,{children:["After an error during ad loading: ",(0,s.jsx)(i.code,{children:"requestAds -> error"})]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"single-page-app-state",children:"Single Page App state"}),"\n",(0,s.jsxs)(i.p,{children:["In this state the ad tag allows to call ",(0,s.jsx)(i.code,{children:"requestAds()"})," multiple times. The ad tag state will\nremain ",(0,s.jsx)(i.code,{children:"spa"})," if there are no errors. Note that ",(0,s.jsx)(i.code,{children:"requestAds()"})," call is only allowed if the\n",(0,s.jsx)(i.code,{children:"window.location.href"})," has changed. This is a safety guard against unwanted ad fraud behaviour."]}),"\n",(0,s.jsx)(i.p,{children:"KeyValues and Labels are handled depending on their source:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"keyValues and labels from the static configuration shipped with the ad tag persist."}),"\n",(0,s.jsxs)(i.li,{children:["keyValues and labels configured via ",(0,s.jsx)(i.code,{children:"setTargeting(...)"})," and ",(0,s.jsx)(i.code,{children:"addLabel(...)"})," are only valid\nfor the next ",(0,s.jsx)(i.code,{children:"requestAds()"})," call and will be cleaned afterwards."]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["Supported loading behaviours is ",(0,s.jsx)(i.code,{children:"eager"}),"."]}),"\n",(0,s.jsx)(i.h4,{id:"integration",children:"Integration"}),"\n",(0,s.jsxs)(i.p,{children:["Single page applications are quite more complex than purely server-side-rendered websites. We have\na set of APIs at our disposal to deal with that.\n*\nSlots that are ",(0,s.jsx)(i.strong,{children:"server-side rendered"})," and never removed. Examples for this there are header area slots\nthat are part of the generic page layout that does not change on any page.\n",(0,s.jsx)(i.em,{children:"Configuration:"})," Use the ",(0,s.jsx)(i.code,{children:"eager"})," loading behaviour."]}),"\n",(0,s.jsx)(i.p,{children:"Eager slots (configuration 1) don't need any special handling as the DOM element is present when the\nsite is being delivered and everything works as if it weren't a single page app."}),"\n",(0,s.jsx)(i.h3,{id:"finished-state",children:"Finished state"}),"\n",(0,s.jsx)(i.p,{children:"All ads have been successfully loaded."}),"\n",(0,s.jsx)(i.h3,{id:"error-state",children:"Error state"}),"\n",(0,s.jsx)(i.p,{children:"An error occurred while were being loaded."}),"\n",(0,s.jsx)(i.h2,{id:"interfaces",children:"Interfaces"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigurable",children:"IConfigurable"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigured",children:"IConfigured"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IError",children:"IError"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IFinished",children:"IFinished"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IHooks",children:"IHooks"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IRequestAds",children:"IRequestAds"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.ISinglePageApp",children:"ISinglePageApp"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IState",children:"IState"})}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"type-aliases",children:"Type Aliases"}),"\n",(0,s.jsx)(i.h3,{id:"afterrequestadsstates",children:"AfterRequestAdsStates"}),"\n",(0,s.jsxs)(i.p,{children:["\u01ac ",(0,s.jsx)(i.strong,{children:"AfterRequestAdsStates"}),": ",(0,s.jsx)(i.code,{children:"Extract"}),"<",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/namespaces/Moli.state#states",children:(0,s.jsx)(i.code,{children:"States"})}),", ",(0,s.jsx)(i.code,{children:'"finished"'})," | ",(0,s.jsx)(i.code,{children:'"error"'})," | ",(0,s.jsx)(i.code,{children:'"spa-finished"'}),">"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h3,{id:"beforerequestadshook",children:"BeforeRequestAdsHook"}),"\n",(0,s.jsxs)(i.p,{children:["\u01ac ",(0,s.jsx)(i.strong,{children:"BeforeRequestAdsHook"}),": (",(0,s.jsx)(i.code,{children:"config"}),": ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.MoliConfig",children:(0,s.jsx)(i.code,{children:"MoliConfig"})}),") => ",(0,s.jsx)(i.code,{children:"void"})]}),"\n",(0,s.jsx)(i.p,{children:"Callback function executed before ads are being requested.\nDOM is ready at this point."}),"\n",(0,s.jsx)(i.h4,{id:"type-declaration",children:"Type declaration"}),"\n",(0,s.jsxs)(i.p,{children:["\u25b8 (",(0,s.jsx)(i.code,{children:"config"}),"): ",(0,s.jsx)(i.code,{children:"void"})]}),"\n",(0,s.jsx)(i.h5,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{style:{textAlign:"left"},children:"Name"}),(0,s.jsx)(i.th,{style:{textAlign:"left"},children:"Type"})]})}),(0,s.jsx)(i.tbody,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.code,{children:"config"})}),(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.MoliConfig",children:(0,s.jsx)(i.code,{children:"MoliConfig"})})})]})})]}),"\n",(0,s.jsx)(i.h5,{id:"returns",children:"Returns"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.code,{children:"void"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h3,{id:"irefreshinfiniteslot",children:"IRefreshInfiniteSlot"}),"\n",(0,s.jsxs)(i.p,{children:["\u01ac ",(0,s.jsx)(i.strong,{children:"IRefreshInfiniteSlot"}),": ",(0,s.jsx)(i.code,{children:"Object"})]}),"\n",(0,s.jsxs)(i.p,{children:["Models ",(0,s.jsx)(i.code,{children:"refreshInifiniteAdSlot"})," calls before ads are being requested"]}),"\n",(0,s.jsx)(i.h4,{id:"type-declaration-1",children:"Type declaration"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{style:{textAlign:"left"},children:"Name"}),(0,s.jsx)(i.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(i.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.code,{children:"artificialDomId"})}),(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.code,{children:"string"})}),(0,s.jsx)(i.td,{style:{textAlign:"left"},children:"the newly created domID by the infinite slot loading behaviour. This ID can be used to reference the ad slot in the config in the ad pipeline context config."})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.code,{children:"idOfConfiguredSlot"})}),(0,s.jsx)(i.td,{style:{textAlign:"left"},children:(0,s.jsx)(i.code,{children:"string"})}),(0,s.jsx)(i.td,{style:{textAlign:"left"},children:"the domID that references the slot configuration in the original config."})]})]})]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h3,{id:"istatemachine",children:"IStateMachine"}),"\n",(0,s.jsxs)(i.p,{children:["\u01ac ",(0,s.jsx)(i.strong,{children:"IStateMachine"}),": ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigurable",children:(0,s.jsx)(i.code,{children:"IConfigurable"})})," | ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigured",children:(0,s.jsx)(i.code,{children:"IConfigured"})})," | ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.ISinglePageApp",children:(0,s.jsx)(i.code,{children:"ISinglePageApp"})})," | ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IRequestAds",children:(0,s.jsx)(i.code,{children:"IRequestAds"})})," | ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IFinished",children:(0,s.jsx)(i.code,{children:"IFinished"})})," | ",(0,s.jsx)(i.a,{href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IError",children:(0,s.jsx)(i.code,{children:"IError"})})]}),"\n",(0,s.jsx)(i.p,{children:"All valid states"}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h3,{id:"states",children:"States"}),"\n",(0,s.jsxs)(i.p,{children:["\u01ac ",(0,s.jsx)(i.strong,{children:"States"}),": ",(0,s.jsx)(i.code,{children:'"configurable"'})," | ",(0,s.jsx)(i.code,{children:'"configured"'})," | ",(0,s.jsx)(i.code,{children:'"spa-finished"'})," | ",(0,s.jsx)(i.code,{children:'"spa-requestAds"'})," | ",(0,s.jsx)(i.code,{children:'"requestAds"'})," | ",(0,s.jsx)(i.code,{children:'"finished"'})," | ",(0,s.jsx)(i.code,{children:'"error"'})]})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>l,a:()=>a});var s=n(67294);const t={},d=s.createContext(t);function a(e){const i=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(d.Provider,{value:i},e.children)}}}]);