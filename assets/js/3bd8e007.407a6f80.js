"use strict";(self.webpackChunkthe_publisher_ad_tag=self.webpackChunkthe_publisher_ad_tag||[]).push([[37204],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var i=s(96540);const a={},t=i.createContext(a);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},31795:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/index","title":"state","description":"State transitions","source":"@site/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/index.md","sourceDirName":"api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state","slug":"/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/","permalink":"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/","draft":false,"unlisted":false,"editUrl":"https://github.com/highfivve/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"API","previous":{"title":"Type Alias: PrebidListenerProvider","permalink":"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/headerbidding/type-aliases/PrebidListenerProvider"},"next":{"title":"Interface: IConfigurable","permalink":"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IConfigurable"}}');var a=s(74848),t=s(28453);const l={},r="state",d={},o=[{value:"State transitions",id:"state-transitions",level:2},{value:"Configurable state",id:"configurable-state",level:3},{value:"Configured state",id:"configured-state",level:3},{value:"RequestAds state",id:"requestads-state",level:3},{value:"Single Page App state",id:"single-page-app-state",level:3},{value:"Integration",id:"integration",level:4},{value:"Finished state",id:"finished-state",level:3},{value:"Error state",id:"error-state",level:3},{value:"Index",id:"index",level:2},{value:"Interfaces",id:"interfaces",level:3},{value:"Type Aliases",id:"type-aliases",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"state",children:"state"})}),"\n",(0,a.jsx)(n.h2,{id:"state-transitions",children:"State transitions"}),"\n",(0,a.jsx)(n.p,{children:"The state machine is defined as:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"                                                                                  setXYZ / addXYZ\n                                                                                  requestAds()\n\n                                                                                  +----------+\n                                                                                  |          |\n                                                                                  |          |\n                                                                                  |          v\n                                                                                  |\n                                        +------------+     requestAds()     +-----+-------------------------+\n                                        |            |                      |                               |\n                                        | configured |  +----------------\x3e  | Single Page App               |\n                                        |            |                      | spa-requestAds / spa-finished |\n                                        +------------+                      +-------------------------------+\n\n                                              ^\n                                              |\n                                              |  enableSinglePageApp()\n                                              |                                        ads ok        +----------+\n                                              |                                                      |          |\n                                              |                                     +------------\x3e   | finished |\n                                              +                                     |                |          |\n                                                                                    |                +----------+\n+--------------+    configure(config)   +------------+      requestAds()     +------+-----+\n|              |                        |            |                       |            |\n| configurable |  +-------------------\x3e | configured |  +-----------------\x3e  | requestAds |\n|              |                        |            |                       |            |\n+--------------+                        +------------+                       +------+-----+\n                                                                                    |                +----------+\n  +         ^                            +         ^                                |                |          |\n  |         |                            |         |                                +-------------\x3e  | error    |\n  +  setXYZ +                            +  setXYZ +                                                 |          |\n     addXYZ                                 addXYZ                                     ads not ok    +----------+\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Each state has allowed operations and transitions"}),"\n",(0,a.jsx)(n.h3,{id:"configurable-state",children:"Configurable state"}),"\n",(0,a.jsxs)(n.p,{children:["In this state the ad tag can be customized. All ",(0,a.jsx)(n.code,{children:"getXYZ"})," and ",(0,a.jsx)(n.code,{children:"addXYZ"})," methods\ncan be called."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"addXYZ"})," - with transition ",(0,a.jsx)(n.code,{children:"configurable -> configurable"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"setXYZ"})," - with transition ",(0,a.jsx)(n.code,{children:"configurable -> configurable"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"configure"})," - with transition ",(0,a.jsx)(n.code,{children:"configurable ->  configured"}),"\nSets the main configuration. Changes can still be made."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"requestAds"})," - with transition ",(0,a.jsx)(n.code,{children:"configurable -> configurable"}),"\nAfter ",(0,a.jsx)(n.code,{children:"moli.configure"})," has been called, ads will be requested immediately."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"configured-state",children:"Configured state"}),"\n",(0,a.jsxs)(n.p,{children:["The main ad configuration has been set. ",(0,a.jsx)(n.code,{children:"moli.getConfig"})," now returns the current\nconfiguration."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"addXYZ"})," - with transition ",(0,a.jsx)(n.code,{children:"configured -> configured"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"setXYZ"})," - with transition ",(0,a.jsx)(n.code,{children:"configured -> configured"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"requestAds"})," - with transition ",(0,a.jsx)(n.code,{children:"configured -> requestAds"}),".\nNo changes are allowed anymore"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"requestads-state",children:"RequestAds state"}),"\n",(0,a.jsxs)(n.p,{children:["No changes are allowed anymore. The configuration is frozen. All ",(0,a.jsx)(n.code,{children:"addXYZ"})," and ",(0,a.jsx)(n.code,{children:"setXYZ"}),"\ncalls will fail."]}),"\n",(0,a.jsx)(n.p,{children:"Two state transitions will happen:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["After all ads have been loaded successfully: ",(0,a.jsx)(n.code,{children:"requestAds -> finished"})]}),"\n",(0,a.jsxs)(n.li,{children:["After an error during ad loading: ",(0,a.jsx)(n.code,{children:"requestAds -> error"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"single-page-app-state",children:"Single Page App state"}),"\n",(0,a.jsxs)(n.p,{children:["In this state the ad tag allows to call ",(0,a.jsx)(n.code,{children:"requestAds()"})," multiple times. The ad tag state will\nremain ",(0,a.jsx)(n.code,{children:"spa"})," if there are no errors. Note that ",(0,a.jsx)(n.code,{children:"requestAds()"})," call is only allowed if the\n",(0,a.jsx)(n.code,{children:"window.location.href"})," has changed. This is a safety guard against unwanted ad fraud behaviour."]}),"\n",(0,a.jsx)(n.p,{children:"KeyValues and Labels are handled depending on their source:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"keyValues and labels from the static configuration shipped with the ad tag persist."}),"\n",(0,a.jsxs)(n.li,{children:["keyValues and labels configured via ",(0,a.jsx)(n.code,{children:"setTargeting(...)"})," and ",(0,a.jsx)(n.code,{children:"addLabel(...)"})," are only valid\nfor the next ",(0,a.jsx)(n.code,{children:"requestAds()"})," call and will be cleaned afterwards."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Supported loading behaviours is ",(0,a.jsx)(n.code,{children:"eager"}),"."]}),"\n",(0,a.jsx)(n.h4,{id:"integration",children:"Integration"}),"\n",(0,a.jsxs)(n.p,{children:["Single page applications are quite more complex than purely server-side-rendered websites. We have\na set of APIs at our disposal to deal with that.\n*\nSlots that are ",(0,a.jsx)(n.strong,{children:"server-side rendered"})," and never removed. Examples for this there are header area slots\nthat are part of the generic page layout that does not change on any page.\n",(0,a.jsx)(n.em,{children:"Configuration:"})," Use the ",(0,a.jsx)(n.code,{children:"eager"})," loading behaviour."]}),"\n",(0,a.jsx)(n.p,{children:"Eager slots (configuration 1) don't need any special handling as the DOM element is present when the\nsite is being delivered and everything works as if it weren't a single page app."}),"\n",(0,a.jsx)(n.h3,{id:"finished-state",children:"Finished state"}),"\n",(0,a.jsx)(n.p,{children:"All ads have been successfully loaded."}),"\n",(0,a.jsx)(n.h3,{id:"error-state",children:"Error state"}),"\n",(0,a.jsx)(n.p,{children:"An error occurred while were being loaded."}),"\n",(0,a.jsx)(n.h2,{id:"index",children:"Index"}),"\n",(0,a.jsx)(n.h3,{id:"interfaces",children:"Interfaces"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IConfigurable",children:"IConfigurable"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IConfigured",children:"IConfigured"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IError",children:"IError"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IFinished",children:"IFinished"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IHooks",children:"IHooks"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IRequestAds",children:"IRequestAds"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/ISinglePageApp",children:"ISinglePageApp"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/interfaces/IState",children:"IState"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"type-aliases",children:"Type Aliases"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/type-aliases/AfterRequestAdsStates",children:"AfterRequestAdsStates"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/type-aliases/BeforeRequestAdsHook",children:"BeforeRequestAdsHook"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/type-aliases/IStateMachine",children:"IStateMachine"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/moli-ad-tag/docs/api/types/moliRuntime/namespaces/MoliRuntime/namespaces/state/type-aliases/States",children:"States"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);