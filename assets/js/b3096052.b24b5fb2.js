"use strict";(self.webpackChunkthe_publisher_ad_tag=self.webpackChunkthe_publisher_ad_tag||[]).push([[6437],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>c});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=d(a),c=i,f=m["".concat(s,".").concat(c)]||m[c]||u[c]||r;return a?n.createElement(f,l(l({ref:t},p),{},{components:a})):n.createElement(f,l({ref:t},p))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var d=2;d<r;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6591:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=a(7462),i=(a(7294),a(3905));const r={id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},l=void 0,o={unversionedId:"api/namespaces/Moli.state",id:"api/namespaces/Moli.state",title:"Namespace: state",description:"Moli.state",source:"@site/docs/api/namespaces/Moli.state.md",sourceDirName:"api/namespaces",slug:"/api/namespaces/Moli.state",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.state",draft:!1,editUrl:null,tags:[],version:"current",frontMatter:{id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},sidebar:"API",previous:{title:"schain",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.schain"},next:{title:"yield_optimization",permalink:"/moli-ad-tag/docs/api/namespaces/Moli.yield_optimization"}},s={},d=[{value:"State transitions",id:"state-transitions",level:2},{value:"Configurable state",id:"configurable-state",level:3},{value:"Configured state",id:"configured-state",level:3},{value:"RequestAds state",id:"requestads-state",level:3},{value:"Single Page App state",id:"single-page-app-state",level:3},{value:"Integration",id:"integration",level:4},{value:"Finished state",id:"finished-state",level:3},{value:"Error state",id:"error-state",level:3},{value:"Interfaces",id:"interfaces",level:2},{value:"Type Aliases",id:"type-aliases",level:2},{value:"AfterRequestAdsStates",id:"afterrequestadsstates",level:3},{value:"BeforeRequestAdsHook",id:"beforerequestadshook",level:3},{value:"Type declaration",id:"type-declaration",level:4},{value:"Parameters",id:"parameters",level:5},{value:"Returns",id:"returns",level:5},{value:"IRefreshInfiniteSlot",id:"irefreshinfiniteslot",level:3},{value:"Type declaration",id:"type-declaration-1",level:4},{value:"IStateMachine",id:"istatemachine",level:3},{value:"States",id:"states",level:3}],p={toc:d};function u(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/namespaces/Moli"},"Moli"),".state"),(0,i.kt)("h2",{id:"state-transitions"},"State transitions"),(0,i.kt)("p",null,"The state machine is defined as:"),(0,i.kt)("pre",{style:"font-size:10px;"},"setXYZ / addXYZ requestAds() +----------+ |          | |          | |          v | +------------+     requestAds()     +-----+-------------------------+ |            |                      |                               | | configured |  +----------------\x3e  | Single Page App               | |            |                      | spa-requestAds / spa-finished | +------------+                      +-------------------------------+ ^ | |  enableSinglePageApp() |                                        ads ok        +----------+ |                                                      |          | |                                     +------------\x3e   | finished | +                                     |                |          | |                +----------+ +--------------+    configure(config)   +------------+      requestAds()     +------+-----+ |              |                        |            |                       |            | | configurable |  +-------------------\x3e | configured |  +-----------------\x3e  | requestAds | |              |                        |            |                       |            | +--------------+                        +------------+                       +------+-----+ |                +----------+ +         ^                            +         ^                                |                |          | |         |                            |         |                                +-------------\x3e  | error    | +  setXYZ +                            +  setXYZ +                                                 |          | addXYZ                                 addXYZ                                     ads not ok    +----------+"),(0,i.kt)("p",null,"Each state has allowed operations and transitions"),(0,i.kt)("h3",{id:"configurable-state"},"Configurable state"),(0,i.kt)("p",null,"In this state the ad tag can be customized. All ",(0,i.kt)("inlineCode",{parentName:"p"},"getXYZ")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"addXYZ")," methods\ncan be called."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"addXYZ")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configurable -> configurable")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setXYZ")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configurable -> configurable")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"configure")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configurable ->  configured"),"\nSets the main configuration. Changes can still be made."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"requestAds")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configurable -> configurable"),"\nAfter ",(0,i.kt)("inlineCode",{parentName:"li"},"moli.configure")," has been called, ads will be requested immediately.")),(0,i.kt)("h3",{id:"configured-state"},"Configured state"),(0,i.kt)("p",null,"The main ad configuration has been set. ",(0,i.kt)("inlineCode",{parentName:"p"},"moli.getConfig")," now returns the current\nconfiguration."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"addXYZ")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configured -> configured")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setXYZ")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configured -> configured")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"requestAds")," - with transition ",(0,i.kt)("inlineCode",{parentName:"li"},"configured -> requestAds"),".\nNo changes are allowed anymore")),(0,i.kt)("h3",{id:"requestads-state"},"RequestAds state"),(0,i.kt)("p",null,"No changes are allowed anymore. The configuration is frozen. All ",(0,i.kt)("inlineCode",{parentName:"p"},"addXYZ")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"setXYZ"),"\ncalls will fail."),(0,i.kt)("p",null,"Two state transitions will happen:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"After all ads have been loaded successfully: ",(0,i.kt)("inlineCode",{parentName:"li"},"requestAds -> finished")),(0,i.kt)("li",{parentName:"ol"},"After an error during ad loading: ",(0,i.kt)("inlineCode",{parentName:"li"},"requestAds -> error"))),(0,i.kt)("h3",{id:"single-page-app-state"},"Single Page App state"),(0,i.kt)("p",null,"In this state the ad tag allows to call ",(0,i.kt)("inlineCode",{parentName:"p"},"requestAds()")," multiple times. The ad tag state will\nremain ",(0,i.kt)("inlineCode",{parentName:"p"},"spa")," if there are no errors. Note that ",(0,i.kt)("inlineCode",{parentName:"p"},"requestAds()")," call is only allowed if the\n",(0,i.kt)("inlineCode",{parentName:"p"},"window.location.href")," has changed. This is a safety guard against unwanted ad fraud behaviour."),(0,i.kt)("p",null,"KeyValues and Labels are handled depending on their source:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"keyValues and labels from the static configuration shipped with the ad tag persist."),(0,i.kt)("li",{parentName:"ul"},"keyValues and labels configured via ",(0,i.kt)("inlineCode",{parentName:"li"},"setTargeting(...)")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"addLabel(...)")," are only valid\nfor the next ",(0,i.kt)("inlineCode",{parentName:"li"},"requestAds()")," call and will be cleaned afterwards.")),(0,i.kt)("p",null,"Supported loading behaviours is ",(0,i.kt)("inlineCode",{parentName:"p"},"eager"),"."),(0,i.kt)("h4",{id:"integration"},"Integration"),(0,i.kt)("p",null,"Single page applications are quite more complex than purely server-side-rendered websites. We have\na set of APIs at our disposal to deal with that."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Slots that are ",(0,i.kt)("strong",{parentName:"li"},"server-side rendered")," and never removed. Examples for this there are header area slots\nthat are part of the generic page layout that does not change on any page.\n",(0,i.kt)("em",{parentName:"li"},"Configuration:")," Use the ",(0,i.kt)("inlineCode",{parentName:"li"},"eager")," loading behaviour.")),(0,i.kt)("p",null,"Eager slots (configuration 1) don't need any special handling as the DOM element is present when the\nsite is being delivered and everything works as if it weren't a single page app."),(0,i.kt)("h3",{id:"finished-state"},"Finished state"),(0,i.kt)("p",null,"All ads have been successfully loaded."),(0,i.kt)("h3",{id:"error-state"},"Error state"),(0,i.kt)("p",null,"An error occurred while were being loaded."),(0,i.kt)("h2",{id:"interfaces"},"Interfaces"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigurable"},"IConfigurable")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigured"},"IConfigured")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IError"},"IError")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IFinished"},"IFinished")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IHooks"},"IHooks")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IRequestAds"},"IRequestAds")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.ISinglePageApp"},"ISinglePageApp")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IState"},"IState"))),(0,i.kt)("h2",{id:"type-aliases"},"Type Aliases"),(0,i.kt)("h3",{id:"afterrequestadsstates"},"AfterRequestAdsStates"),(0,i.kt)("p",null,"\u01ac ",(0,i.kt)("strong",{parentName:"p"},"AfterRequestAdsStates"),": ",(0,i.kt)("inlineCode",{parentName:"p"},"Extract"),"<",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/namespaces/Moli.state#states"},(0,i.kt)("inlineCode",{parentName:"a"},"States")),", ",(0,i.kt)("inlineCode",{parentName:"p"},'"finished"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"error"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"spa-finished"'),">"),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"beforerequestadshook"},"BeforeRequestAdsHook"),(0,i.kt)("p",null,"\u01ac ",(0,i.kt)("strong",{parentName:"p"},"BeforeRequestAdsHook"),": (",(0,i.kt)("inlineCode",{parentName:"p"},"config"),": ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.MoliConfig"},(0,i.kt)("inlineCode",{parentName:"a"},"MoliConfig")),") => ",(0,i.kt)("inlineCode",{parentName:"p"},"void")),(0,i.kt)("h4",{id:"type-declaration"},"Type declaration"),(0,i.kt)("p",null,"\u25b8 (",(0,i.kt)("inlineCode",{parentName:"p"},"config"),"): ",(0,i.kt)("inlineCode",{parentName:"p"},"void")),(0,i.kt)("p",null,"Callback function executed before ads are being requested.\nDOM is ready at this point."),(0,i.kt)("h5",{id:"parameters"},"Parameters"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Type"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"config")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"/moli-ad-tag/docs/api/interfaces/Moli.MoliConfig"},(0,i.kt)("inlineCode",{parentName:"a"},"MoliConfig")))))),(0,i.kt)("h5",{id:"returns"},"Returns"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"void")),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"irefreshinfiniteslot"},"IRefreshInfiniteSlot"),(0,i.kt)("p",null,"\u01ac ",(0,i.kt)("strong",{parentName:"p"},"IRefreshInfiniteSlot"),": ",(0,i.kt)("inlineCode",{parentName:"p"},"Object")),(0,i.kt)("p",null,"Models ",(0,i.kt)("inlineCode",{parentName:"p"},"refreshInifiniteAdSlot")," calls before ads are being requested"),(0,i.kt)("h4",{id:"type-declaration-1"},"Type declaration"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"artificialDomId")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:"left"},"the newly created domID by the infinite slot loading behaviour. This ID can be used to reference the ad slot in the config in the ad pipeline context config.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"idOfConfiguredSlot")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:"left"},"the domID that references the slot configuration in the original config.")))),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"istatemachine"},"IStateMachine"),(0,i.kt)("p",null,"\u01ac ",(0,i.kt)("strong",{parentName:"p"},"IStateMachine"),": ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigurable"},(0,i.kt)("inlineCode",{parentName:"a"},"IConfigurable"))," ","|"," ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IConfigured"},(0,i.kt)("inlineCode",{parentName:"a"},"IConfigured"))," ","|"," ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.ISinglePageApp"},(0,i.kt)("inlineCode",{parentName:"a"},"ISinglePageApp"))," ","|"," ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IRequestAds"},(0,i.kt)("inlineCode",{parentName:"a"},"IRequestAds"))," ","|"," ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IFinished"},(0,i.kt)("inlineCode",{parentName:"a"},"IFinished"))," ","|"," ",(0,i.kt)("a",{parentName:"p",href:"/moli-ad-tag/docs/api/interfaces/Moli.state.IError"},(0,i.kt)("inlineCode",{parentName:"a"},"IError"))),(0,i.kt)("p",null,"All valid states"),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"states"},"States"),(0,i.kt)("p",null,"\u01ac ",(0,i.kt)("strong",{parentName:"p"},"States"),": ",(0,i.kt)("inlineCode",{parentName:"p"},'"configurable"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"configured"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"spa-finished"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"spa-requestAds"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"requestAds"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"finished"')," ","|"," ",(0,i.kt)("inlineCode",{parentName:"p"},'"error"')))}u.isMDXComponent=!0}}]);