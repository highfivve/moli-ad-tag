"use strict";(self.webpackChunkthe_publisher_ad_tag=self.webpackChunkthe_publisher_ad_tag||[]).push([[6437],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return m}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=d(a),m=i,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||r;return a?n.createElement(h,l(l({ref:t},p),{},{components:a})):n.createElement(h,l({ref:t},p))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var d=2;d<r;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},6591:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return p},default:function(){return c}});var n=a(7462),i=a(3366),r=(a(7294),a(3905)),l=["components"],o={id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},s=void 0,d={unversionedId:"api/namespaces/Moli.state",id:"api/namespaces/Moli.state",isDocsHomePage:!1,title:"Namespace: state",description:"Moli.state",source:"@site/docs/api/namespaces/Moli.state.md",sourceDirName:"api/namespaces",slug:"/api/namespaces/Moli.state",permalink:"/docs/api/namespaces/Moli.state",editUrl:null,tags:[],version:"current",frontMatter:{id:"Moli.state",title:"Namespace: state",sidebar_label:"state",custom_edit_url:null},sidebar:"API",previous:{title:"reporting",permalink:"/docs/api/namespaces/Moli.reporting"},next:{title:"yield_optimization",permalink:"/docs/api/namespaces/Moli.yield_optimization"}},p=[{value:"State transitions",id:"state-transitions",children:[{value:"Configurable state",id:"configurable-state",children:[]},{value:"Configured state",id:"configured-state",children:[]},{value:"RequestAds state",id:"requestads-state",children:[]},{value:"Single Page App state",id:"single-page-app-state",children:[]},{value:"Finished state",id:"finished-state",children:[]},{value:"Error state",id:"error-state",children:[]}]},{value:"Interfaces",id:"interfaces",children:[]},{value:"Type aliases",id:"type-aliases",children:[{value:"AfterRequestAdsStates",id:"afterrequestadsstates",children:[]},{value:"IStateMachine",id:"istatemachine",children:[]},{value:"States",id:"states",children:[]}]}],u={toc:p};function c(e){var t=e.components,a=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"Moli"},"Moli"),".state"),(0,r.kt)("h2",{id:"state-transitions"},"State transitions"),(0,r.kt)("p",null,"The state machine is defined as:"),(0,r.kt)("pre",{style:"font-size:10px;"},"setXYZ / addXYZ requestAds() +----------+ |          | |          | |          v | +------------+     requestAds()     +-----+-------------------------+ |            |                      |                               | | configured |  +----------------\x3e  | Single Page App               | |            |                      | spa-requestAds / spa-finished | +------------+                      +-------------------------------+ ^ | |  enableSinglePageApp() |                                        ads ok        +----------+ |                                                      |          | |                                     +------------\x3e   | finished | +                                     |                |          | |                +----------+ +--------------+    configure(config)   +------------+      requestAds()     +------+-----+ |              |                        |            |                       |            | | configurable |  +-------------------\x3e | configured |  +-----------------\x3e  | requestAds | |              |                        |            |                       |            | +--------------+                        +------------+                       +------+-----+ |                +----------+ +         ^                            +         ^                                |                |          | |         |                            |         |                                +-------------\x3e  | error    | +  setXYZ +                            +  setXYZ +                                                 |          | addXYZ                                 addXYZ                                     ads not ok    +----------+"),(0,r.kt)("p",null,"Each state has allowed operations and transitions"),(0,r.kt)("h3",{id:"configurable-state"},"Configurable state"),(0,r.kt)("p",null,"In this state the ad tag can be customized. All ",(0,r.kt)("inlineCode",{parentName:"p"},"getXYZ")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"addXYZ")," methods\ncan be called."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"addXYZ")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configurable -> configurable")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setXYZ")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configurable -> configurable")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"configure")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configurable ->  configured"),"\nSets the main configuration. Changes can still be made."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requestAds")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configurable -> configurable"),"\nAfter ",(0,r.kt)("inlineCode",{parentName:"li"},"moli.configure")," has been called, ads will be requested immediately.")),(0,r.kt)("h3",{id:"configured-state"},"Configured state"),(0,r.kt)("p",null,"The main ad configuration has been set. ",(0,r.kt)("inlineCode",{parentName:"p"},"moli.getConfig")," now returns the current\nconfiguration."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"addXYZ")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configured -> configured")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setXYZ")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configured -> configured")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requestAds")," - with transition ",(0,r.kt)("inlineCode",{parentName:"li"},"configured -> requestAds"),".\nNo changes are allowed anymore")),(0,r.kt)("h3",{id:"requestads-state"},"RequestAds state"),(0,r.kt)("p",null,"No changes are allowed anymore. The configuration is frozen. All ",(0,r.kt)("inlineCode",{parentName:"p"},"addXYZ")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setXYZ"),"\ncalls will fail."),(0,r.kt)("p",null,"Two state transitions will happen:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"After all ads have been loaded successfully: ",(0,r.kt)("inlineCode",{parentName:"li"},"requestAds -> finished")),(0,r.kt)("li",{parentName:"ol"},"After an error during ad loading: ",(0,r.kt)("inlineCode",{parentName:"li"},"requestAds -> error"))),(0,r.kt)("h3",{id:"single-page-app-state"},"Single Page App state"),(0,r.kt)("p",null,"In this state the ad tag allows to call ",(0,r.kt)("inlineCode",{parentName:"p"},"requestAds()")," multiple times. The ad tag state will\nremain ",(0,r.kt)("inlineCode",{parentName:"p"},"spa")," if there are no errors. Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"requestAds()")," call is only allowed if the\n",(0,r.kt)("inlineCode",{parentName:"p"},"window.location.href")," has changed. This is a saftey guard against unwanted ad fraud behaviour."),(0,r.kt)("p",null,"KeyValues and Labels are handled depending on their source:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"keyValues and labels from the static configuration shipped with the ad tag persist."),(0,r.kt)("li",{parentName:"ul"},"keyValues and labels configured via ",(0,r.kt)("inlineCode",{parentName:"li"},"setTargeting(...)")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"addLabel(...)")," are only valid\nfor the next ",(0,r.kt)("inlineCode",{parentName:"li"},"requestAds()")," call and will be cleaned afterwards.")),(0,r.kt)("p",null,"Supported loading behaviours are ",(0,r.kt)("inlineCode",{parentName:"p"},"eager")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"lazy-refreshable"),". You should use ",(0,r.kt)("inlineCode",{parentName:"p"},"lazy refreshable"),"\nfor slots that are part of a component that is rendered after the dom is ready."),(0,r.kt)("h4",{id:"integration"},"Integration"),(0,r.kt)("p",null,"Single page applications are quite more complex than purely server-side-rendered websites. We have\na set of APIs at our disposal to deal with that."),(0,r.kt)("p",null,"There are a three slot configurations we need to handle"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"slots that are ",(0,r.kt)("strong",{parentName:"li"},"server-side rendered")," and never removed. Examples for this are header area slots\nthat are part of the generic page layout that does not change on any page.\n",(0,r.kt)("em",{parentName:"li"},"Configuration:")," Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"eager")," loading behaviour."),(0,r.kt)("li",{parentName:"ol"},"slots that are ",(0,r.kt)("strong",{parentName:"li"},"server-side rendered"),", but may dis- and reappear in the spa context.\n",(0,r.kt)("em",{parentName:"li"},"Configuration:")," Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"lazy refreshable")," loading behaviour."),(0,r.kt)("li",{parentName:"ol"},"slots that are rendered by the SPA.\n",(0,r.kt)("em",{parentName:"li"},"Configuration:")," Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"lazy refreshable")," loading behaviour.")),(0,r.kt)("p",null,"Eager slots (configuration 1) don't need any special handling as the DOM element is present when the\nsite is being delivered and everything works as if it weren't a single page app."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"lazy refreshable")," slots need a deeper integration. Conceptually the necessary calls look like this"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Initial page load",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"configure moli anywhere you want. Call ",(0,r.kt)("inlineCode",{parentName:"li"},"moli.requestAds()")),(0,r.kt)("li",{parentName:"ol"},"the component did mount in the DOM. Then fire the event that the refreshable slot can be loaded"))),(0,r.kt)("li",{parentName:"ol"},"Page navigation",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"after navigation change call ",(0,r.kt)("inlineCode",{parentName:"li"},"moli.requestAds()")),(0,r.kt)("li",{parentName:"ol"},"the component did mount in the DOM. Then fire the event that the refreshable slot can be loaded")))),(0,r.kt)("p",null,"While this is the sequential order we want things to be executed, this isn't the case in reality. Mounting\nin the DOM can appear before the ",(0,r.kt)("inlineCode",{parentName:"p"},"requestAds()")," call has succesfully configured all event listeners, leading\nto events not being received and ads not being shown."),(0,r.kt)("p",null,"We will provide a few examples on how to solve this in major SPA frameworks."),(0,r.kt)("h5",{id:"react-example"},"React Example"),(0,r.kt)("p",null,"Dependencies"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://reactjs.org/"},"react")," as SPA framework"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://reacttraining.com/react-router/web/guides/quick-start"},"react-router")," for routing"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/ReactTraining/history"},"history")," for browser history management")),(0,r.kt)("p",null,"The idea:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Provide a ",(0,r.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/context.html"},"React Context"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"RequestAdsContext"),", that contains a\nflag if requestAds has already finished"),(0,r.kt)("li",{parentName:"ul"},"use the ",(0,r.kt)("inlineCode",{parentName:"li"},"history.listen")," method to ",(0,r.kt)("inlineCode",{parentName:"li"},"requestAds()")," on navigation changes and update the ",(0,r.kt)("inlineCode",{parentName:"li"},"RequestAdsContext")),(0,r.kt)("li",{parentName:"ul"},"use the ",(0,r.kt)("inlineCode",{parentName:"li"},"moli.afterRequestAds(hook)")," hook to react when the ad tag has configured everything and update the ",(0,r.kt)("inlineCode",{parentName:"li"},"RequestAdsContext")),(0,r.kt)("li",{parentName:"ul"},"managed the trigger event firing in each component")),(0,r.kt)("p",null,"If you need example source code, just ask :)"),(0,r.kt)("h3",{id:"finished-state"},"Finished state"),(0,r.kt)("p",null,"All ads have been successfully loaded."),(0,r.kt)("h3",{id:"error-state"},"Error state"),(0,r.kt)("p",null,"An error occurred while were being loaded."),(0,r.kt)("h2",{id:"interfaces"},"Interfaces"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IConfigurable"},"IConfigurable")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IConfigured"},"IConfigured")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IError"},"IError")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IFinished"},"IFinished")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IHooks"},"IHooks")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IRequestAds"},"IRequestAds")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.ISinglePageApp"},"ISinglePageApp")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../interfaces/Moli.state.IState"},"IState"))),(0,r.kt)("h2",{id:"type-aliases"},"Type aliases"),(0,r.kt)("h3",{id:"afterrequestadsstates"},"AfterRequestAdsStates"),(0,r.kt)("p",null,"\u01ac ",(0,r.kt)("strong",{parentName:"p"},"AfterRequestAdsStates"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"Extract"),"<",(0,r.kt)("a",{parentName:"p",href:"Moli.state#states"},(0,r.kt)("inlineCode",{parentName:"a"},"States")),", ",(0,r.kt)("inlineCode",{parentName:"p"},'"finished"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"error"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"spa-finished"'),">"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"istatemachine"},"IStateMachine"),(0,r.kt)("p",null,"\u01ac ",(0,r.kt)("strong",{parentName:"p"},"IStateMachine"),": ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.IConfigurable"},(0,r.kt)("inlineCode",{parentName:"a"},"IConfigurable"))," ","|"," ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.IConfigured"},(0,r.kt)("inlineCode",{parentName:"a"},"IConfigured"))," ","|"," ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.ISinglePageApp"},(0,r.kt)("inlineCode",{parentName:"a"},"ISinglePageApp"))," ","|"," ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.IRequestAds"},(0,r.kt)("inlineCode",{parentName:"a"},"IRequestAds"))," ","|"," ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.IFinished"},(0,r.kt)("inlineCode",{parentName:"a"},"IFinished"))," ","|"," ",(0,r.kt)("a",{parentName:"p",href:"../interfaces/Moli.state.IError"},(0,r.kt)("inlineCode",{parentName:"a"},"IError"))),(0,r.kt)("p",null,"All valid states"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"states"},"States"),(0,r.kt)("p",null,"\u01ac ",(0,r.kt)("strong",{parentName:"p"},"States"),": ",(0,r.kt)("inlineCode",{parentName:"p"},'"configurable"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"configured"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"spa-finished"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"spa-requestAds"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"requestAds"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"finished"')," ","|"," ",(0,r.kt)("inlineCode",{parentName:"p"},'"error"')))}c.isMDXComponent=!0}}]);